#define __COMPILE_0
#define __COMPILE_1
#define __COMPILE_2
#define __COMPILE_3
#define __COMPILE_4
#define __COMPILE_5
#define __COMPILE_6
#define __COMPILE_7
#define __COMPILE_8
#define __COMPILE_9
#define __COMPILE_10
#define __COMPILE_11
#define __COMPILE_12
#define __COMPILE_13
#define __COMPILE_14
#define __COMPILE_15
#define __COMPILE_16
#define __COMPILE_17
#define __COMPILE_18
#define __COMPILE_19
#define __COMPILE_20
#define __COMPILE_21
#define __COMPILE_22
#define __COMPILE_23
#define __COMPILE_24
#define __COMPILE_25
#define __COMPILE_28
#define __COMPILE_29
#define __COMPILE_30
#define __COMPILE_31
#define __COMPILE_32
#define __COMPILE_33
#define __COMPILE_34
#define __COMPILE_35
#define __COMPILE_36
#define __COMPILE_37
#define __COMPILE_38
#define __COMPILE_39
#define __COMPILE_40
#define __COMPILE_41
#define __COMPILE_42
#define __COMPILE_43
#define __COMPILE_44
#define __COMPILE_45
#define __COMPILE_46
#define __COMPILE_47
#define __COMPILE_48
#define __COMPILE_49
#define __COMPILE_50
#define __COMPILE_51
#define __COMPILE_52
#define __COMPILE_53
#define __COMPILE_54
#define __COMPILE_55
#define __COMPILE_56
#define __COMPILE_57
#define __COMPILE_58
#define __COMPILE_59
#define __COMPILE_80
#define __COMPILE_81
#define __COMPILE_82
#define __COMPILE_83
#define __COMPILE_84
#define __COMPILE_85
#define __COMPILE_86
#define __COMPILE_87
#define __COMPILE_88
#define __COMPILE_89
#define __COMPILE_90
#define __COMPILE_91
#define __COMPILE_92
#define __COMPILE_93
#define __COMPILE_94
#define __COMPILE_95
#define __COMPILE_96
#define __COMPILE_97
#define __COMPILE_98
#define __COMPILE_99
#define __COMPILE_100
#define __COMPILE_101
#define __COMPILE_102
#define __COMPILE_103
#define __COMPILE_104
#define __COMPILE_105
#define __COMPILE_106
#define __COMPILE_107
#define __COMPILE_108
#define __COMPILE_109
#define __COMPILE_110
#define __COMPILE_111
#define __COMPILE_112
#define __COMPILE_113
#define __COMPILE_114
#define __COMPILE_115
#define __COMPILE_116
#define __COMPILE_117
#define __COMPILE_118
#define __COMPILE_119
#define __COMPILE_120
#define __COMPILE_121
#define __COMPILE_122
#define __COMPILE_123
#define __COMPILE_124
#define __COMPILE_125
#define __COMPILE_126
#define __COMPILE_127
#define __COMPILE_128
#define __COMPILE_129
#define __COMPILE_130
#define __COMPILE_131
#define __COMPILE_132
#define __COMPILE_133
#define __COMPILE_134
#define __COMPILE_137
#define __COMPILE_138
#define __COMPILE_139
#define __COMPILE_150
#define __COMPILE_151
#define __COMPILE_152
#define __COMPILE_153
#define __COMPILE_154
#define __COMPILE_155
#define __COMPILE_156
#define __COMPILE_157
#define __COMPILE_158
#define __COMPILE_159
#define __COMPILE_160
#define __COMPILE_161
#define __COMPILE_162
#define __COMPILE_163
#define __COMPILE_164
#define __COMPILE_165
#define __COMPILE_166
#define __COMPILE_167
#define __COMPILE_168
#define __COMPILE_169
#define __COMPILE_170
#define __COMPILE_171
#define __COMPILE_172
#define __COMPILE_173
#define __COMPILE_174
#define __COMPILE_175
#define __COMPILE_176
#define __COMPILE_177
#define __COMPILE_178
#define __COMPILE_179
#define __COMPILE_180
#define __COMPILE_181
#define __COMPILE_182
#define __COMPILE_183
#define __COMPILE_184
#define __COMPILE_185
#define __COMPILE_186
#define __COMPILE_187
#define __COMPILE_188
#define __COMPILE_189
#define __COMPILE_190
#define __COMPILE_191
#define __COMPILE_192
#define __COMPILE_193
#define __COMPILE_194
#define __COMPILE_195
#define __COMPILE_196
#define __COMPILE_197
#define __COMPILE_198
#define __COMPILE_199
#define __COMPILE_200
#define __COMPILE_201
#define __COMPILE_202
#define __COMPILE_203
#define __COMPILE_204
#define __COMPILE_205
#define __COMPILE_206
#define __COMPILE_207
#define __COMPILE_208
#define __COMPILE_209
#define __COMPILE_210
#define __COMPILE_211
#define __COMPILE_212
#define __COMPILE_213
#define __COMPILE_214
#define __COMPILE_215
#define __COMPILE_216
#define __COMPILE_217
#define __COMPILE_218
#define __COMPILE_219
#define __COMPILE_220
#define __COMPILE_221
#define __COMPILE_222
#define __COMPILE_223
#define __COMPILE_224
#define __COMPILE_225
#define __COMPILE_226
#define __COMPILE_227
#define __COMPILE_228
#define __COMPILE_229
#define __COMPILE_230
#define __COMPILE_231
#define __COMPILE_232
#define __COMPILE_233
#define __COMPILE_234
#define __COMPILE_235
#define __COMPILE_236
#define __COMPILE_237
#define __COMPILE_238
#define __COMPILE_239
#define __COMPILE_240
#define __COMPILE_241
#define __COMPILE_242
#define __COMPILE_243
#define __COMPILE_244
#define __COMPILE_245
#define __COMPILE_246
#define __COMPILE_247
#define __COMPILE_248
#define __COMPILE_249
#define __COMPILE_250
#define __COMPILE_251
#define __COMPILE_252
#define __COMPILE_253
#define __COMPILE_254
#define __COMPILE_255
#define __COMPILE_256
#define __COMPILE_257
#define __COMPILE_258
#define __COMPILE_259
#define __COMPILE_260
#define __COMPILE_261
#define __COMPILE_262
#define __COMPILE_263
#define __COMPILE_264
#define __COMPILE_265
#define __COMPILE_266
#define __COMPILE_267
#define __COMPILE_268
#define __COMPILE_269
#define __COMPILE_270
#define __COMPILE_271
#define __COMPILE_272
#define __COMPILE_273
#define __COMPILE_274
#define __COMPILE_275
#define __COMPILE_276
#define __COMPILE_277
#define __COMPILE_278
#define __COMPILE_279
#define __COMPILE_280
#define __COMPILE_281
#define __COMPILE_282
#define __COMPILE_283
#define __COMPILE_284
#define __COMPILE_285
#define __COMPILE_286
#define __COMPILE_287
#define __COMPILE_288
#define __COMPILE_289
#define __COMPILE_290
#define __COMPILE_291
#define __COMPILE_292
#define __COMPILE_293
#define __COMPILE_294
#define __COMPILE_295
#define __COMPILE_296
#define __COMPILE_297
#define __COMPILE_298
#define __COMPILE_299
#define __COMPILE_300
#define __COMPILE_301
#define __COMPILE_302
#define __COMPILE_303
#define __COMPILE_304
#define __COMPILE_305
#define __COMPILE_306
#define __COMPILE_307
#define __COMPILE_308
#define __COMPILE_309
#define __COMPILE_310
#define __COMPILE_311
#define __COMPILE_312
#define __COMPILE_313
#define __COMPILE_314
#define __COMPILE_315
#define __COMPILE_316
#define __COMPILE_317
#define __COMPILE_318
#define __COMPILE_319
#define __COMPILE_320
#define __COMPILE_321
#define __COMPILE_322
#define __COMPILE_323
#define __COMPILE_324
#define __COMPILE_325
#define __COMPILE_326
#define __COMPILE_327
#define __COMPILE_328
#define __COMPILE_329
#define __COMPILE_330
#define __COMPILE_331
#define __COMPILE_332
#define __COMPILE_333
#define __COMPILE_334
#define __COMPILE_335
#define __COMPILE_336
#define __COMPILE_337
#define __COMPILE_338
#define __COMPILE_341
#define __COMPILE_342
#define __COMPILE_343
#define __COMPILE_344
#define __COMPILE_345
#define __COMPILE_346
#define __COMPILE_347
#define __COMPILE_348
#define __COMPILE_349
#define __COMPILE_350
#define __COMPILE_351
#define __COMPILE_352
#define __COMPILE_353
#define __COMPILE_354
#define __COMPILE_355
#define __COMPILE_356
#define __COMPILE_357
#define __COMPILE_358
#define __COMPILE_359
#define __COMPILE_360
#define __COMPILE_361
#define __COMPILE_362
#define __COMPILE_363
#define __COMPILE_364
#define __COMPILE_365
#define __COMPILE_366
#define __COMPILE_367
#define __COMPILE_368
#define __COMPILE_369
#define __COMPILE_370
#define __COMPILE_371
#define __COMPILE_372
#define __COMPILE_393
#define __COMPILE_394
#define __COMPILE_395
#define __COMPILE_396
#define __COMPILE_397
#define __COMPILE_398
#define __COMPILE_399
#define __COMPILE_400
#define __COMPILE_401
#define __COMPILE_402
#define __COMPILE_403
#define __COMPILE_404
#define __COMPILE_405
#define __COMPILE_406
#define __COMPILE_407
#define __COMPILE_408
#define __COMPILE_409
#define __COMPILE_410
#define __COMPILE_411
#define __COMPILE_412
#define __COMPILE_413
#define __COMPILE_414
#define __COMPILE_415
#define __COMPILE_416
#define __COMPILE_417
#define __COMPILE_418
#define __COMPILE_419
#define __COMPILE_420
#define __COMPILE_421
#define __COMPILE_422
#define __COMPILE_423
#define __COMPILE_424
#define __COMPILE_425
#define __COMPILE_426
#define __COMPILE_427
#define __COMPILE_428
#define __COMPILE_429
#define __COMPILE_430
#define __COMPILE_431
#define __COMPILE_432
#define __COMPILE_433
#define __COMPILE_434
#define __COMPILE_435
#define __COMPILE_436
#define __COMPILE_437
#define __COMPILE_438
#define __COMPILE_439
#define __COMPILE_440
#define __COMPILE_441
#define __COMPILE_442
#define __COMPILE_443
#define __COMPILE_444
#define __COMPILE_445
#define __COMPILE_446
#define __COMPILE_447
#define __COMPILE_450
#define __COMPILE_451
#define __COMPILE_452
#define __COMPILE_463
#define __COMPILE_464
#define __COMPILE_465
#define __COMPILE_466
#define __COMPILE_467
#define __COMPILE_468
#define __COMPILE_469
#define __COMPILE_470
#define __COMPILE_471
#define __COMPILE_472
#define __COMPILE_473
#define __COMPILE_474
#define __COMPILE_475
#define __COMPILE_476
#define __COMPILE_477
#define __COMPILE_478
#define __COMPILE_479
#define __COMPILE_480
#define __COMPILE_481
#define __COMPILE_482
#define __COMPILE_483
#define __COMPILE_484
#define __COMPILE_485
#define __COMPILE_486
#define __COMPILE_487
#define __COMPILE_488
#define __COMPILE_489
#define __COMPILE_490
#define __COMPILE_491
#define __COMPILE_492
#define __COMPILE_493
#define __COMPILE_494
#define __COMPILE_495
#define __COMPILE_496
#define __COMPILE_497
#define __COMPILE_498
#define __COMPILE_499
// compile_fin
int __get_mutant(); int __is_neg(const char *location,char *lid,int count, ...); int __abst_hole(); char *__stat_write_init(const char *func_name);void __write_stat(char *str,const char *var_name,void *var_addr,int size); void __stat_file_close(const char *func_name,char *str);long long __mutate(const long long,const char *,const char *); int __trident_choice(char* lid, char* typestr,int* rvals, char** rvals_ids, int rvals_size,int** lvals, char** lvals_ids, int lvals_size);int __trident_output(char* id, char* typestr, int value);float fabs_trident(float a);int __choose(const char *);void *__var_select(unsigned int var_count,void *vars[]);void *__var_select_2(unsigned int var_count,void *vars[]);long long __const_select(unsigned int const_count, ...);void* memset(void*, int, unsigned long); 
/*
   +----------------------------------------------------------------------+
   | PHP Version 5                                                        |
   +----------------------------------------------------------------------+
   | Copyright (c) 1997-2011 The PHP Group                                |
   +----------------------------------------------------------------------+
   | This source file is subject to version 3.01 of the PHP license,      |
   | that is bundled with this package in the file LICENSE, and is        |
   | available through the world-wide-web at the following url:           |
   | http://www.php.net/license/3_01.txt                                  |
   | If you did not receive a copy of the PHP license and are unable to   |
   | obtain it through the world-wide-web, please send a note to          |
   | license@php.net so we can mail you a copy immediately.               |
   +----------------------------------------------------------------------+
   | Author: Marcus Boerger <helly@php.net>                               |
   +----------------------------------------------------------------------+
 */

/* $Id$ */

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif

#include "php.h"
#include "php_ini.h"
#include "ext/standard/info.h"
#include "ext/standard/file.h"
#include "ext/standard/php_string.h"
#include "zend_compile.h"
#include "zend_exceptions.h"
#include "zend_interfaces.h"

#include "php_spl.h"
#include "spl_functions.h"
#include "spl_engine.h"
#include "spl_iterators.h"
#include "spl_directory.h"
#include "spl_exceptions.h"

#include "php.h"
#include "fopen_wrappers.h"

#include "ext/standard/basic_functions.h"
#include "ext/standard/php_filestat.h"

#define SPL_HAS_FLAG(flags, test_flag) ((flags & test_flag) ? 1 : 0)

/* declare the class handlers */
static zend_object_handlers spl_filesystem_object_handlers;

/* decalre the class entry */
PHPAPI zend_class_entry *spl_ce_SplFileInfo;
PHPAPI zend_class_entry *spl_ce_DirectoryIterator;
PHPAPI zend_class_entry *spl_ce_FilesystemIterator;
PHPAPI zend_class_entry *spl_ce_RecursiveDirectoryIterator;
PHPAPI zend_class_entry *spl_ce_GlobIterator;
PHPAPI zend_class_entry *spl_ce_SplFileObject;
PHPAPI zend_class_entry *spl_ce_SplTempFileObject;

static void spl_filesystem_file_free_line(spl_filesystem_object *intern TSRMLS_DC) /* {{{ */
{
	if (intern->u.file.current_line) {
		efree(intern->u.file.current_line);
		intern->u.file.current_line = NULL;
	}
	if (intern->u.file.current_zval) {
		zval_ptr_dtor(&intern->u.file.current_zval);
		intern->u.file.current_zval = NULL;
	}
} /* }}} */

static void spl_filesystem_object_free_storage(void *object TSRMLS_DC) /* {{{ */
{
	spl_filesystem_object *intern = (spl_filesystem_object*)object;

	if (intern->oth_handler && intern->oth_handler->dtor) {
		intern->oth_handler->dtor(intern TSRMLS_CC);
	}
	
	zend_object_std_dtor(&intern->std TSRMLS_CC);
	
	if (intern->_path) {
		efree(intern->_path);
	}
	if (intern->file_name) {
		efree(intern->file_name);
	}
	switch(intern->type) {
	case SPL_FS_INFO:
		break;
	case SPL_FS_DIR:
		if (intern->u.dir.dirp) {
			php_stream_close(intern->u.dir.dirp);
			intern->u.dir.dirp = NULL;
		}
		if (intern->u.dir.sub_path) {
			efree(intern->u.dir.sub_path);
		}		
		break;
	case SPL_FS_FILE:
		if (intern->u.file.stream) {
			if (intern->u.file.zcontext) {
/*				zend_list_delref(Z_RESVAL_P(intern->zcontext));*/
			}
			if (!intern->u.file.stream->is_persistent) {
				php_stream_free(intern->u.file.stream, PHP_STREAM_FREE_CLOSE);
			} else {
				php_stream_free(intern->u.file.stream, PHP_STREAM_FREE_CLOSE_PERSISTENT);
			}
			if (intern->u.file.open_mode) {
				efree(intern->u.file.open_mode);
			}
			if (intern->orig_path) {
				efree(intern->orig_path);
			}
		}
		spl_filesystem_file_free_line(intern TSRMLS_CC);
		break;
	}
	efree(object);
} /* }}} */

/* {{{ spl_ce_dir_object_new */
/* creates the object by 
   - allocating memory 
   - initializing the object members
   - storing the object
   - setting it's handlers

   called from 
   - clone
   - new
 */
static zend_object_value spl_filesystem_object_new_ex(zend_class_entry *class_type, spl_filesystem_object **obj TSRMLS_DC)
{
	zend_object_value retval;
	spl_filesystem_object *intern;

	intern = emalloc(sizeof(spl_filesystem_object));
	memset(intern, 0, sizeof(spl_filesystem_object));
	/* intern->type = SPL_FS_INFO; done by set 0 */
	intern->file_class = spl_ce_SplFileObject;
	intern->info_class = spl_ce_SplFileInfo;
	if (obj) *obj = intern;

	zend_object_std_init(&intern->std, class_type TSRMLS_CC);
	object_properties_init(&intern->std, class_type);

	retval.handle = zend_objects_store_put(intern, (zend_objects_store_dtor_t) zend_objects_destroy_object, (zend_objects_free_object_storage_t) spl_filesystem_object_free_storage, NULL TSRMLS_CC);
	retval.handlers = &spl_filesystem_object_handlers;
	return retval;
}
/* }}} */

/* {{{ spl_filesystem_object_new */
/* See spl_filesystem_object_new_ex */
static zend_object_value spl_filesystem_object_new(zend_class_entry *class_type TSRMLS_DC)
{
	return spl_filesystem_object_new_ex(class_type, NULL TSRMLS_CC);
}
/* }}} */

PHPAPI char* spl_filesystem_object_get_path(spl_filesystem_object *intern, int *len TSRMLS_DC) /* {{{ */
{
#ifdef HAVE_GLOB
	if (intern->type == SPL_FS_DIR) {
		if (php_stream_is(intern->u.dir.dirp ,&php_glob_stream_ops)) {
			return php_glob_stream_get_path(intern->u.dir.dirp, 0, len);
		}
	}
#endif
	if (len) {
		*len = intern->_path_len;
	}
	return intern->_path;
} /* }}} */

static inline void spl_filesystem_object_get_file_name(spl_filesystem_object *intern TSRMLS_DC) /* {{{ */
{
	char slash = SPL_HAS_FLAG(intern->flags, SPL_FILE_DIR_UNIXPATHS) ? '/' : DEFAULT_SLASH;

	if (!intern->file_name) {
		switch (intern->type) {
		case SPL_FS_INFO:
		case SPL_FS_FILE:
			php_error_docref(NULL TSRMLS_CC, E_ERROR, "Object not initialized");
			break;
		case SPL_FS_DIR:
			intern->file_name_len = spprintf(&intern->file_name, 0, "%s%c%s",
			                                 spl_filesystem_object_get_path(intern, NULL TSRMLS_CC),
			                                 slash, intern->u.dir.entry.d_name);
			break;
		}
	}
} /* }}} */

static int spl_filesystem_dir_read(spl_filesystem_object *intern TSRMLS_DC) /* {{{ */
{
	if (!intern->u.dir.dirp || !php_stream_readdir(intern->u.dir.dirp, &intern->u.dir.entry)) {
		intern->u.dir.entry.d_name[0] = '\0';
		return 0;
	} else {
		return 1;
	}
}
/* }}} */

#define IS_SLASH_AT(zs, pos) (IS_SLASH(zs[pos]))

static inline int spl_filesystem_is_dot(const char * d_name) /* {{{ */
{
	return !strcmp(d_name, ".") || !strcmp(d_name, "..");
}
/* }}} */

/* {{{ spl_filesystem_dir_open */
/* open a directory resource */
static void spl_filesystem_dir_open(spl_filesystem_object* intern, char *path TSRMLS_DC)
{
	int skip_dots = SPL_HAS_FLAG(intern->flags, SPL_FILE_DIR_SKIPDOTS);

	intern->type = SPL_FS_DIR;
	intern->_path_len = strlen(path);
	intern->u.dir.dirp = php_stream_opendir(path, REPORT_ERRORS, NULL);

	if (intern->_path_len > 1 && IS_SLASH_AT(path, intern->_path_len-1)) {
		intern->_path = estrndup(path, --intern->_path_len);
	} else {
		intern->_path = estrndup(path, intern->_path_len);
	}
	intern->u.dir.index = 0;

	//prophet generated patch
	{
	int __choose0 = __choose("__SWITCH0");
	if (__choose0 == 0)
	{}
	#ifdef __COMPILE_0
	else if (__choose0 == 1)
	{
	//AddIfStmtKind
	if (intern->_path_len > 1 && (((path[intern->_path_len - 1]) == '/'))) {
	    intern->_path = _estrndup((path), (--intern->_path_len));
	} else {
	    intern->_path = _estrndup((path), (intern->_path_len));
	}
	}
	#endif
	#ifdef __COMPILE_1
	else if (__choose0 == 2)
	{
	//AddStmtAndReplaceAtomKind
	(intern)->file_name_len--;
	}
	#endif
	#ifdef __COMPILE_2
	else if (__choose0 == 3)
	{
	//AddStmtAndReplaceAtomKind
	(intern)->u.dir.index++;
	}
	#endif
	#ifdef __COMPILE_3
	else if (__choose0 == 4)
	{
	//AddStmtAndReplaceAtomKind
	(intern)->u.file.current_line_num++;
	}
	#endif
	#ifdef __COMPILE_4
	else if (__choose0 == 5)
	{
	//AddStmtAndReplaceAtomKind
	(path)++;
	}
	#endif
	#ifdef __COMPILE_5
	else if (__choose0 == 6)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->_path));
	}
	#endif
	#ifdef __COMPILE_6
	else if (__choose0 == 7)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->file_name));
	}
	#endif
	#ifdef __COMPILE_7
	else if (__choose0 == 8)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->orig_path));
	}
	#endif
	#ifdef __COMPILE_8
	else if (__choose0 == 9)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->u.dir.sub_path));
	}
	#endif
	#ifdef __COMPILE_9
	else if (__choose0 == 10)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->u.file.current_line));
	}
	#endif
	#ifdef __COMPILE_10
	else if (__choose0 == 11)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->u.file.open_mode));
	}
	#endif
	#ifdef __COMPILE_11
	else if (__choose0 == 12)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((path)));
	}
	#endif
	#ifdef __COMPILE_12
	else if (__choose0 == 13)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_free(((intern)->u.dir.dirp), (1 | 2));
	}
	#endif
	#ifdef __COMPILE_13
	else if (__choose0 == 14)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_free(((intern)->u.file.stream), (((1 | 2) | 16)));
	}
	#endif
	#ifdef __COMPILE_14
	else if (__choose0 == 15)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_free(((intern)->u.file.stream), ((1 | 2)));
	}
	#endif
	#ifdef __COMPILE_15
	else if (__choose0 == 16)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_seek((((intern)->u.dir.dirp)), 0L, 0);
	}
	#endif
	#ifdef __COMPILE_16
	else if (__choose0 == 17)
	{
	//AddStmtAndReplaceAtomKind
	_zend_list_addref((*(intern)->u.file.zcontext).value.lval);
	}
	#endif
	#ifdef __COMPILE_17
	else if (__choose0 == 18)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor(((intern)->u.file.current_zval));
	}
	#endif
	#ifdef __COMPILE_18
	else if (__choose0 == 19)
	{
	//AddStmtAndReplaceAtomKind
	_zval_ptr_dtor((&(intern)->u.file.current_zval));
	}
	#endif
	#ifdef __COMPILE_19
	else if (__choose0 == 20)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = (path);
	}
	#endif
	#ifdef __COMPILE_20
	else if (__choose0 == 21)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup(((path)), (--intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_21
	else if (__choose0 == 22)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup(((path)), (intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_22
	else if (__choose0 == 23)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path && !(1 << 5)), (--intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_23
	else if (__choose0 == 24)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path && !(1 << 5)), (intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_24
	else if (__choose0 == 25)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), ((intern)->_path_len));
	}
	#endif
	#ifdef __COMPILE_25
	else if (__choose0 == 26)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), (--(intern)->_path_len));
	}
	#endif
	#ifdef __COMPILE_26
	else if (__choose0 == 27)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), (--intern && !(1 << 5)->_path_len));
	}
	#endif
	#ifdef __COMPILE_27
	else if (__choose0 == 28)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), (intern && !(1 << 5)->_path_len));
	}
	#endif
	#ifdef __COMPILE_28
	else if (__choose0 == 29)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (0);
	}
	#endif
	#ifdef __COMPILE_29
	else if (__choose0 == 30)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (1);
	}
	#endif
	#ifdef __COMPILE_30
	else if (__choose0 == 31)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (4096);
	}
	#endif
	#ifdef __COMPILE_31
	else if (__choose0 == 32)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (8);
	}
	#endif
	#ifdef __COMPILE_32
	else if (__choose0 == 33)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (skip_dots);
	}
	#endif
	#ifdef __COMPILE_33
	else if (__choose0 == 34)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = strlen((path));
	}
	#endif
	#ifdef __COMPILE_34
	else if (__choose0 == 35)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = strlen(path && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_35
	else if (__choose0 == 36)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (0);
	}
	#endif
	#ifdef __COMPILE_36
	else if (__choose0 == 37)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (1);
	}
	#endif
	#ifdef __COMPILE_37
	else if (__choose0 == 38)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (4096);
	}
	#endif
	#ifdef __COMPILE_38
	else if (__choose0 == 39)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (8);
	}
	#endif
	#ifdef __COMPILE_39
	else if (__choose0 == 40)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (SPL_FS_DIR);
	}
	#endif
	#ifdef __COMPILE_40
	else if (__choose0 == 41)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (SPL_FS_FILE);
	}
	#endif
	#ifdef __COMPILE_41
	else if (__choose0 == 42)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (SPL_FS_INFO);
	}
	#endif
	#ifdef __COMPILE_42
	else if (__choose0 == 43)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.dirp = _php_stream_opendir(((path)), (8), (((void *)0)));
	}
	#endif
	#ifdef __COMPILE_43
	else if (__choose0 == 44)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.dirp = _php_stream_opendir((path && !(1 << 5)), (8), (((void *)0)));
	}
	#endif
	#ifdef __COMPILE_44
	else if (__choose0 == 45)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (0);
	}
	#endif
	#ifdef __COMPILE_45
	else if (__choose0 == 46)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (1);
	}
	#endif
	#ifdef __COMPILE_46
	else if (__choose0 == 47)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (4096);
	}
	#endif
	#ifdef __COMPILE_47
	else if (__choose0 == 48)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (8);
	}
	#endif
	#ifdef __COMPILE_48
	else if (__choose0 == 49)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (0);
	}
	#endif
	#ifdef __COMPILE_49
	else if (__choose0 == 50)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (1);
	}
	#endif
	#ifdef __COMPILE_50
	else if (__choose0 == 51)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (4096);
	}
	#endif
	#ifdef __COMPILE_51
	else if (__choose0 == 52)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (8);
	}
	#endif
	#ifdef __COMPILE_52
	else if (__choose0 == 53)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (skip_dots);
	}
	#endif
	#ifdef __COMPILE_53
	else if (__choose0 == 54)
	{
	//AddStmtAndReplaceAtomKind
	memcpy(&spl_filesystem_object_handlers && !(1 << 5), zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_54
	else if (__choose0 == 55)
	{
	//AddStmtAndReplaceAtomKind
	memset((intern), 0, sizeof(spl_filesystem_object));
	}
	#endif
	#ifdef __COMPILE_55
	else if (__choose0 == 56)
	{
	//AddStmtAndReplaceAtomKind
	rebuild_object_properties(&(intern)->std);
	}
	#endif
	#ifdef __COMPILE_56
	else if (__choose0 == 57)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_dir_read((intern));
	}
	#endif
	#ifdef __COMPILE_57
	else if (__choose0 == 58)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_dir_read(intern && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_58
	else if (__choose0 == 59)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_file_free_line((intern));
	}
	#endif
	#ifdef __COMPILE_59
	else if (__choose0 == 60)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_object_get_file_name((intern));
	}
	#endif
	#ifdef __COMPILE_60
	else if (__choose0 == 61)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_std_class(&spl_ce_SplFileInfo && !(1 << 5), "SplFileInfo", spl_filesystem_object_new, spl_SplFileInfo_functions);
	}
	#endif
	#ifdef __COMPILE_61
	else if (__choose0 == 62)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_std_class(&spl_ce_SplFileInfo, "SplFileInfo", spl_filesystem_object_new, spl_SplFileInfo_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_62
	else if (__choose0 == 63)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_DirectoryIterator && !(1 << 5), spl_ce_SplFileInfo, "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_63
	else if (__choose0 == 64)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_DirectoryIterator, spl_ce_SplFileInfo && !(1 << 5), "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_64
	else if (__choose0 == 65)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_DirectoryIterator, spl_ce_SplFileInfo, "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_65
	else if (__choose0 == 66)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_FilesystemIterator && !(1 << 5), spl_ce_DirectoryIterator, "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions);
	}
	#endif
	#ifdef __COMPILE_66
	else if (__choose0 == 67)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_FilesystemIterator, spl_ce_DirectoryIterator && !(1 << 5), "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions);
	}
	#endif
	#ifdef __COMPILE_67
	else if (__choose0 == 68)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_FilesystemIterator, spl_ce_DirectoryIterator, "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_68
	else if (__choose0 == 69)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_GlobIterator && !(1 << 5), spl_ce_FilesystemIterator, "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions);
	}
	#endif
	#ifdef __COMPILE_69
	else if (__choose0 == 70)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_GlobIterator, spl_ce_FilesystemIterator && !(1 << 5), "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions);
	}
	#endif
	#ifdef __COMPILE_70
	else if (__choose0 == 71)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_GlobIterator, spl_ce_FilesystemIterator, "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_71
	else if (__choose0 == 72)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator && !(1 << 5), spl_ce_FilesystemIterator, "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_72
	else if (__choose0 == 73)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator, spl_ce_FilesystemIterator && !(1 << 5), "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_73
	else if (__choose0 == 74)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator, spl_ce_FilesystemIterator, "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_74
	else if (__choose0 == 75)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplFileObject && !(1 << 5), spl_ce_SplFileInfo, "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_75
	else if (__choose0 == 76)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplFileObject, spl_ce_SplFileInfo && !(1 << 5), "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_76
	else if (__choose0 == 77)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplFileObject, spl_ce_SplFileInfo, "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_77
	else if (__choose0 == 78)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplTempFileObject && !(1 << 5), spl_ce_SplFileObject, "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_78
	else if (__choose0 == 79)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplTempFileObject, spl_ce_SplFileObject && !(1 << 5), "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_79
	else if (__choose0 == 80)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplTempFileObject, spl_ce_SplFileObject, "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_80
	else if (__choose0 == 81)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator && !(1 << 5), 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_81
	else if (__choose0 == 82)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator && !(1 << 5), 1, zend_ce_iterator);
	}
	#endif
	#ifdef __COMPILE_82
	else if (__choose0 == 83)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, spl_ce_SeekableIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_83
	else if (__choose0 == 84)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, zend_ce_iterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_84
	else if (__choose0 == 85)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_GlobIterator && !(1 << 5), 1, spl_ce_Countable);
	}
	#endif
	#ifdef __COMPILE_85
	else if (__choose0 == 86)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_GlobIterator, 1, spl_ce_Countable && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_86
	else if (__choose0 == 87)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_RecursiveDirectoryIterator && !(1 << 5), 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_87
	else if (__choose0 == 88)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_RecursiveDirectoryIterator, 1, spl_ce_RecursiveIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_88
	else if (__choose0 == 89)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject && !(1 << 5), 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_89
	else if (__choose0 == 90)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject && !(1 << 5), 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_90
	else if (__choose0 == 91)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_RecursiveIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_91
	else if (__choose0 == 92)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_SeekableIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_92
	else if (__choose0 == 93)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_AS_FILEINFO", sizeof ("CURRENT_AS_FILEINFO") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_93
	else if (__choose0 == 94)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_AS_PATHNAME", sizeof ("CURRENT_AS_PATHNAME") - 1, (long)32);
	}
	#endif
	#ifdef __COMPILE_94
	else if (__choose0 == 95)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_AS_SELF", sizeof ("CURRENT_AS_SELF") - 1, (long)16);
	}
	#endif
	#ifdef __COMPILE_95
	else if (__choose0 == 96)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_MODE_MASK", sizeof ("CURRENT_MODE_MASK") - 1, (long)240);
	}
	#endif
	#ifdef __COMPILE_96
	else if (__choose0 == 97)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "FOLLOW_SYMLINKS", sizeof ("FOLLOW_SYMLINKS") - 1, (long)512);
	}
	#endif
	#ifdef __COMPILE_97
	else if (__choose0 == 98)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "KEY_AS_FILENAME", sizeof ("KEY_AS_FILENAME") - 1, (long)256);
	}
	#endif
	#ifdef __COMPILE_98
	else if (__choose0 == 99)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "KEY_AS_PATHNAME", sizeof ("KEY_AS_PATHNAME") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_99
	else if (__choose0 == 100)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "KEY_MODE_MASK", sizeof ("KEY_MODE_MASK") - 1, (long)3840);
	}
	#endif
	#ifdef __COMPILE_100
	else if (__choose0 == 101)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "NEW_CURRENT_AND_KEY", sizeof ("NEW_CURRENT_AND_KEY") - 1, (long)256 | 0);
	}
	#endif
	#ifdef __COMPILE_101
	else if (__choose0 == 102)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "SKIP_DOTS", sizeof ("SKIP_DOTS") - 1, (long)4096);
	}
	#endif
	#ifdef __COMPILE_102
	else if (__choose0 == 103)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "UNIX_PATHS", sizeof ("UNIX_PATHS") - 1, (long)8192);
	}
	#endif
	#ifdef __COMPILE_103
	else if (__choose0 == 104)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "DROP_NEW_LINE", sizeof ("DROP_NEW_LINE") - 1, (long)1);
	}
	#endif
	#ifdef __COMPILE_104
	else if (__choose0 == 105)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "READ_AHEAD", sizeof ("READ_AHEAD") - 1, (long)2);
	}
	#endif
	#ifdef __COMPILE_105
	else if (__choose0 == 106)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "READ_CSV", sizeof ("READ_CSV") - 1, (long)8);
	}
	#endif
	#ifdef __COMPILE_106
	else if (__choose0 == 107)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "SKIP_EMPTY", sizeof ("SKIP_EMPTY") - 1, (long)6);
	}
	#endif
	#ifdef __COMPILE_107
	else if (__choose0 == 108)
	{
	//AddStmtAndReplaceAtomKind
	zend_object_std_dtor(&(intern)->std);
	}
	#endif
	#ifdef __COMPILE_108
	else if (__choose0 == 109)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_DomainException && !(1 << 5), 0, "Maximum line length must be greater than or equal zero");
	}
	#endif
	#ifdef __COMPILE_109
	else if (__choose0 == 110)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_LogicException, 0, "Can't truncate file %s", (intern)->file_name);
	}
	#endif
	#ifdef __COMPILE_110
	else if (__choose0 == 111)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Could not open file");
	}
	#endif
	#ifdef __COMPILE_111
	else if (__choose0 == 112)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Directory name must not be empty.");
	}
	#endif
	#ifdef __COMPILE_112
	else if (__choose0 == 113)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Internal error, function '%s' not found. Please report", "fgetss");
	}
	#endif
	#ifdef __COMPILE_113
	else if (__choose0 == 114)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Internal error, function '%s' not found. Please report", "flock");
	}
	#endif
	#ifdef __COMPILE_114
	else if (__choose0 == 115)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Internal error, function '%s' not found. Please report", "fstat");
	}
	#endif
	#ifdef __COMPILE_115
	else if (__choose0 == 116)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Operation not supported");
	}
	#endif
	#ifdef __COMPILE_116
	else if (__choose0 == 117)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Cannot read from file %s", (intern)->file_name);
	}
	#endif
	#ifdef __COMPILE_117
	else if (__choose0 == 118)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Cannot rewind file %s", (intern)->file_name);
	}
	#endif
	#ifdef __COMPILE_118
	else if (__choose0 == 119)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Unable to read link %s, error: %s", (intern)->file_name, strerror((*__errno_location())));
	}
	#endif
	#ifdef __COMPILE_119
	else if (__choose0 == 120)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p(&((intern)->u.file.zresource), 1);
	}
	#endif
	#ifdef __COMPILE_120
	else if (__choose0 == 121)
	{
	//AddStmtKind
	(executor_globals.argument_stack) = zend_vm_stack_new_page(((16 * 1024) - 16));
	}
	#endif
	#ifdef __COMPILE_121
	else if (__choose0 == 122)
	{
	//AddStmtKind
	exit(1);
	}
	#endif
	#ifdef __COMPILE_122
	else if (__choose0 == 123)
	{
	//AddStmtKind
	intern->_path = _estrndup((path), (--intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_123
	else if (__choose0 == 124)
	{
	//AddStmtKind
	intern->_path = _estrndup((path), (intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_124
	else if (__choose0 == 125)
	{
	//AddStmtKind
	intern->_path_len = strlen(path);
	}
	#endif
	#ifdef __COMPILE_125
	else if (__choose0 == 126)
	{
	//AddStmtKind
	intern->type = SPL_FS_DIR;
	}
	#endif
	#ifdef __COMPILE_126
	else if (__choose0 == 127)
	{
	//AddStmtKind
	intern->u.dir.dirp = _php_stream_opendir((path), (8), (((void *)0)));
	}
	#endif
	#ifdef __COMPILE_127
	else if (__choose0 == 128)
	{
	//AddStmtKind
	intern->u.dir.entry.d_name[0] = '\x00';
	}
	#endif
	#ifdef __COMPILE_128
	else if (__choose0 == 129)
	{
	//AddStmtKind
	intern->u.dir.index = 0;
	}
	#endif
	#ifdef __COMPILE_129
	else if (__choose0 == 130)
	{
	//AddStmtKind
	memcpy(&spl_filesystem_object_handlers, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_130
	else if (__choose0 == 131)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 0L), "GlobIterator lost glob state");
	}
	#endif
	#ifdef __COMPILE_131
	else if (__choose0 == 132)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "No such file or directory");
	}
	#endif
	#ifdef __COMPILE_132
	else if (__choose0 == 133)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "delimiter must be a character");
	}
	#endif
	#ifdef __COMPILE_133
	else if (__choose0 == 134)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "enclosure must be a character");
	}
	#endif
	#ifdef __COMPILE_134
	else if (__choose0 == 135)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "escape must be a character");
	}
	#endif
	#ifdef __COMPILE_135
	else if (__choose0 == 136)
	{
	//AddStmtKind
	spl_ce_DirectoryIterator->get_iterator = spl_filesystem_dir_get_iterator;
	}
	#endif
	#ifdef __COMPILE_136
	else if (__choose0 == 137)
	{
	//AddStmtKind
	spl_ce_FilesystemIterator->get_iterator = spl_filesystem_tree_get_iterator;
	}
	#endif
	#ifdef __COMPILE_137
	else if (__choose0 == 138)
	{
	//AddStmtKind
	spl_ce_SplFileInfo->serialize = zend_class_serialize_deny;
	}
	#endif
	#ifdef __COMPILE_138
	else if (__choose0 == 139)
	{
	//AddStmtKind
	spl_ce_SplFileInfo->unserialize = zend_class_unserialize_deny;
	}
	#endif
	#ifdef __COMPILE_139
	else if (__choose0 == 140)
	{
	//AddStmtKind
	spl_filesystem_dir_read(intern);
	}
	#endif
	#ifdef __COMPILE_140
	else if (__choose0 == 141)
	{
	//AddStmtKind
	spl_filesystem_object_handlers.cast_object = spl_filesystem_object_cast;
	}
	#endif
	#ifdef __COMPILE_141
	else if (__choose0 == 142)
	{
	//AddStmtKind
	spl_filesystem_object_handlers.clone_obj = spl_filesystem_object_clone;
	}
	#endif
	#ifdef __COMPILE_142
	else if (__choose0 == 143)
	{
	//AddStmtKind
	spl_filesystem_object_handlers.get_debug_info = spl_filesystem_object_get_debug_info;
	}
	#endif
	#ifdef __COMPILE_143
	else if (__choose0 == 144)
	{
	//AddStmtKind
	spl_register_std_class(&spl_ce_SplFileInfo, "SplFileInfo", spl_filesystem_object_new, spl_SplFileInfo_functions);
	}
	#endif
	#ifdef __COMPILE_144
	else if (__choose0 == 145)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_DirectoryIterator, spl_ce_SplFileInfo, "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_145
	else if (__choose0 == 146)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_FilesystemIterator, spl_ce_DirectoryIterator, "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions);
	}
	#endif
	#ifdef __COMPILE_146
	else if (__choose0 == 147)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_GlobIterator, spl_ce_FilesystemIterator, "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions);
	}
	#endif
	#ifdef __COMPILE_147
	else if (__choose0 == 148)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator, spl_ce_FilesystemIterator, "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_148
	else if (__choose0 == 149)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_SplFileObject, spl_ce_SplFileInfo, "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_149
	else if (__choose0 == 150)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_SplTempFileObject, spl_ce_SplFileObject, "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_150
	else if (__choose0 == 151)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_151
	else if (__choose0 == 152)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, zend_ce_iterator);
	}
	#endif
	#ifdef __COMPILE_152
	else if (__choose0 == 153)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_GlobIterator, 1, spl_ce_Countable);
	}
	#endif
	#ifdef __COMPILE_153
	else if (__choose0 == 154)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_RecursiveDirectoryIterator, 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_154
	else if (__choose0 == 155)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_155
	else if (__choose0 == 156)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_156
	else if (__choose0 == 157)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_AS_FILEINFO", sizeof ("CURRENT_AS_FILEINFO") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_157
	else if (__choose0 == 158)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_AS_PATHNAME", sizeof ("CURRENT_AS_PATHNAME") - 1, (long)32);
	}
	#endif
	#ifdef __COMPILE_158
	else if (__choose0 == 159)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_AS_SELF", sizeof ("CURRENT_AS_SELF") - 1, (long)16);
	}
	#endif
	#ifdef __COMPILE_159
	else if (__choose0 == 160)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_MODE_MASK", sizeof ("CURRENT_MODE_MASK") - 1, (long)240);
	}
	#endif
	#ifdef __COMPILE_160
	else if (__choose0 == 161)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "FOLLOW_SYMLINKS", sizeof ("FOLLOW_SYMLINKS") - 1, (long)512);
	}
	#endif
	#ifdef __COMPILE_161
	else if (__choose0 == 162)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "KEY_AS_FILENAME", sizeof ("KEY_AS_FILENAME") - 1, (long)256);
	}
	#endif
	#ifdef __COMPILE_162
	else if (__choose0 == 163)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "KEY_AS_PATHNAME", sizeof ("KEY_AS_PATHNAME") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_163
	else if (__choose0 == 164)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "KEY_MODE_MASK", sizeof ("KEY_MODE_MASK") - 1, (long)3840);
	}
	#endif
	#ifdef __COMPILE_164
	else if (__choose0 == 165)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "NEW_CURRENT_AND_KEY", sizeof ("NEW_CURRENT_AND_KEY") - 1, (long)256 | 0);
	}
	#endif
	#ifdef __COMPILE_165
	else if (__choose0 == 166)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "SKIP_DOTS", sizeof ("SKIP_DOTS") - 1, (long)4096);
	}
	#endif
	#ifdef __COMPILE_166
	else if (__choose0 == 167)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "UNIX_PATHS", sizeof ("UNIX_PATHS") - 1, (long)8192);
	}
	#endif
	#ifdef __COMPILE_167
	else if (__choose0 == 168)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "DROP_NEW_LINE", sizeof ("DROP_NEW_LINE") - 1, (long)1);
	}
	#endif
	#ifdef __COMPILE_168
	else if (__choose0 == 169)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "READ_AHEAD", sizeof ("READ_AHEAD") - 1, (long)2);
	}
	#endif
	#ifdef __COMPILE_169
	else if (__choose0 == 170)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "READ_CSV", sizeof ("READ_CSV") - 1, (long)8);
	}
	#endif
	#ifdef __COMPILE_170
	else if (__choose0 == 171)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "SKIP_EMPTY", sizeof ("SKIP_EMPTY") - 1, (long)6);
	}
	#endif
	#ifdef __COMPILE_171
	else if (__choose0 == 172)
	{
	//AddStmtKind
	zend_error((1 << 0L), "An iterator cannot be used with foreach by reference");
	}
	#endif
	#ifdef __COMPILE_172
	else if (__choose0 == 173)
	{
	//AddStmtKind
	zend_error((1 << 3L), "A non well formed numeric value encountered");
	}
	#endif
	#ifdef __COMPILE_173
	else if (__choose0 == 174)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_DomainException, 0, "Maximum line length must be greater than or equal zero");
	}
	#endif
	#ifdef __COMPILE_174
	else if (__choose0 == 175)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Could not open file");
	}
	#endif
	#ifdef __COMPILE_175
	else if (__choose0 == 176)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Directory name must not be empty.");
	}
	#endif
	#ifdef __COMPILE_176
	else if (__choose0 == 177)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Internal error, function '%s' not found. Please report", "fgetss");
	}
	#endif
	#ifdef __COMPILE_177
	else if (__choose0 == 178)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Internal error, function '%s' not found. Please report", "flock");
	}
	#endif
	#ifdef __COMPILE_178
	else if (__choose0 == 179)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Internal error, function '%s' not found. Please report", "fstat");
	}
	#endif
	#ifdef __COMPILE_179
	else if (__choose0 == 180)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Operation not supported");
	}
	#endif
	int __choose1 = __choose("__SWITCH1");
	{
	int __temp1=((executor_globals.exception) || intern->u.dir.dirp == ((void *)0)) ;
	if (__choose1 == 0)
	{}
	#ifdef __COMPILE_180
	else if (__choose1 == 1)
	{
	__temp1= (__is_neg("1-1", "L235", 112, &(executor_globals.exception), sizeof (executor_globals.exception), &(intern), sizeof (intern), &(executor_globals.exception), sizeof (executor_globals.exception), &(intern->u.dir.dirp), sizeof (intern->u.dir.dirp), &(intern->u.dir.index), sizeof (intern->u.dir.index), &(path), sizeof (path), &(intern->_path), sizeof (intern->_path), &(intern->_path_len), sizeof (intern->_path_len), &(skip_dots), sizeof (skip_dots), &(intern->type), sizeof (intern->type), &(intern->flags), sizeof (intern->flags), &(intern->u.dir.func_rewind), sizeof (intern->u.dir.func_rewind), &(intern->u.dir.func_next), sizeof (intern->u.dir.func_next), &(intern->u.dir.func_valid), sizeof (intern->u.dir.func_valid), &(executor_globals.return_value_ptr_ptr), sizeof (executor_globals.return_value_ptr_ptr), &(executor_globals.uninitialized_zval_ptr), sizeof (executor_globals.uninitialized_zval_ptr), &(executor_globals.error_zval_ptr), sizeof (executor_globals.error_zval_ptr), &(executor_globals.symtable_cache_limit), sizeof (executor_globals.symtable_cache_limit), &(executor_globals.symtable_cache_ptr), sizeof (executor_globals.symtable_cache_ptr), &(executor_globals.opline_ptr), sizeof (executor_globals.opline_ptr), &(executor_globals.active_symbol_table), sizeof (executor_globals.active_symbol_table), &(executor_globals.bailout), sizeof (executor_globals.bailout), &(executor_globals.error_reporting), sizeof (executor_globals.error_reporting), &(executor_globals.orig_error_reporting), sizeof (executor_globals.orig_error_reporting), &(executor_globals.exit_status), sizeof (executor_globals.exit_status), &(executor_globals.active_op_array), sizeof (executor_globals.active_op_array), &(executor_globals.function_table), sizeof (executor_globals.function_table), &(executor_globals.class_table), sizeof (executor_globals.class_table), &(executor_globals.zend_constants), sizeof (executor_globals.zend_constants), &(executor_globals.scope), sizeof (executor_globals.scope), &(executor_globals.called_scope), sizeof (executor_globals.called_scope), &(executor_globals.This), sizeof (executor_globals.This), &(executor_globals.precision), sizeof (executor_globals.precision), &(executor_globals.ticks_count), sizeof (executor_globals.ticks_count), &(executor_globals.in_execution), sizeof (executor_globals.in_execution), &(executor_globals.in_autoload), sizeof (executor_globals.in_autoload), &(executor_globals.autoload_func), sizeof (executor_globals.autoload_func), &(executor_globals.full_tables_cleanup), sizeof (executor_globals.full_tables_cleanup), &(executor_globals.no_extensions), sizeof (executor_globals.no_extensions), &(executor_globals.argument_stack), sizeof (executor_globals.argument_stack), &(executor_globals.user_error_handler_error_reporting), sizeof (executor_globals.user_error_handler_error_reporting), &(executor_globals.user_error_handler), sizeof (executor_globals.user_error_handler), &(executor_globals.user_exception_handler), sizeof (executor_globals.user_exception_handler), &(executor_globals.error_handling), sizeof (executor_globals.error_handling), &(executor_globals.exception_class), sizeof (executor_globals.exception_class), &(executor_globals.timeout_seconds), sizeof (executor_globals.timeout_seconds), &(executor_globals.lambda_count), sizeof (executor_globals.lambda_count), &(executor_globals.ini_directives), sizeof (executor_globals.ini_directives), &(executor_globals.modified_ini_directives), sizeof (executor_globals.modified_ini_directives), &(executor_globals.error_reporting_ini_entry), sizeof (executor_globals.error_reporting_ini_entry), &(executor_globals.prev_exception), sizeof (executor_globals.prev_exception), &(executor_globals.opline_before_exception), sizeof (executor_globals.opline_before_exception), &(executor_globals.current_execute_data), sizeof (executor_globals.current_execute_data), &(executor_globals.current_module), sizeof (executor_globals.current_module), &(executor_globals.active), sizeof (executor_globals.active), &(executor_globals.start_op), sizeof (executor_globals.start_op), &(executor_globals.saved_fpu_cw_ptr), sizeof (executor_globals.saved_fpu_cw_ptr), &(executor_globals.saved_fpu_cw), sizeof (executor_globals.saved_fpu_cw), &(executor_globals.return_value_ptr_ptr), sizeof (executor_globals.return_value_ptr_ptr), &(executor_globals.uninitialized_zval_ptr), sizeof (executor_globals.uninitialized_zval_ptr), &(executor_globals.error_zval_ptr), sizeof (executor_globals.error_zval_ptr), &(executor_globals.symtable_cache_limit), sizeof (executor_globals.symtable_cache_limit), &(executor_globals.symtable_cache_ptr), sizeof (executor_globals.symtable_cache_ptr), &(executor_globals.opline_ptr), sizeof (executor_globals.opline_ptr), &(executor_globals.active_symbol_table), sizeof (executor_globals.active_symbol_table), &(executor_globals.bailout), sizeof (executor_globals.bailout), &(executor_globals.error_reporting), sizeof (executor_globals.error_reporting), &(executor_globals.orig_error_reporting), sizeof (executor_globals.orig_error_reporting), &(executor_globals.exit_status), sizeof (executor_globals.exit_status), &(executor_globals.active_op_array), sizeof (executor_globals.active_op_array), &(executor_globals.function_table), sizeof (executor_globals.function_table), &(executor_globals.class_table), sizeof (executor_globals.class_table), &(executor_globals.zend_constants), sizeof (executor_globals.zend_constants), &(executor_globals.scope), sizeof (executor_globals.scope), &(executor_globals.called_scope), sizeof (executor_globals.called_scope), &(executor_globals.This), sizeof (executor_globals.This), &(executor_globals.precision), sizeof (executor_globals.precision), &(executor_globals.ticks_count), sizeof (executor_globals.ticks_count), &(executor_globals.in_execution), sizeof (executor_globals.in_execution), &(executor_globals.in_autoload), sizeof (executor_globals.in_autoload), &(executor_globals.autoload_func), sizeof (executor_globals.autoload_func), &(executor_globals.full_tables_cleanup), sizeof (executor_globals.full_tables_cleanup), &(executor_globals.no_extensions), sizeof (executor_globals.no_extensions), &(executor_globals.argument_stack), sizeof (executor_globals.argument_stack), &(executor_globals.user_error_handler_error_reporting), sizeof (executor_globals.user_error_handler_error_reporting), &(executor_globals.user_error_handler), sizeof (executor_globals.user_error_handler), &(executor_globals.user_exception_handler), sizeof (executor_globals.user_exception_handler), &(executor_globals.error_handling), sizeof (executor_globals.error_handling), &(executor_globals.exception_class), sizeof (executor_globals.exception_class), &(executor_globals.timeout_seconds), sizeof (executor_globals.timeout_seconds), &(executor_globals.lambda_count), sizeof (executor_globals.lambda_count), &(executor_globals.ini_directives), sizeof (executor_globals.ini_directives), &(executor_globals.modified_ini_directives), sizeof (executor_globals.modified_ini_directives), &(executor_globals.error_reporting_ini_entry), sizeof (executor_globals.error_reporting_ini_entry), &(executor_globals.prev_exception), sizeof (executor_globals.prev_exception), &(executor_globals.opline_before_exception), sizeof (executor_globals.opline_before_exception), &(executor_globals.current_execute_data), sizeof (executor_globals.current_execute_data), &(executor_globals.current_module), sizeof (executor_globals.current_module), &(executor_globals.active), sizeof (executor_globals.active), &(executor_globals.start_op), sizeof (executor_globals.start_op), &(executor_globals.saved_fpu_cw_ptr), sizeof (executor_globals.saved_fpu_cw_ptr), &(executor_globals.saved_fpu_cw), sizeof (executor_globals.saved_fpu_cw), &(intern->oth), sizeof (intern->oth), &(intern->oth_handler), sizeof (intern->oth_handler), &(intern->orig_path), sizeof (intern->orig_path), &(intern->file_name), sizeof (intern->file_name), &(intern->file_name_len), sizeof (intern->file_name_len), &(intern->file_class), sizeof (intern->file_class), &(intern->info_class), sizeof (intern->info_class), &(intern->u.dir.sub_path), sizeof (intern->u.dir.sub_path), &(intern->u.dir.sub_path_len), sizeof (intern->u.dir.sub_path_len), &(intern->u.dir.is_recursive), sizeof (intern->u.dir.is_recursive)));
	}
	#endif
	#ifdef __COMPILE_181
	else if (__choose1 == 2)
	{
	__temp1= ((executor_globals.exception));
	}
	#endif
	#ifdef __COMPILE_182
	else if (__choose1 == 3)
	{
	__temp1= (((executor_globals.exception) || intern->u.dir.dirp == ((void *)0)) && !__is_neg("1-3", "L235", 112, &(executor_globals.exception), sizeof (executor_globals.exception), &(intern), sizeof (intern), &(executor_globals.exception), sizeof (executor_globals.exception), &(intern->u.dir.dirp), sizeof (intern->u.dir.dirp), &(intern->u.dir.index), sizeof (intern->u.dir.index), &(path), sizeof (path), &(intern->_path), sizeof (intern->_path), &(intern->_path_len), sizeof (intern->_path_len), &(skip_dots), sizeof (skip_dots), &(intern->type), sizeof (intern->type), &(intern->flags), sizeof (intern->flags), &(executor_globals.return_value_ptr_ptr), sizeof (executor_globals.return_value_ptr_ptr), &(executor_globals.uninitialized_zval_ptr), sizeof (executor_globals.uninitialized_zval_ptr), &(executor_globals.error_zval_ptr), sizeof (executor_globals.error_zval_ptr), &(executor_globals.symtable_cache_limit), sizeof (executor_globals.symtable_cache_limit), &(executor_globals.symtable_cache_ptr), sizeof (executor_globals.symtable_cache_ptr), &(executor_globals.opline_ptr), sizeof (executor_globals.opline_ptr), &(executor_globals.active_symbol_table), sizeof (executor_globals.active_symbol_table), &(executor_globals.bailout), sizeof (executor_globals.bailout), &(executor_globals.error_reporting), sizeof (executor_globals.error_reporting), &(executor_globals.orig_error_reporting), sizeof (executor_globals.orig_error_reporting), &(executor_globals.exit_status), sizeof (executor_globals.exit_status), &(executor_globals.active_op_array), sizeof (executor_globals.active_op_array), &(executor_globals.function_table), sizeof (executor_globals.function_table), &(executor_globals.class_table), sizeof (executor_globals.class_table), &(executor_globals.zend_constants), sizeof (executor_globals.zend_constants), &(executor_globals.scope), sizeof (executor_globals.scope), &(executor_globals.called_scope), sizeof (executor_globals.called_scope), &(executor_globals.This), sizeof (executor_globals.This), &(executor_globals.precision), sizeof (executor_globals.precision), &(executor_globals.ticks_count), sizeof (executor_globals.ticks_count), &(executor_globals.in_execution), sizeof (executor_globals.in_execution), &(executor_globals.in_autoload), sizeof (executor_globals.in_autoload), &(executor_globals.autoload_func), sizeof (executor_globals.autoload_func), &(executor_globals.full_tables_cleanup), sizeof (executor_globals.full_tables_cleanup), &(executor_globals.no_extensions), sizeof (executor_globals.no_extensions), &(executor_globals.argument_stack), sizeof (executor_globals.argument_stack), &(executor_globals.user_error_handler_error_reporting), sizeof (executor_globals.user_error_handler_error_reporting), &(executor_globals.user_error_handler), sizeof (executor_globals.user_error_handler), &(executor_globals.user_exception_handler), sizeof (executor_globals.user_exception_handler), &(executor_globals.error_handling), sizeof (executor_globals.error_handling), &(executor_globals.exception_class), sizeof (executor_globals.exception_class), &(executor_globals.timeout_seconds), sizeof (executor_globals.timeout_seconds), &(executor_globals.lambda_count), sizeof (executor_globals.lambda_count), &(executor_globals.ini_directives), sizeof (executor_globals.ini_directives), &(executor_globals.modified_ini_directives), sizeof (executor_globals.modified_ini_directives), &(executor_globals.error_reporting_ini_entry), sizeof (executor_globals.error_reporting_ini_entry), &(executor_globals.prev_exception), sizeof (executor_globals.prev_exception), &(executor_globals.opline_before_exception), sizeof (executor_globals.opline_before_exception), &(executor_globals.current_execute_data), sizeof (executor_globals.current_execute_data), &(executor_globals.current_module), sizeof (executor_globals.current_module), &(executor_globals.active), sizeof (executor_globals.active), &(executor_globals.start_op), sizeof (executor_globals.start_op), &(executor_globals.saved_fpu_cw_ptr), sizeof (executor_globals.saved_fpu_cw_ptr), &(executor_globals.saved_fpu_cw), sizeof (executor_globals.saved_fpu_cw), &(executor_globals.return_value_ptr_ptr), sizeof (executor_globals.return_value_ptr_ptr), &(executor_globals.uninitialized_zval_ptr), sizeof (executor_globals.uninitialized_zval_ptr), &(executor_globals.error_zval_ptr), sizeof (executor_globals.error_zval_ptr), &(executor_globals.symtable_cache_limit), sizeof (executor_globals.symtable_cache_limit), &(executor_globals.symtable_cache_ptr), sizeof (executor_globals.symtable_cache_ptr), &(executor_globals.opline_ptr), sizeof (executor_globals.opline_ptr), &(executor_globals.active_symbol_table), sizeof (executor_globals.active_symbol_table), &(executor_globals.bailout), sizeof (executor_globals.bailout), &(executor_globals.error_reporting), sizeof (executor_globals.error_reporting), &(executor_globals.orig_error_reporting), sizeof (executor_globals.orig_error_reporting), &(executor_globals.exit_status), sizeof (executor_globals.exit_status), &(executor_globals.active_op_array), sizeof (executor_globals.active_op_array), &(executor_globals.function_table), sizeof (executor_globals.function_table), &(executor_globals.class_table), sizeof (executor_globals.class_table), &(executor_globals.zend_constants), sizeof (executor_globals.zend_constants), &(executor_globals.scope), sizeof (executor_globals.scope), &(executor_globals.called_scope), sizeof (executor_globals.called_scope), &(executor_globals.This), sizeof (executor_globals.This), &(executor_globals.precision), sizeof (executor_globals.precision), &(executor_globals.ticks_count), sizeof (executor_globals.ticks_count), &(executor_globals.in_execution), sizeof (executor_globals.in_execution), &(executor_globals.in_autoload), sizeof (executor_globals.in_autoload), &(executor_globals.autoload_func), sizeof (executor_globals.autoload_func), &(executor_globals.full_tables_cleanup), sizeof (executor_globals.full_tables_cleanup), &(executor_globals.no_extensions), sizeof (executor_globals.no_extensions), &(executor_globals.argument_stack), sizeof (executor_globals.argument_stack), &(executor_globals.user_error_handler_error_reporting), sizeof (executor_globals.user_error_handler_error_reporting), &(executor_globals.user_error_handler), sizeof (executor_globals.user_error_handler), &(executor_globals.user_exception_handler), sizeof (executor_globals.user_exception_handler), &(executor_globals.error_handling), sizeof (executor_globals.error_handling), &(executor_globals.exception_class), sizeof (executor_globals.exception_class), &(executor_globals.timeout_seconds), sizeof (executor_globals.timeout_seconds), &(executor_globals.lambda_count), sizeof (executor_globals.lambda_count), &(executor_globals.ini_directives), sizeof (executor_globals.ini_directives), &(executor_globals.modified_ini_directives), sizeof (executor_globals.modified_ini_directives), &(executor_globals.error_reporting_ini_entry), sizeof (executor_globals.error_reporting_ini_entry), &(executor_globals.prev_exception), sizeof (executor_globals.prev_exception), &(executor_globals.opline_before_exception), sizeof (executor_globals.opline_before_exception), &(executor_globals.current_execute_data), sizeof (executor_globals.current_execute_data), &(executor_globals.current_module), sizeof (executor_globals.current_module), &(executor_globals.active), sizeof (executor_globals.active), &(executor_globals.start_op), sizeof (executor_globals.start_op), &(executor_globals.saved_fpu_cw_ptr), sizeof (executor_globals.saved_fpu_cw_ptr), &(executor_globals.saved_fpu_cw), sizeof (executor_globals.saved_fpu_cw), &(intern->oth), sizeof (intern->oth), &(intern->oth_handler), sizeof (intern->oth_handler), &(intern->orig_path), sizeof (intern->orig_path), &(intern->file_name), sizeof (intern->file_name), &(intern->file_name_len), sizeof (intern->file_name_len), &(intern->file_class), sizeof (intern->file_class), &(intern->info_class), sizeof (intern->info_class), &(intern->u.dir.sub_path), sizeof (intern->u.dir.sub_path), &(intern->u.dir.sub_path_len), sizeof (intern->u.dir.sub_path_len), &(intern->u.dir.is_recursive), sizeof (intern->u.dir.is_recursive), &(intern->u.dir.func_rewind), sizeof (intern->u.dir.func_rewind), &(intern->u.dir.func_next), sizeof (intern->u.dir.func_next), &(intern->u.dir.func_valid), sizeof (intern->u.dir.func_valid)));
	}
	#endif
	if (__temp1) {
			/* throw exception: should've been already happened */
			{
	int __choose2 = __choose("__SWITCH2");
	if (__choose2 == 0)
	{}
	#ifdef __COMPILE_183
	else if (__choose2 == 1)
	{
	//AddIfStmtKind
	if (intern->_path_len > 1 && (((path[intern->_path_len - 1]) == '/'))) {
	    intern->_path = _estrndup((path), (--intern->_path_len));
	} else {
	    intern->_path = _estrndup((path), (intern->_path_len));
	}
	}
	#endif
	#ifdef __COMPILE_184
	else if (__choose2 == 2)
	{
	//AddInitKind
	memset(&executor_globals.This, 0, sizeof (*(&executor_globals.This)));
	}
	#endif
	#ifdef __COMPILE_185
	else if (__choose2 == 3)
	{
	//AddInitKind
	memset(&executor_globals.active, 0, sizeof (*(&executor_globals.active)));
	}
	#endif
	#ifdef __COMPILE_186
	else if (__choose2 == 4)
	{
	//AddInitKind
	memset(&executor_globals.active_op_array, 0, sizeof (*(&executor_globals.active_op_array)));
	}
	#endif
	#ifdef __COMPILE_187
	else if (__choose2 == 5)
	{
	//AddInitKind
	memset(&executor_globals.active_symbol_table, 0, sizeof (*(&executor_globals.active_symbol_table)));
	}
	#endif
	#ifdef __COMPILE_188
	else if (__choose2 == 6)
	{
	//AddInitKind
	memset(&executor_globals.arg_types_stack, 0, sizeof (*(&executor_globals.arg_types_stack)));
	}
	#endif
	#ifdef __COMPILE_189
	else if (__choose2 == 7)
	{
	//AddInitKind
	memset(&executor_globals.argument_stack, 0, sizeof (*(&executor_globals.argument_stack)));
	}
	#endif
	#ifdef __COMPILE_190
	else if (__choose2 == 8)
	{
	//AddInitKind
	memset(&executor_globals.autoload_func, 0, sizeof (*(&executor_globals.autoload_func)));
	}
	#endif
	#ifdef __COMPILE_191
	else if (__choose2 == 9)
	{
	//AddInitKind
	memset(&executor_globals.bailout, 0, sizeof (*(&executor_globals.bailout)));
	}
	#endif
	#ifdef __COMPILE_192
	else if (__choose2 == 10)
	{
	//AddInitKind
	memset(&executor_globals.called_scope, 0, sizeof (*(&executor_globals.called_scope)));
	}
	#endif
	#ifdef __COMPILE_193
	else if (__choose2 == 11)
	{
	//AddInitKind
	memset(&executor_globals.class_table, 0, sizeof (*(&executor_globals.class_table)));
	}
	#endif
	#ifdef __COMPILE_194
	else if (__choose2 == 12)
	{
	//AddInitKind
	memset(&executor_globals.current_execute_data, 0, sizeof (*(&executor_globals.current_execute_data)));
	}
	#endif
	#ifdef __COMPILE_195
	else if (__choose2 == 13)
	{
	//AddInitKind
	memset(&executor_globals.current_module, 0, sizeof (*(&executor_globals.current_module)));
	}
	#endif
	#ifdef __COMPILE_196
	else if (__choose2 == 14)
	{
	//AddInitKind
	memset(&executor_globals.error_handling, 0, sizeof (*(&executor_globals.error_handling)));
	}
	#endif
	#ifdef __COMPILE_197
	else if (__choose2 == 15)
	{
	//AddInitKind
	memset(&executor_globals.error_reporting, 0, sizeof (*(&executor_globals.error_reporting)));
	}
	#endif
	#ifdef __COMPILE_198
	else if (__choose2 == 16)
	{
	//AddInitKind
	memset(&executor_globals.error_reporting_ini_entry, 0, sizeof (*(&executor_globals.error_reporting_ini_entry)));
	}
	#endif
	#ifdef __COMPILE_199
	else if (__choose2 == 17)
	{
	//AddInitKind
	memset(&executor_globals.error_zval, 0, sizeof (*(&executor_globals.error_zval)));
	}
	#endif
	#ifdef __COMPILE_200
	else if (__choose2 == 18)
	{
	//AddInitKind
	memset(&executor_globals.error_zval_ptr, 0, sizeof (*(&executor_globals.error_zval_ptr)));
	}
	#endif
	#ifdef __COMPILE_201
	else if (__choose2 == 19)
	{
	//AddInitKind
	memset(&executor_globals.exception, 0, sizeof (*(&executor_globals.exception)));
	}
	#endif
	#ifdef __COMPILE_202
	else if (__choose2 == 20)
	{
	//AddInitKind
	memset(&executor_globals.exception_class, 0, sizeof (*(&executor_globals.exception_class)));
	}
	#endif
	#ifdef __COMPILE_203
	else if (__choose2 == 21)
	{
	//AddInitKind
	memset(&executor_globals.exception_op, 0, sizeof (*(&executor_globals.exception_op)));
	}
	#endif
	#ifdef __COMPILE_204
	else if (__choose2 == 22)
	{
	//AddInitKind
	memset(&executor_globals.exit_status, 0, sizeof (*(&executor_globals.exit_status)));
	}
	#endif
	#ifdef __COMPILE_205
	else if (__choose2 == 23)
	{
	//AddInitKind
	memset(&executor_globals.full_tables_cleanup, 0, sizeof (*(&executor_globals.full_tables_cleanup)));
	}
	#endif
	#ifdef __COMPILE_206
	else if (__choose2 == 24)
	{
	//AddInitKind
	memset(&executor_globals.function_table, 0, sizeof (*(&executor_globals.function_table)));
	}
	#endif
	#ifdef __COMPILE_207
	else if (__choose2 == 25)
	{
	//AddInitKind
	memset(&executor_globals.in_autoload, 0, sizeof (*(&executor_globals.in_autoload)));
	}
	#endif
	#ifdef __COMPILE_208
	else if (__choose2 == 26)
	{
	//AddInitKind
	memset(&executor_globals.in_execution, 0, sizeof (*(&executor_globals.in_execution)));
	}
	#endif
	#ifdef __COMPILE_209
	else if (__choose2 == 27)
	{
	//AddInitKind
	memset(&executor_globals.included_files, 0, sizeof (*(&executor_globals.included_files)));
	}
	#endif
	#ifdef __COMPILE_210
	else if (__choose2 == 28)
	{
	//AddInitKind
	memset(&executor_globals.ini_directives, 0, sizeof (*(&executor_globals.ini_directives)));
	}
	#endif
	#ifdef __COMPILE_211
	else if (__choose2 == 29)
	{
	//AddInitKind
	memset(&executor_globals.lambda_count, 0, sizeof (*(&executor_globals.lambda_count)));
	}
	#endif
	#ifdef __COMPILE_212
	else if (__choose2 == 30)
	{
	//AddInitKind
	memset(&executor_globals.modified_ini_directives, 0, sizeof (*(&executor_globals.modified_ini_directives)));
	}
	#endif
	#ifdef __COMPILE_213
	else if (__choose2 == 31)
	{
	//AddInitKind
	memset(&executor_globals.no_extensions, 0, sizeof (*(&executor_globals.no_extensions)));
	}
	#endif
	#ifdef __COMPILE_214
	else if (__choose2 == 32)
	{
	//AddInitKind
	memset(&executor_globals.objects_store, 0, sizeof (*(&executor_globals.objects_store)));
	}
	#endif
	#ifdef __COMPILE_215
	else if (__choose2 == 33)
	{
	//AddInitKind
	memset(&executor_globals.opline_before_exception, 0, sizeof (*(&executor_globals.opline_before_exception)));
	}
	#endif
	#ifdef __COMPILE_216
	else if (__choose2 == 34)
	{
	//AddInitKind
	memset(&executor_globals.opline_ptr, 0, sizeof (*(&executor_globals.opline_ptr)));
	}
	#endif
	#ifdef __COMPILE_217
	else if (__choose2 == 35)
	{
	//AddInitKind
	memset(&executor_globals.orig_error_reporting, 0, sizeof (*(&executor_globals.orig_error_reporting)));
	}
	#endif
	#ifdef __COMPILE_218
	else if (__choose2 == 36)
	{
	//AddInitKind
	memset(&executor_globals.persistent_list, 0, sizeof (*(&executor_globals.persistent_list)));
	}
	#endif
	#ifdef __COMPILE_219
	else if (__choose2 == 37)
	{
	//AddInitKind
	memset(&executor_globals.precision, 0, sizeof (*(&executor_globals.precision)));
	}
	#endif
	#ifdef __COMPILE_220
	else if (__choose2 == 38)
	{
	//AddInitKind
	memset(&executor_globals.prev_exception, 0, sizeof (*(&executor_globals.prev_exception)));
	}
	#endif
	#ifdef __COMPILE_221
	else if (__choose2 == 39)
	{
	//AddInitKind
	memset(&executor_globals.regular_list, 0, sizeof (*(&executor_globals.regular_list)));
	}
	#endif
	#ifdef __COMPILE_222
	else if (__choose2 == 40)
	{
	//AddInitKind
	memset(&executor_globals.reserved, 0, sizeof (*(&executor_globals.reserved)));
	}
	#endif
	#ifdef __COMPILE_223
	else if (__choose2 == 41)
	{
	//AddInitKind
	memset(&executor_globals.return_value_ptr_ptr, 0, sizeof (*(&executor_globals.return_value_ptr_ptr)));
	}
	#endif
	#ifdef __COMPILE_224
	else if (__choose2 == 42)
	{
	//AddInitKind
	memset(&executor_globals.saved_fpu_cw, 0, sizeof (*(&executor_globals.saved_fpu_cw)));
	}
	#endif
	#ifdef __COMPILE_225
	else if (__choose2 == 43)
	{
	//AddInitKind
	memset(&executor_globals.saved_fpu_cw_ptr, 0, sizeof (*(&executor_globals.saved_fpu_cw_ptr)));
	}
	#endif
	#ifdef __COMPILE_226
	else if (__choose2 == 44)
	{
	//AddInitKind
	memset(&executor_globals.scope, 0, sizeof (*(&executor_globals.scope)));
	}
	#endif
	#ifdef __COMPILE_227
	else if (__choose2 == 45)
	{
	//AddInitKind
	memset(&executor_globals.start_op, 0, sizeof (*(&executor_globals.start_op)));
	}
	#endif
	#ifdef __COMPILE_228
	else if (__choose2 == 46)
	{
	//AddInitKind
	memset(&executor_globals.std_property_info, 0, sizeof (*(&executor_globals.std_property_info)));
	}
	#endif
	#ifdef __COMPILE_229
	else if (__choose2 == 47)
	{
	//AddInitKind
	memset(&executor_globals.symbol_table, 0, sizeof (*(&executor_globals.symbol_table)));
	}
	#endif
	#ifdef __COMPILE_230
	else if (__choose2 == 48)
	{
	//AddInitKind
	memset(&executor_globals.symtable_cache, 0, sizeof (*(&executor_globals.symtable_cache)));
	}
	#endif
	#ifdef __COMPILE_231
	else if (__choose2 == 49)
	{
	//AddInitKind
	memset(&executor_globals.symtable_cache_limit, 0, sizeof (*(&executor_globals.symtable_cache_limit)));
	}
	#endif
	#ifdef __COMPILE_232
	else if (__choose2 == 50)
	{
	//AddInitKind
	memset(&executor_globals.symtable_cache_ptr, 0, sizeof (*(&executor_globals.symtable_cache_ptr)));
	}
	#endif
	#ifdef __COMPILE_233
	else if (__choose2 == 51)
	{
	//AddInitKind
	memset(&executor_globals.ticks_count, 0, sizeof (*(&executor_globals.ticks_count)));
	}
	#endif
	#ifdef __COMPILE_234
	else if (__choose2 == 52)
	{
	//AddInitKind
	memset(&executor_globals.timeout_seconds, 0, sizeof (*(&executor_globals.timeout_seconds)));
	}
	#endif
	#ifdef __COMPILE_235
	else if (__choose2 == 53)
	{
	//AddInitKind
	memset(&executor_globals.uninitialized_zval, 0, sizeof (*(&executor_globals.uninitialized_zval)));
	}
	#endif
	#ifdef __COMPILE_236
	else if (__choose2 == 54)
	{
	//AddInitKind
	memset(&executor_globals.uninitialized_zval_ptr, 0, sizeof (*(&executor_globals.uninitialized_zval_ptr)));
	}
	#endif
	#ifdef __COMPILE_237
	else if (__choose2 == 55)
	{
	//AddInitKind
	memset(&executor_globals.user_error_handler, 0, sizeof (*(&executor_globals.user_error_handler)));
	}
	#endif
	#ifdef __COMPILE_238
	else if (__choose2 == 56)
	{
	//AddInitKind
	memset(&executor_globals.user_error_handler_error_reporting, 0, sizeof (*(&executor_globals.user_error_handler_error_reporting)));
	}
	#endif
	#ifdef __COMPILE_239
	else if (__choose2 == 57)
	{
	//AddInitKind
	memset(&executor_globals.user_error_handlers, 0, sizeof (*(&executor_globals.user_error_handlers)));
	}
	#endif
	#ifdef __COMPILE_240
	else if (__choose2 == 58)
	{
	//AddInitKind
	memset(&executor_globals.user_error_handlers_error_reporting, 0, sizeof (*(&executor_globals.user_error_handlers_error_reporting)));
	}
	#endif
	#ifdef __COMPILE_241
	else if (__choose2 == 59)
	{
	//AddInitKind
	memset(&executor_globals.user_exception_handler, 0, sizeof (*(&executor_globals.user_exception_handler)));
	}
	#endif
	#ifdef __COMPILE_242
	else if (__choose2 == 60)
	{
	//AddInitKind
	memset(&executor_globals.user_exception_handlers, 0, sizeof (*(&executor_globals.user_exception_handlers)));
	}
	#endif
	#ifdef __COMPILE_243
	else if (__choose2 == 61)
	{
	//AddInitKind
	memset(&executor_globals.zend_constants, 0, sizeof (*(&executor_globals.zend_constants)));
	}
	#endif
	#ifdef __COMPILE_244
	else if (__choose2 == 62)
	{
	//AddInitKind
	memset(&intern->_path, 0, sizeof (*(&intern->_path)));
	}
	#endif
	#ifdef __COMPILE_245
	else if (__choose2 == 63)
	{
	//AddInitKind
	memset(&intern->_path_len, 0, sizeof (*(&intern->_path_len)));
	}
	#endif
	#ifdef __COMPILE_246
	else if (__choose2 == 64)
	{
	//AddInitKind
	memset(&intern->file_class, 0, sizeof (*(&intern->file_class)));
	}
	#endif
	#ifdef __COMPILE_247
	else if (__choose2 == 65)
	{
	//AddInitKind
	memset(&intern->file_name, 0, sizeof (*(&intern->file_name)));
	}
	#endif
	#ifdef __COMPILE_248
	else if (__choose2 == 66)
	{
	//AddInitKind
	memset(&intern->file_name_len, 0, sizeof (*(&intern->file_name_len)));
	}
	#endif
	#ifdef __COMPILE_249
	else if (__choose2 == 67)
	{
	//AddInitKind
	memset(&intern->flags, 0, sizeof (*(&intern->flags)));
	}
	#endif
	#ifdef __COMPILE_250
	else if (__choose2 == 68)
	{
	//AddInitKind
	memset(&intern->info_class, 0, sizeof (*(&intern->info_class)));
	}
	#endif
	#ifdef __COMPILE_251
	else if (__choose2 == 69)
	{
	//AddInitKind
	memset(&intern->it, 0, sizeof (*(&intern->it)));
	}
	#endif
	#ifdef __COMPILE_252
	else if (__choose2 == 70)
	{
	//AddInitKind
	memset(&intern->orig_path, 0, sizeof (*(&intern->orig_path)));
	}
	#endif
	#ifdef __COMPILE_253
	else if (__choose2 == 71)
	{
	//AddInitKind
	memset(&intern->oth, 0, sizeof (*(&intern->oth)));
	}
	#endif
	#ifdef __COMPILE_254
	else if (__choose2 == 72)
	{
	//AddInitKind
	memset(&intern->oth_handler, 0, sizeof (*(&intern->oth_handler)));
	}
	#endif
	#ifdef __COMPILE_255
	else if (__choose2 == 73)
	{
	//AddInitKind
	memset(&intern->std, 0, sizeof (*(&intern->std)));
	}
	#endif
	#ifdef __COMPILE_256
	else if (__choose2 == 74)
	{
	//AddInitKind
	memset(&intern->type, 0, sizeof (*(&intern->type)));
	}
	#endif
	#ifdef __COMPILE_257
	else if (__choose2 == 75)
	{
	//AddInitKind
	memset(&intern->u, 0, sizeof (*(&intern->u)));
	}
	#endif
	#ifdef __COMPILE_258
	else if (__choose2 == 76)
	{
	//AddInitKind
	memset(&intern->u.dir, 0, sizeof (*(&intern->u.dir)));
	}
	#endif
	#ifdef __COMPILE_259
	else if (__choose2 == 77)
	{
	//AddInitKind
	memset(&intern->u.dir.dirp, 0, sizeof (*(&intern->u.dir.dirp)));
	}
	#endif
	#ifdef __COMPILE_260
	else if (__choose2 == 78)
	{
	//AddInitKind
	memset(&intern->u.dir.entry, 0, sizeof (*(&intern->u.dir.entry)));
	}
	#endif
	#ifdef __COMPILE_261
	else if (__choose2 == 79)
	{
	//AddInitKind
	memset(&intern->u.dir.entry.d_name, 0, sizeof (*(&intern->u.dir.entry.d_name)));
	}
	#endif
	#ifdef __COMPILE_262
	else if (__choose2 == 80)
	{
	//AddInitKind
	memset(&intern->u.dir.func_next, 0, sizeof (*(&intern->u.dir.func_next)));
	}
	#endif
	#ifdef __COMPILE_263
	else if (__choose2 == 81)
	{
	//AddInitKind
	memset(&intern->u.dir.func_rewind, 0, sizeof (*(&intern->u.dir.func_rewind)));
	}
	#endif
	#ifdef __COMPILE_264
	else if (__choose2 == 82)
	{
	//AddInitKind
	memset(&intern->u.dir.func_valid, 0, sizeof (*(&intern->u.dir.func_valid)));
	}
	#endif
	#ifdef __COMPILE_265
	else if (__choose2 == 83)
	{
	//AddInitKind
	memset(&intern->u.dir.index, 0, sizeof (*(&intern->u.dir.index)));
	}
	#endif
	#ifdef __COMPILE_266
	else if (__choose2 == 84)
	{
	//AddInitKind
	memset(&intern->u.dir.is_recursive, 0, sizeof (*(&intern->u.dir.is_recursive)));
	}
	#endif
	#ifdef __COMPILE_267
	else if (__choose2 == 85)
	{
	//AddInitKind
	memset(&intern->u.dir.sub_path, 0, sizeof (*(&intern->u.dir.sub_path)));
	}
	#endif
	#ifdef __COMPILE_268
	else if (__choose2 == 86)
	{
	//AddInitKind
	memset(&intern->u.dir.sub_path_len, 0, sizeof (*(&intern->u.dir.sub_path_len)));
	}
	#endif
	#ifdef __COMPILE_269
	else if (__choose2 == 87)
	{
	//AddInitKind
	memset(&intern->u.file, 0, sizeof (*(&intern->u.file)));
	}
	#endif
	#ifdef __COMPILE_270
	else if (__choose2 == 88)
	{
	//AddInitKind
	memset(executor_globals.This, 0, sizeof (*(executor_globals.This)));
	}
	#endif
	#ifdef __COMPILE_271
	else if (__choose2 == 89)
	{
	//AddInitKind
	memset(executor_globals.active_op_array, 0, sizeof (*(executor_globals.active_op_array)));
	}
	#endif
	#ifdef __COMPILE_272
	else if (__choose2 == 90)
	{
	//AddInitKind
	memset(executor_globals.active_symbol_table, 0, sizeof (*(executor_globals.active_symbol_table)));
	}
	#endif
	#ifdef __COMPILE_273
	else if (__choose2 == 91)
	{
	//AddInitKind
	memset(executor_globals.argument_stack, 0, sizeof (*(executor_globals.argument_stack)));
	}
	#endif
	#ifdef __COMPILE_274
	else if (__choose2 == 92)
	{
	//AddInitKind
	memset(executor_globals.autoload_func, 0, sizeof (*(executor_globals.autoload_func)));
	}
	#endif
	#ifdef __COMPILE_275
	else if (__choose2 == 93)
	{
	//AddInitKind
	memset(executor_globals.bailout, 0, sizeof (*(executor_globals.bailout)));
	}
	#endif
	#ifdef __COMPILE_276
	else if (__choose2 == 94)
	{
	//AddInitKind
	memset(executor_globals.called_scope, 0, sizeof (*(executor_globals.called_scope)));
	}
	#endif
	#ifdef __COMPILE_277
	else if (__choose2 == 95)
	{
	//AddInitKind
	memset(executor_globals.class_table, 0, sizeof (*(executor_globals.class_table)));
	}
	#endif
	#ifdef __COMPILE_278
	else if (__choose2 == 96)
	{
	//AddInitKind
	memset(executor_globals.current_execute_data, 0, sizeof (*(executor_globals.current_execute_data)));
	}
	#endif
	#ifdef __COMPILE_279
	else if (__choose2 == 97)
	{
	//AddInitKind
	memset(executor_globals.current_module, 0, sizeof (*(executor_globals.current_module)));
	}
	#endif
	#ifdef __COMPILE_280
	else if (__choose2 == 98)
	{
	//AddInitKind
	memset(executor_globals.error_reporting_ini_entry, 0, sizeof (*(executor_globals.error_reporting_ini_entry)));
	}
	#endif
	#ifdef __COMPILE_281
	else if (__choose2 == 99)
	{
	//AddInitKind
	memset(executor_globals.error_zval_ptr, 0, sizeof (*(executor_globals.error_zval_ptr)));
	}
	#endif
	#ifdef __COMPILE_282
	else if (__choose2 == 100)
	{
	//AddInitKind
	memset(executor_globals.exception, 0, sizeof (*(executor_globals.exception)));
	}
	#endif
	#ifdef __COMPILE_283
	else if (__choose2 == 101)
	{
	//AddInitKind
	memset(executor_globals.exception_class, 0, sizeof (*(executor_globals.exception_class)));
	}
	#endif
	#ifdef __COMPILE_284
	else if (__choose2 == 102)
	{
	//AddInitKind
	memset(executor_globals.function_table, 0, sizeof (*(executor_globals.function_table)));
	}
	#endif
	#ifdef __COMPILE_285
	else if (__choose2 == 103)
	{
	//AddInitKind
	memset(executor_globals.in_autoload, 0, sizeof (*(executor_globals.in_autoload)));
	}
	#endif
	#ifdef __COMPILE_286
	else if (__choose2 == 104)
	{
	//AddInitKind
	memset(executor_globals.ini_directives, 0, sizeof (*(executor_globals.ini_directives)));
	}
	#endif
	#ifdef __COMPILE_287
	else if (__choose2 == 105)
	{
	//AddInitKind
	memset(executor_globals.modified_ini_directives, 0, sizeof (*(executor_globals.modified_ini_directives)));
	}
	#endif
	#ifdef __COMPILE_288
	else if (__choose2 == 106)
	{
	//AddInitKind
	memset(executor_globals.opline_before_exception, 0, sizeof (*(executor_globals.opline_before_exception)));
	}
	#endif
	#ifdef __COMPILE_289
	else if (__choose2 == 107)
	{
	//AddInitKind
	memset(executor_globals.opline_ptr, 0, sizeof (*(executor_globals.opline_ptr)));
	}
	#endif
	#ifdef __COMPILE_290
	else if (__choose2 == 108)
	{
	//AddInitKind
	memset(executor_globals.prev_exception, 0, sizeof (*(executor_globals.prev_exception)));
	}
	#endif
	#ifdef __COMPILE_291
	else if (__choose2 == 109)
	{
	//AddInitKind
	memset(executor_globals.return_value_ptr_ptr, 0, sizeof (*(executor_globals.return_value_ptr_ptr)));
	}
	#endif
	#ifdef __COMPILE_292
	else if (__choose2 == 110)
	{
	//AddInitKind
	memset(executor_globals.saved_fpu_cw_ptr, 0, sizeof (*(executor_globals.saved_fpu_cw_ptr)));
	}
	#endif
	#ifdef __COMPILE_293
	else if (__choose2 == 111)
	{
	//AddInitKind
	memset(executor_globals.scope, 0, sizeof (*(executor_globals.scope)));
	}
	#endif
	#ifdef __COMPILE_294
	else if (__choose2 == 112)
	{
	//AddInitKind
	memset(executor_globals.start_op, 0, sizeof (*(executor_globals.start_op)));
	}
	#endif
	#ifdef __COMPILE_295
	else if (__choose2 == 113)
	{
	//AddInitKind
	memset(executor_globals.symtable_cache_limit, 0, sizeof (*(executor_globals.symtable_cache_limit)));
	}
	#endif
	#ifdef __COMPILE_296
	else if (__choose2 == 114)
	{
	//AddInitKind
	memset(executor_globals.symtable_cache_ptr, 0, sizeof (*(executor_globals.symtable_cache_ptr)));
	}
	#endif
	#ifdef __COMPILE_297
	else if (__choose2 == 115)
	{
	//AddInitKind
	memset(executor_globals.uninitialized_zval_ptr, 0, sizeof (*(executor_globals.uninitialized_zval_ptr)));
	}
	#endif
	#ifdef __COMPILE_298
	else if (__choose2 == 116)
	{
	//AddInitKind
	memset(executor_globals.user_error_handler, 0, sizeof (*(executor_globals.user_error_handler)));
	}
	#endif
	#ifdef __COMPILE_299
	else if (__choose2 == 117)
	{
	//AddInitKind
	memset(executor_globals.user_exception_handler, 0, sizeof (*(executor_globals.user_exception_handler)));
	}
	#endif
	#ifdef __COMPILE_300
	else if (__choose2 == 118)
	{
	//AddInitKind
	memset(executor_globals.zend_constants, 0, sizeof (*(executor_globals.zend_constants)));
	}
	#endif
	#ifdef __COMPILE_301
	else if (__choose2 == 119)
	{
	//AddInitKind
	memset(intern, 0, sizeof (*(intern)));
	}
	#endif
	#ifdef __COMPILE_302
	else if (__choose2 == 120)
	{
	//AddInitKind
	memset(intern->_path, 0, sizeof (*(intern->_path)));
	}
	#endif
	#ifdef __COMPILE_303
	else if (__choose2 == 121)
	{
	//AddInitKind
	memset(intern->file_class, 0, sizeof (*(intern->file_class)));
	}
	#endif
	#ifdef __COMPILE_304
	else if (__choose2 == 122)
	{
	//AddInitKind
	memset(intern->file_name, 0, sizeof (*(intern->file_name)));
	}
	#endif
	#ifdef __COMPILE_305
	else if (__choose2 == 123)
	{
	//AddInitKind
	memset(intern->info_class, 0, sizeof (*(intern->info_class)));
	}
	#endif
	#ifdef __COMPILE_306
	else if (__choose2 == 124)
	{
	//AddInitKind
	memset(intern->orig_path, 0, sizeof (*(intern->orig_path)));
	}
	#endif
	#ifdef __COMPILE_307
	else if (__choose2 == 125)
	{
	//AddInitKind
	memset(intern->oth, 0, sizeof (*(intern->oth)));
	}
	#endif
	#ifdef __COMPILE_308
	else if (__choose2 == 126)
	{
	//AddInitKind
	memset(intern->oth_handler, 0, sizeof (*(intern->oth_handler)));
	}
	#endif
	#ifdef __COMPILE_309
	else if (__choose2 == 127)
	{
	//AddInitKind
	memset(intern->u.dir.dirp, 0, sizeof (*(intern->u.dir.dirp)));
	}
	#endif
	#ifdef __COMPILE_310
	else if (__choose2 == 128)
	{
	//AddInitKind
	memset(intern->u.dir.func_next, 0, sizeof (*(intern->u.dir.func_next)));
	}
	#endif
	#ifdef __COMPILE_311
	else if (__choose2 == 129)
	{
	//AddInitKind
	memset(intern->u.dir.func_rewind, 0, sizeof (*(intern->u.dir.func_rewind)));
	}
	#endif
	#ifdef __COMPILE_312
	else if (__choose2 == 130)
	{
	//AddInitKind
	memset(intern->u.dir.func_valid, 0, sizeof (*(intern->u.dir.func_valid)));
	}
	#endif
	#ifdef __COMPILE_313
	else if (__choose2 == 131)
	{
	//AddInitKind
	memset(intern->u.dir.sub_path, 0, sizeof (*(intern->u.dir.sub_path)));
	}
	#endif
	#ifdef __COMPILE_314
	else if (__choose2 == 132)
	{
	//AddStmtAndReplaceAtomKind
	(intern)->file_name_len--;
	}
	#endif
	#ifdef __COMPILE_315
	else if (__choose2 == 133)
	{
	//AddStmtAndReplaceAtomKind
	(intern)->u.dir.index++;
	}
	#endif
	#ifdef __COMPILE_316
	else if (__choose2 == 134)
	{
	//AddStmtAndReplaceAtomKind
	(intern)->u.file.current_line_num++;
	}
	#endif
	#ifdef __COMPILE_317
	else if (__choose2 == 135)
	{
	//AddStmtAndReplaceAtomKind
	(path)++;
	}
	#endif
	#ifdef __COMPILE_318
	else if (__choose2 == 136)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->_path));
	}
	#endif
	#ifdef __COMPILE_319
	else if (__choose2 == 137)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->file_name));
	}
	#endif
	#ifdef __COMPILE_320
	else if (__choose2 == 138)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->orig_path));
	}
	#endif
	#ifdef __COMPILE_321
	else if (__choose2 == 139)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->u.dir.sub_path));
	}
	#endif
	#ifdef __COMPILE_322
	else if (__choose2 == 140)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->u.file.current_line));
	}
	#endif
	#ifdef __COMPILE_323
	else if (__choose2 == 141)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((intern)->u.file.open_mode));
	}
	#endif
	#ifdef __COMPILE_324
	else if (__choose2 == 142)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((path)));
	}
	#endif
	#ifdef __COMPILE_325
	else if (__choose2 == 143)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_free(((intern)->u.dir.dirp), (1 | 2));
	}
	#endif
	#ifdef __COMPILE_326
	else if (__choose2 == 144)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_free(((intern)->u.file.stream), (((1 | 2) | 16)));
	}
	#endif
	#ifdef __COMPILE_327
	else if (__choose2 == 145)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_free(((intern)->u.file.stream), ((1 | 2)));
	}
	#endif
	#ifdef __COMPILE_328
	else if (__choose2 == 146)
	{
	//AddStmtAndReplaceAtomKind
	_php_stream_seek((((intern)->u.dir.dirp)), 0L, 0);
	}
	#endif
	#ifdef __COMPILE_329
	else if (__choose2 == 147)
	{
	//AddStmtAndReplaceAtomKind
	_zend_list_addref((*(intern)->u.file.zcontext).value.lval);
	}
	#endif
	#ifdef __COMPILE_330
	else if (__choose2 == 148)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor(((intern)->u.file.current_zval));
	}
	#endif
	#ifdef __COMPILE_331
	else if (__choose2 == 149)
	{
	//AddStmtAndReplaceAtomKind
	_zval_ptr_dtor((&(intern)->u.file.current_zval));
	}
	#endif
	#ifdef __COMPILE_332
	else if (__choose2 == 150)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = (path);
	}
	#endif
	#ifdef __COMPILE_333
	else if (__choose2 == 151)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup(((path)), (--intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_334
	else if (__choose2 == 152)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup(((path)), (intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_335
	else if (__choose2 == 153)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path && !(1 << 5)), (--intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_336
	else if (__choose2 == 154)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path && !(1 << 5)), (intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_337
	else if (__choose2 == 155)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), ((intern)->_path_len));
	}
	#endif
	#ifdef __COMPILE_338
	else if (__choose2 == 156)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), (--(intern)->_path_len));
	}
	#endif
	#ifdef __COMPILE_339
	else if (__choose2 == 157)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), (--intern && !(1 << 5)->_path_len));
	}
	#endif
	#ifdef __COMPILE_340
	else if (__choose2 == 158)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path = _estrndup((path), (intern && !(1 << 5)->_path_len));
	}
	#endif
	#ifdef __COMPILE_341
	else if (__choose2 == 159)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (0);
	}
	#endif
	#ifdef __COMPILE_342
	else if (__choose2 == 160)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (1);
	}
	#endif
	#ifdef __COMPILE_343
	else if (__choose2 == 161)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (4096);
	}
	#endif
	#ifdef __COMPILE_344
	else if (__choose2 == 162)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (8);
	}
	#endif
	#ifdef __COMPILE_345
	else if (__choose2 == 163)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = (skip_dots);
	}
	#endif
	#ifdef __COMPILE_346
	else if (__choose2 == 164)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = strlen((path));
	}
	#endif
	#ifdef __COMPILE_347
	else if (__choose2 == 165)
	{
	//AddStmtAndReplaceAtomKind
	intern->_path_len = strlen(path && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_348
	else if (__choose2 == 166)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (0);
	}
	#endif
	#ifdef __COMPILE_349
	else if (__choose2 == 167)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (1);
	}
	#endif
	#ifdef __COMPILE_350
	else if (__choose2 == 168)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (4096);
	}
	#endif
	#ifdef __COMPILE_351
	else if (__choose2 == 169)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (8);
	}
	#endif
	#ifdef __COMPILE_352
	else if (__choose2 == 170)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (SPL_FS_DIR);
	}
	#endif
	#ifdef __COMPILE_353
	else if (__choose2 == 171)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (SPL_FS_FILE);
	}
	#endif
	#ifdef __COMPILE_354
	else if (__choose2 == 172)
	{
	//AddStmtAndReplaceAtomKind
	intern->type = (SPL_FS_INFO);
	}
	#endif
	#ifdef __COMPILE_355
	else if (__choose2 == 173)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.dirp = _php_stream_opendir(((path)), (8), (((void *)0)));
	}
	#endif
	#ifdef __COMPILE_356
	else if (__choose2 == 174)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.dirp = _php_stream_opendir((path && !(1 << 5)), (8), (((void *)0)));
	}
	#endif
	#ifdef __COMPILE_357
	else if (__choose2 == 175)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (0);
	}
	#endif
	#ifdef __COMPILE_358
	else if (__choose2 == 176)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (1);
	}
	#endif
	#ifdef __COMPILE_359
	else if (__choose2 == 177)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (4096);
	}
	#endif
	#ifdef __COMPILE_360
	else if (__choose2 == 178)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.entry.d_name[0] = (8);
	}
	#endif
	#ifdef __COMPILE_361
	else if (__choose2 == 179)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (0);
	}
	#endif
	#ifdef __COMPILE_362
	else if (__choose2 == 180)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (1);
	}
	#endif
	#ifdef __COMPILE_363
	else if (__choose2 == 181)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (4096);
	}
	#endif
	#ifdef __COMPILE_364
	else if (__choose2 == 182)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (8);
	}
	#endif
	#ifdef __COMPILE_365
	else if (__choose2 == 183)
	{
	//AddStmtAndReplaceAtomKind
	intern->u.dir.index = (skip_dots);
	}
	#endif
	#ifdef __COMPILE_366
	else if (__choose2 == 184)
	{
	//AddStmtAndReplaceAtomKind
	memcpy(&spl_filesystem_object_handlers && !(1 << 5), zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_367
	else if (__choose2 == 185)
	{
	//AddStmtAndReplaceAtomKind
	memset((intern), 0, sizeof(spl_filesystem_object));
	}
	#endif
	#ifdef __COMPILE_368
	else if (__choose2 == 186)
	{
	//AddStmtAndReplaceAtomKind
	rebuild_object_properties(&(intern)->std);
	}
	#endif
	#ifdef __COMPILE_369
	else if (__choose2 == 187)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_dir_read((intern));
	}
	#endif
	#ifdef __COMPILE_370
	else if (__choose2 == 188)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_dir_read(intern && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_371
	else if (__choose2 == 189)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_file_free_line((intern));
	}
	#endif
	#ifdef __COMPILE_372
	else if (__choose2 == 190)
	{
	//AddStmtAndReplaceAtomKind
	spl_filesystem_object_get_file_name((intern));
	}
	#endif
	#ifdef __COMPILE_373
	else if (__choose2 == 191)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_std_class(&spl_ce_SplFileInfo && !(1 << 5), "SplFileInfo", spl_filesystem_object_new, spl_SplFileInfo_functions);
	}
	#endif
	#ifdef __COMPILE_374
	else if (__choose2 == 192)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_std_class(&spl_ce_SplFileInfo, "SplFileInfo", spl_filesystem_object_new, spl_SplFileInfo_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_375
	else if (__choose2 == 193)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_DirectoryIterator && !(1 << 5), spl_ce_SplFileInfo, "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_376
	else if (__choose2 == 194)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_DirectoryIterator, spl_ce_SplFileInfo && !(1 << 5), "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_377
	else if (__choose2 == 195)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_DirectoryIterator, spl_ce_SplFileInfo, "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_378
	else if (__choose2 == 196)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_FilesystemIterator && !(1 << 5), spl_ce_DirectoryIterator, "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions);
	}
	#endif
	#ifdef __COMPILE_379
	else if (__choose2 == 197)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_FilesystemIterator, spl_ce_DirectoryIterator && !(1 << 5), "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions);
	}
	#endif
	#ifdef __COMPILE_380
	else if (__choose2 == 198)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_FilesystemIterator, spl_ce_DirectoryIterator, "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_381
	else if (__choose2 == 199)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_GlobIterator && !(1 << 5), spl_ce_FilesystemIterator, "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions);
	}
	#endif
	#ifdef __COMPILE_382
	else if (__choose2 == 200)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_GlobIterator, spl_ce_FilesystemIterator && !(1 << 5), "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions);
	}
	#endif
	#ifdef __COMPILE_383
	else if (__choose2 == 201)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_GlobIterator, spl_ce_FilesystemIterator, "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_384
	else if (__choose2 == 202)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator && !(1 << 5), spl_ce_FilesystemIterator, "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_385
	else if (__choose2 == 203)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator, spl_ce_FilesystemIterator && !(1 << 5), "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_386
	else if (__choose2 == 204)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator, spl_ce_FilesystemIterator, "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_387
	else if (__choose2 == 205)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplFileObject && !(1 << 5), spl_ce_SplFileInfo, "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_388
	else if (__choose2 == 206)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplFileObject, spl_ce_SplFileInfo && !(1 << 5), "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_389
	else if (__choose2 == 207)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplFileObject, spl_ce_SplFileInfo, "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_390
	else if (__choose2 == 208)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplTempFileObject && !(1 << 5), spl_ce_SplFileObject, "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_391
	else if (__choose2 == 209)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplTempFileObject, spl_ce_SplFileObject && !(1 << 5), "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_392
	else if (__choose2 == 210)
	{
	//AddStmtAndReplaceAtomKind
	spl_register_sub_class(&spl_ce_SplTempFileObject, spl_ce_SplFileObject, "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_393
	else if (__choose2 == 211)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator && !(1 << 5), 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_394
	else if (__choose2 == 212)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator && !(1 << 5), 1, zend_ce_iterator);
	}
	#endif
	#ifdef __COMPILE_395
	else if (__choose2 == 213)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, spl_ce_SeekableIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_396
	else if (__choose2 == 214)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, zend_ce_iterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_397
	else if (__choose2 == 215)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_GlobIterator && !(1 << 5), 1, spl_ce_Countable);
	}
	#endif
	#ifdef __COMPILE_398
	else if (__choose2 == 216)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_GlobIterator, 1, spl_ce_Countable && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_399
	else if (__choose2 == 217)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_RecursiveDirectoryIterator && !(1 << 5), 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_400
	else if (__choose2 == 218)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_RecursiveDirectoryIterator, 1, spl_ce_RecursiveIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_401
	else if (__choose2 == 219)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject && !(1 << 5), 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_402
	else if (__choose2 == 220)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject && !(1 << 5), 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_403
	else if (__choose2 == 221)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_RecursiveIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_404
	else if (__choose2 == 222)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_SeekableIterator && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_405
	else if (__choose2 == 223)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_AS_FILEINFO", sizeof ("CURRENT_AS_FILEINFO") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_406
	else if (__choose2 == 224)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_AS_PATHNAME", sizeof ("CURRENT_AS_PATHNAME") - 1, (long)32);
	}
	#endif
	#ifdef __COMPILE_407
	else if (__choose2 == 225)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_AS_SELF", sizeof ("CURRENT_AS_SELF") - 1, (long)16);
	}
	#endif
	#ifdef __COMPILE_408
	else if (__choose2 == 226)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "CURRENT_MODE_MASK", sizeof ("CURRENT_MODE_MASK") - 1, (long)240);
	}
	#endif
	#ifdef __COMPILE_409
	else if (__choose2 == 227)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "FOLLOW_SYMLINKS", sizeof ("FOLLOW_SYMLINKS") - 1, (long)512);
	}
	#endif
	#ifdef __COMPILE_410
	else if (__choose2 == 228)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "KEY_AS_FILENAME", sizeof ("KEY_AS_FILENAME") - 1, (long)256);
	}
	#endif
	#ifdef __COMPILE_411
	else if (__choose2 == 229)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "KEY_AS_PATHNAME", sizeof ("KEY_AS_PATHNAME") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_412
	else if (__choose2 == 230)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "KEY_MODE_MASK", sizeof ("KEY_MODE_MASK") - 1, (long)3840);
	}
	#endif
	#ifdef __COMPILE_413
	else if (__choose2 == 231)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "NEW_CURRENT_AND_KEY", sizeof ("NEW_CURRENT_AND_KEY") - 1, (long)256 | 0);
	}
	#endif
	#ifdef __COMPILE_414
	else if (__choose2 == 232)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "SKIP_DOTS", sizeof ("SKIP_DOTS") - 1, (long)4096);
	}
	#endif
	#ifdef __COMPILE_415
	else if (__choose2 == 233)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator && !(1 << 5), "UNIX_PATHS", sizeof ("UNIX_PATHS") - 1, (long)8192);
	}
	#endif
	#ifdef __COMPILE_416
	else if (__choose2 == 234)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "DROP_NEW_LINE", sizeof ("DROP_NEW_LINE") - 1, (long)1);
	}
	#endif
	#ifdef __COMPILE_417
	else if (__choose2 == 235)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "READ_AHEAD", sizeof ("READ_AHEAD") - 1, (long)2);
	}
	#endif
	#ifdef __COMPILE_418
	else if (__choose2 == 236)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "READ_CSV", sizeof ("READ_CSV") - 1, (long)8);
	}
	#endif
	#ifdef __COMPILE_419
	else if (__choose2 == 237)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(spl_ce_SplFileObject && !(1 << 5), "SKIP_EMPTY", sizeof ("SKIP_EMPTY") - 1, (long)6);
	}
	#endif
	#ifdef __COMPILE_420
	else if (__choose2 == 238)
	{
	//AddStmtAndReplaceAtomKind
	zend_object_std_dtor(&(intern)->std);
	}
	#endif
	#ifdef __COMPILE_421
	else if (__choose2 == 239)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_DomainException && !(1 << 5), 0, "Maximum line length must be greater than or equal zero");
	}
	#endif
	#ifdef __COMPILE_422
	else if (__choose2 == 240)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_LogicException, 0, "Can't truncate file %s", (intern)->file_name);
	}
	#endif
	#ifdef __COMPILE_423
	else if (__choose2 == 241)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Could not open file");
	}
	#endif
	#ifdef __COMPILE_424
	else if (__choose2 == 242)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Directory name must not be empty.");
	}
	#endif
	#ifdef __COMPILE_425
	else if (__choose2 == 243)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Internal error, function '%s' not found. Please report", "fgetss");
	}
	#endif
	#ifdef __COMPILE_426
	else if (__choose2 == 244)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Internal error, function '%s' not found. Please report", "flock");
	}
	#endif
	#ifdef __COMPILE_427
	else if (__choose2 == 245)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Internal error, function '%s' not found. Please report", "fstat");
	}
	#endif
	#ifdef __COMPILE_428
	else if (__choose2 == 246)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException && !(1 << 5), 0, "Operation not supported");
	}
	#endif
	#ifdef __COMPILE_429
	else if (__choose2 == 247)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Cannot read from file %s", (intern)->file_name);
	}
	#endif
	#ifdef __COMPILE_430
	else if (__choose2 == 248)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Cannot rewind file %s", (intern)->file_name);
	}
	#endif
	#ifdef __COMPILE_431
	else if (__choose2 == 249)
	{
	//AddStmtAndReplaceAtomKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Unable to read link %s, error: %s", (intern)->file_name, strerror((*__errno_location())));
	}
	#endif
	#ifdef __COMPILE_432
	else if (__choose2 == 250)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p(&((intern)->u.file.zresource), 1);
	}
	#endif
	#ifdef __COMPILE_433
	else if (__choose2 == 251)
	{
	//AddStmtKind
	(executor_globals.argument_stack) = zend_vm_stack_new_page(((16 * 1024) - 16));
	}
	#endif
	#ifdef __COMPILE_434
	else if (__choose2 == 252)
	{
	//AddStmtKind
	exit(1);
	}
	#endif
	#ifdef __COMPILE_435
	else if (__choose2 == 253)
	{
	//AddStmtKind
	intern->_path = _estrndup((path), (--intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_436
	else if (__choose2 == 254)
	{
	//AddStmtKind
	intern->_path = _estrndup((path), (intern->_path_len));
	}
	#endif
	#ifdef __COMPILE_437
	else if (__choose2 == 255)
	{
	//AddStmtKind
	intern->_path_len = strlen(path);
	}
	#endif
	#ifdef __COMPILE_438
	else if (__choose2 == 256)
	{
	//AddStmtKind
	intern->type = SPL_FS_DIR;
	}
	#endif
	#ifdef __COMPILE_439
	else if (__choose2 == 257)
	{
	//AddStmtKind
	intern->u.dir.dirp = _php_stream_opendir((path), (8), (((void *)0)));
	}
	#endif
	#ifdef __COMPILE_440
	else if (__choose2 == 258)
	{
	//AddStmtKind
	intern->u.dir.entry.d_name[0] = '\x00';
	}
	#endif
	#ifdef __COMPILE_441
	else if (__choose2 == 259)
	{
	//AddStmtKind
	intern->u.dir.index = 0;
	}
	#endif
	#ifdef __COMPILE_442
	else if (__choose2 == 260)
	{
	//AddStmtKind
	memcpy(&spl_filesystem_object_handlers, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_443
	else if (__choose2 == 261)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 0L), "GlobIterator lost glob state");
	}
	#endif
	#ifdef __COMPILE_444
	else if (__choose2 == 262)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "No such file or directory");
	}
	#endif
	#ifdef __COMPILE_445
	else if (__choose2 == 263)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "delimiter must be a character");
	}
	#endif
	#ifdef __COMPILE_446
	else if (__choose2 == 264)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "enclosure must be a character");
	}
	#endif
	#ifdef __COMPILE_447
	else if (__choose2 == 265)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "escape must be a character");
	}
	#endif
	#ifdef __COMPILE_448
	else if (__choose2 == 266)
	{
	//AddStmtKind
	spl_ce_DirectoryIterator->get_iterator = spl_filesystem_dir_get_iterator;
	}
	#endif
	#ifdef __COMPILE_449
	else if (__choose2 == 267)
	{
	//AddStmtKind
	spl_ce_FilesystemIterator->get_iterator = spl_filesystem_tree_get_iterator;
	}
	#endif
	#ifdef __COMPILE_450
	else if (__choose2 == 268)
	{
	//AddStmtKind
	spl_ce_SplFileInfo->serialize = zend_class_serialize_deny;
	}
	#endif
	#ifdef __COMPILE_451
	else if (__choose2 == 269)
	{
	//AddStmtKind
	spl_ce_SplFileInfo->unserialize = zend_class_unserialize_deny;
	}
	#endif
	#ifdef __COMPILE_452
	else if (__choose2 == 270)
	{
	//AddStmtKind
	spl_filesystem_dir_read(intern);
	}
	#endif
	#ifdef __COMPILE_453
	else if (__choose2 == 271)
	{
	//AddStmtKind
	spl_filesystem_object_handlers.cast_object = spl_filesystem_object_cast;
	}
	#endif
	#ifdef __COMPILE_454
	else if (__choose2 == 272)
	{
	//AddStmtKind
	spl_filesystem_object_handlers.clone_obj = spl_filesystem_object_clone;
	}
	#endif
	#ifdef __COMPILE_455
	else if (__choose2 == 273)
	{
	//AddStmtKind
	spl_filesystem_object_handlers.get_debug_info = spl_filesystem_object_get_debug_info;
	}
	#endif
	#ifdef __COMPILE_456
	else if (__choose2 == 274)
	{
	//AddStmtKind
	spl_register_std_class(&spl_ce_SplFileInfo, "SplFileInfo", spl_filesystem_object_new, spl_SplFileInfo_functions);
	}
	#endif
	#ifdef __COMPILE_457
	else if (__choose2 == 275)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_DirectoryIterator, spl_ce_SplFileInfo, "DirectoryIterator", spl_filesystem_object_new, spl_DirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_458
	else if (__choose2 == 276)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_FilesystemIterator, spl_ce_DirectoryIterator, "FilesystemIterator", spl_filesystem_object_new, spl_FilesystemIterator_functions);
	}
	#endif
	#ifdef __COMPILE_459
	else if (__choose2 == 277)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_GlobIterator, spl_ce_FilesystemIterator, "GlobIterator", spl_filesystem_object_new, spl_GlobIterator_functions);
	}
	#endif
	#ifdef __COMPILE_460
	else if (__choose2 == 278)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_RecursiveDirectoryIterator, spl_ce_FilesystemIterator, "RecursiveDirectoryIterator", spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions);
	}
	#endif
	#ifdef __COMPILE_461
	else if (__choose2 == 279)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_SplFileObject, spl_ce_SplFileInfo, "SplFileObject", spl_filesystem_object_new, spl_SplFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_462
	else if (__choose2 == 280)
	{
	//AddStmtKind
	spl_register_sub_class(&spl_ce_SplTempFileObject, spl_ce_SplFileObject, "SplTempFileObject", spl_filesystem_object_new, spl_SplTempFileObject_functions);
	}
	#endif
	#ifdef __COMPILE_463
	else if (__choose2 == 281)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_464
	else if (__choose2 == 282)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_DirectoryIterator, 1, zend_ce_iterator);
	}
	#endif
	#ifdef __COMPILE_465
	else if (__choose2 == 283)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_GlobIterator, 1, spl_ce_Countable);
	}
	#endif
	#ifdef __COMPILE_466
	else if (__choose2 == 284)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_RecursiveDirectoryIterator, 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_467
	else if (__choose2 == 285)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_RecursiveIterator);
	}
	#endif
	#ifdef __COMPILE_468
	else if (__choose2 == 286)
	{
	//AddStmtKind
	zend_class_implements(spl_ce_SplFileObject, 1, spl_ce_SeekableIterator);
	}
	#endif
	#ifdef __COMPILE_469
	else if (__choose2 == 287)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_AS_FILEINFO", sizeof ("CURRENT_AS_FILEINFO") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_470
	else if (__choose2 == 288)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_AS_PATHNAME", sizeof ("CURRENT_AS_PATHNAME") - 1, (long)32);
	}
	#endif
	#ifdef __COMPILE_471
	else if (__choose2 == 289)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_AS_SELF", sizeof ("CURRENT_AS_SELF") - 1, (long)16);
	}
	#endif
	#ifdef __COMPILE_472
	else if (__choose2 == 290)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "CURRENT_MODE_MASK", sizeof ("CURRENT_MODE_MASK") - 1, (long)240);
	}
	#endif
	#ifdef __COMPILE_473
	else if (__choose2 == 291)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "FOLLOW_SYMLINKS", sizeof ("FOLLOW_SYMLINKS") - 1, (long)512);
	}
	#endif
	#ifdef __COMPILE_474
	else if (__choose2 == 292)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "KEY_AS_FILENAME", sizeof ("KEY_AS_FILENAME") - 1, (long)256);
	}
	#endif
	#ifdef __COMPILE_475
	else if (__choose2 == 293)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "KEY_AS_PATHNAME", sizeof ("KEY_AS_PATHNAME") - 1, (long)0);
	}
	#endif
	#ifdef __COMPILE_476
	else if (__choose2 == 294)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "KEY_MODE_MASK", sizeof ("KEY_MODE_MASK") - 1, (long)3840);
	}
	#endif
	#ifdef __COMPILE_477
	else if (__choose2 == 295)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "NEW_CURRENT_AND_KEY", sizeof ("NEW_CURRENT_AND_KEY") - 1, (long)256 | 0);
	}
	#endif
	#ifdef __COMPILE_478
	else if (__choose2 == 296)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "SKIP_DOTS", sizeof ("SKIP_DOTS") - 1, (long)4096);
	}
	#endif
	#ifdef __COMPILE_479
	else if (__choose2 == 297)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_FilesystemIterator, "UNIX_PATHS", sizeof ("UNIX_PATHS") - 1, (long)8192);
	}
	#endif
	#ifdef __COMPILE_480
	else if (__choose2 == 298)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "DROP_NEW_LINE", sizeof ("DROP_NEW_LINE") - 1, (long)1);
	}
	#endif
	#ifdef __COMPILE_481
	else if (__choose2 == 299)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "READ_AHEAD", sizeof ("READ_AHEAD") - 1, (long)2);
	}
	#endif
	#ifdef __COMPILE_482
	else if (__choose2 == 300)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "READ_CSV", sizeof ("READ_CSV") - 1, (long)8);
	}
	#endif
	#ifdef __COMPILE_483
	else if (__choose2 == 301)
	{
	//AddStmtKind
	zend_declare_class_constant_long(spl_ce_SplFileObject, "SKIP_EMPTY", sizeof ("SKIP_EMPTY") - 1, (long)6);
	}
	#endif
	#ifdef __COMPILE_484
	else if (__choose2 == 302)
	{
	//AddStmtKind
	zend_error((1 << 0L), "An iterator cannot be used with foreach by reference");
	}
	#endif
	#ifdef __COMPILE_485
	else if (__choose2 == 303)
	{
	//AddStmtKind
	zend_error((1 << 3L), "A non well formed numeric value encountered");
	}
	#endif
	#ifdef __COMPILE_486
	else if (__choose2 == 304)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_DomainException, 0, "Maximum line length must be greater than or equal zero");
	}
	#endif
	#ifdef __COMPILE_487
	else if (__choose2 == 305)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Could not open file");
	}
	#endif
	#ifdef __COMPILE_488
	else if (__choose2 == 306)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Directory name must not be empty.");
	}
	#endif
	#ifdef __COMPILE_489
	else if (__choose2 == 307)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Internal error, function '%s' not found. Please report", "fgetss");
	}
	#endif
	#ifdef __COMPILE_490
	else if (__choose2 == 308)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Internal error, function '%s' not found. Please report", "flock");
	}
	#endif
	#ifdef __COMPILE_491
	else if (__choose2 == 309)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Internal error, function '%s' not found. Please report", "fstat");
	}
	#endif
	#ifdef __COMPILE_492
	else if (__choose2 == 310)
	{
	//AddStmtKind
	zend_throw_exception_ex(spl_ce_RuntimeException, 0, "Operation not supported");
	}
	#endif
	#ifdef __COMPILE_493
	else if (__choose2 == 311)
	{
	//IfExitKind
	if (__is_neg("2-311", "L237", 22, &(intern), sizeof (intern), &(intern->u.dir.dirp),
				 sizeof (intern->u.dir.dirp), &(skip_dots), sizeof (skip_dots), &(intern->u.dir.index), sizeof (intern->u.dir.index), &(path),
				 sizeof (path), &(intern->_path), sizeof (intern->_path), &(intern->_path_len), sizeof (intern->_path_len), &(intern->type),
				 sizeof (intern->type), &(intern->flags), sizeof (intern->flags), &(intern->oth), sizeof (intern->oth), &(intern->oth_handler),
				 sizeof (intern->oth_handler), &(intern->orig_path), sizeof (intern->orig_path), &(intern->file_name), sizeof (intern->file_name), &(intern->file_name_len),
				 sizeof (intern->file_name_len), &(intern->file_class), sizeof (intern->file_class), &(intern->info_class), sizeof (intern->info_class), &(intern->u.dir.sub_path),
				 sizeof (intern->u.dir.sub_path), &(intern->u.dir.sub_path_len), sizeof (intern->u.dir.sub_path_len), &(intern->u.dir.is_recursive), sizeof (intern->u.dir.is_recursive), &(intern->u.dir.func_rewind),
				 sizeof (intern->u.dir.func_rewind), &(intern->u.dir.func_next), sizeof (intern->u.dir.func_next), &(intern->u.dir.func_valid), sizeof (intern->u.dir.func_valid)))
	    return;
	}
	#endif
	int __choose3 = __choose("__SWITCH3");
	if (__choose3 == 0)
	{
	intern->u.dir.entry.d_name[0] = '\0';
	
	}
	#ifdef __COMPILE_494
	else if (__choose3 == 1)
	{
	//GuardKind
	if (!__is_neg("3-1", "L237", 22, &(intern), sizeof (intern), &(intern->u.dir.dirp), sizeof (intern->u.dir.dirp), &(skip_dots), sizeof (skip_dots), &(intern->u.dir.index), sizeof (intern->u.dir.index), &(path), sizeof (path), &(intern->_path), sizeof (intern->_path), &(intern->_path_len), sizeof (intern->_path_len), &(intern->type), sizeof (intern->type), &(intern->flags), sizeof (intern->flags), &(intern->oth), sizeof (intern->oth), &(intern->oth_handler), sizeof (intern->oth_handler), &(intern->orig_path), sizeof (intern->orig_path), &(intern->file_name), sizeof (intern->file_name), &(intern->file_name_len), sizeof (intern->file_name_len), &(intern->file_class), sizeof (intern->file_class), &(intern->info_class), sizeof (intern->info_class), &(intern->u.dir.sub_path), sizeof (intern->u.dir.sub_path), &(intern->u.dir.sub_path_len), sizeof (intern->u.dir.sub_path_len), &(intern->u.dir.is_recursive), sizeof (intern->u.dir.is_recursive), &(intern->u.dir.func_rewind), sizeof (intern->u.dir.func_rewind), &(intern->u.dir.func_next), sizeof (intern->u.dir.func_next), &(intern->u.dir.func_valid), sizeof (intern->u.dir.func_valid)))
	    intern->u.dir.entry.d_name[0] = '\x00';
	
	}
	#endif
	#ifdef __COMPILE_495
	else if (__choose3 == 2)
	{
	//MSVExtRemoveStmtKind
	{
	}
	
	}
	#endif
	#ifdef __COMPILE_496
	else if (__choose3 == 3)
	{
	//ReplaceKind
	intern->u.dir.entry.d_name[0] = (0);
	
	}
	#endif
	#ifdef __COMPILE_497
	else if (__choose3 == 4)
	{
	//ReplaceKind
	intern->u.dir.entry.d_name[0] = (1);
	
	}
	#endif
	#ifdef __COMPILE_498
	else if (__choose3 == 5)
	{
	//ReplaceKind
	intern->u.dir.entry.d_name[0] = (4096);
	
	}
	#endif
	#ifdef __COMPILE_499
	else if (__choose3 == 6)
	{
	//ReplaceKind
	intern->u.dir.entry.d_name[0] = (8);
	
	}
	#endif
	}
		} else {
			do {
				spl_filesystem_dir_read(intern TSRMLS_CC);
			} while (skip_dots && spl_filesystem_is_dot(intern->u.dir.entry.d_name));
		}
	}
	}
}
/* }}} */

static int spl_filesystem_file_open(spl_filesystem_object *intern, int use_include_path, int silent TSRMLS_DC) /* {{{ */
{
	intern->type = SPL_FS_FILE;
	intern->u.file.context = php_stream_context_from_zval(intern->u.file.zcontext, 0);
	intern->u.file.stream = php_stream_open_wrapper_ex(intern->file_name, intern->u.file.open_mode, (use_include_path ? USE_PATH : 0) | REPORT_ERRORS, NULL, intern->u.file.context);

	if (!intern->file_name_len || !intern->u.file.stream) {
		if (!EG(exception)) {
			zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Cannot open file '%s'", intern->file_name_len ? intern->file_name : "");
		}
		intern->file_name = NULL; /* until here it is not a copy */
		intern->u.file.open_mode = NULL;
		return FAILURE;
	}

	if (intern->u.file.zcontext) {
		zend_list_addref(Z_RESVAL_P(intern->u.file.zcontext));
	}

	if (intern->file_name_len > 1 && IS_SLASH_AT(intern->file_name, intern->file_name_len-1)) {
		intern->file_name_len--;
	}

	intern->orig_path = estrndup(intern->u.file.stream->orig_path, strlen(intern->u.file.stream->orig_path));

	intern->file_name = estrndup(intern->file_name, intern->file_name_len);
	intern->u.file.open_mode = estrndup(intern->u.file.open_mode, intern->u.file.open_mode_len);

	/* avoid reference counting in debug mode, thus do it manually */
	ZVAL_RESOURCE(&intern->u.file.zresource, php_stream_get_resource_id(intern->u.file.stream));
	Z_SET_REFCOUNT(intern->u.file.zresource, 1);
	
	intern->u.file.delimiter = ',';
	intern->u.file.enclosure = '"';
	intern->u.file.escape = '\\';

	zend_hash_find(&intern->std.ce->function_table, "getcurrentline", sizeof("getcurrentline"), (void **) &intern->u.file.func_getCurr);

	return SUCCESS;
} /* }}} */

/* {{{ spl_filesystem_object_clone */
/* Local zend_object_value creation (on stack)
   Load the 'other' object 
   Create a new empty object (See spl_filesystem_object_new_ex)
   Open the directory
   Clone other members (properties)
 */
static zend_object_value spl_filesystem_object_clone(zval *zobject TSRMLS_DC)
{
	zend_object_value new_obj_val;
	zend_object *old_object;
	zend_object *new_object;
	zend_object_handle handle = Z_OBJ_HANDLE_P(zobject);
	spl_filesystem_object *intern;
	spl_filesystem_object *source;
	int index, skip_dots;

	old_object = zend_objects_get_address(zobject TSRMLS_CC);
	source = (spl_filesystem_object*)old_object;

	new_obj_val = spl_filesystem_object_new_ex(old_object->ce, &intern TSRMLS_CC);
	new_object = &intern->std;

	intern->flags = source->flags;

	switch (source->type) {
	case SPL_FS_INFO:
		intern->_path_len = source->_path_len;
		intern->_path = estrndup(source->_path, source->_path_len);
		intern->file_name_len = source->file_name_len;
		intern->file_name = estrndup(source->file_name, intern->file_name_len);
		break;
	case SPL_FS_DIR:
		spl_filesystem_dir_open(intern, source->_path TSRMLS_CC);
		/* read until we hit the position in which we were before */
		skip_dots = SPL_HAS_FLAG(source->flags, SPL_FILE_DIR_SKIPDOTS);
		for(index = 0; index < source->u.dir.index; ++index) {
			do {
				spl_filesystem_dir_read(intern TSRMLS_CC);
			} while (skip_dots && spl_filesystem_is_dot(intern->u.dir.entry.d_name));
		}
		intern->u.dir.index = index;
		break;
	case SPL_FS_FILE:
		php_error_docref(NULL TSRMLS_CC, E_ERROR, "An object of class %s cannot be cloned", old_object->ce->name);
		break;
	}
	
	intern->file_class = source->file_class;
	intern->info_class = source->info_class;
	intern->oth = source->oth;
	intern->oth_handler = source->oth_handler;

	zend_objects_clone_members(new_object, new_obj_val, old_object, handle TSRMLS_CC);

	if (intern->oth_handler && intern->oth_handler->clone) {
		intern->oth_handler->clone(source, intern TSRMLS_CC);
	}

	return new_obj_val;
}
/* }}} */

void spl_filesystem_info_set_filename(spl_filesystem_object *intern, char *path, int len, int use_copy TSRMLS_DC) /* {{{ */
{
	char *p1, *p2;

	intern->file_name = use_copy ? estrndup(path, len) : path;
	intern->file_name_len = len;

	while(IS_SLASH_AT(intern->file_name, intern->file_name_len-1) && intern->file_name_len > 1) {
		intern->file_name[intern->file_name_len-1] = 0;
		intern->file_name_len--;
	}

	p1 = strrchr(intern->file_name, '/');
#if defined(PHP_WIN32) || defined(NETWARE)
	p2 = strrchr(intern->file_name, '\\');
#else
	p2 = 0;
#endif
	if (p1 || p2) {
		intern->_path_len = (p1 > p2 ? p1 : p2) - intern->file_name;
	} else {
		intern->_path_len = 0;
	}

	intern->_path = estrndup(path, intern->_path_len);
} /* }}} */

static spl_filesystem_object * spl_filesystem_object_create_info(spl_filesystem_object *source, char *file_path, int file_path_len, int use_copy, zend_class_entry *ce, zval *return_value TSRMLS_DC) /* {{{ */
{
	spl_filesystem_object *intern;
	zval *arg1;
	zend_error_handling error_handling;

	if (!file_path || !file_path_len) {
#if defined(PHP_WIN32)
		zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Cannot create SplFileInfo for empty path");
		if (file_path && !use_copy) {
			efree(file_path);
		}
#else
		if (file_path && !use_copy) {
			efree(file_path);
		}
		use_copy = 1;
		file_path_len = 1;
		file_path = "/";
#endif
		return NULL;
	}

	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);

	ce = ce ? ce : source->info_class;

	zend_update_class_constants(ce TSRMLS_CC);

	return_value->value.obj = spl_filesystem_object_new_ex(ce, &intern TSRMLS_CC);
	Z_TYPE_P(return_value) = IS_OBJECT;

	if (ce->constructor->common.scope != spl_ce_SplFileInfo) {
		MAKE_STD_ZVAL(arg1);
		ZVAL_STRINGL(arg1, file_path, file_path_len, use_copy);
		zend_call_method_with_1_params(&return_value, ce, &ce->constructor, "__construct", NULL, arg1);
		zval_ptr_dtor(&arg1);
	} else {
		spl_filesystem_info_set_filename(intern, file_path, file_path_len, use_copy TSRMLS_CC);
	}
	
	zend_restore_error_handling(&error_handling TSRMLS_CC);
	return intern;
} /* }}} */

static spl_filesystem_object * spl_filesystem_object_create_type(int ht, spl_filesystem_object *source, int type, zend_class_entry *ce, zval *return_value TSRMLS_DC) /* {{{ */
{
	spl_filesystem_object *intern;
	zend_bool use_include_path = 0;
	zval *arg1, *arg2;
	zend_error_handling error_handling;

	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);

	switch (source->type) {
	case SPL_FS_INFO:
	case SPL_FS_FILE:
		break;
	case SPL_FS_DIR:
		if (!source->u.dir.entry.d_name[0]) {
			zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Could not open file");
			zend_restore_error_handling(&error_handling TSRMLS_CC);
			return NULL;
		}
	}

	switch (type) {
	case SPL_FS_INFO:
		ce = ce ? ce : source->info_class;

		zend_update_class_constants(ce TSRMLS_CC);

		return_value->value.obj = spl_filesystem_object_new_ex(ce, &intern TSRMLS_CC);
		Z_TYPE_P(return_value) = IS_OBJECT;

		spl_filesystem_object_get_file_name(source TSRMLS_CC);
		if (ce->constructor->common.scope != spl_ce_SplFileInfo) {
			MAKE_STD_ZVAL(arg1);
			ZVAL_STRINGL(arg1, source->file_name, source->file_name_len, 1);
			zend_call_method_with_1_params(&return_value, ce, &ce->constructor, "__construct", NULL, arg1);
			zval_ptr_dtor(&arg1);
		} else {
			intern->file_name = estrndup(source->file_name, source->file_name_len);
			intern->file_name_len = source->file_name_len;
			intern->_path = spl_filesystem_object_get_path(source, &intern->_path_len TSRMLS_CC);
			intern->_path = estrndup(intern->_path, intern->_path_len);
		}
		break;
	case SPL_FS_FILE:
		ce = ce ? ce : source->file_class;

		zend_update_class_constants(ce TSRMLS_CC);

		return_value->value.obj = spl_filesystem_object_new_ex(ce, &intern TSRMLS_CC);
		Z_TYPE_P(return_value) = IS_OBJECT;
	
		spl_filesystem_object_get_file_name(source TSRMLS_CC);

		if (ce->constructor->common.scope != spl_ce_SplFileObject) {
			MAKE_STD_ZVAL(arg1);
			MAKE_STD_ZVAL(arg2);
			ZVAL_STRINGL(arg1, source->file_name, source->file_name_len, 1);
			ZVAL_STRINGL(arg2, "r", 1, 1);
			zend_call_method_with_2_params(&return_value, ce, &ce->constructor, "__construct", NULL, arg1, arg2);
			zval_ptr_dtor(&arg1);
			zval_ptr_dtor(&arg2);
		} else {
			intern->file_name = source->file_name;
			intern->file_name_len = source->file_name_len;
			intern->_path = spl_filesystem_object_get_path(source, &intern->_path_len TSRMLS_CC);
			intern->_path = estrndup(intern->_path, intern->_path_len);
		
			intern->u.file.open_mode = "r";
			intern->u.file.open_mode_len = 1;
		
			if (ht && zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|sbr", 
					&intern->u.file.open_mode, &intern->u.file.open_mode_len, 
					&use_include_path, &intern->u.file.zcontext) == FAILURE) {
				zend_restore_error_handling(&error_handling TSRMLS_CC);
				intern->u.file.open_mode = NULL;
				intern->file_name = NULL;
				zval_dtor(return_value);
				Z_TYPE_P(return_value) = IS_NULL;
				return NULL;
			}
		
			if (spl_filesystem_file_open(intern, use_include_path, 0 TSRMLS_CC) == FAILURE) {
				zend_restore_error_handling(&error_handling TSRMLS_CC);
				zval_dtor(return_value);
				Z_TYPE_P(return_value) = IS_NULL;
				return NULL;
			}
		}
		break;
	case SPL_FS_DIR:	
		zend_restore_error_handling(&error_handling TSRMLS_CC);
		zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Operation not supported");
		return NULL;
	}
	zend_restore_error_handling(&error_handling TSRMLS_CC);
	return NULL;
} /* }}} */

static int spl_filesystem_is_invalid_or_dot(const char * d_name) /* {{{ */
{
	return d_name[0] == '\0' || spl_filesystem_is_dot(d_name);
}
/* }}} */

static char *spl_filesystem_object_get_pathname(spl_filesystem_object *intern, int *len TSRMLS_DC) { /* {{{ */
	switch (intern->type) {
	case SPL_FS_INFO:
	case SPL_FS_FILE:
		*len = intern->file_name_len;
		return intern->file_name;
	case SPL_FS_DIR:
		if (intern->u.dir.entry.d_name[0]) {
			spl_filesystem_object_get_file_name(intern TSRMLS_CC);
			*len = intern->file_name_len;
			return intern->file_name;
		}
	}
	*len = 0;
	return NULL;
}
/* }}} */

static HashTable* spl_filesystem_object_get_debug_info(zval *obj, int *is_temp TSRMLS_DC) /* {{{ */
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(obj TSRMLS_CC);
	HashTable *rv;
	zval *tmp, zrv;
	char *pnstr, *path;
	int  pnlen, path_len;
	char stmp[2];

	*is_temp = 1;

	if (!intern->std.properties) {
		rebuild_object_properties(&intern->std);
	}

	ALLOC_HASHTABLE(rv);
	ZEND_INIT_SYMTABLE_EX(rv, zend_hash_num_elements(intern->std.properties) + 3, 0);

	INIT_PZVAL(&zrv);
	Z_ARRVAL(zrv) = rv;

	zend_hash_copy(rv, intern->std.properties, (copy_ctor_func_t) zval_add_ref, (void *) &tmp, sizeof(zval *));

	pnstr = spl_gen_private_prop_name(spl_ce_SplFileInfo, "pathName", sizeof("pathName")-1, &pnlen TSRMLS_CC);
	path = spl_filesystem_object_get_pathname(intern, &path_len TSRMLS_CC);
	add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, path, path_len, 1);
	efree(pnstr);

	if (intern->file_name) {
		pnstr = spl_gen_private_prop_name(spl_ce_SplFileInfo, "fileName", sizeof("fileName")-1, &pnlen TSRMLS_CC);
		spl_filesystem_object_get_path(intern, &path_len TSRMLS_CC);
		
		if (path_len && path_len < intern->file_name_len) {
			add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, intern->file_name + path_len + 1, intern->file_name_len - (path_len + 1), 1);
		} else {
			add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, intern->file_name, intern->file_name_len, 1);
		}
		efree(pnstr);
	}
	if (intern->type == SPL_FS_DIR) {
#ifdef HAVE_GLOB
		pnstr = spl_gen_private_prop_name(spl_ce_DirectoryIterator, "glob", sizeof("glob")-1, &pnlen TSRMLS_CC);
		if (php_stream_is(intern->u.dir.dirp ,&php_glob_stream_ops)) {
			add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, intern->_path, intern->_path_len, 1);
		} else {
			add_assoc_bool_ex(&zrv, pnstr, pnlen+1, 0);
		}
		efree(pnstr);
#endif
		pnstr = spl_gen_private_prop_name(spl_ce_RecursiveDirectoryIterator, "subPathName", sizeof("subPathName")-1, &pnlen TSRMLS_CC);
		if (intern->u.dir.sub_path) {
			add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, intern->u.dir.sub_path, intern->u.dir.sub_path_len, 1);
		} else {
			add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, "", 0, 1);
		}
		efree(pnstr);
	}
	if (intern->type == SPL_FS_FILE) {
		pnstr = spl_gen_private_prop_name(spl_ce_SplFileObject, "openMode", sizeof("openMode")-1, &pnlen TSRMLS_CC);
		add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, intern->u.file.open_mode, intern->u.file.open_mode_len, 1);
		efree(pnstr);
		stmp[1] = '\0';
		stmp[0] = intern->u.file.delimiter;
		pnstr = spl_gen_private_prop_name(spl_ce_SplFileObject, "delimiter", sizeof("delimiter")-1, &pnlen TSRMLS_CC);
		add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, stmp, 1, 1);
		efree(pnstr);
		stmp[0] = intern->u.file.enclosure;
		pnstr = spl_gen_private_prop_name(spl_ce_SplFileObject, "enclosure", sizeof("enclosure")-1, &pnlen TSRMLS_CC);
		add_assoc_stringl_ex(&zrv, pnstr, pnlen+1, stmp, 1, 1);
		efree(pnstr);
	}

	return rv;
}
/* }}} */

#define DIT_CTOR_FLAGS  0x00000001
#define DIT_CTOR_GLOB   0x00000002

void spl_filesystem_object_construct(INTERNAL_FUNCTION_PARAMETERS, long ctor_flags) /* {{{ */
{
	spl_filesystem_object *intern;
	char *path;
	int parsed, len;
	long flags;
	zend_error_handling error_handling;

	zend_replace_error_handling(EH_THROW, spl_ce_UnexpectedValueException, &error_handling TSRMLS_CC);

	if (SPL_HAS_FLAG(ctor_flags, DIT_CTOR_FLAGS)) {
		flags = SPL_FILE_DIR_KEY_AS_PATHNAME|SPL_FILE_DIR_CURRENT_AS_FILEINFO;
		parsed = zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &path, &len, &flags);
	} else {
		flags = SPL_FILE_DIR_KEY_AS_PATHNAME|SPL_FILE_DIR_CURRENT_AS_SELF;
		parsed = zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &path, &len);
	}
	if (SPL_HAS_FLAG(ctor_flags, SPL_FILE_DIR_SKIPDOTS)) {
		flags |= SPL_FILE_DIR_SKIPDOTS;
	}
	if (SPL_HAS_FLAG(ctor_flags, SPL_FILE_DIR_UNIXPATHS)) {
		flags |= SPL_FILE_DIR_UNIXPATHS;
	}
	if (parsed == FAILURE) {
		zend_restore_error_handling(&error_handling TSRMLS_CC);
		return;
	}
	if (!len) {
		zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Directory name must not be empty.");
		zend_restore_error_handling(&error_handling TSRMLS_CC);
		return;
	}

	intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	intern->flags = flags;
#ifdef HAVE_GLOB
	if (SPL_HAS_FLAG(ctor_flags, DIT_CTOR_GLOB) && strstr(path, "glob://") != path) {
		spprintf(&path, 0, "glob://%s", path);
		spl_filesystem_dir_open(intern, path TSRMLS_CC);
		efree(path);
	} else
#endif
	{
		spl_filesystem_dir_open(intern, path TSRMLS_CC);

	}

	intern->u.dir.is_recursive = instanceof_function(intern->std.ce, spl_ce_RecursiveDirectoryIterator TSRMLS_CC) ? 1 : 0;

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

/* {{{ proto void DirectoryIterator::__construct(string path)
 Cronstructs a new dir iterator from a path. */
SPL_METHOD(DirectoryIterator, __construct)
{
	spl_filesystem_object_construct(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);
}
/* }}} */

/* {{{ proto void DirectoryIterator::rewind()
   Rewind dir back to the start */
SPL_METHOD(DirectoryIterator, rewind)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	intern->u.dir.index = 0;
	if (intern->u.dir.dirp) {
		php_stream_rewinddir(intern->u.dir.dirp);
	}
	spl_filesystem_dir_read(intern TSRMLS_CC);
}
/* }}} */

/* {{{ proto string DirectoryIterator::key()
   Return current dir entry */
SPL_METHOD(DirectoryIterator, key)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (intern->u.dir.dirp) {
		RETURN_LONG(intern->u.dir.index);
	} else {
		RETURN_FALSE;
	}
}
/* }}} */

/* {{{ proto DirectoryIterator DirectoryIterator::current()
   Return this (needed for Iterator interface) */
SPL_METHOD(DirectoryIterator, current)
{
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}
	RETURN_ZVAL(getThis(), 1, 0);
}
/* }}} */

/* {{{ proto void DirectoryIterator::next()
   Move to next entry */
SPL_METHOD(DirectoryIterator, next)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	int skip_dots = SPL_HAS_FLAG(intern->flags, SPL_FILE_DIR_SKIPDOTS);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	intern->u.dir.index++;
	do {
		spl_filesystem_dir_read(intern TSRMLS_CC);
	} while (skip_dots && spl_filesystem_is_dot(intern->u.dir.entry.d_name));
	if (intern->file_name) {
		efree(intern->file_name);
		intern->file_name = NULL;
	}
}
/* }}} */

/* {{{ proto void DirectoryIterator::seek(int position)
   Seek to the given position */
SPL_METHOD(DirectoryIterator, seek)
{
	spl_filesystem_object *intern    = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zval                  *retval    = NULL;
	long                   pos;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l", &pos) == FAILURE) {
		return;
	}

	if (intern->u.dir.index > pos) {
		/* we first rewind */
		zend_call_method_with_0_params(&this_ptr, Z_OBJCE_P(getThis()), &intern->u.dir.func_rewind, "rewind", &retval);
		if (retval) {
			zval_ptr_dtor(&retval);
		}
	}

	while (intern->u.dir.index < pos) {
		int valid = 0;
		zend_call_method_with_0_params(&this_ptr, Z_OBJCE_P(getThis()), &intern->u.dir.func_valid, "valid", &retval);
		if (retval) {
			valid = zend_is_true(retval);
			zval_ptr_dtor(&retval);
		}
		if (!valid) {
			break;
		}
		zend_call_method_with_0_params(&this_ptr, Z_OBJCE_P(getThis()), &intern->u.dir.func_next, "next", &retval);
		if (retval) {
			zval_ptr_dtor(&retval);
		}
	}
} /* }}} */

/* {{{ proto string DirectoryIterator::valid()
   Check whether dir contains more entries */
SPL_METHOD(DirectoryIterator, valid)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	RETURN_BOOL(intern->u.dir.entry.d_name[0] != '\0');
}
/* }}} */

/* {{{ proto string SplFileInfo::getPath()
   Return the path */
SPL_METHOD(SplFileInfo, getPath)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *path;
	int path_len;
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

  	path = spl_filesystem_object_get_path(intern, &path_len TSRMLS_CC);
	RETURN_STRINGL(path, path_len, 1);
}
/* }}} */

/* {{{ proto string SplFileInfo::getFilename()
   Return filename only */
SPL_METHOD(SplFileInfo, getFilename)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	int path_len;
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	spl_filesystem_object_get_path(intern, &path_len TSRMLS_CC);
	
	if (path_len && path_len < intern->file_name_len) {
		RETURN_STRINGL(intern->file_name + path_len + 1, intern->file_name_len - (path_len + 1), 1);
	} else {
		RETURN_STRINGL(intern->file_name, intern->file_name_len, 1);
	}
}
/* }}} */

/* {{{ proto string DirectoryIterator::getFilename()
   Return filename of current dir entry */
SPL_METHOD(DirectoryIterator, getFilename)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	RETURN_STRING(intern->u.dir.entry.d_name, 1);
}
/* }}} */

/* {{{ proto string SplFileInfo::getExtension()
   Returns file extension component of path */
SPL_METHOD(SplFileInfo, getExtension)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *fname = NULL;
	const char *p;
	size_t flen;
	int path_len, idx;

	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	spl_filesystem_object_get_path(intern, &path_len TSRMLS_CC);

	if (path_len && path_len < intern->file_name_len) {
		fname = intern->file_name + path_len + 1;
		flen = intern->file_name_len - (path_len + 1);
	} else {
		fname = intern->file_name;
		flen = intern->file_name_len;
	}

	php_basename(fname, flen, NULL, 0, &fname, &flen TSRMLS_CC);

	p = zend_memrchr(fname, '.', flen);
	if (p) {
		idx = p - fname;
		RETVAL_STRINGL(fname + idx + 1, flen - idx - 1, 1);
		efree(fname);
		return;
	} else {
		if (fname) {
			efree(fname);
		}
		RETURN_EMPTY_STRING();
	}
}
/* }}}*/

/* {{{ proto string DirectoryIterator::getExtension()
   Returns the file extension component of path */
SPL_METHOD(DirectoryIterator, getExtension)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *fname = NULL;
	const char *p;
	size_t flen;
	int idx;

	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	php_basename(intern->u.dir.entry.d_name, strlen(intern->u.dir.entry.d_name), NULL, 0, &fname, &flen TSRMLS_CC);

	p = zend_memrchr(fname, '.', flen);
	if (p) {
		idx = p - fname;
		RETVAL_STRINGL(fname + idx + 1, flen - idx - 1, 1);
		efree(fname);
		return;
	} else {
		if (fname) {
			efree(fname);
		}
		RETURN_EMPTY_STRING();
	}
}
/* }}} */

/* {{{ proto string SplFileInfo::getBasename([string $suffix]) U
   Returns filename component of path */
SPL_METHOD(SplFileInfo, getBasename)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *fname, *suffix = 0;
	size_t flen;
	int slen = 0, path_len;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|s", &suffix, &slen) == FAILURE) {
		return;
	}

	spl_filesystem_object_get_path(intern, &path_len TSRMLS_CC);

	if (path_len && path_len < intern->file_name_len) {
		fname = intern->file_name + path_len + 1;
		flen = intern->file_name_len - (path_len + 1);
	} else {
		fname = intern->file_name;
		flen = intern->file_name_len;
	}

	php_basename(fname, flen, suffix, slen, &fname, &flen TSRMLS_CC);

	RETURN_STRINGL(fname, flen, 0);
}
/* }}}*/   

/* {{{ proto string DirectoryIterator::getBasename([string $suffix]) U
   Returns filename component of current dir entry */
SPL_METHOD(DirectoryIterator, getBasename)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *suffix = 0, *fname;
	int slen = 0;
	size_t flen;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|s", &suffix, &slen) == FAILURE) {
		return;
	}

	php_basename(intern->u.dir.entry.d_name, strlen(intern->u.dir.entry.d_name), suffix, slen, &fname, &flen TSRMLS_CC);

	RETURN_STRINGL(fname, flen, 0);
}
/* }}} */

/* {{{ proto string SplFileInfo::getPathname()
   Return path and filename */
SPL_METHOD(SplFileInfo, getPathname)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *path;
	int path_len;

	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}
	path = spl_filesystem_object_get_pathname(intern, &path_len TSRMLS_CC);
	if (path != NULL) {
		RETURN_STRINGL(path, path_len, 1);
	} else {
		RETURN_FALSE;
	}
}
/* }}} */

/* {{{ proto string FilesystemIterator::key()
   Return getPathname() or getFilename() depending on flags */
SPL_METHOD(FilesystemIterator, key)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (SPL_FILE_DIR_KEY(intern, SPL_FILE_DIR_KEY_AS_FILENAME)) {
		RETURN_STRING(intern->u.dir.entry.d_name, 1);
	} else {
		spl_filesystem_object_get_file_name(intern TSRMLS_CC);
		RETURN_STRINGL(intern->file_name, intern->file_name_len, 1);
	}
}
/* }}} */

/* {{{ proto string FilesystemIterator::current()
   Return getFilename(), getFileInfo() or $this depending on flags */
SPL_METHOD(FilesystemIterator, current)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (SPL_FILE_DIR_CURRENT(intern, SPL_FILE_DIR_CURRENT_AS_PATHNAME)) {
		spl_filesystem_object_get_file_name(intern TSRMLS_CC);
		RETURN_STRINGL(intern->file_name, intern->file_name_len, 1);
	} else if (SPL_FILE_DIR_CURRENT(intern, SPL_FILE_DIR_CURRENT_AS_FILEINFO)) {
		spl_filesystem_object_get_file_name(intern TSRMLS_CC);
		spl_filesystem_object_create_type(0, intern, SPL_FS_INFO, NULL, return_value TSRMLS_CC);
	} else {
		RETURN_ZVAL(getThis(), 1, 0);
		/*RETURN_STRING(intern->u.dir.entry.d_name, 1);*/
	}
}
/* }}} */

/* {{{ proto bool DirectoryIterator::isDot()
   Returns true if current entry is '.' or  '..' */
SPL_METHOD(DirectoryIterator, isDot)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	RETURN_BOOL(spl_filesystem_is_dot(intern->u.dir.entry.d_name));
}
/* }}} */

/* {{{ proto void SplFileInfo::__construct(string file_name)
 Cronstructs a new SplFileInfo from a path. */
/* zend_replace_error_handling() is used to throw exceptions in case
   the constructor fails. Here we use this to ensure the object
   has a valid directory resource.
   
   When the constructor gets called the object is already created 
   by the engine, so we must only call 'additional' initializations.
 */
SPL_METHOD(SplFileInfo, __construct)
{
	spl_filesystem_object *intern;
	char *path;
	int len;
	zend_error_handling error_handling;

	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &path, &len) == FAILURE) {
		zend_restore_error_handling(&error_handling TSRMLS_CC);
		return;
	}

	intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	spl_filesystem_info_set_filename(intern, path, len, 1 TSRMLS_CC);

	zend_restore_error_handling(&error_handling TSRMLS_CC);
	
	/* intern->type = SPL_FS_INFO; already set */
}
/* }}} */

/* {{{ FileInfoFunction */
#define FileInfoFunction(func_name, func_num) \
SPL_METHOD(SplFileInfo, func_name) \
{ \
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC); \
	zend_error_handling error_handling; \
	if (zend_parse_parameters_none() == FAILURE) { \
		return; \
	} \
 \
	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);\
	spl_filesystem_object_get_file_name(intern TSRMLS_CC); \
	php_stat(intern->file_name, intern->file_name_len, func_num, return_value TSRMLS_CC); \
	zend_restore_error_handling(&error_handling TSRMLS_CC); \
}
/* }}} */

/* {{{ proto int SplFileInfo::getPerms()
   Get file permissions */
FileInfoFunction(getPerms, FS_PERMS)
/* }}} */

/* {{{ proto int SplFileInfo::getInode()
   Get file inode */
FileInfoFunction(getInode, FS_INODE)
/* }}} */

/* {{{ proto int SplFileInfo::getSize()
   Get file size */
FileInfoFunction(getSize, FS_SIZE)
/* }}} */

/* {{{ proto int SplFileInfo::getOwner()
   Get file owner */
FileInfoFunction(getOwner, FS_OWNER)
/* }}} */

/* {{{ proto int SplFileInfo::getGroup()
   Get file group */
FileInfoFunction(getGroup, FS_GROUP)
/* }}} */

/* {{{ proto int SplFileInfo::getATime()
   Get last access time of file */
FileInfoFunction(getATime, FS_ATIME)
/* }}} */

/* {{{ proto int SplFileInfo::getMTime()
   Get last modification time of file */
FileInfoFunction(getMTime, FS_MTIME)
/* }}} */

/* {{{ proto int SplFileInfo::getCTime()
   Get inode modification time of file */
FileInfoFunction(getCTime, FS_CTIME)
/* }}} */

/* {{{ proto string SplFileInfo::getType()
   Get file type */
FileInfoFunction(getType, FS_TYPE)
/* }}} */

/* {{{ proto bool SplFileInfo::isWritable()
   Returns true if file can be written */
FileInfoFunction(isWritable, FS_IS_W)
/* }}} */

/* {{{ proto bool SplFileInfo::isReadable()
   Returns true if file can be read */
FileInfoFunction(isReadable, FS_IS_R)
/* }}} */

/* {{{ proto bool SplFileInfo::isExecutable()
   Returns true if file is executable */
FileInfoFunction(isExecutable, FS_IS_X)
/* }}} */

/* {{{ proto bool SplFileInfo::isFile()
   Returns true if file is a regular file */
FileInfoFunction(isFile, FS_IS_FILE)
/* }}} */

/* {{{ proto bool SplFileInfo::isDir()
   Returns true if file is directory */
FileInfoFunction(isDir, FS_IS_DIR)
/* }}} */

/* {{{ proto bool SplFileInfo::isLink()
   Returns true if file is symbolic link */
FileInfoFunction(isLink, FS_IS_LINK)
/* }}} */

/* {{{ proto string SplFileInfo::getLinkTarget() U
   Return the target of a symbolic link */
SPL_METHOD(SplFileInfo, getLinkTarget)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	int ret;
	char buff[MAXPATHLEN];
	zend_error_handling error_handling;
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);

#if defined(PHP_WIN32) || HAVE_SYMLINK
	if (!IS_ABSOLUTE_PATH(intern->file_name, intern->file_name_len)) {
		char expanded_path[MAXPATHLEN];

		/* TODO: Fix expand_filepath to do not resolve links but only expand the path 
		   (Pierre) */
		if (!expand_filepath(intern->file_name, expanded_path TSRMLS_CC)) {
			php_error_docref(NULL TSRMLS_CC, E_WARNING, "No such file or directory");
			RETURN_FALSE;
		}
		ret = php_sys_readlink(expanded_path, buff, MAXPATHLEN - 1);
	} else {
		ret = php_sys_readlink(intern->file_name, buff,  MAXPATHLEN-1);
	}
#else
	ret = -1; /* always fail if not implemented */
#endif

	if (ret == -1) {
		zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Unable to read link %s, error: %s", intern->file_name, strerror(errno));
		RETVAL_FALSE;
	} else {
		/* Append NULL to the end of the string */
		buff[ret] = '\0';

		RETVAL_STRINGL(buff, ret, 1);
	}

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

#if (!defined(__BEOS__) && !defined(NETWARE) && HAVE_REALPATH) || defined(ZTS)
/* {{{ proto string SplFileInfo::getRealPath()
   Return the resolved path */
SPL_METHOD(SplFileInfo, getRealPath)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char buff[MAXPATHLEN];
	char *filename;
	zend_error_handling error_handling;
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);

	if (intern->type == SPL_FS_DIR && !intern->file_name && intern->u.dir.entry.d_name[0]) {
		spl_filesystem_object_get_file_name(intern TSRMLS_CC);
	}
	
	if (intern->orig_path) {
		filename = intern->orig_path;
	} else { 
		filename = intern->file_name;
	}


	if (filename && VCWD_REALPATH(filename, buff)) {
#ifdef ZTS
		if (VCWD_ACCESS(buff, F_OK)) {
			RETVAL_FALSE;
		} else
#endif
		RETVAL_STRING(buff, 1);
	} else {
		RETVAL_FALSE;
	}

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */
#endif

/* {{{ proto SplFileObject SplFileInfo::openFile([string mode = 'r' [, bool use_include_path  [, resource context]]])
   Open the current file */
SPL_METHOD(SplFileInfo, openFile)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	spl_filesystem_object_create_type(ht, intern, SPL_FS_FILE, NULL, return_value TSRMLS_CC);
}
/* }}} */

/* {{{ proto void SplFileInfo::setFileClass([string class_name])
   Class to use in openFile() */
SPL_METHOD(SplFileInfo, setFileClass)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zend_class_entry *ce = spl_ce_SplFileObject;
	zend_error_handling error_handling;
	
	zend_replace_error_handling(EH_THROW, spl_ce_UnexpectedValueException, &error_handling TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|C", &ce) == SUCCESS) {
		intern->file_class = ce;
	}

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

/* {{{ proto void SplFileInfo::setInfoClass([string class_name])
   Class to use in getFileInfo(), getPathInfo() */
SPL_METHOD(SplFileInfo, setInfoClass)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zend_class_entry *ce = spl_ce_SplFileInfo;
	zend_error_handling error_handling;
	
	zend_replace_error_handling(EH_THROW, spl_ce_UnexpectedValueException, &error_handling  TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|C", &ce) == SUCCESS) {
		intern->info_class = ce;
	}

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

/* {{{ proto SplFileInfo SplFileInfo::getFileInfo([string $class_name])
   Get/copy file info */
SPL_METHOD(SplFileInfo, getFileInfo)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zend_class_entry *ce = intern->info_class;
	zend_error_handling error_handling;
	
	zend_replace_error_handling(EH_THROW, spl_ce_UnexpectedValueException, &error_handling TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|C", &ce) == SUCCESS) {
		spl_filesystem_object_create_type(ht, intern, SPL_FS_INFO, ce, return_value TSRMLS_CC);
	}

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

/* {{{ proto SplFileInfo SplFileInfo::getPathInfo([string $class_name])
   Get/copy file info */
SPL_METHOD(SplFileInfo, getPathInfo)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zend_class_entry *ce = intern->info_class;
	zend_error_handling error_handling;
	
	zend_replace_error_handling(EH_THROW, spl_ce_UnexpectedValueException, &error_handling TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|C", &ce) == SUCCESS) {
		int path_len;
		char *path = spl_filesystem_object_get_pathname(intern, &path_len TSRMLS_CC);
		if (path) {
			char *dpath = estrndup(path, path_len);
			path_len = php_dirname(dpath, path_len);
			spl_filesystem_object_create_info(intern, dpath, path_len, 1, ce, return_value TSRMLS_CC);
			efree(dpath);
		}
	}

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

/* {{{ proto void FilesystemIterator::__construct(string path [, int flags])
 Cronstructs a new dir iterator from a path. */
SPL_METHOD(FilesystemIterator, __construct)
{
	spl_filesystem_object_construct(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIT_CTOR_FLAGS | SPL_FILE_DIR_SKIPDOTS);
}
/* }}} */

/* {{{ proto void FilesystemIterator::rewind()
   Rewind dir back to the start */
SPL_METHOD(FilesystemIterator, rewind)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	intern->u.dir.index = 0;
	if (intern->u.dir.dirp) {
		php_stream_rewinddir(intern->u.dir.dirp);
	}
	do {
		spl_filesystem_dir_read(intern TSRMLS_CC);
	} while (spl_filesystem_is_dot(intern->u.dir.entry.d_name));
}
/* }}} */

/* {{{ proto int FilesystemIterator::getFlags()
   Get handling flags */
SPL_METHOD(FilesystemIterator, getFlags)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	RETURN_LONG(intern->flags & (SPL_FILE_DIR_KEY_MODE_MASK | SPL_FILE_DIR_CURRENT_MODE_MASK | SPL_FILE_DIR_OTHERS_MASK));
} /* }}} */

/* {{{ proto void FilesystemIterator::setFlags(long $flags)
   Set handling flags */
SPL_METHOD(FilesystemIterator, setFlags)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	long flags;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l", &flags) == FAILURE) {
		return;
	}

	intern->flags &= ~(SPL_FILE_DIR_KEY_MODE_MASK|SPL_FILE_DIR_CURRENT_MODE_MASK|SPL_FILE_DIR_OTHERS_MASK);
	intern->flags |= ((SPL_FILE_DIR_KEY_MODE_MASK|SPL_FILE_DIR_CURRENT_MODE_MASK|SPL_FILE_DIR_OTHERS_MASK) & flags);
} /* }}} */

/* {{{ proto bool RecursiveDirectoryIterator::hasChildren([bool $allow_links = false])
   Returns whether current entry is a directory and not '.' or '..' */
SPL_METHOD(RecursiveDirectoryIterator, hasChildren)
{
	zend_bool allow_links = 0;
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|b", &allow_links) == FAILURE) {
		return;
	}
	if (spl_filesystem_is_invalid_or_dot(intern->u.dir.entry.d_name)) {
		RETURN_FALSE;
	} else {
		spl_filesystem_object_get_file_name(intern TSRMLS_CC);
		if (!allow_links && !(intern->flags & SPL_FILE_DIR_FOLLOW_SYMLINKS)) {
			php_stat(intern->file_name, intern->file_name_len, FS_IS_LINK, return_value TSRMLS_CC);
			if (zend_is_true(return_value)) {
				RETURN_FALSE;
			}
		}
		php_stat(intern->file_name, intern->file_name_len, FS_IS_DIR, return_value TSRMLS_CC);
    }
}
/* }}} */

/* {{{ proto RecursiveDirectoryIterator DirectoryIterator::getChildren()
   Returns an iterator for the current entry if it is a directory */
SPL_METHOD(RecursiveDirectoryIterator, getChildren)
{
	zval zpath, zflags;
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	spl_filesystem_object *subdir;
	char slash = SPL_HAS_FLAG(intern->flags, SPL_FILE_DIR_UNIXPATHS) ? '/' : DEFAULT_SLASH;
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}
	
	spl_filesystem_object_get_file_name(intern TSRMLS_CC);

	if (SPL_HAS_FLAG(intern->flags, SPL_FILE_DIR_CURRENT_AS_PATHNAME)) {
		RETURN_STRINGL(intern->file_name, intern->file_name_len, 1);
	} else {
		INIT_PZVAL(&zflags);
		INIT_PZVAL(&zpath);
		ZVAL_LONG(&zflags, intern->flags);
		ZVAL_STRINGL(&zpath, intern->file_name, intern->file_name_len, 0);
		spl_instantiate_arg_ex2(Z_OBJCE_P(getThis()), &return_value, 0, &zpath, &zflags TSRMLS_CC);
		
		subdir = (spl_filesystem_object*)zend_object_store_get_object(return_value TSRMLS_CC);
		if (subdir) {
			if (intern->u.dir.sub_path && intern->u.dir.sub_path[0]) {
				subdir->u.dir.sub_path_len = spprintf(&subdir->u.dir.sub_path, 0, "%s%c%s", intern->u.dir.sub_path, slash, intern->u.dir.entry.d_name);
			} else {
				subdir->u.dir.sub_path_len = strlen(intern->u.dir.entry.d_name);
				subdir->u.dir.sub_path = estrndup(intern->u.dir.entry.d_name, subdir->u.dir.sub_path_len);
			}
			subdir->info_class = intern->info_class;
			subdir->file_class = intern->file_class;
			subdir->oth = intern->oth;
		}
	}
}
/* }}} */

/* {{{ proto void RecursiveDirectoryIterator::getSubPath()
   Get sub path */
SPL_METHOD(RecursiveDirectoryIterator, getSubPath)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (intern->u.dir.sub_path) {
		RETURN_STRINGL(intern->u.dir.sub_path, intern->u.dir.sub_path_len, 1);
	} else {
		RETURN_STRINGL("", 0, 1);
	}
}
/* }}} */

/* {{{ proto void RecursiveDirectoryIterator::getSubPathname()
   Get sub path and file name */
SPL_METHOD(RecursiveDirectoryIterator, getSubPathname)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *sub_name;
	int len;
	char slash = SPL_HAS_FLAG(intern->flags, SPL_FILE_DIR_UNIXPATHS) ? '/' : DEFAULT_SLASH;
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (intern->u.dir.sub_path) {
		len = spprintf(&sub_name, 0, "%s%c%s", intern->u.dir.sub_path, slash, intern->u.dir.entry.d_name);
		RETURN_STRINGL(sub_name, len, 0);
	} else {
		RETURN_STRING(intern->u.dir.entry.d_name, 1);
	}
}
/* }}} */

/* {{{ proto int RecursiveDirectoryIterator::__construct(string path [, int flags])
 Cronstructs a new dir iterator from a path. */
SPL_METHOD(RecursiveDirectoryIterator, __construct)
{
	spl_filesystem_object_construct(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIT_CTOR_FLAGS);
}
/* }}} */

#ifdef HAVE_GLOB
/* {{{ proto int GlobIterator::__construct(string path [, int flags])
 Cronstructs a new dir iterator from a glob expression (no glob:// needed). */
SPL_METHOD(GlobIterator, __construct)
{
	spl_filesystem_object_construct(INTERNAL_FUNCTION_PARAM_PASSTHRU, DIT_CTOR_FLAGS|DIT_CTOR_GLOB);
}
/* }}} */

/* {{{ proto int GlobIterator::cont()
   Return the number of directories and files found by globbing */
SPL_METHOD(GlobIterator, count)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (php_stream_is(intern->u.dir.dirp ,&php_glob_stream_ops)) {
		RETURN_LONG(php_glob_stream_get_count(intern->u.dir.dirp, NULL));
	} else {
		/* should not happen */
		php_error_docref(NULL TSRMLS_CC, E_ERROR, "GlobIterator lost glob state");
	}
}
/* }}} */
#endif /* HAVE_GLOB */

/* {{{ forward declarations to the iterator handlers */
static void spl_filesystem_dir_it_dtor(zend_object_iterator *iter TSRMLS_DC);
static int spl_filesystem_dir_it_valid(zend_object_iterator *iter TSRMLS_DC);
static void spl_filesystem_dir_it_current_data(zend_object_iterator *iter, zval ***data TSRMLS_DC);
static int spl_filesystem_dir_it_current_key(zend_object_iterator *iter, char **str_key, uint *str_key_len, ulong *int_key TSRMLS_DC);
static void spl_filesystem_dir_it_move_forward(zend_object_iterator *iter TSRMLS_DC);
static void spl_filesystem_dir_it_rewind(zend_object_iterator *iter TSRMLS_DC);

/* iterator handler table */
zend_object_iterator_funcs spl_filesystem_dir_it_funcs = {
	spl_filesystem_dir_it_dtor,
	spl_filesystem_dir_it_valid,
	spl_filesystem_dir_it_current_data,
	spl_filesystem_dir_it_current_key,
	spl_filesystem_dir_it_move_forward,
	spl_filesystem_dir_it_rewind
};
/* }}} */

/* {{{ spl_ce_dir_get_iterator */
zend_object_iterator *spl_filesystem_dir_get_iterator(zend_class_entry *ce, zval *object, int by_ref TSRMLS_DC)
{
	spl_filesystem_iterator *iterator;
	spl_filesystem_object   *dir_object;

	if (by_ref) {
		zend_error(E_ERROR, "An iterator cannot be used with foreach by reference");
	}
	dir_object = (spl_filesystem_object*)zend_object_store_get_object(object TSRMLS_CC);
	iterator   = spl_filesystem_object_to_iterator(dir_object);

	Z_SET_REFCOUNT_P(object, Z_REFCOUNT_P(object) + 2);
	iterator->intern.data = (void*)object;
	iterator->intern.funcs = &spl_filesystem_dir_it_funcs;
	iterator->current = object;
	
	return (zend_object_iterator*)iterator;
}
/* }}} */

/* {{{ spl_filesystem_dir_it_dtor */
static void spl_filesystem_dir_it_dtor(zend_object_iterator *iter TSRMLS_DC)
{
	spl_filesystem_iterator *iterator = (spl_filesystem_iterator *)iter;
	zval *zfree = (zval*)iterator->intern.data;

	iterator->intern.data = NULL; /* mark as unused */
	zval_ptr_dtor(&iterator->current);
	if (zfree) {
		zval_ptr_dtor(&zfree);
	}
}
/* }}} */

/* {{{ spl_filesystem_dir_it_valid */
static int spl_filesystem_dir_it_valid(zend_object_iterator *iter TSRMLS_DC)
{
	spl_filesystem_object *object = spl_filesystem_iterator_to_object((spl_filesystem_iterator *)iter);

	return object->u.dir.entry.d_name[0] != '\0' ? SUCCESS : FAILURE;
}
/* }}} */

/* {{{ spl_filesystem_dir_it_current_data */
static void spl_filesystem_dir_it_current_data(zend_object_iterator *iter, zval ***data TSRMLS_DC)
{
	spl_filesystem_iterator *iterator = (spl_filesystem_iterator *)iter;
	
	*data = &iterator->current;
}
/* }}} */

/* {{{ spl_filesystem_dir_it_current_key */
static int spl_filesystem_dir_it_current_key(zend_object_iterator *iter, char **str_key, uint *str_key_len, ulong *int_key TSRMLS_DC)
{
	spl_filesystem_object *object = spl_filesystem_iterator_to_object((spl_filesystem_iterator *)iter);
	
	*int_key = object->u.dir.index;
	return HASH_KEY_IS_LONG;
}
/* }}} */

/* {{{ spl_filesystem_dir_it_move_forward */
static void spl_filesystem_dir_it_move_forward(zend_object_iterator *iter TSRMLS_DC)
{
	spl_filesystem_object *object = spl_filesystem_iterator_to_object((spl_filesystem_iterator *)iter);
	
	object->u.dir.index++;
	spl_filesystem_dir_read(object TSRMLS_CC);
	if (object->file_name) {
		efree(object->file_name);
		object->file_name = NULL;
	}
}
/* }}} */

/* {{{ spl_filesystem_dir_it_rewind */
static void spl_filesystem_dir_it_rewind(zend_object_iterator *iter TSRMLS_DC)
{
	spl_filesystem_object *object = spl_filesystem_iterator_to_object((spl_filesystem_iterator *)iter);
	
	object->u.dir.index = 0;
	if (object->u.dir.dirp) {
		php_stream_rewinddir(object->u.dir.dirp);
	}
	spl_filesystem_dir_read(object TSRMLS_CC);
}
/* }}} */

/* {{{ spl_filesystem_tree_it_dtor */
static void spl_filesystem_tree_it_dtor(zend_object_iterator *iter TSRMLS_DC)
{
	spl_filesystem_iterator *iterator = (spl_filesystem_iterator *)iter;
	zval *zfree = (zval*)iterator->intern.data;

	if (iterator->current) {
		zval_ptr_dtor(&iterator->current);
	}
	iterator->intern.data = NULL; /* mark as unused */
	/* free twice as we add ref twice */
	zval_ptr_dtor(&zfree);
	zval_ptr_dtor(&zfree);
}
/* }}} */

/* {{{ spl_filesystem_tree_it_current_data */
static void spl_filesystem_tree_it_current_data(zend_object_iterator *iter, zval ***data TSRMLS_DC)
{
	spl_filesystem_iterator *iterator = (spl_filesystem_iterator *)iter;
	spl_filesystem_object   *object   = spl_filesystem_iterator_to_object(iterator);

	if (SPL_FILE_DIR_CURRENT(object, SPL_FILE_DIR_CURRENT_AS_PATHNAME)) {
		if (!iterator->current) {
			ALLOC_INIT_ZVAL(iterator->current);
			spl_filesystem_object_get_file_name(object TSRMLS_CC);
			ZVAL_STRINGL(iterator->current, object->file_name, object->file_name_len, 1);
		}
		*data = &iterator->current;
	} else if (SPL_FILE_DIR_CURRENT(object, SPL_FILE_DIR_CURRENT_AS_FILEINFO)) {
		if (!iterator->current) {
			ALLOC_INIT_ZVAL(iterator->current);
			spl_filesystem_object_get_file_name(object TSRMLS_CC);
			spl_filesystem_object_create_type(0, object, SPL_FS_INFO, NULL, iterator->current TSRMLS_CC);
		}
		*data = &iterator->current;
	} else {
		*data = (zval**)&iterator->intern.data;
	}
}
/* }}} */

/* {{{ spl_filesystem_tree_it_current_key */
static int spl_filesystem_tree_it_current_key(zend_object_iterator *iter, char **str_key, uint *str_key_len, ulong *int_key TSRMLS_DC)
{
	spl_filesystem_object *object = spl_filesystem_iterator_to_object((spl_filesystem_iterator *)iter);
	
	if (SPL_FILE_DIR_KEY(object, SPL_FILE_DIR_KEY_AS_FILENAME)) {
		*str_key_len = strlen(object->u.dir.entry.d_name) + 1;
		*str_key = estrndup(object->u.dir.entry.d_name, *str_key_len - 1);
	} else {
		spl_filesystem_object_get_file_name(object TSRMLS_CC);
		*str_key_len = object->file_name_len + 1;
		*str_key = estrndup(object->file_name, object->file_name_len);
	}
	return HASH_KEY_IS_STRING;
}
/* }}} */

/* {{{ spl_filesystem_tree_it_move_forward */
static void spl_filesystem_tree_it_move_forward(zend_object_iterator *iter TSRMLS_DC)
{
	spl_filesystem_iterator *iterator = (spl_filesystem_iterator *)iter;
	spl_filesystem_object   *object   = spl_filesystem_iterator_to_object(iterator);
	
	object->u.dir.index++;
	do {
		spl_filesystem_dir_read(object TSRMLS_CC);
	} while (spl_filesystem_is_dot(object->u.dir.entry.d_name));
	if (object->file_name) {
		efree(object->file_name);
		object->file_name = NULL;
	}
	if (iterator->current) {
		zval_ptr_dtor(&iterator->current);
		iterator->current = NULL;
	}
}
/* }}} */

/* {{{ spl_filesystem_tree_it_rewind */
static void spl_filesystem_tree_it_rewind(zend_object_iterator *iter TSRMLS_DC)
{
	spl_filesystem_iterator *iterator = (spl_filesystem_iterator *)iter;
	spl_filesystem_object   *object   = spl_filesystem_iterator_to_object(iterator);
	
	object->u.dir.index = 0;
	if (object->u.dir.dirp) {
		php_stream_rewinddir(object->u.dir.dirp);
	}
	do {
		spl_filesystem_dir_read(object TSRMLS_CC);
	} while (spl_filesystem_is_dot(object->u.dir.entry.d_name));
	if (iterator->current) {
		zval_ptr_dtor(&iterator->current);
		iterator->current = NULL;
	}
}
/* }}} */

/* {{{ iterator handler table */
zend_object_iterator_funcs spl_filesystem_tree_it_funcs = {
	spl_filesystem_tree_it_dtor,
	spl_filesystem_dir_it_valid,
	spl_filesystem_tree_it_current_data,
	spl_filesystem_tree_it_current_key,
	spl_filesystem_tree_it_move_forward,
	spl_filesystem_tree_it_rewind
};
/* }}} */

/* {{{ spl_ce_dir_get_iterator */
zend_object_iterator *spl_filesystem_tree_get_iterator(zend_class_entry *ce, zval *object, int by_ref TSRMLS_DC)
{
	spl_filesystem_iterator *iterator;
	spl_filesystem_object *dir_object;

	if (by_ref) {
		zend_error(E_ERROR, "An iterator cannot be used with foreach by reference");
	}
	dir_object = (spl_filesystem_object*)zend_object_store_get_object(object TSRMLS_CC);
	iterator   = spl_filesystem_object_to_iterator(dir_object);

	Z_SET_REFCOUNT_P(object, Z_REFCOUNT_P(object) + 2);
	iterator->intern.data = (void*)object;
	iterator->intern.funcs = &spl_filesystem_tree_it_funcs;
	iterator->current = NULL;
	
	return (zend_object_iterator*)iterator;
}
/* }}} */

/* {{{ spl_filesystem_object_cast */
static int spl_filesystem_object_cast(zval *readobj, zval *writeobj, int type TSRMLS_DC)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(readobj TSRMLS_CC);

	if (type == IS_STRING) {
		switch (intern->type) {
		case SPL_FS_INFO:
		case SPL_FS_FILE:
			if (readobj == writeobj) {
				zval retval;
				zval *retval_ptr = &retval;

				ZVAL_STRINGL(retval_ptr, intern->file_name, intern->file_name_len, 1);
				zval_dtor(readobj);
				ZVAL_ZVAL(writeobj, retval_ptr, 0, 0);
			} else {
				ZVAL_STRINGL(writeobj, intern->file_name, intern->file_name_len, 1);
			}
			return SUCCESS;
		case SPL_FS_DIR:
			if (readobj == writeobj) {
				zval retval;
				zval *retval_ptr = &retval;

				ZVAL_STRING(retval_ptr, intern->u.dir.entry.d_name, 1);
				zval_dtor(readobj);
				ZVAL_ZVAL(writeobj, retval_ptr, 0, 0);
			} else {
				ZVAL_STRING(writeobj, intern->u.dir.entry.d_name, 1);
			}
			return SUCCESS;
		}
	}
	if (readobj == writeobj) {
		zval_dtor(readobj);
	}
	ZVAL_NULL(writeobj);
	return FAILURE;
}
/* }}} */

/* {{{ declare method parameters */
/* supply a name and default to call by parameter */
ZEND_BEGIN_ARG_INFO(arginfo_info___construct, 0) 
	ZEND_ARG_INFO(0, file_name)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_info_openFile, 0, 0, 0)
	ZEND_ARG_INFO(0, open_mode)
	ZEND_ARG_INFO(0, use_include_path)
	ZEND_ARG_INFO(0, context)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_info_optinalFileClass, 0, 0, 0)
	ZEND_ARG_INFO(0, class_name)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_optinalSuffix, 0, 0, 0)
	ZEND_ARG_INFO(0, suffix)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_splfileinfo_void, 0)
ZEND_END_ARG_INFO()

/* the method table */
/* each method can have its own parameters and visibility */
static const zend_function_entry spl_SplFileInfo_functions[] = {
	SPL_ME(SplFileInfo,       __construct,   arginfo_info___construct, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getPath,       arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getFilename,   arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getExtension,  arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getBasename,   arginfo_optinalSuffix, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getPathname,   arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getPerms,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getInode,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getSize,       arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getOwner,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getGroup,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getATime,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getMTime,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getCTime,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getType,       arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       isWritable,    arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       isReadable,    arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       isExecutable,  arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       isFile,        arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       isDir,         arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       isLink,        arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getLinkTarget, arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
#if (!defined(__BEOS__) && !defined(NETWARE) && HAVE_REALPATH) || defined(ZTS)
	SPL_ME(SplFileInfo,       getRealPath,   arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
#endif
	SPL_ME(SplFileInfo,       getFileInfo,   arginfo_info_optinalFileClass, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       getPathInfo,   arginfo_info_optinalFileClass, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       openFile,      arginfo_info_openFile,         ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       setFileClass,  arginfo_info_optinalFileClass, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileInfo,       setInfoClass,  arginfo_info_optinalFileClass, ZEND_ACC_PUBLIC)
	SPL_MA(SplFileInfo,       __toString, SplFileInfo, getPathname, arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};

ZEND_BEGIN_ARG_INFO(arginfo_dir___construct, 0) 
	ZEND_ARG_INFO(0, path)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_dir_it_seek, 0) 
	ZEND_ARG_INFO(0, position)
ZEND_END_ARG_INFO();

/* the method table */
/* each method can have its own parameters and visibility */
static const zend_function_entry spl_DirectoryIterator_functions[] = {
	SPL_ME(DirectoryIterator, __construct,   arginfo_dir___construct, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, getFilename,   arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, getExtension,  arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, getBasename,   arginfo_optinalSuffix, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, isDot,         arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, rewind,        arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, valid,         arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, key,           arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, current,       arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, next,          arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator, seek,          arginfo_dir_it_seek, ZEND_ACC_PUBLIC)
	SPL_MA(DirectoryIterator, __toString, DirectoryIterator, getFilename, arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};

ZEND_BEGIN_ARG_INFO_EX(arginfo_r_dir___construct, 0, 0, 1) 
	ZEND_ARG_INFO(0, path)
	ZEND_ARG_INFO(0, flags)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_r_dir_hasChildren, 0, 0, 0)
	ZEND_ARG_INFO(0, allow_links)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_r_dir_setFlags, 0, 0, 0)
	ZEND_ARG_INFO(0, flags)
ZEND_END_ARG_INFO()

static const zend_function_entry spl_FilesystemIterator_functions[] = {
	SPL_ME(FilesystemIterator, __construct,   arginfo_r_dir___construct, ZEND_ACC_PUBLIC)
	SPL_ME(FilesystemIterator, rewind,        arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(DirectoryIterator,  next,          arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(FilesystemIterator, key,           arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(FilesystemIterator, current,       arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(FilesystemIterator, getFlags,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(FilesystemIterator, setFlags,      arginfo_r_dir_setFlags, ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};

static const zend_function_entry spl_RecursiveDirectoryIterator_functions[] = {
	SPL_ME(RecursiveDirectoryIterator, __construct,   arginfo_r_dir___construct, ZEND_ACC_PUBLIC)
	SPL_ME(RecursiveDirectoryIterator, hasChildren,   arginfo_r_dir_hasChildren, ZEND_ACC_PUBLIC)
	SPL_ME(RecursiveDirectoryIterator, getChildren,   arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(RecursiveDirectoryIterator, getSubPath,    arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_ME(RecursiveDirectoryIterator, getSubPathname,arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};

#ifdef HAVE_GLOB
static const zend_function_entry spl_GlobIterator_functions[] = {
	SPL_ME(GlobIterator, __construct,   arginfo_r_dir___construct, ZEND_ACC_PUBLIC)
	SPL_ME(GlobIterator, count,         arginfo_splfileinfo_void,  ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};
#endif
/* }}} */

static int spl_filesystem_file_read(spl_filesystem_object *intern, int silent TSRMLS_DC) /* {{{ */
{
	char *buf;
	size_t line_len = 0;
	int len;
	long line_add = (intern->u.file.current_line || intern->u.file.current_zval) ? 1 : 0;

	spl_filesystem_file_free_line(intern TSRMLS_CC);
	
	if (php_stream_eof(intern->u.file.stream)) {
		if (!silent) {
			zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Cannot read from file %s", intern->file_name);
		}
		return FAILURE;
	}

	if (intern->u.file.max_line_len > 0) {
		buf = safe_emalloc((intern->u.file.max_line_len + 1), sizeof(char), 0);
		if (php_stream_get_line(intern->u.file.stream, buf, intern->u.file.max_line_len, &line_len) == NULL) {
			efree(buf);
			buf = NULL;
		} else {
			buf[line_len] = '\0';
		}
	} else {
		buf = php_stream_get_line(intern->u.file.stream, NULL, 0, &line_len);
	}

	if (!buf) {
		intern->u.file.current_line = estrdup("");
		intern->u.file.current_line_len = 0;
	} else {
		if (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_DROP_NEW_LINE)) {
			line_len = strcspn(buf, "\r\n");
			buf[line_len] = '\0';
		}
	
		if (PG(magic_quotes_runtime)) {
			buf = php_addslashes(buf, line_len, &len, 1 TSRMLS_CC);
			line_len = len;
		}
	
		intern->u.file.current_line = buf;
		intern->u.file.current_line_len = line_len;
	}
	intern->u.file.current_line_num += line_add;

	return SUCCESS;
} /* }}} */

static int spl_filesystem_file_call(spl_filesystem_object *intern, zend_function *func_ptr, int pass_num_args, zval *return_value, zval *arg2 TSRMLS_DC) /* {{{ */
{
	zend_fcall_info fci;
	zend_fcall_info_cache fcic;
	zval z_fname;
	zval * zresource_ptr = &intern->u.file.zresource, *retval;
	int result;
	int num_args = pass_num_args + (arg2 ? 2 : 1);

	zval ***params = (zval***)safe_emalloc(num_args, sizeof(zval**), 0);

	params[0] = &zresource_ptr;
	
	if (arg2) {
		params[1] = &arg2;
	}

	zend_get_parameters_array_ex(pass_num_args, params+(arg2 ? 2 : 1));

	ZVAL_STRING(&z_fname, func_ptr->common.function_name, 0);

	fci.size = sizeof(fci);
	fci.function_table = EG(function_table);
	fci.object_ptr = NULL;
	fci.function_name = &z_fname;
	fci.retval_ptr_ptr = &retval;
	fci.param_count = num_args;
	fci.params = params;
	fci.no_separation = 1;
	fci.symbol_table = NULL;

	fcic.initialized = 1;
	fcic.function_handler = func_ptr;
	fcic.calling_scope = NULL;
	fcic.called_scope = NULL;
	fcic.object_ptr = NULL;

	result = zend_call_function(&fci, &fcic TSRMLS_CC);
	
	if (result == FAILURE) {
		RETVAL_FALSE;
	} else {
		ZVAL_ZVAL(return_value, retval, 1, 1);
	}

	efree(params);
	return result;
} /* }}} */

#define FileFunctionCall(func_name, pass_num_args, arg2) /* {{{ */ \
{ \
	zend_function *func_ptr; \
	int ret; \
	ret = zend_hash_find(EG(function_table), #func_name, sizeof(#func_name), (void **) &func_ptr); \
	if (ret != SUCCESS) { \
		zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Internal error, function '%s' not found. Please report", #func_name); \
		return; \
	} \
	spl_filesystem_file_call(intern, func_ptr, pass_num_args, return_value, arg2 TSRMLS_CC); \
} /* }}} */

static int spl_filesystem_file_read_csv(spl_filesystem_object *intern, char delimiter, char enclosure, char escape, zval *return_value TSRMLS_DC) /* {{{ */
{
	int ret = SUCCESS;
	
	do {
		ret = spl_filesystem_file_read(intern, 1 TSRMLS_CC);
	} while (ret == SUCCESS && !intern->u.file.current_line_len && SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_SKIP_EMPTY));
	
	if (ret == SUCCESS) {
		size_t buf_len = intern->u.file.current_line_len;
		char *buf = estrndup(intern->u.file.current_line, buf_len);

		if (intern->u.file.current_zval) {
			zval_ptr_dtor(&intern->u.file.current_zval);
		}
		ALLOC_INIT_ZVAL(intern->u.file.current_zval);

		php_fgetcsv(intern->u.file.stream, delimiter, enclosure, escape, buf_len, buf, intern->u.file.current_zval TSRMLS_CC);
		if (return_value) {
			if (Z_TYPE_P(return_value) != IS_NULL) {
				zval_dtor(return_value);
				ZVAL_NULL(return_value);
			}
			ZVAL_ZVAL(return_value, intern->u.file.current_zval, 1, 0);
		}
	}
	return ret;
}
/* }}} */

static int spl_filesystem_file_read_line_ex(zval * this_ptr, spl_filesystem_object *intern, int silent TSRMLS_DC) /* {{{ */
{
	zval *retval = NULL;

	/* 1) use fgetcsv? 2) overloaded call the function, 3) do it directly */
	if (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_READ_CSV) || intern->u.file.func_getCurr->common.scope != spl_ce_SplFileObject) {
		if (php_stream_eof(intern->u.file.stream)) {
			if (!silent) {
				zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Cannot read from file %s", intern->file_name);
			}
			return FAILURE;
		}
		if (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_READ_CSV)) {
			return spl_filesystem_file_read_csv(intern, intern->u.file.delimiter, intern->u.file.enclosure, intern->u.file.escape, NULL TSRMLS_CC);
		} else {
			zend_call_method_with_0_params(&this_ptr, Z_OBJCE_P(getThis()), &intern->u.file.func_getCurr, "getCurrentLine", &retval);
		}
		if (retval) {
			if (intern->u.file.current_line || intern->u.file.current_zval) {
				intern->u.file.current_line_num++;
			}
			spl_filesystem_file_free_line(intern TSRMLS_CC);
			if (Z_TYPE_P(retval) == IS_STRING) {
				intern->u.file.current_line = estrndup(Z_STRVAL_P(retval), Z_STRLEN_P(retval));
				intern->u.file.current_line_len = Z_STRLEN_P(retval);
			} else {
				MAKE_STD_ZVAL(intern->u.file.current_zval);
				ZVAL_ZVAL(intern->u.file.current_zval, retval, 1, 0);
			}
			zval_ptr_dtor(&retval);
			return SUCCESS;
		} else {
			return FAILURE;
		}
	} else {
		return spl_filesystem_file_read(intern, silent TSRMLS_CC);
	}
} /* }}} */

static int spl_filesystem_file_is_empty_line(spl_filesystem_object *intern TSRMLS_DC) /* {{{ */
{
	if (intern->u.file.current_line) {
		return intern->u.file.current_line_len == 0;
	} else if (intern->u.file.current_zval) {
		switch(Z_TYPE_P(intern->u.file.current_zval)) {
		case IS_STRING:
			return Z_STRLEN_P(intern->u.file.current_zval) == 0;
		case IS_ARRAY:
			if (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_READ_CSV)
			&& zend_hash_num_elements(Z_ARRVAL_P(intern->u.file.current_zval)) == 1) {
				zval ** first = Z_ARRVAL_P(intern->u.file.current_zval)->pListHead->pData;
					
				return Z_TYPE_PP(first) == IS_STRING && Z_STRLEN_PP(first) == 0;
			}
			return zend_hash_num_elements(Z_ARRVAL_P(intern->u.file.current_zval)) == 0;
		case IS_NULL:
			return 1;
		default:
			return 0;
		}
	} else {
		return 1;
	}
}
/* }}} */

static int spl_filesystem_file_read_line(zval * this_ptr, spl_filesystem_object *intern, int silent TSRMLS_DC) /* {{{ */
{
	int ret = spl_filesystem_file_read_line_ex(this_ptr, intern, silent TSRMLS_CC);

	while (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_SKIP_EMPTY) && ret == SUCCESS && spl_filesystem_file_is_empty_line(intern TSRMLS_CC)) {
		spl_filesystem_file_free_line(intern TSRMLS_CC);
		ret = spl_filesystem_file_read_line_ex(this_ptr, intern, silent TSRMLS_CC);
	}
	
	return ret;
}
/* }}} */

static void spl_filesystem_file_rewind(zval * this_ptr, spl_filesystem_object *intern TSRMLS_DC) /* {{{ */
{
	if (-1 == php_stream_rewind(intern->u.file.stream)) {
		zend_throw_exception_ex(spl_ce_RuntimeException, 0 TSRMLS_CC, "Cannot rewind file %s", intern->file_name);
	} else {
		spl_filesystem_file_free_line(intern TSRMLS_CC);
		intern->u.file.current_line_num = 0;
	}
	if (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_READ_AHEAD)) {
		spl_filesystem_file_read_line(this_ptr, intern, 1 TSRMLS_CC);
	}
} /* }}} */

/* {{{ proto void SplFileObject::__construct(string filename [, string mode = 'r' [, bool use_include_path  [, resource context]]]])
   Construct a new file object */
SPL_METHOD(SplFileObject, __construct)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zend_bool use_include_path = 0;
	char *p1, *p2;
	char *tmp_path;
	int   tmp_path_len;
	zend_error_handling error_handling;

	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);

	intern->u.file.open_mode = "r";
	intern->u.file.open_mode_len = 1;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|sbr", 
			&intern->file_name, &intern->file_name_len,
			&intern->u.file.open_mode, &intern->u.file.open_mode_len, 
			&use_include_path, &intern->u.file.zcontext) == FAILURE) {
		zend_restore_error_handling(&error_handling TSRMLS_CC);
		return;
	}
	
	if (spl_filesystem_file_open(intern, use_include_path, 0 TSRMLS_CC) == SUCCESS) {
		tmp_path_len = strlen(intern->u.file.stream->orig_path);

		if (tmp_path_len > 1 && IS_SLASH_AT(intern->u.file.stream->orig_path, tmp_path_len-1)) {
			tmp_path_len--;
		}

		tmp_path = estrndup(intern->u.file.stream->orig_path, tmp_path_len);

		p1 = strrchr(tmp_path, '/');
#if defined(PHP_WIN32) || defined(NETWARE)
		p2 = strrchr(tmp_path, '\\');
#else
		p2 = 0;
#endif
		if (p1 || p2) {
			intern->_path_len = (p1 > p2 ? p1 : p2) - tmp_path;
		} else {
			intern->_path_len = 0;
		}

		efree(tmp_path);

		intern->_path = estrndup(intern->u.file.stream->orig_path, intern->_path_len);
	}

	zend_restore_error_handling(&error_handling TSRMLS_CC);

} /* }}} */

/* {{{ proto void SplTempFileObject::__construct([int max_memory])
   Construct a new temp file object */
SPL_METHOD(SplTempFileObject, __construct)
{
	long max_memory = PHP_STREAM_MAX_MEM;
	char tmp_fname[48];
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zend_error_handling error_handling;

	zend_replace_error_handling(EH_THROW, spl_ce_RuntimeException, &error_handling TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|l", &max_memory) == FAILURE) {
		zend_restore_error_handling(&error_handling TSRMLS_CC);
		return;
	}

	if (max_memory < 0) {
		intern->file_name = "php://memory";
		intern->file_name_len = 12;
	} else if (ZEND_NUM_ARGS()) {
		intern->file_name_len = slprintf(tmp_fname, sizeof(tmp_fname), "php://temp/maxmemory:%ld", max_memory);
		intern->file_name = tmp_fname;
	} else {
		intern->file_name = "php://temp";
		intern->file_name_len = 10;
	}
	intern->u.file.open_mode = "wb";
	intern->u.file.open_mode_len = 1;
	intern->u.file.zcontext = NULL;
	
	if (spl_filesystem_file_open(intern, 0, 0 TSRMLS_CC) == SUCCESS) {
		intern->_path_len = 0;
		intern->_path = estrndup("", 0);
	}
	zend_restore_error_handling(&error_handling TSRMLS_CC);
} /* }}} */

/* {{{ proto void SplFileObject::rewind()
   Rewind the file and read the first line */
SPL_METHOD(SplFileObject, rewind)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	spl_filesystem_file_rewind(getThis(), intern TSRMLS_CC);
} /* }}} */

/* {{{ proto void SplFileObject::eof()
   Return whether end of file is reached */
SPL_METHOD(SplFileObject, eof)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	RETURN_BOOL(php_stream_eof(intern->u.file.stream));
} /* }}} */

/* {{{ proto void SplFileObject::valid()
   Return !eof() */
SPL_METHOD(SplFileObject, valid)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_READ_AHEAD)) {
		RETURN_BOOL(intern->u.file.current_line || intern->u.file.current_zval);
	} else {
		RETVAL_BOOL(!php_stream_eof(intern->u.file.stream));
	}
} /* }}} */

/* {{{ proto string SplFileObject::fgets()
   Rturn next line from file */
SPL_METHOD(SplFileObject, fgets)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (spl_filesystem_file_read(intern, 0 TSRMLS_CC) == FAILURE) {
		RETURN_FALSE;
	}
	RETURN_STRINGL(intern->u.file.current_line, intern->u.file.current_line_len, 1);
} /* }}} */

/* {{{ proto string SplFileObject::current()
   Return current line from file */
SPL_METHOD(SplFileObject, current)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	if (!intern->u.file.current_line && !intern->u.file.current_zval) {
		spl_filesystem_file_read_line(getThis(), intern, 1 TSRMLS_CC);
	}
	if (intern->u.file.current_line && (!SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_READ_CSV) || !intern->u.file.current_zval)) {
		RETURN_STRINGL(intern->u.file.current_line, intern->u.file.current_line_len, 1);
	} else if (intern->u.file.current_zval) {
		RETURN_ZVAL(intern->u.file.current_zval, 1, 0);
	}
	RETURN_FALSE;
} /* }}} */

/* {{{ proto int SplFileObject::key()
   Return line number */
SPL_METHOD(SplFileObject, key)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

/*	Do not read the next line to support correct counting with fgetc()
	if (!intern->current_line) {
		spl_filesystem_file_read_line(getThis(), intern, 1 TSRMLS_CC);
	} */
	RETURN_LONG(intern->u.file.current_line_num);
} /* }}} */

/* {{{ proto void SplFileObject::next()
   Read next line */
SPL_METHOD(SplFileObject, next)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	spl_filesystem_file_free_line(intern TSRMLS_CC);
	if (SPL_HAS_FLAG(intern->flags, SPL_FILE_OBJECT_READ_AHEAD)) {
		spl_filesystem_file_read_line(getThis(), intern, 1 TSRMLS_CC);
	}
	intern->u.file.current_line_num++;
} /* }}} */

/* {{{ proto void SplFileObject::setFlags(int flags)
   Set file handling flags */
SPL_METHOD(SplFileObject, setFlags)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l", &intern->flags);
} /* }}} */

/* {{{ proto int SplFileObject::getFlags()
   Get file handling flags */
SPL_METHOD(SplFileObject, getFlags)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	RETURN_LONG(intern->flags & SPL_FILE_OBJECT_MASK);
} /* }}} */

/* {{{ proto void SplFileObject::setMaxLineLen(int max_len)
   Set maximum line length */
SPL_METHOD(SplFileObject, setMaxLineLen)
{
	long max_len;

	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l", &max_len) == FAILURE) {
		return;
	}

	if (max_len < 0) {
		zend_throw_exception_ex(spl_ce_DomainException, 0 TSRMLS_CC, "Maximum line length must be greater than or equal zero");
		return;
	}
	
	intern->u.file.max_line_len = max_len;
} /* }}} */

/* {{{ proto int SplFileObject::getMaxLineLen()
   Get maximum line length */
SPL_METHOD(SplFileObject, getMaxLineLen)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}

	RETURN_LONG((long)intern->u.file.max_line_len);
} /* }}} */

/* {{{ proto bool SplFileObject::hasChildren()
   Return false */
SPL_METHOD(SplFileObject, hasChildren)
{
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}
	
	RETURN_FALSE;
} /* }}} */

/* {{{ proto bool SplFileObject::getChildren()
   Read NULL */
SPL_METHOD(SplFileObject, getChildren)
{
	if (zend_parse_parameters_none() == FAILURE) {
		return;
	}
	/* return NULL */
} /* }}} */

/* {{{ FileFunction */
#define FileFunction(func_name) \
SPL_METHOD(SplFileObject, func_name) \
{ \
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC); \
	FileFunctionCall(func_name, ZEND_NUM_ARGS(), NULL); \
}
/* }}} */

/* {{{ proto array SplFileObject::fgetcsv([string delimiter [, string enclosure [, escape = '\\']]])
   Return current line as csv */
SPL_METHOD(SplFileObject, fgetcsv)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char delimiter = intern->u.file.delimiter, enclosure = intern->u.file.enclosure, escape = intern->u.file.escape;
	char *delim = NULL, *enclo = NULL, *esc = NULL;
	int d_len = 0, e_len = 0, esc_len = 0;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|sss", &delim, &d_len, &enclo, &e_len, &esc, &esc_len) == SUCCESS) {
		switch(ZEND_NUM_ARGS())
		{
		case 3:
			if (esc_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "escape must be a character");
				RETURN_FALSE;
			}
			escape = esc[0];
			/* no break */
		case 2:
			if (e_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "enclosure must be a character");
				RETURN_FALSE;
			}
			enclosure = enclo[0];
			/* no break */
		case 1:
			if (d_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "delimiter must be a character");
				RETURN_FALSE;
			}
			delimiter = delim[0];
			/* no break */
		case 0:
			break;
		}
		spl_filesystem_file_read_csv(intern, delimiter, enclosure, escape, return_value TSRMLS_CC);
	}
}
/* }}} */

/* {{{ proto int SplFileObject::fputcsv(array fields, [string delimiter [, string enclosure]])
   Output a field array as a CSV line */
SPL_METHOD(SplFileObject, fputcsv)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char delimiter = intern->u.file.delimiter, enclosure = intern->u.file.enclosure, escape = intern->u.file.escape;
	char *delim = NULL, *enclo = NULL;
	int d_len = 0, e_len = 0, ret;
	zval *fields = NULL;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "a|ss", &fields, &delim, &d_len, &enclo, &e_len) == SUCCESS) {
		switch(ZEND_NUM_ARGS())
		{
		case 3:
			if (e_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "enclosure must be a character");
				RETURN_FALSE;
			}
			enclosure = enclo[0];
			/* no break */
		case 2:
			if (d_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "delimiter must be a character");
				RETURN_FALSE;
			}
			delimiter = delim[0];
			/* no break */
		case 1:
		case 0:
			break;
		}
		ret = php_fputcsv(intern->u.file.stream, fields, delimiter, enclosure, escape TSRMLS_CC);
		RETURN_LONG(ret);
	}
}
/* }}} */

/* {{{ proto void SplFileObject::setCsvControl([string delimiter = ',' [, string enclosure = '"' [, string escape = '\\']]])
   Set the delimiter and enclosure character used in fgetcsv */
SPL_METHOD(SplFileObject, setCsvControl)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char delimiter = ',', enclosure = '"', escape='\\';
	char *delim = NULL, *enclo = NULL, *esc = NULL;
	int d_len = 0, e_len = 0, esc_len = 0;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|sss", &delim, &d_len, &enclo, &e_len, &esc, &esc_len) == SUCCESS) {
		switch(ZEND_NUM_ARGS())
		{
		case 3:
			if (esc_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "escape must be a character");
				RETURN_FALSE;
			}
			escape = esc[0];
			/* no break */
		case 2:
			if (e_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "enclosure must be a character");
				RETURN_FALSE;
			}
			enclosure = enclo[0];
			/* no break */
		case 1:
			if (d_len != 1) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "delimiter must be a character");
				RETURN_FALSE;
			}
			delimiter = delim[0];
			/* no break */
		case 0:
			break;
		}
		intern->u.file.delimiter = delimiter;
		intern->u.file.enclosure = enclosure;
		intern->u.file.escape    = escape;
	}
}
/* }}} */

/* {{{ proto array SplFileObject::getCsvControl()
   Get the delimiter and enclosure character used in fgetcsv */
SPL_METHOD(SplFileObject, getCsvControl)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char delimiter[2], enclosure[2];

	array_init(return_value);
	
	delimiter[0] = intern->u.file.delimiter;
	delimiter[1] = '\0';
	enclosure[0] = intern->u.file.enclosure;
	enclosure[1] = '\0';

	add_next_index_string(return_value, delimiter, 1);
	add_next_index_string(return_value, enclosure, 1);
}
/* }}} */

/* {{{ proto bool SplFileObject::flock(int operation [, int &wouldblock])
   Portable file locking */
FileFunction(flock)
/* }}} */

/* {{{ proto bool SplFileObject::fflush()
   Flush the file */
SPL_METHOD(SplFileObject, fflush)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	RETURN_BOOL(!php_stream_flush(intern->u.file.stream));
} /* }}} */

/* {{{ proto int SplFileObject::ftell()
   Return current file position */
SPL_METHOD(SplFileObject, ftell)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);	
	long ret = php_stream_tell(intern->u.file.stream);

	if (ret == -1) {
		RETURN_FALSE;
	} else {
		RETURN_LONG(ret);
	}
} /* }}} */

/* {{{ proto int SplFileObject::fseek(int pos [, int whence = SEEK_SET])
   Return current file position */
SPL_METHOD(SplFileObject, fseek)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	long pos, whence = SEEK_SET;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l|l", &pos, &whence) == FAILURE) {
		return;
	}

	spl_filesystem_file_free_line(intern TSRMLS_CC);
	RETURN_LONG(php_stream_seek(intern->u.file.stream, pos, whence));
} /* }}} */

/* {{{ proto int SplFileObject::fgetc()
   Get a character form the file */
SPL_METHOD(SplFileObject, fgetc)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char buf[2];
	int result;

	spl_filesystem_file_free_line(intern TSRMLS_CC);

	result = php_stream_getc(intern->u.file.stream);

	if (result == EOF) {
		RETVAL_FALSE;
	} else {
		if (result == '\n') {
			intern->u.file.current_line_num++;
		}
		buf[0] = result;
		buf[1] = '\0';

		RETURN_STRINGL(buf, 1, 1);
	}
} /* }}} */

/* {{{ proto string SplFileObject::fgetss([string allowable_tags])
   Get a line from file pointer and strip HTML tags */
SPL_METHOD(SplFileObject, fgetss)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	zval *arg2 = NULL;
	MAKE_STD_ZVAL(arg2);

	if (intern->u.file.max_line_len > 0) {
		ZVAL_LONG(arg2, intern->u.file.max_line_len);
	} else {
		ZVAL_LONG(arg2, 1024);
	}

	spl_filesystem_file_free_line(intern TSRMLS_CC);
	intern->u.file.current_line_num++;

	FileFunctionCall(fgetss, ZEND_NUM_ARGS(), arg2);

	zval_ptr_dtor(&arg2);
} /* }}} */

/* {{{ proto int SplFileObject::fpassthru()
   Output all remaining data from a file pointer */
SPL_METHOD(SplFileObject, fpassthru)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	RETURN_LONG(php_stream_passthru(intern->u.file.stream));
} /* }}} */

/* {{{ proto bool SplFileObject::fscanf(string format [, string ...])
   Implements a mostly ANSI compatible fscanf() */
SPL_METHOD(SplFileObject, fscanf)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);

	spl_filesystem_file_free_line(intern TSRMLS_CC);
	intern->u.file.current_line_num++;

	FileFunctionCall(fscanf, ZEND_NUM_ARGS(), NULL);
}
/* }}} */

/* {{{ proto mixed SplFileObject::fwrite(string str [, int length])
   Binary-safe file write */
SPL_METHOD(SplFileObject, fwrite)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	char *str;
	int str_len;
	int ret;
	long length = 0;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &str, &str_len, &length) == FAILURE) {
		return;
	}

	if (ZEND_NUM_ARGS() > 1) {
		str_len = MAX(0, MIN(length, str_len));
	}
	if (!str_len) {
		RETURN_LONG(0);
	}

	if (PG(magic_quotes_runtime)) {
		str = estrndup(str, str_len);
		php_stripslashes(str, &str_len TSRMLS_CC);
		ret = php_stream_write(intern->u.file.stream, str, str_len);
		efree(str);
		RETURN_LONG(ret);
	}

	RETURN_LONG(php_stream_write(intern->u.file.stream, str, str_len));
} /* }}} */

/* {{{ proto bool SplFileObject::fstat()
   Stat() on a filehandle */
FileFunction(fstat)
/* }}} */

/* {{{ proto bool SplFileObject::ftruncate(int size)
   Truncate file to 'size' length */
SPL_METHOD(SplFileObject, ftruncate)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	long size;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l", &size) == FAILURE) {
		return;
	}

	if (!php_stream_truncate_supported(intern->u.file.stream)) {
		zend_throw_exception_ex(spl_ce_LogicException, 0 TSRMLS_CC, "Can't truncate file %s", intern->file_name);
		RETURN_FALSE;
	}
	
	RETURN_BOOL(0 == php_stream_truncate_set_size(intern->u.file.stream, size));
} /* }}} */

/* {{{ proto void SplFileObject::seek(int line_pos)
   Seek to specified line */
SPL_METHOD(SplFileObject, seek)
{
	spl_filesystem_object *intern = (spl_filesystem_object*)zend_object_store_get_object(getThis() TSRMLS_CC);
	long line_pos;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l", &line_pos) == FAILURE) {
		return;
	}
	if (line_pos < 0) {
		zend_throw_exception_ex(spl_ce_LogicException, 0 TSRMLS_CC, "Can't seek file %s to negative line %ld", intern->file_name, line_pos);
		RETURN_FALSE;		
	}
	
	spl_filesystem_file_rewind(getThis(), intern TSRMLS_CC);
	
	while(intern->u.file.current_line_num < line_pos) {
		if (spl_filesystem_file_read_line(getThis(), intern, 1 TSRMLS_CC) == FAILURE) {
			break;
		}
	}
} /* }}} */

/* {{{ Function/Class/Method definitions */
ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object___construct, 0, 0, 1)
	ZEND_ARG_INFO(0, file_name)
	ZEND_ARG_INFO(0, open_mode)
	ZEND_ARG_INFO(0, use_include_path)
	ZEND_ARG_INFO(0, context)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_file_object_setFlags, 0)
	ZEND_ARG_INFO(0, flags)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_file_object_setMaxLineLen, 0)
	ZEND_ARG_INFO(0, max_len)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_fgetcsv, 0, 0, 0)
	ZEND_ARG_INFO(0, delimiter)
	ZEND_ARG_INFO(0, enclosure)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_fputcsv, 0, 0, 1)
	ZEND_ARG_INFO(0, fields)
	ZEND_ARG_INFO(0, delimiter)
	ZEND_ARG_INFO(0, enclosure)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_flock, 0, 0, 1) 
	ZEND_ARG_INFO(0, operation)
	ZEND_ARG_INFO(1, wouldblock)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_fseek, 0, 0, 1) 
	ZEND_ARG_INFO(0, pos)
	ZEND_ARG_INFO(0, whence)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_fgetss, 0, 0, 0) 
	ZEND_ARG_INFO(0, allowable_tags)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_fscanf, 1, 0, 1) 
	ZEND_ARG_INFO(0, format)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_fwrite, 0, 0, 1) 
	ZEND_ARG_INFO(0, str)
	ZEND_ARG_INFO(0, length)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_ftruncate, 0, 0, 1) 
	ZEND_ARG_INFO(0, size)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_file_object_seek, 0, 0, 1) 
	ZEND_ARG_INFO(0, line_pos)
ZEND_END_ARG_INFO()

static const zend_function_entry spl_SplFileObject_functions[] = {
	SPL_ME(SplFileObject, __construct,    arginfo_file_object___construct,   ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, rewind,         arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, eof,            arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, valid,          arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fgets,          arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fgetcsv,        arginfo_file_object_fgetcsv,       ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fputcsv,        arginfo_file_object_fputcsv,       ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, setCsvControl,  arginfo_file_object_fgetcsv,       ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, getCsvControl,  arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, flock,          arginfo_file_object_flock,         ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fflush,         arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, ftell,          arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fseek,          arginfo_file_object_fseek,         ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fgetc,          arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fpassthru,      arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fgetss,         arginfo_file_object_fgetss,        ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fscanf,         arginfo_file_object_fscanf,        ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fwrite,         arginfo_file_object_fwrite,        ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, fstat,          arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, ftruncate,      arginfo_file_object_ftruncate,     ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, current,        arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, key,            arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, next,           arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, setFlags,       arginfo_file_object_setFlags,      ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, getFlags,       arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, setMaxLineLen,  arginfo_file_object_setMaxLineLen, ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, getMaxLineLen,  arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, hasChildren,    arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, getChildren,    arginfo_splfileinfo_void,          ZEND_ACC_PUBLIC)
	SPL_ME(SplFileObject, seek,           arginfo_file_object_seek,          ZEND_ACC_PUBLIC)
	/* mappings */
	SPL_MA(SplFileObject, getCurrentLine, SplFileObject, fgets,      arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	SPL_MA(SplFileObject, __toString,     SplFileObject, current,    arginfo_splfileinfo_void, ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};

ZEND_BEGIN_ARG_INFO_EX(arginfo_temp_file_object___construct, 0, 0, 0)
	ZEND_ARG_INFO(0, max_memory)
ZEND_END_ARG_INFO()

static const zend_function_entry spl_SplTempFileObject_functions[] = {
	SPL_ME(SplTempFileObject, __construct, arginfo_temp_file_object___construct,  ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};
/* }}} */

/* {{{ PHP_MINIT_FUNCTION(spl_directory)
 */
PHP_MINIT_FUNCTION(spl_directory)
{
	REGISTER_SPL_STD_CLASS_EX(SplFileInfo, spl_filesystem_object_new, spl_SplFileInfo_functions);
	memcpy(&spl_filesystem_object_handlers, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	spl_filesystem_object_handlers.clone_obj       = spl_filesystem_object_clone;
	spl_filesystem_object_handlers.cast_object     = spl_filesystem_object_cast;
	spl_filesystem_object_handlers.get_debug_info  = spl_filesystem_object_get_debug_info;
	spl_ce_SplFileInfo->serialize = zend_class_serialize_deny;
	spl_ce_SplFileInfo->unserialize = zend_class_unserialize_deny;

	REGISTER_SPL_SUB_CLASS_EX(DirectoryIterator, SplFileInfo, spl_filesystem_object_new, spl_DirectoryIterator_functions);
	zend_class_implements(spl_ce_DirectoryIterator TSRMLS_CC, 1, zend_ce_iterator);
	REGISTER_SPL_IMPLEMENTS(DirectoryIterator, SeekableIterator);

	spl_ce_DirectoryIterator->get_iterator = spl_filesystem_dir_get_iterator;

	REGISTER_SPL_SUB_CLASS_EX(FilesystemIterator, DirectoryIterator, spl_filesystem_object_new, spl_FilesystemIterator_functions);

	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "CURRENT_MODE_MASK",   SPL_FILE_DIR_CURRENT_MODE_MASK);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "CURRENT_AS_PATHNAME", SPL_FILE_DIR_CURRENT_AS_PATHNAME);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "CURRENT_AS_FILEINFO", SPL_FILE_DIR_CURRENT_AS_FILEINFO);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "CURRENT_AS_SELF",     SPL_FILE_DIR_CURRENT_AS_SELF);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "KEY_MODE_MASK",       SPL_FILE_DIR_KEY_MODE_MASK);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "KEY_AS_PATHNAME",     SPL_FILE_DIR_KEY_AS_PATHNAME);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "FOLLOW_SYMLINKS",     SPL_FILE_DIR_FOLLOW_SYMLINKS);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "KEY_AS_FILENAME",     SPL_FILE_DIR_KEY_AS_FILENAME);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "NEW_CURRENT_AND_KEY", SPL_FILE_DIR_KEY_AS_FILENAME|SPL_FILE_DIR_CURRENT_AS_FILEINFO);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "SKIP_DOTS",           SPL_FILE_DIR_SKIPDOTS);
	REGISTER_SPL_CLASS_CONST_LONG(FilesystemIterator, "UNIX_PATHS",          SPL_FILE_DIR_UNIXPATHS);

	spl_ce_FilesystemIterator->get_iterator = spl_filesystem_tree_get_iterator;

	REGISTER_SPL_SUB_CLASS_EX(RecursiveDirectoryIterator, FilesystemIterator, spl_filesystem_object_new, spl_RecursiveDirectoryIterator_functions);
	REGISTER_SPL_IMPLEMENTS(RecursiveDirectoryIterator, RecursiveIterator);

#ifdef HAVE_GLOB
	REGISTER_SPL_SUB_CLASS_EX(GlobIterator, FilesystemIterator, spl_filesystem_object_new, spl_GlobIterator_functions);
	REGISTER_SPL_IMPLEMENTS(GlobIterator, Countable);
#endif

	REGISTER_SPL_SUB_CLASS_EX(SplFileObject, SplFileInfo, spl_filesystem_object_new, spl_SplFileObject_functions);
	REGISTER_SPL_IMPLEMENTS(SplFileObject, RecursiveIterator);
	REGISTER_SPL_IMPLEMENTS(SplFileObject, SeekableIterator);

	REGISTER_SPL_CLASS_CONST_LONG(SplFileObject, "DROP_NEW_LINE", SPL_FILE_OBJECT_DROP_NEW_LINE);
	REGISTER_SPL_CLASS_CONST_LONG(SplFileObject, "READ_AHEAD",    SPL_FILE_OBJECT_READ_AHEAD);
	REGISTER_SPL_CLASS_CONST_LONG(SplFileObject, "SKIP_EMPTY",    SPL_FILE_OBJECT_SKIP_EMPTY);
	REGISTER_SPL_CLASS_CONST_LONG(SplFileObject, "READ_CSV",      SPL_FILE_OBJECT_READ_CSV);
	
	REGISTER_SPL_SUB_CLASS_EX(SplTempFileObject, SplFileObject, spl_filesystem_object_new, spl_SplTempFileObject_functions);
	return SUCCESS;
}
/* }}} */

/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * End:
 * vim600: noet sw=4 ts=4 fdm=marker
 * vim<600: noet sw=4 ts=4
 */
