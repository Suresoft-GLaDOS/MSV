#define __COMPILE_0
#define __COMPILE_1
#define __COMPILE_2
#define __COMPILE_4
#define __COMPILE_5
#define __COMPILE_6
#define __COMPILE_7
#define __COMPILE_8
#define __COMPILE_9
#define __COMPILE_10
#define __COMPILE_11
#define __COMPILE_12
#define __COMPILE_13
#define __COMPILE_14
#define __COMPILE_15
#define __COMPILE_16
#define __COMPILE_17
#define __COMPILE_18
#define __COMPILE_19
#define __COMPILE_20
#define __COMPILE_21
#define __COMPILE_22
#define __COMPILE_23
#define __COMPILE_24
#define __COMPILE_25
#define __COMPILE_26
#define __COMPILE_27
#define __COMPILE_28
#define __COMPILE_29
#define __COMPILE_30
#define __COMPILE_31
#define __COMPILE_32
#define __COMPILE_33
#define __COMPILE_34
#define __COMPILE_35
#define __COMPILE_36
#define __COMPILE_37
#define __COMPILE_38
#define __COMPILE_39
#define __COMPILE_40
#define __COMPILE_41
#define __COMPILE_42
#define __COMPILE_43
#define __COMPILE_44
#define __COMPILE_45
#define __COMPILE_46
#define __COMPILE_47
#define __COMPILE_48
#define __COMPILE_49
#define __COMPILE_50
#define __COMPILE_51
#define __COMPILE_52
#define __COMPILE_53
#define __COMPILE_54
#define __COMPILE_55
#define __COMPILE_58
#define __COMPILE_59
#define __COMPILE_60
#define __COMPILE_62
#define __COMPILE_63
#define __COMPILE_64
#define __COMPILE_65
#define __COMPILE_66
#define __COMPILE_67
#define __COMPILE_68
#define __COMPILE_69
#define __COMPILE_70
#define __COMPILE_71
#define __COMPILE_72
#define __COMPILE_73
#define __COMPILE_74
#define __COMPILE_75
#define __COMPILE_76
#define __COMPILE_77
#define __COMPILE_78
#define __COMPILE_79
#define __COMPILE_80
#define __COMPILE_81
#define __COMPILE_82
#define __COMPILE_83
#define __COMPILE_84
#define __COMPILE_85
#define __COMPILE_86
#define __COMPILE_87
#define __COMPILE_88
#define __COMPILE_89
#define __COMPILE_90
#define __COMPILE_91
#define __COMPILE_92
#define __COMPILE_93
#define __COMPILE_94
#define __COMPILE_95
#define __COMPILE_96
#define __COMPILE_97
#define __COMPILE_98
#define __COMPILE_99
#define __COMPILE_100
#define __COMPILE_101
#define __COMPILE_102
#define __COMPILE_103
#define __COMPILE_104
#define __COMPILE_105
#define __COMPILE_106
#define __COMPILE_107
#define __COMPILE_108
#define __COMPILE_109
#define __COMPILE_110
#define __COMPILE_111
#define __COMPILE_112
#define __COMPILE_113
#define __COMPILE_114
#define __COMPILE_115
#define __COMPILE_116
#define __COMPILE_117
#define __COMPILE_118
#define __COMPILE_119
#define __COMPILE_120
#define __COMPILE_121
#define __COMPILE_122
#define __COMPILE_123
#define __COMPILE_124
#define __COMPILE_125
#define __COMPILE_126
#define __COMPILE_127
#define __COMPILE_128
#define __COMPILE_129
#define __COMPILE_130
#define __COMPILE_131
#define __COMPILE_132
#define __COMPILE_133
#define __COMPILE_134
#define __COMPILE_135
#define __COMPILE_136
#define __COMPILE_137
#define __COMPILE_138
#define __COMPILE_139
#define __COMPILE_140
#define __COMPILE_141
#define __COMPILE_142
#define __COMPILE_143
#define __COMPILE_144
#define __COMPILE_145
#define __COMPILE_146
#define __COMPILE_147
#define __COMPILE_148
#define __COMPILE_149
#define __COMPILE_150
#define __COMPILE_151
#define __COMPILE_152
#define __COMPILE_153
#define __COMPILE_154
#define __COMPILE_155
#define __COMPILE_156
#define __COMPILE_157
#define __COMPILE_158
#define __COMPILE_159
#define __COMPILE_160
#define __COMPILE_161
#define __COMPILE_162
#define __COMPILE_163
#define __COMPILE_164
#define __COMPILE_165
#define __COMPILE_166
#define __COMPILE_167
#define __COMPILE_168
#define __COMPILE_169
#define __COMPILE_170
#define __COMPILE_171
#define __COMPILE_172
#define __COMPILE_173
#define __COMPILE_174
#define __COMPILE_175
#define __COMPILE_176
#define __COMPILE_177
#define __COMPILE_178
#define __COMPILE_179
#define __COMPILE_180
#define __COMPILE_181
#define __COMPILE_182
#define __COMPILE_183
#define __COMPILE_184
#define __COMPILE_185
#define __COMPILE_186
#define __COMPILE_187
#define __COMPILE_188
#define __COMPILE_189
#define __COMPILE_190
#define __COMPILE_191
#define __COMPILE_192
#define __COMPILE_193
#define __COMPILE_194
#define __COMPILE_195
#define __COMPILE_196
#define __COMPILE_197
#define __COMPILE_198
#define __COMPILE_199
#define __COMPILE_200
#define __COMPILE_201
#define __COMPILE_203
#define __COMPILE_204
#define __COMPILE_205
#define __COMPILE_207
#define __COMPILE_208
#define __COMPILE_209
#define __COMPILE_210
#define __COMPILE_211
#define __COMPILE_212
#define __COMPILE_213
#define __COMPILE_214
#define __COMPILE_215
#define __COMPILE_216
#define __COMPILE_217
#define __COMPILE_218
#define __COMPILE_219
#define __COMPILE_220
#define __COMPILE_221
#define __COMPILE_222
#define __COMPILE_223
#define __COMPILE_224
#define __COMPILE_225
#define __COMPILE_226
#define __COMPILE_227
#define __COMPILE_228
#define __COMPILE_229
#define __COMPILE_230
#define __COMPILE_231
#define __COMPILE_232
#define __COMPILE_233
#define __COMPILE_234
#define __COMPILE_236
#define __COMPILE_237
#define __COMPILE_238
#define __COMPILE_239
#define __COMPILE_240
#define __COMPILE_241
#define __COMPILE_242
#define __COMPILE_243
#define __COMPILE_244
#define __COMPILE_245
#define __COMPILE_246
#define __COMPILE_247
#define __COMPILE_248
#define __COMPILE_249
#define __COMPILE_250
#define __COMPILE_251
#define __COMPILE_252
#define __COMPILE_253
#define __COMPILE_254
#define __COMPILE_256
#define __COMPILE_257
#define __COMPILE_258
#define __COMPILE_259
#define __COMPILE_260
#define __COMPILE_261
#define __COMPILE_262
#define __COMPILE_263
#define __COMPILE_264
#define __COMPILE_265
#define __COMPILE_266
#define __COMPILE_267
#define __COMPILE_268
#define __COMPILE_269
#define __COMPILE_270
#define __COMPILE_271
#define __COMPILE_272
#define __COMPILE_273
#define __COMPILE_274
#define __COMPILE_275
#define __COMPILE_276
#define __COMPILE_277
#define __COMPILE_278
#define __COMPILE_279
#define __COMPILE_280
#define __COMPILE_281
#define __COMPILE_282
#define __COMPILE_283
#define __COMPILE_284
#define __COMPILE_285
#define __COMPILE_286
#define __COMPILE_287
#define __COMPILE_288
#define __COMPILE_289
#define __COMPILE_290
#define __COMPILE_291
#define __COMPILE_292
#define __COMPILE_293
#define __COMPILE_294
#define __COMPILE_295
#define __COMPILE_296
#define __COMPILE_297
#define __COMPILE_298
#define __COMPILE_299
#define __COMPILE_300
#define __COMPILE_301
#define __COMPILE_302
#define __COMPILE_303
#define __COMPILE_304
#define __COMPILE_305
#define __COMPILE_306
#define __COMPILE_307
#define __COMPILE_308
#define __COMPILE_309
#define __COMPILE_310
#define __COMPILE_311
#define __COMPILE_312
#define __COMPILE_313
#define __COMPILE_314
#define __COMPILE_315
#define __COMPILE_316
#define __COMPILE_317
#define __COMPILE_318
#define __COMPILE_319
#define __COMPILE_320
#define __COMPILE_321
#define __COMPILE_322
#define __COMPILE_323
#define __COMPILE_324
#define __COMPILE_325
#define __COMPILE_326
#define __COMPILE_327
#define __COMPILE_328
#define __COMPILE_329
#define __COMPILE_330
#define __COMPILE_331
#define __COMPILE_332
#define __COMPILE_333
#define __COMPILE_334
#define __COMPILE_335
#define __COMPILE_336
#define __COMPILE_337
#define __COMPILE_338
#define __COMPILE_339
#define __COMPILE_340
#define __COMPILE_341
#define __COMPILE_342
#define __COMPILE_343
#define __COMPILE_344
#define __COMPILE_345
#define __COMPILE_346
#define __COMPILE_347
#define __COMPILE_348
#define __COMPILE_349
#define __COMPILE_350
#define __COMPILE_351
#define __COMPILE_352
#define __COMPILE_353
#define __COMPILE_354
#define __COMPILE_355
#define __COMPILE_356
#define __COMPILE_357
#define __COMPILE_358
#define __COMPILE_359
#define __COMPILE_360
#define __COMPILE_361
#define __COMPILE_362
#define __COMPILE_363
#define __COMPILE_364
#define __COMPILE_365
#define __COMPILE_366
#define __COMPILE_367
#define __COMPILE_368
#define __COMPILE_369
#define __COMPILE_370
#define __COMPILE_371
#define __COMPILE_372
#define __COMPILE_373
#define __COMPILE_374
#define __COMPILE_375
#define __COMPILE_376
#define __COMPILE_377
#define __COMPILE_378
#define __COMPILE_379
#define __COMPILE_380
#define __COMPILE_381
#define __COMPILE_382
#define __COMPILE_383
#define __COMPILE_384
#define __COMPILE_385
#define __COMPILE_386
#define __COMPILE_387
#define __COMPILE_388
#define __COMPILE_389
#define __COMPILE_390
#define __COMPILE_391
#define __COMPILE_392
#define __COMPILE_393
#define __COMPILE_394
#define __COMPILE_395
#define __COMPILE_396
#define __COMPILE_397
#define __COMPILE_398
#define __COMPILE_399
#define __COMPILE_400
#define __COMPILE_401
#define __COMPILE_402
#define __COMPILE_403
#define __COMPILE_404
#define __COMPILE_405
#define __COMPILE_406
#define __COMPILE_407
#define __COMPILE_408
#define __COMPILE_409
#define __COMPILE_410
#define __COMPILE_411
#define __COMPILE_412
#define __COMPILE_413
#define __COMPILE_414
#define __COMPILE_415
#define __COMPILE_416
#define __COMPILE_417
#define __COMPILE_418
#define __COMPILE_419
#define __COMPILE_420
#define __COMPILE_421
#define __COMPILE_422
#define __COMPILE_423
#define __COMPILE_424
#define __COMPILE_425
#define __COMPILE_426
#define __COMPILE_427
#define __COMPILE_428
#define __COMPILE_429
#define __COMPILE_430
#define __COMPILE_431
#define __COMPILE_432
#define __COMPILE_433
#define __COMPILE_434
#define __COMPILE_435
#define __COMPILE_436
#define __COMPILE_437
#define __COMPILE_438
#define __COMPILE_439
#define __COMPILE_440
#define __COMPILE_441
#define __COMPILE_442
#define __COMPILE_443
#define __COMPILE_444
#define __COMPILE_445
#define __COMPILE_446
#define __COMPILE_447
#define __COMPILE_448
#define __COMPILE_449
#define __COMPILE_450
#define __COMPILE_451
#define __COMPILE_452
#define __COMPILE_453
#define __COMPILE_454
#define __COMPILE_455
#define __COMPILE_456
#define __COMPILE_457
#define __COMPILE_458
#define __COMPILE_459
#define __COMPILE_460
#define __COMPILE_461
#define __COMPILE_462
#define __COMPILE_463
#define __COMPILE_464
#define __COMPILE_465
#define __COMPILE_466
#define __COMPILE_467
#define __COMPILE_468
#define __COMPILE_469
#define __COMPILE_470
#define __COMPILE_471
#define __COMPILE_472
#define __COMPILE_473
#define __COMPILE_474
#define __COMPILE_475
#define __COMPILE_476
#define __COMPILE_477
#define __COMPILE_478
#define __COMPILE_479
#define __COMPILE_480
#define __COMPILE_481
#define __COMPILE_482
#define __COMPILE_483
#define __COMPILE_484
#define __COMPILE_485
#define __COMPILE_486
#define __COMPILE_487
#define __COMPILE_488
#define __COMPILE_489
#define __COMPILE_490
#define __COMPILE_491
#define __COMPILE_492
#define __COMPILE_493
#define __COMPILE_494
#define __COMPILE_495
#define __COMPILE_496
#define __COMPILE_497
#define __COMPILE_498
#define __COMPILE_499
#define __COMPILE_500
#define __COMPILE_501
#define __COMPILE_502
#define __COMPILE_503
#define __COMPILE_504
#define __COMPILE_505
#define __COMPILE_506
#define __COMPILE_507
#define __COMPILE_508
#define __COMPILE_509
#define __COMPILE_510
#define __COMPILE_511
#define __COMPILE_512
#define __COMPILE_513
#define __COMPILE_514
#define __COMPILE_515
#define __COMPILE_516
#define __COMPILE_517
#define __COMPILE_518
#define __COMPILE_519
#define __COMPILE_520
#define __COMPILE_521
#define __COMPILE_522
#define __COMPILE_523
#define __COMPILE_524
#define __COMPILE_525
#define __COMPILE_526
#define __COMPILE_527
#define __COMPILE_528
#define __COMPILE_529
#define __COMPILE_530
#define __COMPILE_531
#define __COMPILE_532
#define __COMPILE_533
#define __COMPILE_534
#define __COMPILE_535
#define __COMPILE_536
#define __COMPILE_537
#define __COMPILE_538
#define __COMPILE_539
#define __COMPILE_540
#define __COMPILE_541
#define __COMPILE_542
#define __COMPILE_543
#define __COMPILE_544
#define __COMPILE_545
#define __COMPILE_546
#define __COMPILE_547
#define __COMPILE_548
#define __COMPILE_549
#define __COMPILE_550
#define __COMPILE_551
#define __COMPILE_552
#define __COMPILE_553
#define __COMPILE_554
#define __COMPILE_555
#define __COMPILE_556
#define __COMPILE_557
#define __COMPILE_558
#define __COMPILE_559
#define __COMPILE_560
#define __COMPILE_561
#define __COMPILE_562
#define __COMPILE_563
#define __COMPILE_564
#define __COMPILE_565
#define __COMPILE_566
#define __COMPILE_567
#define __COMPILE_568
#define __COMPILE_569
#define __COMPILE_570
#define __COMPILE_571
#define __COMPILE_572
#define __COMPILE_573
#define __COMPILE_574
#define __COMPILE_575
#define __COMPILE_576
#define __COMPILE_577
#define __COMPILE_578
#define __COMPILE_579
#define __COMPILE_580
#define __COMPILE_581
#define __COMPILE_582
#define __COMPILE_583
#define __COMPILE_584
#define __COMPILE_585
#define __COMPILE_586
#define __COMPILE_587
#define __COMPILE_588
#define __COMPILE_589
#define __COMPILE_590
#define __COMPILE_591
#define __COMPILE_592
#define __COMPILE_593
#define __COMPILE_594
#define __COMPILE_595
#define __COMPILE_596
#define __COMPILE_597
#define __COMPILE_598
#define __COMPILE_599
#define __COMPILE_600
#define __COMPILE_601
#define __COMPILE_602
#define __COMPILE_603
#define __COMPILE_604
#define __COMPILE_605
#define __COMPILE_606
#define __COMPILE_607
#define __COMPILE_608
#define __COMPILE_609
#define __COMPILE_610
#define __COMPILE_611
#define __COMPILE_612
#define __COMPILE_613
#define __COMPILE_614
#define __COMPILE_615
#define __COMPILE_616
#define __COMPILE_617
#define __COMPILE_618
#define __COMPILE_619
#define __COMPILE_620
#define __COMPILE_621
#define __COMPILE_622
#define __COMPILE_623
#define __COMPILE_624
#define __COMPILE_625
#define __COMPILE_626
#define __COMPILE_627
#define __COMPILE_628
#define __COMPILE_629
#define __COMPILE_630
#define __COMPILE_631
#define __COMPILE_632
#define __COMPILE_633
#define __COMPILE_634
#define __COMPILE_635
#define __COMPILE_636
#define __COMPILE_637
#define __COMPILE_638
#define __COMPILE_639
#define __COMPILE_640
#define __COMPILE_641
#define __COMPILE_642
#define __COMPILE_643
#define __COMPILE_644
#define __COMPILE_645
#define __COMPILE_646
#define __COMPILE_647
#define __COMPILE_648
#define __COMPILE_649
#define __COMPILE_650
#define __COMPILE_651
#define __COMPILE_652
#define __COMPILE_653
#define __COMPILE_654
#define __COMPILE_655
#define __COMPILE_656
#define __COMPILE_657
#define __COMPILE_658
#define __COMPILE_659
#define __COMPILE_660
#define __COMPILE_661
#define __COMPILE_662
#define __COMPILE_663
#define __COMPILE_664
// compile_fin
int __get_mutant(); int __is_neg(const char *location,char *lid,int count, ...); int __abst_hole(); char *__stat_write_init(const char *func_name);void __write_stat(char *str,const char *var_name,void *var_addr,int size); void __stat_file_close(const char *func_name,char *str);long long __mutate(const long long,const char *,const char *); int __trident_choice(char* lid, char* typestr,int* rvals, char** rvals_ids, int rvals_size,int** lvals, char** lvals_ids, int lvals_size);int __trident_output(char* id, char* typestr, int value);float fabs_trident(float a);int __choose(const char *);void *__var_select(unsigned int var_count,void *vars[]);void *__var_select_2(unsigned int var_count,void *vars[]);long long __const_select(unsigned int const_count, ...);void* memset(void*, int, unsigned long); 
/*
   +----------------------------------------------------------------------+
   | PHP Version 5                                                        |
   +----------------------------------------------------------------------+
   | Copyright (c) 1997-2011 The PHP Group                                |
   +----------------------------------------------------------------------+
   | This source file is subject to version 3.01 of the PHP license,      |
   | that is bundled with this package in the file LICENSE, and is        |
   | available through the world-wide-web at the following url:           |
   | http://www.php.net/license/3_01.txt                                  |
   | If you did not receive a copy of the PHP license and are unable to   |
   | obtain it through the world-wide-web, please send a note to          |
   | license@php.net so we can mail you a copy immediately.               |
   +----------------------------------------------------------------------+
   | Authors: Derick Rethans <derick@derickrethans.nl>                    |
   +----------------------------------------------------------------------+
 */

/* $Id$ */

#include "php.h"
#include "php_streams.h"
#include "php_main.h"
#include "php_globals.h"
#include "php_ini.h"
#include "ext/standard/info.h"
#include "ext/standard/php_versioning.h"
#include "ext/standard/php_math.h"
#include "php_date.h"
#include "zend_interfaces.h"
#include "lib/timelib.h"
#include <time.h>

#ifdef PHP_WIN32
static __inline __int64 php_date_llabs( __int64 i ) { return i >= 0? i: -i; }
#elif defined(__GNUC__) && __GNUC__ < 3
static __inline __int64_t php_date_llabs( __int64_t i ) { return i >= 0 ? i : -i; }
#else
static inline long long php_date_llabs( long long i ) { return i >= 0 ? i : -i; }
#endif

/* {{{ arginfo */
ZEND_BEGIN_ARG_INFO_EX(arginfo_date, 0, 0, 1)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, timestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_gmdate, 0, 0, 1)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, timestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_idate, 0, 0, 1)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, timestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_strtotime, 0, 0, 1)
	ZEND_ARG_INFO(0, time)
	ZEND_ARG_INFO(0, now)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_mktime, 0, 0, 0)
	ZEND_ARG_INFO(0, hour)
	ZEND_ARG_INFO(0, min)
	ZEND_ARG_INFO(0, sec)
	ZEND_ARG_INFO(0, mon)
	ZEND_ARG_INFO(0, day)
	ZEND_ARG_INFO(0, year)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_gmmktime, 0, 0, 0)
	ZEND_ARG_INFO(0, hour)
	ZEND_ARG_INFO(0, min)
	ZEND_ARG_INFO(0, sec)
	ZEND_ARG_INFO(0, mon)
	ZEND_ARG_INFO(0, day)
	ZEND_ARG_INFO(0, year)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_checkdate, 0)
	ZEND_ARG_INFO(0, month)
	ZEND_ARG_INFO(0, day)
	ZEND_ARG_INFO(0, year)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_strftime, 0, 0, 1)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, timestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_gmstrftime, 0, 0, 1)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, timestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_time, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_localtime, 0, 0, 0)
	ZEND_ARG_INFO(0, timestamp)
	ZEND_ARG_INFO(0, associative_array)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_getdate, 0, 0, 0)
	ZEND_ARG_INFO(0, timestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_default_timezone_set, 0)
	ZEND_ARG_INFO(0, timezone_identifier)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_default_timezone_get, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_sunrise, 0, 0, 1)
	ZEND_ARG_INFO(0, time)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, latitude)
	ZEND_ARG_INFO(0, longitude)
	ZEND_ARG_INFO(0, zenith)
	ZEND_ARG_INFO(0, gmt_offset)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_sunset, 0, 0, 1)
	ZEND_ARG_INFO(0, time)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, latitude)
	ZEND_ARG_INFO(0, longitude)
	ZEND_ARG_INFO(0, zenith)
	ZEND_ARG_INFO(0, gmt_offset)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_sun_info, 0)
	ZEND_ARG_INFO(0, time)
	ZEND_ARG_INFO(0, latitude)
	ZEND_ARG_INFO(0, longitude)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_create, 0, 0, 0)
	ZEND_ARG_INFO(0, time)
	ZEND_ARG_INFO(0, object)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_create_from_format, 0, 0, 2)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, time)
	ZEND_ARG_INFO(0, object)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_parse, 0, 0, 1)
	ZEND_ARG_INFO(0, date)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_parse_from_format, 0, 0, 2)
	ZEND_ARG_INFO(0, format)
	ZEND_ARG_INFO(0, date)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_get_last_errors, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_format, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, format)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_format, 0, 0, 1)
	ZEND_ARG_INFO(0, format)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_modify, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, modify)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_modify, 0, 0, 1)
	ZEND_ARG_INFO(0, modify)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_add, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, interval)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_add, 0, 0, 1)
	ZEND_ARG_INFO(0, interval)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_sub, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, interval)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_sub, 0, 0, 1)
	ZEND_ARG_INFO(0, interval)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_timezone_get, 0, 0, 1)
	ZEND_ARG_INFO(0, object)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_method_timezone_get, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_timezone_set, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, timezone)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_timezone_set, 0, 0, 1)
	ZEND_ARG_INFO(0, timezone)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_offset_get, 0, 0, 1)
	ZEND_ARG_INFO(0, object)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_method_offset_get, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_diff, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, object2)
	ZEND_ARG_INFO(0, absolute)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_diff, 0, 0, 1)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, absolute)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_time_set, 0, 0, 3)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, hour)
	ZEND_ARG_INFO(0, minute)
	ZEND_ARG_INFO(0, second)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_time_set, 0, 0, 2)
	ZEND_ARG_INFO(0, hour)
	ZEND_ARG_INFO(0, minute)
	ZEND_ARG_INFO(0, second)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_date_set, 0, 0, 4)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, year)
	ZEND_ARG_INFO(0, month)
	ZEND_ARG_INFO(0, day)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_date_set, 0, 0, 3)
	ZEND_ARG_INFO(0, year)
	ZEND_ARG_INFO(0, month)
	ZEND_ARG_INFO(0, day)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_isodate_set, 0, 0, 3)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, year)
	ZEND_ARG_INFO(0, week)
	ZEND_ARG_INFO(0, day)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_isodate_set, 0, 0, 2)
	ZEND_ARG_INFO(0, year)
	ZEND_ARG_INFO(0, week)
	ZEND_ARG_INFO(0, day)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_timestamp_set, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, unixtimestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_method_timestamp_set, 0, 0, 1)
	ZEND_ARG_INFO(0, unixtimestamp)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_timestamp_get, 0, 0, 1)
	ZEND_ARG_INFO(0, object)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_method_timestamp_get, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_open, 0, 0, 1)
	ZEND_ARG_INFO(0, timezone)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_name_get, 0, 0, 1)
	ZEND_ARG_INFO(0, object)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_timezone_method_name_get, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_name_from_abbr, 0, 0, 1)
	ZEND_ARG_INFO(0, abbr)
	ZEND_ARG_INFO(0, gmtoffset)
	ZEND_ARG_INFO(0, isdst)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_offset_get, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, datetime)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_method_offset_get, 0, 0, 1)
	ZEND_ARG_INFO(0, datetime)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_transitions_get, 0, 0, 1)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, timestamp_begin)
	ZEND_ARG_INFO(0, timestamp_end)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_timezone_method_transitions_get, 0)
	ZEND_ARG_INFO(0, timestamp_begin)
	ZEND_ARG_INFO(0, timestamp_end)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_location_get, 0, 0, 1)
	ZEND_ARG_INFO(0, object)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_timezone_method_location_get, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_timezone_identifiers_list, 0, 0, 0)
	ZEND_ARG_INFO(0, what)
	ZEND_ARG_INFO(0, country)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_timezone_abbreviations_list, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_timezone_version_get, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_interval_create_from_date_string, 0, 0, 1)
	ZEND_ARG_INFO(0, time)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_interval_format, 0, 0, 2)
	ZEND_ARG_INFO(0, object)
	ZEND_ARG_INFO(0, format)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_date_method_interval_format, 0)
	ZEND_ARG_INFO(0, format)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_period_construct, 0, 0, 3)
	ZEND_ARG_INFO(0, start)
	ZEND_ARG_INFO(0, interval)
	ZEND_ARG_INFO(0, end)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO_EX(arginfo_date_interval_construct, 0, 0, 0)
	ZEND_ARG_INFO(0, interval_spec)
ZEND_END_ARG_INFO()
/* }}} */

/* {{{ Function table */
const zend_function_entry date_functions[] = {
	PHP_FE(strtotime, arginfo_strtotime)
	PHP_FE(date, arginfo_date)
	PHP_FE(idate, arginfo_idate)
	PHP_FE(gmdate, arginfo_gmdate)
	PHP_FE(mktime, arginfo_mktime)
	PHP_FE(gmmktime, arginfo_gmmktime)
	PHP_FE(checkdate, arginfo_checkdate)

#ifdef HAVE_STRFTIME
	PHP_FE(strftime, arginfo_strftime)
	PHP_FE(gmstrftime, arginfo_gmstrftime)
#endif

	PHP_FE(time, arginfo_time)
	PHP_FE(localtime, arginfo_localtime)
	PHP_FE(getdate, arginfo_getdate)

	/* Advanced Interface */
	PHP_FE(date_create, arginfo_date_create)
	PHP_FE(date_create_from_format, arginfo_date_create_from_format)
	PHP_FE(date_parse, arginfo_date_parse)
	PHP_FE(date_parse_from_format, arginfo_date_parse_from_format)
	PHP_FE(date_get_last_errors, arginfo_date_get_last_errors)
	PHP_FE(date_format, arginfo_date_format)
	PHP_FE(date_modify, arginfo_date_modify)
	PHP_FE(date_add, arginfo_date_add)
	PHP_FE(date_sub, arginfo_date_sub)
	PHP_FE(date_timezone_get, arginfo_date_timezone_get)
	PHP_FE(date_timezone_set, arginfo_date_timezone_set)
	PHP_FE(date_offset_get, arginfo_date_offset_get)
	PHP_FE(date_diff, arginfo_date_diff)

	PHP_FE(date_time_set, arginfo_date_time_set)
	PHP_FE(date_date_set, arginfo_date_date_set)
	PHP_FE(date_isodate_set, arginfo_date_isodate_set)
	PHP_FE(date_timestamp_set, arginfo_date_timestamp_set)
	PHP_FE(date_timestamp_get, arginfo_date_timestamp_get)

	PHP_FE(timezone_open, arginfo_timezone_open)
	PHP_FE(timezone_name_get, arginfo_timezone_name_get)
	PHP_FE(timezone_name_from_abbr, arginfo_timezone_name_from_abbr)
	PHP_FE(timezone_offset_get, arginfo_timezone_offset_get)
	PHP_FE(timezone_transitions_get, arginfo_timezone_transitions_get)
	PHP_FE(timezone_location_get, arginfo_timezone_location_get)
	PHP_FE(timezone_identifiers_list, arginfo_timezone_identifiers_list)
	PHP_FE(timezone_abbreviations_list, arginfo_timezone_abbreviations_list)
	PHP_FE(timezone_version_get, arginfo_timezone_version_get)

	PHP_FE(date_interval_create_from_date_string, arginfo_date_interval_create_from_date_string)
	PHP_FE(date_interval_format, arginfo_date_interval_format)

	/* Options and Configuration */
	PHP_FE(date_default_timezone_set, arginfo_date_default_timezone_set)
	PHP_FE(date_default_timezone_get, arginfo_date_default_timezone_get)

	/* Astronomical functions */
	PHP_FE(date_sunrise, arginfo_date_sunrise)
	PHP_FE(date_sunset, arginfo_date_sunset)
	PHP_FE(date_sun_info, arginfo_date_sun_info)
	{NULL, NULL, NULL}
};

const zend_function_entry date_funcs_date[] = {
	PHP_ME(DateTime,			__construct,		arginfo_date_create, ZEND_ACC_CTOR|ZEND_ACC_PUBLIC)
	PHP_ME(DateTime,			__wakeup,			NULL, ZEND_ACC_PUBLIC)
	PHP_ME(DateTime,			__set_state,		NULL, ZEND_ACC_PUBLIC|ZEND_ACC_STATIC)
	PHP_ME_MAPPING(createFromFormat, date_create_from_format,	arginfo_date_create_from_format, ZEND_ACC_PUBLIC|ZEND_ACC_STATIC)
	PHP_ME_MAPPING(getLastErrors, date_get_last_errors,	arginfo_date_get_last_errors, ZEND_ACC_PUBLIC|ZEND_ACC_STATIC)
	PHP_ME_MAPPING(format,		date_format,		arginfo_date_method_format, 0)
	PHP_ME_MAPPING(modify,		date_modify,		arginfo_date_method_modify, 0)
	PHP_ME_MAPPING(add,			date_add,			arginfo_date_method_add, 0)
	PHP_ME_MAPPING(sub,			date_sub,			arginfo_date_method_sub, 0)
	PHP_ME_MAPPING(getTimezone, date_timezone_get,	arginfo_date_method_timezone_get, 0)
	PHP_ME_MAPPING(setTimezone, date_timezone_set,	arginfo_date_method_timezone_set, 0)
	PHP_ME_MAPPING(getOffset,	date_offset_get,	arginfo_date_method_offset_get, 0)
	PHP_ME_MAPPING(setTime,		date_time_set,		arginfo_date_method_time_set, 0)
	PHP_ME_MAPPING(setDate,		date_date_set,		arginfo_date_method_date_set, 0)
	PHP_ME_MAPPING(setISODate,	date_isodate_set,	arginfo_date_method_isodate_set, 0)
	PHP_ME_MAPPING(setTimestamp,	date_timestamp_set, arginfo_date_method_timestamp_set, 0)
	PHP_ME_MAPPING(getTimestamp,	date_timestamp_get, arginfo_date_method_timestamp_get, 0)
	PHP_ME_MAPPING(diff,			date_diff, arginfo_date_method_diff, 0)
	{NULL, NULL, NULL}
};

const zend_function_entry date_funcs_timezone[] = {
	PHP_ME(DateTimeZone,              __construct,                 arginfo_timezone_open, ZEND_ACC_CTOR|ZEND_ACC_PUBLIC)
	PHP_ME_MAPPING(getName,           timezone_name_get,           arginfo_timezone_method_name_get, 0)
	PHP_ME_MAPPING(getOffset,         timezone_offset_get,         arginfo_timezone_method_offset_get, 0)
	PHP_ME_MAPPING(getTransitions,    timezone_transitions_get,    arginfo_timezone_method_transitions_get, 0)
	PHP_ME_MAPPING(getLocation,       timezone_location_get,       arginfo_timezone_method_location_get, 0)
	PHP_ME_MAPPING(listAbbreviations, timezone_abbreviations_list, arginfo_timezone_abbreviations_list, ZEND_ACC_PUBLIC|ZEND_ACC_STATIC)
	PHP_ME_MAPPING(listIdentifiers,   timezone_identifiers_list,   arginfo_timezone_identifiers_list, ZEND_ACC_PUBLIC|ZEND_ACC_STATIC)
	{NULL, NULL, NULL}
};

const zend_function_entry date_funcs_interval[] = {
	PHP_ME(DateInterval,              __construct,                 arginfo_date_interval_construct, ZEND_ACC_CTOR|ZEND_ACC_PUBLIC)
	PHP_ME_MAPPING(format,            date_interval_format,        arginfo_date_method_interval_format, 0)
	PHP_ME_MAPPING(createFromDateString, date_interval_create_from_date_string,	arginfo_date_interval_create_from_date_string, ZEND_ACC_PUBLIC|ZEND_ACC_STATIC)
	{NULL, NULL, NULL}
};

const zend_function_entry date_funcs_period[] = {
	PHP_ME(DatePeriod,                __construct,                 arginfo_date_period_construct, ZEND_ACC_CTOR|ZEND_ACC_PUBLIC)
	{NULL, NULL, NULL}
};

static char* guess_timezone(const timelib_tzdb *tzdb TSRMLS_DC);
static void date_register_classes(TSRMLS_D);
/* }}} */

ZEND_DECLARE_MODULE_GLOBALS(date)
static PHP_GINIT_FUNCTION(date);

/* True global */
timelib_tzdb *php_date_global_timezone_db;
int php_date_global_timezone_db_enabled;

#define DATE_DEFAULT_LATITUDE "31.7667"
#define DATE_DEFAULT_LONGITUDE "35.2333"

/* on 90'35; common sunset declaration (start of sun body appear) */
#define DATE_SUNSET_ZENITH "90.583333"

/* on 90'35; common sunrise declaration (sun body disappeared) */
#define DATE_SUNRISE_ZENITH "90.583333"

/* {{{ INI Settings */
PHP_INI_BEGIN()
	STD_PHP_INI_ENTRY("date.timezone", "", PHP_INI_ALL, OnUpdateString, default_timezone, zend_date_globals, date_globals)
	PHP_INI_ENTRY("date.default_latitude",           DATE_DEFAULT_LATITUDE,        PHP_INI_ALL, NULL)
	PHP_INI_ENTRY("date.default_longitude",          DATE_DEFAULT_LONGITUDE,       PHP_INI_ALL, NULL)
	PHP_INI_ENTRY("date.sunset_zenith",              DATE_SUNSET_ZENITH,           PHP_INI_ALL, NULL)
	PHP_INI_ENTRY("date.sunrise_zenith",             DATE_SUNRISE_ZENITH,          PHP_INI_ALL, NULL)
PHP_INI_END()
/* }}} */

zend_class_entry *date_ce_date, *date_ce_timezone, *date_ce_interval, *date_ce_period;


PHPAPI zend_class_entry *php_date_get_date_ce(void)
{
	return date_ce_date;
}

PHPAPI zend_class_entry *php_date_get_timezone_ce(void)
{
	return date_ce_timezone;
}

static zend_object_handlers date_object_handlers_date;
static zend_object_handlers date_object_handlers_timezone;
static zend_object_handlers date_object_handlers_interval;
static zend_object_handlers date_object_handlers_period;

#define DATE_SET_CONTEXT \
	zval *object; \
	object = getThis(); \
   
#define DATE_FETCH_OBJECT	\
	php_date_obj *obj;	\
	DATE_SET_CONTEXT; \
	if (object) {	\
		if (zend_parse_parameters_none() == FAILURE) {	\
			return;	\
		}	\
	} else {	\
		if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, NULL, "O", &object, date_ce_date) == FAILURE) {	\
			RETURN_FALSE;	\
		}	\
	}	\
	obj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);	\

#define DATE_CHECK_INITIALIZED(member, class_name) \
	if (!(member)) { \
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "The " #class_name " object has not been correctly initialized by its constructor"); \
		RETURN_FALSE; \
	}

static void date_object_free_storage_date(void *object TSRMLS_DC);
static void date_object_free_storage_timezone(void *object TSRMLS_DC);
static void date_object_free_storage_interval(void *object TSRMLS_DC);
static void date_object_free_storage_period(void *object TSRMLS_DC);

static zend_object_value date_object_new_date(zend_class_entry *class_type TSRMLS_DC);
static zend_object_value date_object_new_timezone(zend_class_entry *class_type TSRMLS_DC);
static zend_object_value date_object_new_interval(zend_class_entry *class_type TSRMLS_DC);
static zend_object_value date_object_new_period(zend_class_entry *class_type TSRMLS_DC);

static zend_object_value date_object_clone_date(zval *this_ptr TSRMLS_DC);
static zend_object_value date_object_clone_timezone(zval *this_ptr TSRMLS_DC);
static zend_object_value date_object_clone_interval(zval *this_ptr TSRMLS_DC);
static zend_object_value date_object_clone_period(zval *this_ptr TSRMLS_DC);

static int date_object_compare_date(zval *d1, zval *d2 TSRMLS_DC);
static HashTable *date_object_get_properties(zval *object TSRMLS_DC);
static HashTable *date_object_get_properties_interval(zval *object TSRMLS_DC);

zval *date_interval_read_property(zval *object, zval *member, int type, const zend_literal *key TSRMLS_DC);
void date_interval_write_property(zval *object, zval *member, zval *value, const zend_literal *key TSRMLS_DC);

/* {{{ Module struct */
zend_module_entry date_module_entry = {
	STANDARD_MODULE_HEADER_EX,
	NULL,
	NULL,
	"date",                     /* extension name */
	date_functions,             /* function list */
	PHP_MINIT(date),            /* process startup */
	PHP_MSHUTDOWN(date),        /* process shutdown */
	PHP_RINIT(date),            /* request startup */
	PHP_RSHUTDOWN(date),        /* request shutdown */
	PHP_MINFO(date),            /* extension info */
	PHP_VERSION,                /* extension version */
	PHP_MODULE_GLOBALS(date),   /* globals descriptor */
	PHP_GINIT(date),            /* globals ctor */
	NULL,                       /* globals dtor */
	NULL,                       /* post deactivate */
	STANDARD_MODULE_PROPERTIES_EX
};
/* }}} */


/* {{{ PHP_GINIT_FUNCTION */
static PHP_GINIT_FUNCTION(date)
{
	date_globals->default_timezone = NULL;
	date_globals->timezone = NULL;
	date_globals->tzcache = NULL;
}
/* }}} */


static void _php_date_tzinfo_dtor(void *tzinfo)
{
	timelib_tzinfo **tzi = (timelib_tzinfo **)tzinfo;

	timelib_tzinfo_dtor(*tzi);
}

/* {{{ PHP_RINIT_FUNCTION */
PHP_RINIT_FUNCTION(date)
{
	if (DATEG(timezone)) {
		efree(DATEG(timezone));
	}
	DATEG(timezone) = NULL;
	DATEG(tzcache) = NULL;
	DATEG(last_errors) = NULL;

	return SUCCESS;
}
/* }}} */

/* {{{ PHP_RSHUTDOWN_FUNCTION */
PHP_RSHUTDOWN_FUNCTION(date)
{
	if (DATEG(timezone)) {
		efree(DATEG(timezone));
	}
	DATEG(timezone) = NULL;
	if(DATEG(tzcache)) {
		zend_hash_destroy(DATEG(tzcache));
		FREE_HASHTABLE(DATEG(tzcache));
		DATEG(tzcache) = NULL;
	}
	if (DATEG(last_errors)) {
		timelib_error_container_dtor(DATEG(last_errors));
		DATEG(last_errors) = NULL;
	}

	return SUCCESS;
}
/* }}} */

#define DATE_TIMEZONEDB      php_date_global_timezone_db ? php_date_global_timezone_db : timelib_builtin_db()

/*
 * RFC822, Section 5.1: http://www.ietf.org/rfc/rfc822.txt
 *  date-time   =  [ day "," ] date time        ; dd mm yy hh:mm:ss zzz
 *  day         =  "Mon"  / "Tue" /  "Wed"  / "Thu"  /  "Fri"  / "Sat" /  "Sun"
 *  date        =  1*2DIGIT month 2DIGIT        ; day month year e.g. 20 Jun 82
 *  month       =  "Jan"  /  "Feb" /  "Mar"  /  "Apr"  /  "May"  /  "Jun" /  "Jul"  /  "Aug"  /  "Sep"  /  "Oct" /  "Nov"  /  "Dec"
 *  time        =  hour zone                    ; ANSI and Military
 *  hour        =  2DIGIT ":" 2DIGIT [":" 2DIGIT] ; 00:00:00 - 23:59:59
 *  zone        =  "UT"  / "GMT"  /  "EST" / "EDT"  /  "CST" / "CDT"  /  "MST" / "MDT"  /  "PST" / "PDT"  /  1ALPHA  / ( ("+" / "-") 4DIGIT )
 */
#define DATE_FORMAT_RFC822   "D, d M y H:i:s O"

/*
 * RFC850, Section 2.1.4: http://www.ietf.org/rfc/rfc850.txt
 *  Format must be acceptable both to the ARPANET and to the getdate routine.
 *  One format that is acceptable to both is Weekday, DD-Mon-YY HH:MM:SS TIMEZONE
 *  TIMEZONE can be any timezone name (3 or more letters)
 */
#define DATE_FORMAT_RFC850   "l, d-M-y H:i:s T"

/*
 * RFC1036, Section 2.1.2: http://www.ietf.org/rfc/rfc1036.txt
 *  Its format must be acceptable both in RFC-822 and to the getdate(3)
 *  Wdy, DD Mon YY HH:MM:SS TIMEZONE
 *  There is no hope of having a complete list of timezones.  Universal
 *  Time (GMT), the North American timezones (PST, PDT, MST, MDT, CST,
 *  CDT, EST, EDT) and the +/-hhmm offset specifed in RFC-822 should be supported.
 */
#define DATE_FORMAT_RFC1036  "D, d M y H:i:s O"

/*
 * RFC1123, Section 5.2.14: http://www.ietf.org/rfc/rfc1123.txt
 *  RFC-822 Date and Time Specification: RFC-822 Section 5
 *  The syntax for the date is hereby changed to: date = 1*2DIGIT month 2*4DIGIT
 */
#define DATE_FORMAT_RFC1123  "D, d M Y H:i:s O"

/*
 * RFC2822, Section 3.3: http://www.ietf.org/rfc/rfc2822.txt
 *  FWS             =       ([*WSP CRLF] 1*WSP) /   ; Folding white space
 *  CFWS            =       *([FWS] comment) (([FWS] comment) / FWS)
 *  
 *  date-time       =       [ day-of-week "," ] date FWS time [CFWS]
 *  day-of-week     =       ([FWS] day-name)
 *  day-name        =       "Mon" / "Tue" / "Wed" / "Thu" / "Fri" / "Sat" / "Sun"
 *  date            =       day month year
 *  year            =       4*DIGIT
 *  month           =       (FWS month-name FWS)
 *  month-name      =       "Jan" / "Feb" / "Mar" / "Apr" / "May" / "Jun" / "Jul" / "Aug" / "Sep" / "Oct" / "Nov" / "Dec"
 *  day             =       ([FWS] 1*2DIGIT)
 *  time            =       time-of-day FWS zone
 *  time-of-day     =       hour ":" minute [ ":" second ]
 *  hour            =       2DIGIT
 *  minute          =       2DIGIT
 *  second          =       2DIGIT
 *  zone            =       (( "+" / "-" ) 4DIGIT)
 */
#define DATE_FORMAT_RFC2822  "D, d M Y H:i:s O"
/*
 * RFC3339, Section 5.6: http://www.ietf.org/rfc/rfc3339.txt
 *  date-fullyear   = 4DIGIT
 *  date-month      = 2DIGIT  ; 01-12
 *  date-mday       = 2DIGIT  ; 01-28, 01-29, 01-30, 01-31 based on month/year
 *  
 *  time-hour       = 2DIGIT  ; 00-23
 *  time-minute     = 2DIGIT  ; 00-59
 *  time-second     = 2DIGIT  ; 00-58, 00-59, 00-60 based on leap second rules
 *  
 *  time-secfrac    = "." 1*DIGIT
 *  time-numoffset  = ("+" / "-") time-hour ":" time-minute
 *  time-offset     = "Z" / time-numoffset
 *  
 *  partial-time    = time-hour ":" time-minute ":" time-second [time-secfrac]
 *  full-date       = date-fullyear "-" date-month "-" date-mday
 *  full-time       = partial-time time-offset
 *  
 *  date-time       = full-date "T" full-time
 */
#define DATE_FORMAT_RFC3339  "Y-m-d\\TH:i:sP"

#define DATE_FORMAT_ISO8601  "Y-m-d\\TH:i:sO"

#define DATE_TZ_ERRMSG \
	"It is not safe to rely on the system's timezone settings. You are " \
	"*required* to use the date.timezone setting or the " \
	"date_default_timezone_set() function. In case you used any of those " \
	"methods and you are still getting this warning, you most likely " \
	"misspelled the timezone identifier. "

#define SUNFUNCS_RET_TIMESTAMP 0
#define SUNFUNCS_RET_STRING    1
#define SUNFUNCS_RET_DOUBLE    2


/* {{{ PHP_MINIT_FUNCTION */
PHP_MINIT_FUNCTION(date)
{
	REGISTER_INI_ENTRIES();
	date_register_classes(TSRMLS_C);
/*
 * RFC4287, Section 3.3: http://www.ietf.org/rfc/rfc4287.txt
 *   A Date construct is an element whose content MUST conform to the
 *   "date-time" production in [RFC3339].  In addition, an uppercase "T"
 *   character MUST be used to separate date and time, and an uppercase
 *   "Z" character MUST be present in the absence of a numeric time zone offset.
 */
	REGISTER_STRING_CONSTANT("DATE_ATOM",    DATE_FORMAT_RFC3339, CONST_CS | CONST_PERSISTENT);
/*
 * Preliminary specification: http://wp.netscape.com/newsref/std/cookie_spec.html
 *   "This is based on RFC 822, RFC 850,  RFC 1036, and  RFC 1123,
 *   with the variations that the only legal time zone is GMT
 *   and the separators between the elements of the date must be dashes."
 */
	REGISTER_STRING_CONSTANT("DATE_COOKIE",  DATE_FORMAT_RFC850,  CONST_CS | CONST_PERSISTENT);
	REGISTER_STRING_CONSTANT("DATE_ISO8601", DATE_FORMAT_ISO8601, CONST_CS | CONST_PERSISTENT);
	REGISTER_STRING_CONSTANT("DATE_RFC822",  DATE_FORMAT_RFC822,  CONST_CS | CONST_PERSISTENT);
	REGISTER_STRING_CONSTANT("DATE_RFC850",  DATE_FORMAT_RFC850,  CONST_CS | CONST_PERSISTENT);
	REGISTER_STRING_CONSTANT("DATE_RFC1036", DATE_FORMAT_RFC1036, CONST_CS | CONST_PERSISTENT);
	REGISTER_STRING_CONSTANT("DATE_RFC1123", DATE_FORMAT_RFC1123, CONST_CS | CONST_PERSISTENT);
	REGISTER_STRING_CONSTANT("DATE_RFC2822", DATE_FORMAT_RFC2822, CONST_CS | CONST_PERSISTENT);
 	REGISTER_STRING_CONSTANT("DATE_RFC3339", DATE_FORMAT_RFC3339, CONST_CS | CONST_PERSISTENT);
/*
 * RSS 2.0 Specification: http://blogs.law.harvard.edu/tech/rss
 *   "All date-times in RSS conform to the Date and Time Specification of RFC 822,
 *   with the exception that the year may be expressed with two characters or four characters (four preferred)"
 */
	REGISTER_STRING_CONSTANT("DATE_RSS",     DATE_FORMAT_RFC1123, CONST_CS | CONST_PERSISTENT);
	REGISTER_STRING_CONSTANT("DATE_W3C",     DATE_FORMAT_RFC3339, CONST_CS | CONST_PERSISTENT);

	REGISTER_LONG_CONSTANT("SUNFUNCS_RET_TIMESTAMP", SUNFUNCS_RET_TIMESTAMP, CONST_CS | CONST_PERSISTENT);
	REGISTER_LONG_CONSTANT("SUNFUNCS_RET_STRING", SUNFUNCS_RET_STRING, CONST_CS | CONST_PERSISTENT);
	REGISTER_LONG_CONSTANT("SUNFUNCS_RET_DOUBLE", SUNFUNCS_RET_DOUBLE, CONST_CS | CONST_PERSISTENT);

	php_date_global_timezone_db = NULL;
	php_date_global_timezone_db_enabled = 0;
	DATEG(last_errors) = NULL;
	return SUCCESS;
}
/* }}} */

/* {{{ PHP_MSHUTDOWN_FUNCTION */
PHP_MSHUTDOWN_FUNCTION(date)
{
	UNREGISTER_INI_ENTRIES();

	if (DATEG(last_errors)) {
		timelib_error_container_dtor(DATEG(last_errors));
	}

	return SUCCESS;
}
/* }}} */

/* {{{ PHP_MINFO_FUNCTION */
PHP_MINFO_FUNCTION(date)
{
	const timelib_tzdb *tzdb = DATE_TIMEZONEDB;
	
	php_info_print_table_start();
	php_info_print_table_row(2, "date/time support", "enabled");
	php_info_print_table_row(2, "\"Olson\" Timezone Database Version", tzdb->version);
	php_info_print_table_row(2, "Timezone Database", php_date_global_timezone_db_enabled ? "external" : "internal");
	php_info_print_table_row(2, "Default timezone", guess_timezone(tzdb TSRMLS_CC));
	php_info_print_table_end();

	DISPLAY_INI_ENTRIES();
}
/* }}} */

/* {{{ Timezone Cache functions */
static timelib_tzinfo *php_date_parse_tzfile(char *formal_tzname, const timelib_tzdb *tzdb TSRMLS_DC)
{
	timelib_tzinfo *tzi, **ptzi;

	if(!DATEG(tzcache)) {
		ALLOC_HASHTABLE(DATEG(tzcache));
		zend_hash_init(DATEG(tzcache), 4, NULL, _php_date_tzinfo_dtor, 0);
	}

	if (zend_hash_find(DATEG(tzcache), formal_tzname, strlen(formal_tzname) + 1, (void **) &ptzi) == SUCCESS) {
		return *ptzi;
	}

	tzi = timelib_parse_tzfile(formal_tzname, tzdb);
	if (tzi) {
		zend_hash_add(DATEG(tzcache), formal_tzname, strlen(formal_tzname) + 1, (void *) &tzi, sizeof(timelib_tzinfo*), NULL);
	}
	return tzi;
}
/* }}} */

/* {{{ Helper functions */
static char* guess_timezone(const timelib_tzdb *tzdb TSRMLS_DC)
{
	char *env;

	/* Checking configure timezone */
	if (DATEG(timezone) && (strlen(DATEG(timezone)) > 0)) {
		return DATEG(timezone);
	}
	/* Check environment variable */
	env = getenv("TZ");
	if (env && *env && timelib_timezone_id_is_valid(env, tzdb)) {
		return env;
	}
	/* Check config setting for default timezone */
	if (!DATEG(default_timezone)) {
		/* Special case: ext/date wasn't initialized yet */
		zval ztz;
		
		if (SUCCESS == zend_get_configuration_directive("date.timezone", sizeof("date.timezone"), &ztz) &&
		    Z_TYPE(ztz) == IS_STRING &&
		    Z_STRLEN(ztz) > 0 &&
		    timelib_timezone_id_is_valid(Z_STRVAL(ztz), tzdb)) {
			return Z_STRVAL(ztz);
		}
	} else if (*DATEG(default_timezone) && timelib_timezone_id_is_valid(DATEG(default_timezone), tzdb)) {
		return DATEG(default_timezone);
	}
#if HAVE_TM_ZONE
	/* Try to guess timezone from system information */
	{
		struct tm *ta, tmbuf;
		time_t     the_time;
		char      *tzid = NULL;
		
		the_time = time(NULL);
		ta = php_localtime_r(&the_time, &tmbuf);
		if (ta) {
			tzid = timelib_timezone_id_from_abbr(ta->tm_zone, ta->tm_gmtoff, ta->tm_isdst);
		}
		if (! tzid) {
			tzid = "UTC";
		}
		
		php_error_docref(NULL TSRMLS_CC, E_WARNING, DATE_TZ_ERRMSG "We selected '%s' for '%s/%.1f/%s' instead", tzid, ta ? ta->tm_zone : "Unknown", ta ? (float) (ta->tm_gmtoff / 3600) : 0, ta ? (ta->tm_isdst ? "DST" : "no DST") : "Unknown");
		return tzid;
	}
#endif
#ifdef PHP_WIN32
	{
		char *tzid;
		TIME_ZONE_INFORMATION tzi;

		switch (GetTimeZoneInformation(&tzi))
		{
			/* DST in effect */
			case TIME_ZONE_ID_DAYLIGHT:
				/* If user has disabled DST in the control panel, Windows returns 0 here */
				if (tzi.DaylightBias == 0) {
					goto php_win_std_time;
				}
				
				tzid = timelib_timezone_id_from_abbr("", (tzi.Bias + tzi.DaylightBias) * -60, 1);
				if (! tzid) {
					tzid = "UTC";
				}
				php_error_docref(NULL TSRMLS_CC, E_WARNING, DATE_TZ_ERRMSG "We selected '%s' for '%.1f/DST' instead", tzid, ((tzi.Bias + tzi.DaylightBias) / -60.0));
				break;

			/* no DST or not in effect */
			case TIME_ZONE_ID_UNKNOWN:
			case TIME_ZONE_ID_STANDARD:
			default:
php_win_std_time:
				tzid = timelib_timezone_id_from_abbr("", (tzi.Bias + tzi.StandardBias) * -60, 0);
				if (! tzid) {
					tzid = "UTC";
				}
				php_error_docref(NULL TSRMLS_CC, E_WARNING, DATE_TZ_ERRMSG "We selected '%s' for '%.1f/no DST' instead", tzid, ((tzi.Bias + tzi.StandardBias) / -60.0));
				break;

		}
		return tzid;
	}
#elif defined(NETWARE)
	/* Try to guess timezone from system information */
	{
		char *tzid = timelib_timezone_id_from_abbr("", ((_timezone * -1) + (daylightOffset * daylightOnOff)), daylightOnOff);
		if (tzid) {
			return tzid;
		}
	}
#endif
	/* Fallback to UTC */
	php_error_docref(NULL TSRMLS_CC, E_WARNING, DATE_TZ_ERRMSG "We had to select 'UTC' because your platform doesn't provide functionality for the guessing algorithm");
	return "UTC";
}

PHPAPI timelib_tzinfo *get_timezone_info(TSRMLS_D)
{
	char *tz;
	timelib_tzinfo *tzi;

	tz = guess_timezone(DATE_TIMEZONEDB TSRMLS_CC);
	tzi = php_date_parse_tzfile(tz, DATE_TIMEZONEDB TSRMLS_CC);
	if (! tzi) {
		php_error_docref(NULL TSRMLS_CC, E_ERROR, "Timezone database is corrupt - this should *never* happen!");
	}
	return tzi;
}
/* }}} */


/* {{{ date() and gmdate() data */
#include "ext/standard/php_smart_str.h"

static char *mon_full_names[] = {
	"January", "February", "March", "April",
	"May", "June", "July", "August",
	"September", "October", "November", "December"
};

static char *mon_short_names[] = {
	"Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
};

static char *day_full_names[] = {
	"Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"
};

static char *day_short_names[] = {
	"Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"
};

static char *english_suffix(timelib_sll number)
{
	if (number >= 10 && number <= 19) {
		return "th";
	} else {
		switch (number % 10) {
			case 1: return "st";
			case 2: return "nd";
			case 3: return "rd";
		}
	}
	return "th";
}
/* }}} */

/* {{{ day of week helpers */
char *php_date_full_day_name(timelib_sll y, timelib_sll m, timelib_sll d)
{
	timelib_sll day_of_week = timelib_day_of_week(y, m, d);
	if (day_of_week < 0) {
		return "Unknown";
	} 
	return day_full_names[day_of_week];	
}

char *php_date_short_day_name(timelib_sll y, timelib_sll m, timelib_sll d)
{
	timelib_sll day_of_week = timelib_day_of_week(y, m, d);
	if (day_of_week < 0) {
		return "Unknown";
	} 
	return day_short_names[day_of_week];	
}
/* }}} */

/* {{{ date_format - (gm)date helper */
static char *date_format(char *format, int format_len, timelib_time *t, int localtime)
{
	smart_str            string = {0};
	int                  i, length;
	char                 buffer[97];
	timelib_time_offset *offset = NULL;
	timelib_sll          isoweek, isoyear;
	int                  rfc_colon;

	if (!format_len) {
		return estrdup("");
	}

	if (localtime) {
		if (t->zone_type == TIMELIB_ZONETYPE_ABBR) {
			offset = timelib_time_offset_ctor();
			offset->offset = (t->z - (t->dst * 60)) * -60;
			offset->leap_secs = 0;
			offset->is_dst = t->dst;
			offset->abbr = strdup(t->tz_abbr);
		} else if (t->zone_type == TIMELIB_ZONETYPE_OFFSET) {
			offset = timelib_time_offset_ctor();
			offset->offset = (t->z) * -60;
			offset->leap_secs = 0;
			offset->is_dst = 0;
			offset->abbr = malloc(9); /* GMTxxxx\0 */
			snprintf(offset->abbr, 9, "GMT%c%02d%02d", 
			                          localtime ? ((offset->offset < 0) ? '-' : '+') : '+',
			                          localtime ? abs(offset->offset / 3600) : 0,
			                          localtime ? abs((offset->offset % 3600) / 60) : 0 );
		} else {
			offset = timelib_get_time_zone_info(t->sse, t->tz_info);
		}
	}
	timelib_isoweek_from_date(t->y, t->m, t->d, &isoweek, &isoyear);

	for (i = 0; i < format_len; i++) {
		rfc_colon = 0;
		switch (format[i]) {
			/* day */
			case 'd': length = slprintf(buffer, 32, "%02d", (int) t->d); break;
			case 'D': length = slprintf(buffer, 32, "%s", php_date_short_day_name(t->y, t->m, t->d)); break;
			case 'j': length = slprintf(buffer, 32, "%d", (int) t->d); break;
			case 'l': length = slprintf(buffer, 32, "%s", php_date_full_day_name(t->y, t->m, t->d)); break;
			case 'S': length = slprintf(buffer, 32, "%s", english_suffix(t->d)); break;
			case 'w': length = slprintf(buffer, 32, "%d", (int) timelib_day_of_week(t->y, t->m, t->d)); break;
			case 'N': length = slprintf(buffer, 32, "%d", (int) timelib_iso_day_of_week(t->y, t->m, t->d)); break;
			case 'z': length = slprintf(buffer, 32, "%d", (int) timelib_day_of_year(t->y, t->m, t->d)); break;

			/* week */
			case 'W': length = slprintf(buffer, 32, "%02d", (int) isoweek); break; /* iso weeknr */
			case 'o': length = slprintf(buffer, 32, "%d", (int) isoyear); break; /* iso year */

			/* month */
			case 'F': length = slprintf(buffer, 32, "%s", mon_full_names[t->m - 1]); break;
			case 'm': length = slprintf(buffer, 32, "%02d", (int) t->m); break;
			case 'M': length = slprintf(buffer, 32, "%s", mon_short_names[t->m - 1]); break;
			case 'n': length = slprintf(buffer, 32, "%d", (int) t->m); break;
			case 't': length = slprintf(buffer, 32, "%d", (int) timelib_days_in_month(t->y, t->m)); break;

			/* year */
			case 'L': length = slprintf(buffer, 32, "%d", timelib_is_leap((int) t->y)); break;
			case 'y': length = slprintf(buffer, 32, "%02d", (int) t->y % 100); break;
			case 'Y': length = slprintf(buffer, 32, "%s%04lld", t->y < 0 ? "-" : "", php_date_llabs((timelib_sll) t->y)); break;

			/* time */
			case 'a': length = slprintf(buffer, 32, "%s", t->h >= 12 ? "pm" : "am"); break;
			case 'A': length = slprintf(buffer, 32, "%s", t->h >= 12 ? "PM" : "AM"); break;
			case 'B': {
				int retval = (((((long)t->sse)-(((long)t->sse) - ((((long)t->sse) % 86400) + 3600))) * 10) / 864);			
				while (retval < 0) {
					retval += 1000;
				}
				retval = retval % 1000;
				length = slprintf(buffer, 32, "%03d", retval);
				break;
			}
			case 'g': length = slprintf(buffer, 32, "%d", (t->h % 12) ? (int) t->h % 12 : 12); break;
			case 'G': length = slprintf(buffer, 32, "%d", (int) t->h); break;
			case 'h': length = slprintf(buffer, 32, "%02d", (t->h % 12) ? (int) t->h % 12 : 12); break;
			case 'H': length = slprintf(buffer, 32, "%02d", (int) t->h); break;
			case 'i': length = slprintf(buffer, 32, "%02d", (int) t->i); break;
			case 's': length = slprintf(buffer, 32, "%02d", (int) t->s); break;
			case 'u': length = slprintf(buffer, 32, "%06d", (int) floor(t->f * 1000000)); break;

			/* timezone */
			case 'I': length = slprintf(buffer, 32, "%d", localtime ? offset->is_dst : 0); break;
			case 'P': rfc_colon = 1; /* break intentionally missing */
			case 'O': length = slprintf(buffer, 32, "%c%02d%s%02d",
											localtime ? ((offset->offset < 0) ? '-' : '+') : '+',
											localtime ? abs(offset->offset / 3600) : 0,
											rfc_colon ? ":" : "",
											localtime ? abs((offset->offset % 3600) / 60) : 0
							  );
					  break;
			case 'T': length = slprintf(buffer, 32, "%s", localtime ? offset->abbr : "GMT"); break;
			case 'e': if (!localtime) {
					      length = slprintf(buffer, 32, "%s", "UTC");
					  } else {
						  switch (t->zone_type) {
							  case TIMELIB_ZONETYPE_ID:
								  length = slprintf(buffer, 32, "%s", t->tz_info->name);
								  break;
							  case TIMELIB_ZONETYPE_ABBR:
								  length = slprintf(buffer, 32, "%s", offset->abbr);
								  break;
							  case TIMELIB_ZONETYPE_OFFSET:
								  length = slprintf(buffer, 32, "%c%02d:%02d",
												((offset->offset < 0) ? '-' : '+'),
												abs(offset->offset / 3600),
												abs((offset->offset % 3600) / 60)
										   );
								  break;
						  }
					  }
					  break;
			case 'Z': length = slprintf(buffer, 32, "%d", localtime ? offset->offset : 0); break;

			/* full date/time */
			case 'c': length = slprintf(buffer, 96, "%04d-%02d-%02dT%02d:%02d:%02d%c%02d:%02d",
							                (int) t->y, (int) t->m, (int) t->d,
											(int) t->h, (int) t->i, (int) t->s,
											localtime ? ((offset->offset < 0) ? '-' : '+') : '+',
											localtime ? abs(offset->offset / 3600) : 0,
											localtime ? abs((offset->offset % 3600) / 60) : 0
							  );
					  break;
			case 'r': length = slprintf(buffer, 96, "%3s, %02d %3s %04d %02d:%02d:%02d %c%02d%02d",
							                php_date_short_day_name(t->y, t->m, t->d),
											(int) t->d, mon_short_names[t->m - 1],
											(int) t->y, (int) t->h, (int) t->i, (int) t->s,
											localtime ? ((offset->offset < 0) ? '-' : '+') : '+',
											localtime ? abs(offset->offset / 3600) : 0,
											localtime ? abs((offset->offset % 3600) / 60) : 0
							  );
					  break;
			case 'U': length = slprintf(buffer, 32, "%lld", (timelib_sll) t->sse); break;

			case '\\': if (i < format_len) i++; /* break intentionally missing */

			default: buffer[0] = format[i]; buffer[1] = '\0'; length = 1; break;
		}
		smart_str_appendl(&string, buffer, length);
	}

	smart_str_0(&string);

	if (localtime) {
		timelib_time_offset_dtor(offset);
	}

	return string.c;
}

static void php_date(INTERNAL_FUNCTION_PARAMETERS, int localtime)
{
	char   *format;
	int     format_len;
	long    ts;
	char   *string;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &format, &format_len, &ts) == FAILURE) {
		RETURN_FALSE;
	}
	if (ZEND_NUM_ARGS() == 1) {
		ts = time(NULL);
	}

	string = php_format_date(format, format_len, ts, localtime TSRMLS_CC);
	
	RETVAL_STRING(string, 0);
}
/* }}} */

PHPAPI char *php_format_date(char *format, int format_len, time_t ts, int localtime TSRMLS_DC) /* {{{ */
{
	timelib_time   *t;
	timelib_tzinfo *tzi;
	char *string;

	t = timelib_time_ctor();

	if (localtime) {
		tzi = get_timezone_info(TSRMLS_C);
		t->tz_info = tzi;
		t->zone_type = TIMELIB_ZONETYPE_ID;
		timelib_unixtime2local(t, ts);
	} else {
		tzi = NULL;
		timelib_unixtime2gmt(t, ts);
	}

	string = date_format(format, format_len, t, localtime);
	
	timelib_time_dtor(t);
	return string;
}
/* }}} */

/* {{{ php_idate
 */
PHPAPI int php_idate(char format, time_t ts, int localtime TSRMLS_DC)
{
	timelib_time   *t;
	timelib_tzinfo *tzi;
	int retval = -1;
	timelib_time_offset *offset = NULL;
	timelib_sll isoweek, isoyear;

	t = timelib_time_ctor();

	if (!localtime) {
		tzi = get_timezone_info(TSRMLS_C);
		t->tz_info = tzi;
		t->zone_type = TIMELIB_ZONETYPE_ID;
		timelib_unixtime2local(t, ts);
	} else {
		tzi = NULL;
		timelib_unixtime2gmt(t, ts);
	}

	if (!localtime) {
		if (t->zone_type == TIMELIB_ZONETYPE_ABBR) {
			offset = timelib_time_offset_ctor();
			offset->offset = (t->z - (t->dst * 60)) * -60;
			offset->leap_secs = 0;
			offset->is_dst = t->dst;
			offset->abbr = strdup(t->tz_abbr);
		} else if (t->zone_type == TIMELIB_ZONETYPE_OFFSET) {
			offset = timelib_time_offset_ctor();
			offset->offset = (t->z - (t->dst * 60)) * -60;
			offset->leap_secs = 0;
			offset->is_dst = t->dst;
			offset->abbr = malloc(9); /* GMTxxxx\0 */
			snprintf(offset->abbr, 9, "GMT%c%02d%02d", 
			                          !localtime ? ((offset->offset < 0) ? '-' : '+') : '+',
			                          !localtime ? abs(offset->offset / 3600) : 0,
			                          !localtime ? abs((offset->offset % 3600) / 60) : 0 );
		} else {
			offset = timelib_get_time_zone_info(t->sse, t->tz_info);
		}
	}

	timelib_isoweek_from_date(t->y, t->m, t->d, &isoweek, &isoyear);

	switch (format) {
		/* day */
		case 'd': case 'j': retval = (int) t->d; break;

		case 'w': retval = (int) timelib_day_of_week(t->y, t->m, t->d); break;
		case 'z': retval = (int) timelib_day_of_year(t->y, t->m, t->d); break;

		/* week */
		case 'W': retval = (int) isoweek; break; /* iso weeknr */

		/* month */
		case 'm': case 'n': retval = (int) t->m; break;
		case 't': retval = (int) timelib_days_in_month(t->y, t->m); break;

		/* year */
		case 'L': retval = (int) timelib_is_leap((int) t->y); break;
		case 'y': retval = (int) (t->y % 100); break;
		case 'Y': retval = (int) t->y; break;

		/* Swatch Beat a.k.a. Internet Time */
		case 'B':
			retval = (((((long)t->sse)-(((long)t->sse) - ((((long)t->sse) % 86400) + 3600))) * 10) / 864);			
			while (retval < 0) {
				retval += 1000;
			}
			retval = retval % 1000;
			break;

		/* time */
		case 'g': case 'h': retval = (int) ((t->h % 12) ? (int) t->h % 12 : 12); break;
		case 'H': case 'G': retval = (int) t->h; break;
		case 'i': retval = (int) t->i; break;
		case 's': retval = (int) t->s; break;

		/* timezone */
		case 'I': retval = (int) (!localtime ? offset->is_dst : 0); break;
		case 'Z': retval = (int) (!localtime ? offset->offset : 0); break;

		case 'U': retval = (int) t->sse; break;
	}

	if (!localtime) {
		timelib_time_offset_dtor(offset);
	}
	timelib_time_dtor(t);

	return retval;
}
/* }}} */

/* {{{ proto string date(string format [, long timestamp])
   Format a local date/time */
PHP_FUNCTION(date)
{
	php_date(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);
}
/* }}} */

/* {{{ proto string gmdate(string format [, long timestamp])
   Format a GMT date/time */
PHP_FUNCTION(gmdate)
{
	php_date(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);
}
/* }}} */

/* {{{ proto int idate(string format [, int timestamp])
   Format a local time/date as integer */
PHP_FUNCTION(idate)
{
	char   *format;
	int     format_len;
	long    ts = 0;
	int ret; 

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &format, &format_len, &ts) == FAILURE) {
		RETURN_FALSE;
	}

	if (format_len != 1) {
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "idate format is one char");
		RETURN_FALSE;
	}

	if (ZEND_NUM_ARGS() == 1) {
		ts = time(NULL);
	}

	ret = php_idate(format[0], ts, 0 TSRMLS_CC);
	if (ret == -1) {
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Unrecognized date format token.");
		RETURN_FALSE;
	}
	RETURN_LONG(ret);
}
/* }}} */

/* {{{ php_date_set_tzdb - NOT THREADSAFE */
PHPAPI void php_date_set_tzdb(timelib_tzdb *tzdb)
{
	const timelib_tzdb *builtin = timelib_builtin_db();
	
	if (php_version_compare(tzdb->version, builtin->version) > 0) {
		php_date_global_timezone_db = tzdb;
		php_date_global_timezone_db_enabled = 1;
	}
}
/* }}} */

/* {{{ php_parse_date: Backwards compability function */
PHPAPI signed long php_parse_date(char *string, signed long *now)
{
	timelib_time *parsed_time;
	timelib_error_container *error = NULL;
	int           error2;
	signed long   retval;

	parsed_time = timelib_strtotime(string, strlen(string), &error, DATE_TIMEZONEDB);
	if (error->error_count) {
		timelib_error_container_dtor(error);
		return -1;
	}
	timelib_error_container_dtor(error);
	timelib_update_ts(parsed_time, NULL);
	retval = timelib_date_to_int(parsed_time, &error2);
	timelib_time_dtor(parsed_time);
	if (error2) {
		return -1;
	}
	return retval;
}
/* }}} */


/* {{{ proto int strtotime(string time [, int now ])
   Convert string representation of date and time to a timestamp */
PHP_FUNCTION(strtotime)
{
	char *times, *initial_ts;
	int   time_len, error1, error2;
	struct timelib_error_container *error;
	long  preset_ts = 0, ts;

	timelib_time *t, *now;
	timelib_tzinfo *tzi;

	tzi = get_timezone_info(TSRMLS_C);

	if (zend_parse_parameters_ex(ZEND_PARSE_PARAMS_QUIET, ZEND_NUM_ARGS() TSRMLS_CC, "sl", &times, &time_len, &preset_ts) != FAILURE) {
		/* We have an initial timestamp */
		now = timelib_time_ctor();

		initial_ts = emalloc(25);
		snprintf(initial_ts, 24, "@%ld UTC", preset_ts);
		t = timelib_strtotime(initial_ts, strlen(initial_ts), NULL, DATE_TIMEZONEDB); /* we ignore the error here, as this should never fail */
		timelib_update_ts(t, tzi);
		now->tz_info = tzi;
		now->zone_type = TIMELIB_ZONETYPE_ID;
		timelib_unixtime2local(now, t->sse);
		timelib_time_dtor(t);
		efree(initial_ts);
	} else if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &times, &time_len, &preset_ts) != FAILURE) {
		/* We have no initial timestamp */
		now = timelib_time_ctor();
		now->tz_info = tzi;
		now->zone_type = TIMELIB_ZONETYPE_ID;
		timelib_unixtime2local(now, (timelib_sll) time(NULL));
	} else {
		RETURN_FALSE;
	}

	if (!time_len) {
		timelib_time_dtor(now);	
		RETURN_FALSE;
	}

	t = timelib_strtotime(times, time_len, &error, DATE_TIMEZONEDB);
	error1 = error->error_count;
	timelib_error_container_dtor(error);
	timelib_fill_holes(t, now, TIMELIB_NO_CLONE);
	timelib_update_ts(t, tzi);
	ts = timelib_date_to_int(t, &error2);

	timelib_time_dtor(now);
	timelib_time_dtor(t);

	if (error1 || error2) {
		RETURN_FALSE;
	} else {
		RETURN_LONG(ts);
	}
}
/* }}} */


/* {{{ php_mktime - (gm)mktime helper */
PHPAPI void php_mktime(INTERNAL_FUNCTION_PARAMETERS, int gmt)
{
	long hou = 0, min = 0, sec = 0, mon = 0, day = 0, yea = 0, dst = -1;
	timelib_time *now;
	timelib_tzinfo *tzi = NULL;
	long ts, adjust_seconds = 0;
	int error;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|lllllll", &hou, &min, &sec, &mon, &day, &yea, &dst) == FAILURE) {
		RETURN_FALSE;
	}
	/* Initialize structure with current time */
	now = timelib_time_ctor();
	if (gmt) {
		timelib_unixtime2gmt(now, (timelib_sll) time(NULL));
	} else {
		tzi = get_timezone_info(TSRMLS_C);
		now->tz_info = tzi;
		now->zone_type = TIMELIB_ZONETYPE_ID;
		timelib_unixtime2local(now, (timelib_sll) time(NULL));
	}
	/* Fill in the new data */
	switch (ZEND_NUM_ARGS()) {
		case 7:
			/* break intentionally missing */
		case 6:
			if (yea >= 0 && yea < 70) {
				yea += 2000;
			} else if (yea >= 70 && yea <= 100) {
				yea += 1900;
			}
			now->y = yea;
			/* break intentionally missing again */
		case 5:
			now->d = day;
			/* break missing intentionally here too */
		case 4:
			now->m = mon;
			/* and here */
		case 3:
			now->s = sec;
			/* yup, this break isn't here on purpose too */
		case 2:
			now->i = min;
			/* last intentionally missing break */
		case 1:
			now->h = hou;
			break;
		default:
			php_error_docref(NULL TSRMLS_CC, E_STRICT, "You should be using the time() function instead");
	}
	/* Update the timestamp */
	if (gmt) {
		timelib_update_ts(now, NULL);
	} else {
		timelib_update_ts(now, tzi);
	}
	/* Support for the deprecated is_dst parameter */
	if (dst != -1) {
		php_error_docref(NULL TSRMLS_CC, E_DEPRECATED, "The is_dst parameter is deprecated");
		if (gmt) {
			/* GMT never uses DST */
			if (dst == 1) {
				adjust_seconds = -3600;
			}
		} else {
			/* Figure out is_dst for current TS */
			timelib_time_offset *tmp_offset;
			tmp_offset = timelib_get_time_zone_info(now->sse, tzi);
			if (dst == 1 && tmp_offset->is_dst == 0) {
				adjust_seconds = -3600;
			}
			if (dst == 0 && tmp_offset->is_dst == 1) {
				adjust_seconds = +3600;
			}
			timelib_time_offset_dtor(tmp_offset);
		}
	}
	/* Clean up and return */
	ts = timelib_date_to_int(now, &error);
	ts += adjust_seconds;
	timelib_time_dtor(now);

	if (error) {
		RETURN_FALSE;
	} else {
		RETURN_LONG(ts);
	}
}
/* }}} */

/* {{{ proto int mktime([int hour [, int min [, int sec [, int mon [, int day [, int year]]]]]])
   Get UNIX timestamp for a date */
PHP_FUNCTION(mktime)
{
	php_mktime(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);
}
/* }}} */

/* {{{ proto int gmmktime([int hour [, int min [, int sec [, int mon [, int day [, int year]]]]]])
   Get UNIX timestamp for a GMT date */
PHP_FUNCTION(gmmktime)
{
	php_mktime(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);
}
/* }}} */


/* {{{ proto bool checkdate(int month, int day, int year)
   Returns true(1) if it is a valid date in gregorian calendar */
PHP_FUNCTION(checkdate)
{
	long m, d, y;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "lll", &m, &d, &y) == FAILURE) {
		RETURN_FALSE;
	}

	if (y < 1 || y > 32767 || !timelib_valid_date(y, m, d)) {
		RETURN_FALSE;
	}
	RETURN_TRUE;	/* True : This month, day, year arguments are valid */
}
/* }}} */

#ifdef HAVE_STRFTIME
/* {{{ php_strftime - (gm)strftime helper */
PHPAPI void php_strftime(INTERNAL_FUNCTION_PARAMETERS, int gmt)
{
	char                *format, *buf;
	int                  format_len;
	long                 timestamp = 0;
	struct tm            ta;
	int                  max_reallocs = 5;
	size_t               buf_len = 64, real_len;
	timelib_time        *ts;
	timelib_tzinfo      *tzi;
	timelib_time_offset *offset = NULL;

	timestamp = (long) time(NULL);

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &format, &format_len, &timestamp) == FAILURE) {
		RETURN_FALSE;
	}

	if (format_len == 0) {
		RETURN_FALSE;
	}

	ts = timelib_time_ctor();
	if (gmt) {
		tzi = NULL;
		timelib_unixtime2gmt(ts, (timelib_sll) timestamp);
	} else {
		tzi = get_timezone_info(TSRMLS_C);
		ts->tz_info = tzi;
		ts->zone_type = TIMELIB_ZONETYPE_ID;
		timelib_unixtime2local(ts, (timelib_sll) timestamp);
	}
	ta.tm_sec   = ts->s;
	ta.tm_min   = ts->i;
	ta.tm_hour  = ts->h;
	ta.tm_mday  = ts->d;
	ta.tm_mon   = ts->m - 1;
	ta.tm_year  = ts->y - 1900;
	ta.tm_wday  = timelib_day_of_week(ts->y, ts->m, ts->d);
	ta.tm_yday  = timelib_day_of_year(ts->y, ts->m, ts->d);
	if (gmt) {
		ta.tm_isdst = 0;
#if HAVE_TM_GMTOFF
		ta.tm_gmtoff = 0;
#endif
#if HAVE_TM_ZONE
		ta.tm_zone = "GMT";
#endif
	} else {
		offset = timelib_get_time_zone_info(timestamp, tzi);

		ta.tm_isdst = offset->is_dst;
#if HAVE_TM_GMTOFF
		ta.tm_gmtoff = offset->offset;
#endif
#if HAVE_TM_ZONE
		ta.tm_zone = offset->abbr;
#endif
	}

	buf = (char *) emalloc(buf_len);
	while ((real_len=strftime(buf, buf_len, format, &ta))==buf_len || real_len==0) {
		buf_len *= 2;
		buf = (char *) erealloc(buf, buf_len);
		if (!--max_reallocs) {
			break;
		}
	}

	timelib_time_dtor(ts);
	if (!gmt) {
		timelib_time_offset_dtor(offset);
	}

	if (real_len && real_len != buf_len) {
		buf = (char *) erealloc(buf, real_len + 1);
		RETURN_STRINGL(buf, real_len, 0);
	}
	efree(buf);
	RETURN_FALSE;
}
/* }}} */

/* {{{ proto string strftime(string format [, int timestamp])
   Format a local time/date according to locale settings */
PHP_FUNCTION(strftime)
{
	php_strftime(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);
}
/* }}} */

/* {{{ proto string gmstrftime(string format [, int timestamp])
   Format a GMT/UCT time/date according to locale settings */
PHP_FUNCTION(gmstrftime)
{
	php_strftime(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);
}
/* }}} */
#endif

/* {{{ proto int time(void)
   Return current UNIX timestamp */
PHP_FUNCTION(time)
{
	RETURN_LONG((long)time(NULL));
}
/* }}} */

/* {{{ proto array localtime([int timestamp [, bool associative_array]])
   Returns the results of the C system call localtime as an associative array if the associative_array argument is set to 1 other wise it is a regular array */
PHP_FUNCTION(localtime)
{
	long timestamp = (long)time(NULL);
	zend_bool associative = 0;
	timelib_tzinfo *tzi;
	timelib_time   *ts;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|lb", &timestamp, &associative) == FAILURE) {
		RETURN_FALSE;
	}

	tzi = get_timezone_info(TSRMLS_C);
	ts = timelib_time_ctor();
	ts->tz_info = tzi;
	ts->zone_type = TIMELIB_ZONETYPE_ID;
	timelib_unixtime2local(ts, (timelib_sll) timestamp);

	array_init(return_value);

	if (associative) {
		add_assoc_long(return_value, "tm_sec",   ts->s);
		add_assoc_long(return_value, "tm_min",   ts->i);
		add_assoc_long(return_value, "tm_hour",  ts->h);
		add_assoc_long(return_value, "tm_mday",  ts->d);
		add_assoc_long(return_value, "tm_mon",   ts->m - 1);
		add_assoc_long(return_value, "tm_year",  ts->y - 1900);
		add_assoc_long(return_value, "tm_wday",  timelib_day_of_week(ts->y, ts->m, ts->d));
		add_assoc_long(return_value, "tm_yday",  timelib_day_of_year(ts->y, ts->m, ts->d));
		add_assoc_long(return_value, "tm_isdst", ts->dst);
	} else {
		add_next_index_long(return_value, ts->s);
		add_next_index_long(return_value, ts->i);
		add_next_index_long(return_value, ts->h);
		add_next_index_long(return_value, ts->d);
		add_next_index_long(return_value, ts->m - 1);
		add_next_index_long(return_value, ts->y- 1900);
		add_next_index_long(return_value, timelib_day_of_week(ts->y, ts->m, ts->d));
		add_next_index_long(return_value, timelib_day_of_year(ts->y, ts->m, ts->d));
		add_next_index_long(return_value, ts->dst);
	}

	timelib_time_dtor(ts);
}
/* }}} */

/* {{{ proto array getdate([int timestamp])
   Get date/time information */
PHP_FUNCTION(getdate)
{
	long timestamp = (long)time(NULL);
	timelib_tzinfo *tzi;
	timelib_time   *ts;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|l", &timestamp) == FAILURE) {
		RETURN_FALSE;
	}

	tzi = get_timezone_info(TSRMLS_C);
	ts = timelib_time_ctor();
	ts->tz_info = tzi;
	ts->zone_type = TIMELIB_ZONETYPE_ID;
	timelib_unixtime2local(ts, (timelib_sll) timestamp);

	array_init(return_value);

	add_assoc_long(return_value, "seconds", ts->s);
	add_assoc_long(return_value, "minutes", ts->i);
	add_assoc_long(return_value, "hours", ts->h);
	add_assoc_long(return_value, "mday", ts->d);
	add_assoc_long(return_value, "wday", timelib_day_of_week(ts->y, ts->m, ts->d));
	add_assoc_long(return_value, "mon", ts->m);
	add_assoc_long(return_value, "year", ts->y);
	add_assoc_long(return_value, "yday", timelib_day_of_year(ts->y, ts->m, ts->d));
	add_assoc_string(return_value, "weekday", php_date_full_day_name(ts->y, ts->m, ts->d), 1);
	add_assoc_string(return_value, "month", mon_full_names[ts->m - 1], 1);
	add_index_long(return_value, 0, timestamp);

	timelib_time_dtor(ts);
}
/* }}} */

#define PHP_DATE_TIMEZONE_GROUP_AFRICA     0x0001
#define PHP_DATE_TIMEZONE_GROUP_AMERICA    0x0002
#define PHP_DATE_TIMEZONE_GROUP_ANTARCTICA 0x0004
#define PHP_DATE_TIMEZONE_GROUP_ARCTIC     0x0008
#define PHP_DATE_TIMEZONE_GROUP_ASIA       0x0010
#define PHP_DATE_TIMEZONE_GROUP_ATLANTIC   0x0020
#define PHP_DATE_TIMEZONE_GROUP_AUSTRALIA  0x0040
#define PHP_DATE_TIMEZONE_GROUP_EUROPE     0x0080
#define PHP_DATE_TIMEZONE_GROUP_INDIAN     0x0100
#define PHP_DATE_TIMEZONE_GROUP_PACIFIC    0x0200
#define PHP_DATE_TIMEZONE_GROUP_UTC        0x0400
#define PHP_DATE_TIMEZONE_GROUP_ALL        0x07FF
#define PHP_DATE_TIMEZONE_GROUP_ALL_W_BC   0x0FFF
#define PHP_DATE_TIMEZONE_PER_COUNTRY      0x1000

#define PHP_DATE_PERIOD_EXCLUDE_START_DATE 0x0001


/* define an overloaded iterator structure */
typedef struct {
	zend_object_iterator  intern;
	zval                 *date_period_zval;
	zval                 *current;
	php_period_obj       *object;
	int                   current_index;
} date_period_it;

/* {{{ date_period_it_invalidate_current */
static void date_period_it_invalidate_current(zend_object_iterator *iter TSRMLS_DC)
{
	date_period_it *iterator = (date_period_it *)iter;

	if (iterator->current) {
		zval_ptr_dtor(&iterator->current);
		iterator->current = NULL;
	}
}
/* }}} */


/* {{{ date_period_it_dtor */
static void date_period_it_dtor(zend_object_iterator *iter TSRMLS_DC)
{
	date_period_it *iterator = (date_period_it *)iter;

	date_period_it_invalidate_current(iter TSRMLS_CC);

	zval_ptr_dtor(&iterator->date_period_zval);

	efree(iterator);
}
/* }}} */


/* {{{ date_period_it_has_more */
static int date_period_it_has_more(zend_object_iterator *iter TSRMLS_DC)
{
	date_period_it *iterator = (date_period_it *)iter;
	php_period_obj *object   = iterator->object;
	timelib_time   *it_time = object->current;

	/* apply modification if it's not the first iteration */
	if (!object->include_start_date || iterator->current_index > 0) {
		it_time->have_relative = 1;
		it_time->relative = *object->interval;
		it_time->sse_uptodate = 0;
		timelib_update_ts(it_time, NULL);
		timelib_update_from_sse(it_time);
	}

	if (object->end) {
		return object->current->sse < object->end->sse ? SUCCESS : FAILURE;
	} else {
		return (iterator->current_index < object->recurrences) ? SUCCESS : FAILURE;
	}
}
/* }}} */


/* {{{ date_period_it_current_data */
static void date_period_it_current_data(zend_object_iterator *iter, zval ***data TSRMLS_DC)
{
	date_period_it *iterator = (date_period_it *)iter;
	php_period_obj *object   = iterator->object;
	timelib_time   *it_time = object->current;
	php_date_obj   *newdateobj;

	/* Create new object */
	MAKE_STD_ZVAL(iterator->current);
	php_date_instantiate(date_ce_date, iterator->current TSRMLS_CC);
	newdateobj = (php_date_obj *) zend_object_store_get_object(iterator->current TSRMLS_CC);
	newdateobj->time = timelib_time_ctor();
	*newdateobj->time = *it_time;
	if (it_time->tz_abbr) {
		newdateobj->time->tz_abbr = strdup(it_time->tz_abbr);
	}
	if (it_time->tz_info) {
		newdateobj->time->tz_info = it_time->tz_info;
	}
	
	*data = &iterator->current;
}
/* }}} */


/* {{{ date_period_it_current_key */
static int date_period_it_current_key(zend_object_iterator *iter, char **str_key, uint *str_key_len, ulong *int_key TSRMLS_DC)
{
	date_period_it   *iterator = (date_period_it *)iter;
	*int_key = iterator->current_index;
	return HASH_KEY_IS_LONG;
}
/* }}} */


/* {{{ date_period_it_move_forward */
static void date_period_it_move_forward(zend_object_iterator *iter TSRMLS_DC)
{
	date_period_it   *iterator = (date_period_it *)iter;

	iterator->current_index++;
	date_period_it_invalidate_current(iter TSRMLS_CC);
}
/* }}} */


/* {{{ date_period_it_rewind */
static void date_period_it_rewind(zend_object_iterator *iter TSRMLS_DC)
{
	date_period_it   *iterator = (date_period_it *)iter;

	iterator->current_index = 0;
	if (iterator->object->current) {
		timelib_time_dtor(iterator->object->current);
	}
	iterator->object->current = timelib_time_clone(iterator->object->start);
	date_period_it_invalidate_current(iter TSRMLS_CC);
}
/* }}} */


/* iterator handler table */
zend_object_iterator_funcs date_period_it_funcs = {
	date_period_it_dtor,
	date_period_it_has_more,
	date_period_it_current_data,
	date_period_it_current_key,
	date_period_it_move_forward,
	date_period_it_rewind,
	date_period_it_invalidate_current
};



zend_object_iterator *date_object_period_get_iterator(zend_class_entry *ce, zval *object, int by_ref TSRMLS_DC)
{
	date_period_it  *iterator = emalloc(sizeof(date_period_it));
	php_period_obj  *dpobj    = (php_period_obj *)zend_object_store_get_object(object TSRMLS_CC);

	if (by_ref) {
		zend_error(E_ERROR, "An iterator cannot be used with foreach by reference");
	}

	Z_ADDREF_P(object);
	iterator->intern.data = (void*) dpobj;
	iterator->intern.funcs = &date_period_it_funcs;
	iterator->date_period_zval = object;
	iterator->object = dpobj;
	iterator->current = NULL;

	return (zend_object_iterator*)iterator;
}

static void date_register_classes(TSRMLS_D)
{
	zend_class_entry ce_date, ce_timezone, ce_interval, ce_period;

	INIT_CLASS_ENTRY(ce_date, "DateTime", date_funcs_date);
	ce_date.create_object = date_object_new_date;
	date_ce_date = zend_register_internal_class_ex(&ce_date, NULL, NULL TSRMLS_CC);
	memcpy(&date_object_handlers_date, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	date_object_handlers_date.clone_obj = date_object_clone_date;
	date_object_handlers_date.compare_objects = date_object_compare_date;
	date_object_handlers_date.get_properties = date_object_get_properties;

#define REGISTER_DATE_CLASS_CONST_STRING(const_name, value) \
	zend_declare_class_constant_stringl(date_ce_date, const_name, sizeof(const_name)-1, value, sizeof(value)-1 TSRMLS_CC);

	REGISTER_DATE_CLASS_CONST_STRING("ATOM",    DATE_FORMAT_RFC3339);
	REGISTER_DATE_CLASS_CONST_STRING("COOKIE",  DATE_FORMAT_RFC850);
	REGISTER_DATE_CLASS_CONST_STRING("ISO8601", DATE_FORMAT_ISO8601);
	REGISTER_DATE_CLASS_CONST_STRING("RFC822",  DATE_FORMAT_RFC822);
	REGISTER_DATE_CLASS_CONST_STRING("RFC850",  DATE_FORMAT_RFC850);
	REGISTER_DATE_CLASS_CONST_STRING("RFC1036", DATE_FORMAT_RFC1036);
	REGISTER_DATE_CLASS_CONST_STRING("RFC1123", DATE_FORMAT_RFC1123);
	REGISTER_DATE_CLASS_CONST_STRING("RFC2822", DATE_FORMAT_RFC2822);
	REGISTER_DATE_CLASS_CONST_STRING("RFC3339", DATE_FORMAT_RFC3339);
	REGISTER_DATE_CLASS_CONST_STRING("RSS",     DATE_FORMAT_RFC1123);
	REGISTER_DATE_CLASS_CONST_STRING("W3C",     DATE_FORMAT_RFC3339);


	INIT_CLASS_ENTRY(ce_timezone, "DateTimeZone", date_funcs_timezone);
	ce_timezone.create_object = date_object_new_timezone;
	date_ce_timezone = zend_register_internal_class_ex(&ce_timezone, NULL, NULL TSRMLS_CC);
	memcpy(&date_object_handlers_timezone, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	date_object_handlers_timezone.clone_obj = date_object_clone_timezone;

#define REGISTER_TIMEZONE_CLASS_CONST_STRING(const_name, value) \
	zend_declare_class_constant_long(date_ce_timezone, const_name, sizeof(const_name)-1, value TSRMLS_CC);

	REGISTER_TIMEZONE_CLASS_CONST_STRING("AFRICA",      PHP_DATE_TIMEZONE_GROUP_AFRICA);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("AMERICA",     PHP_DATE_TIMEZONE_GROUP_AMERICA);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("ANTARCTICA",  PHP_DATE_TIMEZONE_GROUP_ANTARCTICA);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("ARCTIC",      PHP_DATE_TIMEZONE_GROUP_ARCTIC);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("ASIA",        PHP_DATE_TIMEZONE_GROUP_ASIA);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("ATLANTIC",    PHP_DATE_TIMEZONE_GROUP_ATLANTIC);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("AUSTRALIA",   PHP_DATE_TIMEZONE_GROUP_AUSTRALIA);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("EUROPE",      PHP_DATE_TIMEZONE_GROUP_EUROPE);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("INDIAN",      PHP_DATE_TIMEZONE_GROUP_INDIAN);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("PACIFIC",     PHP_DATE_TIMEZONE_GROUP_PACIFIC);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("UTC",         PHP_DATE_TIMEZONE_GROUP_UTC);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("ALL",         PHP_DATE_TIMEZONE_GROUP_ALL);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("ALL_WITH_BC", PHP_DATE_TIMEZONE_GROUP_ALL_W_BC);
	REGISTER_TIMEZONE_CLASS_CONST_STRING("PER_COUNTRY", PHP_DATE_TIMEZONE_PER_COUNTRY);

	INIT_CLASS_ENTRY(ce_interval, "DateInterval", date_funcs_interval);
	ce_interval.create_object = date_object_new_interval;
	date_ce_interval = zend_register_internal_class_ex(&ce_interval, NULL, NULL TSRMLS_CC);
	memcpy(&date_object_handlers_interval, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	date_object_handlers_interval.clone_obj = date_object_clone_interval;
	date_object_handlers_interval.read_property = date_interval_read_property;
	date_object_handlers_interval.write_property = date_interval_write_property;
	date_object_handlers_interval.get_properties = date_object_get_properties_interval;
	date_object_handlers_interval.get_property_ptr_ptr = NULL;

	INIT_CLASS_ENTRY(ce_period, "DatePeriod", date_funcs_period);
	ce_period.create_object = date_object_new_period;
	date_ce_period = zend_register_internal_class_ex(&ce_period, NULL, NULL TSRMLS_CC);
	date_ce_period->get_iterator = date_object_period_get_iterator;
	date_ce_period->iterator_funcs.funcs = &date_period_it_funcs;
	zend_class_implements(date_ce_period TSRMLS_CC, 1, zend_ce_traversable);
	memcpy(&date_object_handlers_period, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	date_object_handlers_period.clone_obj = date_object_clone_period;

#define REGISTER_PERIOD_CLASS_CONST_STRING(const_name, value) \
	zend_declare_class_constant_long(date_ce_period, const_name, sizeof(const_name)-1, value TSRMLS_CC);

	REGISTER_PERIOD_CLASS_CONST_STRING("EXCLUDE_START_DATE", PHP_DATE_PERIOD_EXCLUDE_START_DATE);
}

static inline zend_object_value date_object_new_date_ex(zend_class_entry *class_type, php_date_obj **ptr TSRMLS_DC)
{
	php_date_obj *intern;
	zend_object_value retval;

	intern = emalloc(sizeof(php_date_obj));
	memset(intern, 0, sizeof(php_date_obj));
	if (ptr) {
		*ptr = intern;
	}
	
	zend_object_std_init(&intern->std, class_type TSRMLS_CC);
	object_properties_init(&intern->std, class_type);
	
	retval.handle = zend_objects_store_put(intern, (zend_objects_store_dtor_t)zend_objects_destroy_object, (zend_objects_free_object_storage_t) date_object_free_storage_date, NULL TSRMLS_CC);
	retval.handlers = &date_object_handlers_date;
	
	return retval;
}

static zend_object_value date_object_new_date(zend_class_entry *class_type TSRMLS_DC)
{
	return date_object_new_date_ex(class_type, NULL TSRMLS_CC);
}

static zend_object_value date_object_clone_date(zval *this_ptr TSRMLS_DC)
{
	php_date_obj *new_obj = NULL;
	php_date_obj *old_obj = (php_date_obj *) zend_object_store_get_object(this_ptr TSRMLS_CC);
	zend_object_value new_ov = date_object_new_date_ex(old_obj->std.ce, &new_obj TSRMLS_CC);
	
	zend_objects_clone_members(&new_obj->std, new_ov, &old_obj->std, Z_OBJ_HANDLE_P(this_ptr) TSRMLS_CC);
	
	/* this should probably moved to a new `timelib_time *timelime_time_clone(timelib_time *)` */
	new_obj->time = timelib_time_ctor();
	*new_obj->time = *old_obj->time;
	if (old_obj->time->tz_abbr) {
		new_obj->time->tz_abbr = strdup(old_obj->time->tz_abbr);
	}
	if (old_obj->time->tz_info) {
		new_obj->time->tz_info = old_obj->time->tz_info;
	}
	
	return new_ov;
}

static int date_object_compare_date(zval *d1, zval *d2 TSRMLS_DC)
{
	if (Z_TYPE_P(d1) == IS_OBJECT && Z_TYPE_P(d2) == IS_OBJECT &&
		instanceof_function(Z_OBJCE_P(d1), date_ce_date TSRMLS_CC) &&
		instanceof_function(Z_OBJCE_P(d2), date_ce_date TSRMLS_CC)) {
		php_date_obj *o1 = zend_object_store_get_object(d1 TSRMLS_CC);
		php_date_obj *o2 = zend_object_store_get_object(d2 TSRMLS_CC);
		
		if (!o1->time->sse_uptodate) {
			timelib_update_ts(o1->time, o1->time->tz_info);
		}
		if (!o2->time->sse_uptodate) {
			timelib_update_ts(o2->time, o2->time->tz_info);
		}
		
		return (o1->time->sse == o2->time->sse) ? 0 : ((o1->time->sse < o2->time->sse) ? -1 : 1);
	}
	
	return 1;
}

static HashTable *date_object_get_properties(zval *object TSRMLS_DC)
{
	HashTable *props;
	zval *zv;
	php_date_obj     *dateobj;


	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);

	props = zend_std_get_properties(object TSRMLS_CC);

	if (!dateobj->time || GC_G(gc_active)) {
		return props;
	}

	/* first we add the date and time in ISO format */
	MAKE_STD_ZVAL(zv);
	ZVAL_STRING(zv, date_format("Y-m-d H:i:s", 12, dateobj->time, 1), 0);
	zend_hash_update(props, "date", 5, &zv, sizeof(zval), NULL);

	/* then we add the timezone name (or similar) */
	if (dateobj->time->is_localtime) {
		MAKE_STD_ZVAL(zv);
		ZVAL_LONG(zv, dateobj->time->zone_type);
		zend_hash_update(props, "timezone_type", 14, &zv, sizeof(zval), NULL);

		MAKE_STD_ZVAL(zv);
		switch (dateobj->time->zone_type) {
			case TIMELIB_ZONETYPE_ID:
				ZVAL_STRING(zv, dateobj->time->tz_info->name, 1);
				break;
			case TIMELIB_ZONETYPE_OFFSET: {
				char *tmpstr = emalloc(sizeof("UTC+05:00"));
				timelib_sll utc_offset = dateobj->time->z;

				snprintf(tmpstr, sizeof("+05:00"), "%c%02d:%02d",
					utc_offset > 0 ? '-' : '+',
					abs(utc_offset / 60),
					abs((utc_offset % 60)));

				ZVAL_STRING(zv, tmpstr, 0);
				}
				break;
			case TIMELIB_ZONETYPE_ABBR:
				ZVAL_STRING(zv, dateobj->time->tz_abbr, 1);
				break;
		}
		zend_hash_update(props, "timezone", 9, &zv, sizeof(zval), NULL);
	}

	return props;
}

static inline zend_object_value date_object_new_timezone_ex(zend_class_entry *class_type, php_timezone_obj **ptr TSRMLS_DC)
{
	php_timezone_obj *intern;
	zend_object_value retval;

	intern = emalloc(sizeof(php_timezone_obj));
	memset(intern, 0, sizeof(php_timezone_obj));
	if (ptr) {
		*ptr = intern;
	}

	zend_object_std_init(&intern->std, class_type TSRMLS_CC);
	object_properties_init(&intern->std, class_type);
	
	retval.handle = zend_objects_store_put(intern, (zend_objects_store_dtor_t)zend_objects_destroy_object, (zend_objects_free_object_storage_t) date_object_free_storage_timezone, NULL TSRMLS_CC);
	retval.handlers = &date_object_handlers_timezone;
	
	return retval;
}

static zend_object_value date_object_new_timezone(zend_class_entry *class_type TSRMLS_DC)
{
	return date_object_new_timezone_ex(class_type, NULL TSRMLS_CC);
}

static zend_object_value date_object_clone_timezone(zval *this_ptr TSRMLS_DC)
{
	php_timezone_obj *new_obj = NULL;
	php_timezone_obj *old_obj = (php_timezone_obj *) zend_object_store_get_object(this_ptr TSRMLS_CC);
	zend_object_value new_ov = date_object_new_timezone_ex(old_obj->std.ce, &new_obj TSRMLS_CC);
	
	zend_objects_clone_members(&new_obj->std, new_ov, &old_obj->std, Z_OBJ_HANDLE_P(this_ptr) TSRMLS_CC);
	new_obj->type = old_obj->type;
	new_obj->initialized = 1;
	switch (new_obj->type) {
		case TIMELIB_ZONETYPE_ID:
			new_obj->tzi.tz = old_obj->tzi.tz;
			break;
		case TIMELIB_ZONETYPE_OFFSET:
			new_obj->tzi.utc_offset = old_obj->tzi.utc_offset;
			break;
		case TIMELIB_ZONETYPE_ABBR:
			new_obj->tzi.z.utc_offset = old_obj->tzi.z.utc_offset;
			new_obj->tzi.z.dst        = old_obj->tzi.z.dst;
			new_obj->tzi.z.abbr       = old_obj->tzi.z.abbr;
			break;
	}
	
	return new_ov;
}

static inline zend_object_value date_object_new_interval_ex(zend_class_entry *class_type, php_interval_obj **ptr TSRMLS_DC)
{
	php_interval_obj *intern;
	zend_object_value retval;

	intern = emalloc(sizeof(php_interval_obj));
	memset(intern, 0, sizeof(php_interval_obj));
	if (ptr) {
		*ptr = intern;
	}

	zend_object_std_init(&intern->std, class_type TSRMLS_CC);
	object_properties_init(&intern->std, class_type);
	
	retval.handle = zend_objects_store_put(intern, (zend_objects_store_dtor_t)zend_objects_destroy_object, (zend_objects_free_object_storage_t) date_object_free_storage_interval, NULL TSRMLS_CC);
	retval.handlers = &date_object_handlers_interval;
	
	return retval;
}

static zend_object_value date_object_new_interval(zend_class_entry *class_type TSRMLS_DC)
{
	return date_object_new_interval_ex(class_type, NULL TSRMLS_CC);
}

static zend_object_value date_object_clone_interval(zval *this_ptr TSRMLS_DC)
{
	php_interval_obj *new_obj = NULL;
	php_interval_obj *old_obj = (php_interval_obj *) zend_object_store_get_object(this_ptr TSRMLS_CC);
	zend_object_value new_ov = date_object_new_interval_ex(old_obj->std.ce, &new_obj TSRMLS_CC);
	
	zend_objects_clone_members(&new_obj->std, new_ov, &old_obj->std, Z_OBJ_HANDLE_P(this_ptr) TSRMLS_CC);

	/** FIX ME ADD CLONE STUFF **/
	return new_ov;
}

static HashTable *date_object_get_properties_interval(zval *object TSRMLS_DC)
{
	HashTable *props;
	zval *zv;
	php_interval_obj     *intervalobj;


	intervalobj = (php_interval_obj *) zend_object_store_get_object(object TSRMLS_CC);

	props = zend_std_get_properties(object TSRMLS_CC);

	if (!intervalobj->initialized || GC_G(gc_active)) {
		return props;
	}

#define PHP_DATE_INTERVAL_ADD_PROPERTY(n,f) \
	MAKE_STD_ZVAL(zv); \
	ZVAL_LONG(zv, intervalobj->diff->f); \
	zend_hash_update(props, n, strlen(n) + 1, &zv, sizeof(zval), NULL);

	PHP_DATE_INTERVAL_ADD_PROPERTY("y", y);
	PHP_DATE_INTERVAL_ADD_PROPERTY("m", m);
	PHP_DATE_INTERVAL_ADD_PROPERTY("d", d);
	PHP_DATE_INTERVAL_ADD_PROPERTY("h", h);
	PHP_DATE_INTERVAL_ADD_PROPERTY("i", i);
	PHP_DATE_INTERVAL_ADD_PROPERTY("s", s);
	PHP_DATE_INTERVAL_ADD_PROPERTY("invert", invert);
	if (intervalobj->diff->days != -99999) {
		PHP_DATE_INTERVAL_ADD_PROPERTY("days", days);
	} else {
		MAKE_STD_ZVAL(zv);
		ZVAL_FALSE(zv);
		zend_hash_update(props, "days", 5, &zv, sizeof(zval), NULL);
	}

	return props;
}

static inline zend_object_value date_object_new_period_ex(zend_class_entry *class_type, php_period_obj **ptr TSRMLS_DC)
{
	php_period_obj *intern;
	zend_object_value retval;

	intern = emalloc(sizeof(php_period_obj));
	memset(intern, 0, sizeof(php_period_obj));
	if (ptr) {
		*ptr = intern;
	}

	zend_object_std_init(&intern->std, class_type TSRMLS_CC);
	object_properties_init(&intern->std, class_type);
	
	retval.handle = zend_objects_store_put(intern, (zend_objects_store_dtor_t)zend_objects_destroy_object, (zend_objects_free_object_storage_t) date_object_free_storage_period, NULL TSRMLS_CC);
	retval.handlers = &date_object_handlers_period;
	
	return retval;
}

static zend_object_value date_object_new_period(zend_class_entry *class_type TSRMLS_DC)
{
	return date_object_new_period_ex(class_type, NULL TSRMLS_CC);
}

static zend_object_value date_object_clone_period(zval *this_ptr TSRMLS_DC)
{
	php_period_obj *new_obj = NULL;
	php_period_obj *old_obj = (php_period_obj *) zend_object_store_get_object(this_ptr TSRMLS_CC);
	zend_object_value new_ov = date_object_new_period_ex(old_obj->std.ce, &new_obj TSRMLS_CC);
	
	zend_objects_clone_members(&new_obj->std, new_ov, &old_obj->std, Z_OBJ_HANDLE_P(this_ptr) TSRMLS_CC);

	/** FIX ME ADD CLONE STUFF **/
	return new_ov;
}

static void date_object_free_storage_date(void *object TSRMLS_DC)
{
	php_date_obj *intern = (php_date_obj *)object;

	if (intern->time) {
		timelib_time_dtor(intern->time);
	}

	zend_object_std_dtor(&intern->std TSRMLS_CC);
	efree(object);
}

static void date_object_free_storage_timezone(void *object TSRMLS_DC)
{
	php_timezone_obj *intern = (php_timezone_obj *)object;

	if (intern->type == TIMELIB_ZONETYPE_ABBR) {
		free(intern->tzi.z.abbr);
	}
	zend_object_std_dtor(&intern->std TSRMLS_CC);
	efree(object);
}

static void date_object_free_storage_interval(void *object TSRMLS_DC)
{
	php_interval_obj *intern = (php_interval_obj *)object;

	timelib_rel_time_dtor(intern->diff);
	zend_object_std_dtor(&intern->std TSRMLS_CC);
	efree(object);
}

static void date_object_free_storage_period(void *object TSRMLS_DC)
{
	php_period_obj *intern = (php_period_obj *)object;

	if (intern->start) {
		timelib_time_dtor(intern->start);
	}

	if (intern->current) {
		timelib_time_dtor(intern->current);
	}

	if (intern->end) {
		timelib_time_dtor(intern->end);
	}

	timelib_rel_time_dtor(intern->interval);
	zend_object_std_dtor(&intern->std TSRMLS_CC);
	efree(object);
}

/* Advanced Interface */
PHPAPI zval *php_date_instantiate(zend_class_entry *pce, zval *object TSRMLS_DC)
{
	Z_TYPE_P(object) = IS_OBJECT;
	object_init_ex(object, pce);
	Z_SET_REFCOUNT_P(object, 1);
	Z_UNSET_ISREF_P(object);
	return object;
}

/* Helper function used to store the latest found warnings and errors while
 * parsing, from either strtotime or parse_from_format. */
static void update_errors_warnings(timelib_error_container *last_errors TSRMLS_DC)
{
	if (DATEG(last_errors)) {
		timelib_error_container_dtor(DATEG(last_errors));
		DATEG(last_errors) = NULL;
	}
	DATEG(last_errors) = last_errors;
}

PHPAPI int php_date_initialize(php_date_obj *dateobj, /*const*/ char *time_str, int time_str_len, char *format, zval *timezone_object, int ctor TSRMLS_DC)
{
	timelib_time   *now;
	timelib_tzinfo *tzi;
	timelib_error_container *err = NULL;
	int type = TIMELIB_ZONETYPE_ID, new_dst;
	char *new_abbr;
	timelib_sll     new_offset;
	
	if (dateobj->time) {
		timelib_time_dtor(dateobj->time);
	}
	if (format) {
		dateobj->time = timelib_parse_from_format(format, time_str_len ? time_str : "", time_str_len ? time_str_len : 0, &err, DATE_TIMEZONEDB);
	} else {
		dateobj->time = timelib_strtotime(time_str_len ? time_str : "now", time_str_len ? time_str_len : sizeof("now") -1, &err, DATE_TIMEZONEDB);
	}

	/* update last errors and warnings */
	update_errors_warnings(err TSRMLS_CC);


	if (ctor && err && err->error_count) {
		/* spit out the first library error message, at least */
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Failed to parse time string (%s) at position %d (%c): %s", time_str,
			err->error_messages[0].position, err->error_messages[0].character, err->error_messages[0].message);
	}
	if (err && err->error_count) {
		return 0;
	}

	if (timezone_object) {
		php_timezone_obj *tzobj;

		tzobj = (php_timezone_obj *) zend_object_store_get_object(timezone_object TSRMLS_CC);
		switch (tzobj->type) {
			case TIMELIB_ZONETYPE_ID:
				tzi = tzobj->tzi.tz;
				break;
			case TIMELIB_ZONETYPE_OFFSET:
				new_offset = tzobj->tzi.utc_offset;
				break;
			case TIMELIB_ZONETYPE_ABBR:
				new_offset = tzobj->tzi.z.utc_offset;
				new_dst    = tzobj->tzi.z.dst;
				new_abbr   = strdup(tzobj->tzi.z.abbr);
				break;
		}
		type = tzobj->type;
	} else if (dateobj->time->tz_info) {
		tzi = dateobj->time->tz_info;
	} else {
		tzi = get_timezone_info(TSRMLS_C);
	}

	now = timelib_time_ctor();
	now->zone_type = type;
	switch (type) {
		case TIMELIB_ZONETYPE_ID:
			now->tz_info = tzi;
			break;
		case TIMELIB_ZONETYPE_OFFSET:
			now->z = new_offset;
			break;
		case TIMELIB_ZONETYPE_ABBR:
			now->z = new_offset;
			now->dst = new_dst;
			now->tz_abbr = new_abbr;
			break;
	}
	timelib_unixtime2local(now, (timelib_sll) time(NULL));

	timelib_fill_holes(dateobj->time, now, TIMELIB_NO_CLONE);
	timelib_update_ts(dateobj->time, tzi);

	dateobj->time->have_relative = 0;

	timelib_time_dtor(now);

	return 1;
}

/* {{{ proto DateTime date_create([string time[, DateTimeZone object]])
   Returns new DateTime object
*/
PHP_FUNCTION(date_create)
{
	zval           *timezone_object = NULL;
	char           *time_str = NULL;
	int             time_str_len = 0;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|sO!", &time_str, &time_str_len, &timezone_object, date_ce_timezone) == FAILURE) {
		RETURN_FALSE;
	}

	php_date_instantiate(date_ce_date, return_value TSRMLS_CC);
	if (!php_date_initialize(zend_object_store_get_object(return_value TSRMLS_CC), time_str, time_str_len, NULL, timezone_object, 0 TSRMLS_CC)) {
		RETURN_FALSE;
	}
}
/* }}} */

/* {{{ proto DateTime date_create_from_format(string format, string time[, DateTimeZone object])
   Returns new DateTime object formatted according to the specified format
*/
PHP_FUNCTION(date_create_from_format)
{
	zval           *timezone_object = NULL;
	char           *time_str = NULL, *format_str = NULL;
	int             time_str_len = 0, format_str_len = 0;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "ss|O", &format_str, &format_str_len, &time_str, &time_str_len, &timezone_object, date_ce_timezone) == FAILURE) {
		RETURN_FALSE;
	}

	php_date_instantiate(date_ce_date, return_value TSRMLS_CC);
	if (!php_date_initialize(zend_object_store_get_object(return_value TSRMLS_CC), time_str, time_str_len, format_str, timezone_object, 0 TSRMLS_CC)) {
		RETURN_FALSE;
	}
}
/* }}} */

/* {{{ proto DateTime::__construct([string time[, DateTimeZone object]])
   Creates new DateTime object
*/
PHP_METHOD(DateTime, __construct)
{
	zval *timezone_object = NULL;
	char *time_str = NULL;
	int time_str_len = 0;
	zend_error_handling error_handling;

	zend_replace_error_handling(EH_THROW, NULL, &error_handling TSRMLS_CC);
	if (SUCCESS == zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|sO!", &time_str, &time_str_len, &timezone_object, date_ce_timezone)) {
		php_date_initialize(zend_object_store_get_object(getThis() TSRMLS_CC), time_str, time_str_len, NULL, timezone_object, 1 TSRMLS_CC);
	}
	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

static int php_date_initialize_from_hash(zval **return_value, php_date_obj **dateobj, HashTable *myht TSRMLS_DC)
{
	zval            **z_date = NULL;
	zval            **z_timezone = NULL;
	zval            **z_timezone_type = NULL;
	zval             *tmp_obj = NULL;
	timelib_tzinfo   *tzi;
	php_timezone_obj *tzobj;

	if (zend_hash_find(myht, "date", 5, (void**) &z_date) == SUCCESS) {
		convert_to_string(*z_date);
		if (zend_hash_find(myht, "timezone_type", 14, (void**) &z_timezone_type) == SUCCESS) {
			convert_to_long(*z_timezone_type);
			if (zend_hash_find(myht, "timezone", 9, (void**) &z_timezone) == SUCCESS) {
				convert_to_string(*z_timezone);

				switch (Z_LVAL_PP(z_timezone_type)) {
					case TIMELIB_ZONETYPE_OFFSET:
					case TIMELIB_ZONETYPE_ABBR: {
						char *tmp = emalloc(Z_STRLEN_PP(z_date) + Z_STRLEN_PP(z_timezone) + 2);
						snprintf(tmp, Z_STRLEN_PP(z_date) + Z_STRLEN_PP(z_timezone) + 2, "%s %s", Z_STRVAL_PP(z_date), Z_STRVAL_PP(z_timezone));
						php_date_initialize(*dateobj, tmp, Z_STRLEN_PP(z_date) + Z_STRLEN_PP(z_timezone) + 1, NULL, NULL, 0 TSRMLS_CC);
						efree(tmp);
						return 1;
					}

					case TIMELIB_ZONETYPE_ID:
						convert_to_string(*z_timezone);

						tzi = php_date_parse_tzfile(Z_STRVAL_PP(z_timezone), DATE_TIMEZONEDB TSRMLS_CC);

						ALLOC_INIT_ZVAL(tmp_obj);
						tzobj = zend_object_store_get_object(php_date_instantiate(date_ce_timezone, tmp_obj TSRMLS_CC) TSRMLS_CC);
						tzobj->type = TIMELIB_ZONETYPE_ID;
						tzobj->tzi.tz = tzi;
						tzobj->initialized = 1;

						php_date_initialize(*dateobj, Z_STRVAL_PP(z_date), Z_STRLEN_PP(z_date), NULL, tmp_obj, 0 TSRMLS_CC);
						zval_ptr_dtor(&tmp_obj);
						return 1;
				}
			}
		}
	}
	return 0;
}

/* {{{ proto DateTime::__set_state()
*/
PHP_METHOD(DateTime, __set_state)
{
	php_date_obj     *dateobj;
	zval             *array;
	HashTable        *myht;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "a", &array) == FAILURE) {
		RETURN_FALSE;
	}

	myht = HASH_OF(array);

	php_date_instantiate(date_ce_date, return_value TSRMLS_CC);
	dateobj = (php_date_obj *) zend_object_store_get_object(return_value TSRMLS_CC);
	php_date_initialize_from_hash(&return_value, &dateobj, myht TSRMLS_CC);
}
/* }}} */

/* {{{ proto DateTime::__wakeup()
*/
PHP_METHOD(DateTime, __wakeup)
{
	zval             *object = getThis();
	php_date_obj     *dateobj;
	HashTable        *myht;

	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);

	myht = Z_OBJPROP_P(object);

	php_date_initialize_from_hash(&return_value, &dateobj, myht TSRMLS_CC);
}
/* }}} */

/* Helper function used to add an associative array of warnings and errors to a zval */
static void zval_from_error_container(zval *z, timelib_error_container *error)
{
	int   i;
	zval *element;

	add_assoc_long(z, "warning_count", error->warning_count);
	MAKE_STD_ZVAL(element);
	array_init(element);
	for (i = 0; i < error->warning_count; i++) {
		add_index_string(element, error->warning_messages[i].position, error->warning_messages[i].message, 1);
	}
	add_assoc_zval(z, "warnings", element);

	add_assoc_long(z, "error_count", error->error_count);
	MAKE_STD_ZVAL(element);
	array_init(element);
	for (i = 0; i < error->error_count; i++) {
		add_index_string(element, error->error_messages[i].position, error->error_messages[i].message, 1);
	}
	add_assoc_zval(z, "errors", element);
}

/* {{{ proto array date_get_last_errors()
   Returns the warnings and errors found while parsing a date/time string.
*/
PHP_FUNCTION(date_get_last_errors)
{
	if (DATEG(last_errors)) {
		array_init(return_value);
		zval_from_error_container(return_value, DATEG(last_errors));
	} else {
		RETURN_FALSE;
	}
}
/* }}} */

void php_date_do_return_parsed_time(INTERNAL_FUNCTION_PARAMETERS, timelib_time *parsed_time, struct timelib_error_container *error)
{
	zval *element;

	array_init(return_value);
#define PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(name, elem) \
	if (parsed_time->elem == -99999) {               \
		add_assoc_bool(return_value, #name, 0); \
	} else {                                       \
		add_assoc_long(return_value, #name, parsed_time->elem); \
	}
	PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(year,      y);
	PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(month,     m);
	PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(day,       d);
	PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(hour,      h);
	PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(minute,    i);
	PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(second,    s);
	
	if (parsed_time->f == -99999) {
		add_assoc_bool(return_value, "fraction", 0);
	} else {
		add_assoc_double(return_value, "fraction", parsed_time->f);
	}

	zval_from_error_container(return_value, error);

	timelib_error_container_dtor(error);

	add_assoc_bool(return_value, "is_localtime", parsed_time->is_localtime);

	if (parsed_time->is_localtime) {
		PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(zone_type, zone_type);
		switch (parsed_time->zone_type) {
			case TIMELIB_ZONETYPE_OFFSET:
				PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(zone, z);
				add_assoc_bool(return_value, "is_dst", parsed_time->dst);
				break;
			case TIMELIB_ZONETYPE_ID:
				if (parsed_time->tz_abbr) {
					add_assoc_string(return_value, "tz_abbr", parsed_time->tz_abbr, 1);
				}
				if (parsed_time->tz_info) {
					add_assoc_string(return_value, "tz_id", parsed_time->tz_info->name, 1);
				}
				break;
			case TIMELIB_ZONETYPE_ABBR:
				PHP_DATE_PARSE_DATE_SET_TIME_ELEMENT(zone, z);
				add_assoc_bool(return_value, "is_dst", parsed_time->dst);
				add_assoc_string(return_value, "tz_abbr", parsed_time->tz_abbr, 1);
				break;
		}
	}
	if (parsed_time->have_relative) {
		MAKE_STD_ZVAL(element);
		array_init(element);
		add_assoc_long(element, "year",   parsed_time->relative.y);
		add_assoc_long(element, "month",  parsed_time->relative.m);
		add_assoc_long(element, "day",    parsed_time->relative.d);
		add_assoc_long(element, "hour",   parsed_time->relative.h);
		add_assoc_long(element, "minute", parsed_time->relative.i);
		add_assoc_long(element, "second", parsed_time->relative.s);
		if (parsed_time->relative.have_weekday_relative) {
			add_assoc_long(element, "weekday", parsed_time->relative.weekday);
		}
		if (parsed_time->relative.have_special_relative && (parsed_time->relative.special.type == TIMELIB_SPECIAL_WEEKDAY)) {
			add_assoc_long(element, "weekdays", parsed_time->relative.special.amount);
		}
		if (parsed_time->relative.first_last_day_of) {
			add_assoc_bool(element, parsed_time->relative.first_last_day_of == 1 ? "first_day_of_month" : "last_day_of_month", 1);
		}
		add_assoc_zval(return_value, "relative", element);
	}
	timelib_time_dtor(parsed_time);
}

/* {{{ proto array date_parse(string date)
   Returns associative array with detailed info about given date
*/
PHP_FUNCTION(date_parse)
{
	char                           *date;
	int                             date_len;
	struct timelib_error_container *error;
	timelib_time                   *parsed_time;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &date, &date_len) == FAILURE) {
		RETURN_FALSE;
	}

	parsed_time = timelib_strtotime(date, date_len, &error, DATE_TIMEZONEDB);
	php_date_do_return_parsed_time(INTERNAL_FUNCTION_PARAM_PASSTHRU, parsed_time, error);
}
/* }}} */

/* {{{ proto array date_parse_from_format(string format, string date)
   Returns associative array with detailed info about given date
*/
PHP_FUNCTION(date_parse_from_format)
{
	char                           *date, *format;
	int                             date_len, format_len;
	struct timelib_error_container *error;
	timelib_time                   *parsed_time;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "ss", &format, &format_len, &date, &date_len) == FAILURE) {
		RETURN_FALSE;
	}

	parsed_time = timelib_parse_from_format(format, date, date_len, &error, DATE_TIMEZONEDB);
	php_date_do_return_parsed_time(INTERNAL_FUNCTION_PARAM_PASSTHRU, parsed_time, error);
}
/* }}} */

/* {{{ proto string date_format(DateTime object, string format)
   Returns date formatted according to given format
*/
PHP_FUNCTION(date_format)
{
	zval         *object;
	php_date_obj *dateobj;
	char         *format;
	int           format_len;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Os", &object, date_ce_date, &format, &format_len) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	RETURN_STRING(date_format(format, format_len, dateobj->time, dateobj->time->is_localtime), 0);
}
/* }}} */

/* {{{ proto DateTime date_modify(DateTime object, string modify)
   Alters the timestamp.
*/
PHP_FUNCTION(date_modify)
{
	zval         *object;
	php_date_obj *dateobj;
	char         *modify;
	int           modify_len;
	timelib_time *tmp_time;
	timelib_error_container *err = NULL;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Os", &object, date_ce_date, &modify, &modify_len) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);

	tmp_time = timelib_strtotime(modify, modify_len, &err, DATE_TIMEZONEDB);

	/* update last errors and warnings */
	update_errors_warnings(err TSRMLS_CC);
	if (err && err->error_count) {
		/* spit out the first library error message, at least */
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Failed to parse time string (%s) at position %d (%c): %s", modify,
			err->error_messages[0].position, err->error_messages[0].character, err->error_messages[0].message);
		timelib_time_dtor(tmp_time);
		RETURN_FALSE;
	}

	memcpy(&dateobj->time->relative, &tmp_time->relative, sizeof(struct timelib_rel_time));
	dateobj->time->have_relative = tmp_time->have_relative;
	dateobj->time->sse_uptodate = 0;

	if (tmp_time->y != -99999) {
		dateobj->time->y = tmp_time->y;
	}
	if (tmp_time->m != -99999) {
		dateobj->time->m = tmp_time->m;
	}
	if (tmp_time->d != -99999) {
		dateobj->time->d = tmp_time->d;
	}

	if (tmp_time->h != -99999) {
		dateobj->time->h = tmp_time->h;
		if (tmp_time->i != -99999) {
			dateobj->time->i = tmp_time->i;
			if (tmp_time->s != -99999) {
				dateobj->time->s = tmp_time->s;
			} else {
				dateobj->time->s = 0;
			}
		} else {
			dateobj->time->i = 0;
			dateobj->time->s = 0;
		}
	}
	timelib_time_dtor(tmp_time);

	timelib_update_ts(dateobj->time, NULL);
	timelib_update_from_sse(dateobj->time);
	dateobj->time->have_relative = 0;

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto DateTime date_add(DateTime object, DateInterval interval)
   Adds an interval to the current date in object.
*/
PHP_FUNCTION(date_add)
{
	zval         *object, *interval;
	php_date_obj *dateobj;
	php_interval_obj *intobj;
	int               bias = 1;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "OO", &object, date_ce_date, &interval, date_ce_interval) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	intobj = (php_interval_obj *) zend_object_store_get_object(interval TSRMLS_CC);
	DATE_CHECK_INITIALIZED(intobj->initialized, DateInterval);


	if (intobj->diff->have_weekday_relative || intobj->diff->have_special_relative) {
		memcpy(&dateobj->time->relative, intobj->diff, sizeof(struct timelib_rel_time));
	} else {
		if (intobj->diff->invert) {
			bias = -1;
		}
		dateobj->time->relative.y = intobj->diff->y * bias;
		dateobj->time->relative.m = intobj->diff->m * bias;
		dateobj->time->relative.d = intobj->diff->d * bias;
		dateobj->time->relative.h = intobj->diff->h * bias;
		dateobj->time->relative.i = intobj->diff->i * bias;
		dateobj->time->relative.s = intobj->diff->s * bias;
		dateobj->time->relative.weekday = 0;
		dateobj->time->relative.have_weekday_relative = 0;
	}
	dateobj->time->have_relative = 1;
	dateobj->time->sse_uptodate = 0;

	timelib_update_ts(dateobj->time, NULL);
	timelib_update_from_sse(dateobj->time);
	dateobj->time->have_relative = 0;

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto DateTime date_sub(DateTime object, DateInterval interval)
   Subtracts an interval to the current date in object.
*/
PHP_FUNCTION(date_sub)
{
	zval         *object, *interval;
	php_date_obj *dateobj;
	php_interval_obj *intobj;
	int               bias = 1;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "OO", &object, date_ce_date, &interval, date_ce_interval) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	intobj = (php_interval_obj *) zend_object_store_get_object(interval TSRMLS_CC);
	DATE_CHECK_INITIALIZED(intobj->initialized, DateInterval);

	if (intobj->diff->have_special_relative) {
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Only non-special relative time specifications are supported for subtraction");
		return;
	}

	if (intobj->diff->invert) {
		bias = -1;
	}

	dateobj->time->relative.y = 0 - (intobj->diff->y * bias);
	dateobj->time->relative.m = 0 - (intobj->diff->m * bias);
	dateobj->time->relative.d = 0 - (intobj->diff->d * bias);
	dateobj->time->relative.h = 0 - (intobj->diff->h * bias);
	dateobj->time->relative.i = 0 - (intobj->diff->i * bias);
	dateobj->time->relative.s = 0 - (intobj->diff->s * bias);
	dateobj->time->have_relative = 1;
	dateobj->time->relative.weekday = 0;
	dateobj->time->relative.have_weekday_relative = 0;
	dateobj->time->sse_uptodate = 0;

	timelib_update_ts(dateobj->time, NULL);
	timelib_update_from_sse(dateobj->time);

	dateobj->time->have_relative = 0;

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto DateTimeZone date_timezone_get(DateTime object)
   Return new DateTimeZone object relative to give DateTime
*/
PHP_FUNCTION(date_timezone_get)
{
	zval             *object;
	php_date_obj     *dateobj;
	php_timezone_obj *tzobj;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "O", &object, date_ce_date) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	if (dateobj->time->is_localtime/* && dateobj->time->tz_info*/) {
		php_date_instantiate(date_ce_timezone, return_value TSRMLS_CC);
		tzobj = (php_timezone_obj *) zend_object_store_get_object(return_value TSRMLS_CC);
		tzobj->initialized = 1;
		tzobj->type = dateobj->time->zone_type;
		switch (dateobj->time->zone_type) {
			case TIMELIB_ZONETYPE_ID:
				tzobj->tzi.tz = dateobj->time->tz_info;
				break;
			case TIMELIB_ZONETYPE_OFFSET:
				tzobj->tzi.utc_offset = dateobj->time->z;
				break;
			case TIMELIB_ZONETYPE_ABBR:
				tzobj->tzi.z.utc_offset = dateobj->time->z;
				tzobj->tzi.z.dst = dateobj->time->dst;
				tzobj->tzi.z.abbr = strdup(dateobj->time->tz_abbr);
				break;
		}
	} else {
		RETURN_FALSE;
	}
}
/* }}} */

/* {{{ proto DateTime date_timezone_set(DateTime object, DateTimeZone object)
   Sets the timezone for the DateTime object.
*/
PHP_FUNCTION(date_timezone_set)
{
	zval             *object;
	zval             *timezone_object;
	php_date_obj     *dateobj;
	php_timezone_obj *tzobj;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "OO", &object, date_ce_date, &timezone_object, date_ce_timezone) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	tzobj = (php_timezone_obj *) zend_object_store_get_object(timezone_object TSRMLS_CC);
	if (tzobj->type != TIMELIB_ZONETYPE_ID) {
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Can only do this for zones with ID for now");
		return;
	}
	timelib_set_timezone(dateobj->time, tzobj->tzi.tz);
	timelib_unixtime2local(dateobj->time, dateobj->time->sse);

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto long date_offset_get(DateTime object)
   Returns the DST offset.
*/
PHP_FUNCTION(date_offset_get)
{
	zval                *object;
	php_date_obj        *dateobj;
	timelib_time_offset *offset;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "O", &object, date_ce_date) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	if (dateobj->time->is_localtime/* && dateobj->time->tz_info*/) {
		switch (dateobj->time->zone_type) {
			case TIMELIB_ZONETYPE_ID:
				offset = timelib_get_time_zone_info(dateobj->time->sse, dateobj->time->tz_info);
				RETVAL_LONG(offset->offset);
				timelib_time_offset_dtor(offset);
				break;
			case TIMELIB_ZONETYPE_OFFSET:
				RETVAL_LONG(dateobj->time->z * -60);
				break;
			case TIMELIB_ZONETYPE_ABBR:
				RETVAL_LONG((dateobj->time->z - (60 * dateobj->time->dst)) * -60);
				break;
		}
		return;
	} else {
		RETURN_LONG(0);
	}
}
/* }}} */

/* {{{ proto DateTime date_time_set(DateTime object, long hour, long minute[, long second])
   Sets the time.
*/
PHP_FUNCTION(date_time_set)
{
	zval         *object;
	php_date_obj *dateobj;
	long          h, i, s = 0;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Oll|l", &object, date_ce_date, &h, &i, &s) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	dateobj->time->h = h;
	dateobj->time->i = i;
	dateobj->time->s = s;
	timelib_update_ts(dateobj->time, NULL);

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto DateTime date_date_set(DateTime object, long year, long month, long day)
   Sets the date.
*/
PHP_FUNCTION(date_date_set)
{
	zval         *object;
	php_date_obj *dateobj;
	long          y, m, d;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Olll", &object, date_ce_date, &y, &m, &d) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	dateobj->time->y = y;
	dateobj->time->m = m;
	dateobj->time->d = d;
	timelib_update_ts(dateobj->time, NULL);

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto DateTime date_isodate_set(DateTime object, long year, long week[, long day])
   Sets the ISO date.
*/
PHP_FUNCTION(date_isodate_set)
{
	zval         *object;
	php_date_obj *dateobj;
	long          y, w, d = 1;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Oll|l", &object, date_ce_date, &y, &w, &d) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	dateobj->time->y = y;
	dateobj->time->m = 1;
	dateobj->time->d = 1;
	//prophet generated patch
	{
	int __choose0 = __choose("__SWITCH0");
	if (__choose0 == 0)
	{}
	#ifdef __COMPILE_0
	else if (__choose0 == 1)
	{
	//AddIfStmtKind
	if (!(date_globals.tzcache)) {
	    ((date_globals.tzcache)) = (HashTable *)_emalloc((sizeof(HashTable)));
	    _zend_hash_init(((date_globals.tzcache)), (4), (((void *)0)), (_php_date_tzinfo_dtor), (0));
	}
	}
	#endif
	#ifdef __COMPILE_1
	else if (__choose0 == 2)
	{
	//AddIfStmtKind
	if ((date_globals.last_errors)) {
	    timelib_error_container_dtor((date_globals.last_errors));
	    (date_globals.last_errors) = ((void *)0);
	}
	}
	#endif
	#ifdef __COMPILE_2
	else if (__choose0 == 3)
	{
	//AddIfStmtKind
	if ((date_globals.last_errors)) {
	    timelib_error_container_dtor((date_globals.last_errors));
	}
	}
	#endif
	#ifdef __COMPILE_3
	else if (__choose0 == 4)
	{
	//AddIfStmtKind
	if ((date_globals.timezone) && (strlen((date_globals.timezone)) > 0)) {
	    return (date_globals.timezone);
	}
	}
	#endif
	#ifdef __COMPILE_4
	else if (__choose0 == 5)
	{
	//AddIfStmtKind
	if ((date_globals.timezone)) {
	    _efree(((date_globals.timezone)));
	    (date_globals.timezone) = ((void *)0);
	}
	}
	#endif
	#ifdef __COMPILE_5
	else if (__choose0 == 6)
	{
	//AddIfStmtKind
	if ((date_globals.timezone)) {
	    _efree(((date_globals.timezone)));
	}
	}
	#endif
	#ifdef __COMPILE_6
	else if (__choose0 == 7)
	{
	//AddIfStmtKind
	if ((date_globals.tzcache)) {
	    zend_hash_destroy((date_globals.tzcache));
	    _efree(((date_globals.tzcache)));
	    (date_globals.tzcache) = ((void *)0);
	}
	}
	#endif
	#ifdef __COMPILE_7
	else if (__choose0 == 8)
	{
	//AddIfStmtKind
	if (1) {
	    _zval_copy_ctor((return_value));
	}
	}
	#endif
	#ifdef __COMPILE_8
	else if (__choose0 == 9)
	{
	//AddInitKind
	memset(&dateobj->props, 0, sizeof (*(&dateobj->props)));
	}
	#endif
	#ifdef __COMPILE_9
	else if (__choose0 == 10)
	{
	//AddInitKind
	memset(&dateobj->std, 0, sizeof (*(&dateobj->std)));
	}
	#endif
	#ifdef __COMPILE_10
	else if (__choose0 == 11)
	{
	//AddInitKind
	memset(&dateobj->time, 0, sizeof (*(&dateobj->time)));
	}
	#endif
	#ifdef __COMPILE_11
	else if (__choose0 == 12)
	{
	//AddInitKind
	memset(&dateobj->time->d, 0, sizeof (*(&dateobj->time->d)));
	}
	#endif
	#ifdef __COMPILE_12
	else if (__choose0 == 13)
	{
	//AddInitKind
	memset(&dateobj->time->dst, 0, sizeof (*(&dateobj->time->dst)));
	}
	#endif
	#ifdef __COMPILE_13
	else if (__choose0 == 14)
	{
	//AddInitKind
	memset(&dateobj->time->f, 0, sizeof (*(&dateobj->time->f)));
	}
	#endif
	#ifdef __COMPILE_14
	else if (__choose0 == 15)
	{
	//AddInitKind
	memset(&dateobj->time->h, 0, sizeof (*(&dateobj->time->h)));
	}
	#endif
	#ifdef __COMPILE_15
	else if (__choose0 == 16)
	{
	//AddInitKind
	memset(&dateobj->time->have_date, 0, sizeof (*(&dateobj->time->have_date)));
	}
	#endif
	#ifdef __COMPILE_16
	else if (__choose0 == 17)
	{
	//AddInitKind
	memset(&dateobj->time->have_relative, 0, sizeof (*(&dateobj->time->have_relative)));
	}
	#endif
	#ifdef __COMPILE_17
	else if (__choose0 == 18)
	{
	//AddInitKind
	memset(&dateobj->time->have_time, 0, sizeof (*(&dateobj->time->have_time)));
	}
	#endif
	#ifdef __COMPILE_18
	else if (__choose0 == 19)
	{
	//AddInitKind
	memset(&dateobj->time->have_weeknr_day, 0, sizeof (*(&dateobj->time->have_weeknr_day)));
	}
	#endif
	#ifdef __COMPILE_19
	else if (__choose0 == 20)
	{
	//AddInitKind
	memset(&dateobj->time->have_zone, 0, sizeof (*(&dateobj->time->have_zone)));
	}
	#endif
	#ifdef __COMPILE_20
	else if (__choose0 == 21)
	{
	//AddInitKind
	memset(&dateobj->time->i, 0, sizeof (*(&dateobj->time->i)));
	}
	#endif
	#ifdef __COMPILE_21
	else if (__choose0 == 22)
	{
	//AddInitKind
	memset(&dateobj->time->is_localtime, 0, sizeof (*(&dateobj->time->is_localtime)));
	}
	#endif
	#ifdef __COMPILE_22
	else if (__choose0 == 23)
	{
	//AddInitKind
	memset(&dateobj->time->m, 0, sizeof (*(&dateobj->time->m)));
	}
	#endif
	#ifdef __COMPILE_23
	else if (__choose0 == 24)
	{
	//AddInitKind
	memset(&dateobj->time->relative, 0, sizeof (*(&dateobj->time->relative)));
	}
	#endif
	#ifdef __COMPILE_24
	else if (__choose0 == 25)
	{
	//AddInitKind
	memset(&dateobj->time->relative.d, 0, sizeof (*(&dateobj->time->relative.d)));
	}
	#endif
	#ifdef __COMPILE_25
	else if (__choose0 == 26)
	{
	//AddInitKind
	memset(&dateobj->time->relative.days, 0, sizeof (*(&dateobj->time->relative.days)));
	}
	#endif
	#ifdef __COMPILE_26
	else if (__choose0 == 27)
	{
	//AddInitKind
	memset(&dateobj->time->relative.first_last_day_of, 0, sizeof (*(&dateobj->time->relative.first_last_day_of)));
	}
	#endif
	#ifdef __COMPILE_27
	else if (__choose0 == 28)
	{
	//AddInitKind
	memset(&dateobj->time->relative.h, 0, sizeof (*(&dateobj->time->relative.h)));
	}
	#endif
	#ifdef __COMPILE_28
	else if (__choose0 == 29)
	{
	//AddInitKind
	memset(&dateobj->time->relative.have_special_relative, 0, sizeof (*(&dateobj->time->relative.have_special_relative)));
	}
	#endif
	#ifdef __COMPILE_29
	else if (__choose0 == 30)
	{
	//AddInitKind
	memset(&dateobj->time->relative.have_weekday_relative, 0, sizeof (*(&dateobj->time->relative.have_weekday_relative)));
	}
	#endif
	#ifdef __COMPILE_30
	else if (__choose0 == 31)
	{
	//AddInitKind
	memset(&dateobj->time->relative.i, 0, sizeof (*(&dateobj->time->relative.i)));
	}
	#endif
	#ifdef __COMPILE_31
	else if (__choose0 == 32)
	{
	//AddInitKind
	memset(&dateobj->time->relative.invert, 0, sizeof (*(&dateobj->time->relative.invert)));
	}
	#endif
	#ifdef __COMPILE_32
	else if (__choose0 == 33)
	{
	//AddInitKind
	memset(&dateobj->time->relative.m, 0, sizeof (*(&dateobj->time->relative.m)));
	}
	#endif
	#ifdef __COMPILE_33
	else if (__choose0 == 34)
	{
	//AddInitKind
	memset(&dateobj->time->relative.s, 0, sizeof (*(&dateobj->time->relative.s)));
	}
	#endif
	#ifdef __COMPILE_34
	else if (__choose0 == 35)
	{
	//AddInitKind
	memset(&dateobj->time->relative.special, 0, sizeof (*(&dateobj->time->relative.special)));
	}
	#endif
	#ifdef __COMPILE_35
	else if (__choose0 == 36)
	{
	//AddInitKind
	memset(&dateobj->time->relative.weekday, 0, sizeof (*(&dateobj->time->relative.weekday)));
	}
	#endif
	#ifdef __COMPILE_36
	else if (__choose0 == 37)
	{
	//AddInitKind
	memset(&dateobj->time->relative.weekday_behavior, 0, sizeof (*(&dateobj->time->relative.weekday_behavior)));
	}
	#endif
	#ifdef __COMPILE_37
	else if (__choose0 == 38)
	{
	//AddInitKind
	memset(&dateobj->time->relative.y, 0, sizeof (*(&dateobj->time->relative.y)));
	}
	#endif
	#ifdef __COMPILE_38
	else if (__choose0 == 39)
	{
	//AddInitKind
	memset(&dateobj->time->s, 0, sizeof (*(&dateobj->time->s)));
	}
	#endif
	#ifdef __COMPILE_39
	else if (__choose0 == 40)
	{
	//AddInitKind
	memset(&dateobj->time->sse, 0, sizeof (*(&dateobj->time->sse)));
	}
	#endif
	#ifdef __COMPILE_40
	else if (__choose0 == 41)
	{
	//AddInitKind
	memset(&dateobj->time->sse_uptodate, 0, sizeof (*(&dateobj->time->sse_uptodate)));
	}
	#endif
	#ifdef __COMPILE_41
	else if (__choose0 == 42)
	{
	//AddInitKind
	memset(&dateobj->time->tim_uptodate, 0, sizeof (*(&dateobj->time->tim_uptodate)));
	}
	#endif
	#ifdef __COMPILE_42
	else if (__choose0 == 43)
	{
	//AddInitKind
	memset(&dateobj->time->tz_abbr, 0, sizeof (*(&dateobj->time->tz_abbr)));
	}
	#endif
	#ifdef __COMPILE_43
	else if (__choose0 == 44)
	{
	//AddInitKind
	memset(&dateobj->time->tz_info, 0, sizeof (*(&dateobj->time->tz_info)));
	}
	#endif
	#ifdef __COMPILE_44
	else if (__choose0 == 45)
	{
	//AddInitKind
	memset(&dateobj->time->y, 0, sizeof (*(&dateobj->time->y)));
	}
	#endif
	#ifdef __COMPILE_45
	else if (__choose0 == 46)
	{
	//AddInitKind
	memset(&dateobj->time->z, 0, sizeof (*(&dateobj->time->z)));
	}
	#endif
	#ifdef __COMPILE_46
	else if (__choose0 == 47)
	{
	//AddInitKind
	memset(&dateobj->time->zone_type, 0, sizeof (*(&dateobj->time->zone_type)));
	}
	#endif
	#ifdef __COMPILE_47
	else if (__choose0 == 48)
	{
	//AddInitKind
	memset(dateobj, 0, sizeof (*(dateobj)));
	}
	#endif
	#ifdef __COMPILE_48
	else if (__choose0 == 49)
	{
	//AddInitKind
	memset(dateobj->props, 0, sizeof (*(dateobj->props)));
	}
	#endif
	#ifdef __COMPILE_49
	else if (__choose0 == 50)
	{
	//AddInitKind
	memset(dateobj->time, 0, sizeof (*(dateobj->time)));
	}
	#endif
	#ifdef __COMPILE_50
	else if (__choose0 == 51)
	{
	//AddInitKind
	memset(dateobj->time->tz_abbr, 0, sizeof (*(dateobj->time->tz_abbr)));
	}
	#endif
	#ifdef __COMPILE_51
	else if (__choose0 == 52)
	{
	//AddInitKind
	memset(dateobj->time->tz_info, 0, sizeof (*(dateobj->time->tz_info)));
	}
	#endif
	#ifdef __COMPILE_52
	else if (__choose0 == 53)
	{
	//AddStmtAndReplaceAtomKind
	_array_init(((object)), 0);
	}
	#endif
	#ifdef __COMPILE_53
	else if (__choose0 == 54)
	{
	//AddStmtAndReplaceAtomKind
	_array_init(((return_value)), 0);
	}
	#endif
	#ifdef __COMPILE_54
	else if (__choose0 == 55)
	{
	//AddStmtAndReplaceAtomKind
	_array_init(((this_ptr)), 0);
	}
	#endif
	#ifdef __COMPILE_55
	else if (__choose0 == 56)
	{
	//AddStmtAndReplaceAtomKind
	_convert_to_string((*(return_value_ptr)));
	}
	#endif
	#ifdef __COMPILE_56
	else if (__choose0 == 57)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((date_globals && !(1 << 5).timezone)));
	}
	#endif
	#ifdef __COMPILE_57
	else if (__choose0 == 58)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((date_globals && !(1 << 5).tzcache)));
	}
	#endif
	#ifdef __COMPILE_58
	else if (__choose0 == 59)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((object)));
	}
	#endif
	#ifdef __COMPILE_59
	else if (__choose0 == 60)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((return_value)));
	}
	#endif
	#ifdef __COMPILE_60
	else if (__choose0 == 61)
	{
	//AddStmtAndReplaceAtomKind
	_efree(((this_ptr)));
	}
	#endif
	#ifdef __COMPILE_61
	else if (__choose0 == 62)
	{
	//AddStmtAndReplaceAtomKind
	_zend_hash_init(((date_globals && !(1 << 5).tzcache)), (4), (((void *)0)), (_php_date_tzinfo_dtor), (0));
	}
	#endif
	#ifdef __COMPILE_62
	else if (__choose0 == 63)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor(((object)));
	}
	#endif
	#ifdef __COMPILE_63
	else if (__choose0 == 64)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor(((return_value)));
	}
	#endif
	#ifdef __COMPILE_64
	else if (__choose0 == 65)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor(((this_ptr)));
	}
	#endif
	#ifdef __COMPILE_65
	else if (__choose0 == 66)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor((return_value && !(1 << 5)));
	}
	#endif
	#ifdef __COMPILE_66
	else if (__choose0 == 67)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor_func((object));
	}
	#endif
	#ifdef __COMPILE_67
	else if (__choose0 == 68)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor_func((return_value));
	}
	#endif
	#ifdef __COMPILE_68
	else if (__choose0 == 69)
	{
	//AddStmtAndReplaceAtomKind
	_zval_copy_ctor_func((this_ptr));
	}
	#endif
	#ifdef __COMPILE_69
	else if (__choose0 == 70)
	{
	//AddStmtAndReplaceAtomKind
	_zval_dtor(((object)));
	}
	#endif
	#ifdef __COMPILE_70
	else if (__choose0 == 71)
	{
	//AddStmtAndReplaceAtomKind
	_zval_dtor(((return_value)));
	}
	#endif
	#ifdef __COMPILE_71
	else if (__choose0 == 72)
	{
	//AddStmtAndReplaceAtomKind
	_zval_dtor(((this_ptr)));
	}
	#endif
	#ifdef __COMPILE_72
	else if (__choose0 == 73)
	{
	//AddStmtAndReplaceAtomKind
	_zval_dtor_func((object));
	}
	#endif
	#ifdef __COMPILE_73
	else if (__choose0 == 74)
	{
	//AddStmtAndReplaceAtomKind
	_zval_dtor_func((return_value));
	}
	#endif
	#ifdef __COMPILE_74
	else if (__choose0 == 75)
	{
	//AddStmtAndReplaceAtomKind
	_zval_dtor_func((this_ptr));
	}
	#endif
	#ifdef __COMPILE_75
	else if (__choose0 == 76)
	{
	//AddStmtAndReplaceAtomKind
	_zval_ptr_dtor((&(object)));
	}
	#endif
	#ifdef __COMPILE_76
	else if (__choose0 == 77)
	{
	//AddStmtAndReplaceAtomKind
	_zval_ptr_dtor((&(return_value)));
	}
	#endif
	#ifdef __COMPILE_77
	else if (__choose0 == 78)
	{
	//AddStmtAndReplaceAtomKind
	_zval_ptr_dtor((&(this_ptr)));
	}
	#endif
	#ifdef __COMPILE_78
	else if (__choose0 == 79)
	{
	//AddStmtAndReplaceAtomKind
	_zval_ptr_dtor((&object && !(1 << 5)));
	}
	#endif
	#ifdef __COMPILE_79
	else if (__choose0 == 80)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "astronomical_twilight_end", strlen("astronomical_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_80
	else if (__choose0 == 81)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "astronomical_twilight_end", strlen("astronomical_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_81
	else if (__choose0 == 82)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "civil_twilight_end", strlen("civil_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_82
	else if (__choose0 == 83)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "civil_twilight_end", strlen("civil_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_83
	else if (__choose0 == 84)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "day", strlen("day") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_84
	else if (__choose0 == 85)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "fraction", strlen("fraction") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_85
	else if (__choose0 == 86)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "hour", strlen("hour") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_86
	else if (__choose0 == 87)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "minute", strlen("minute") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_87
	else if (__choose0 == 88)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "month", strlen("month") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_88
	else if (__choose0 == 89)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "nautical_twilight_end", strlen("nautical_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_89
	else if (__choose0 == 90)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "nautical_twilight_end", strlen("nautical_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_90
	else if (__choose0 == 91)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "second", strlen("second") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_91
	else if (__choose0 == 92)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "sunset", strlen("sunset") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_92
	else if (__choose0 == 93)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "sunset", strlen("sunset") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_93
	else if (__choose0 == 94)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "year", strlen("year") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_94
	else if (__choose0 == 95)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "zone", strlen("zone") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_95
	else if (__choose0 == 96)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((object), "zone_type", strlen("zone_type") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_96
	else if (__choose0 == 97)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "astronomical_twilight_end", strlen("astronomical_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_97
	else if (__choose0 == 98)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "astronomical_twilight_end", strlen("astronomical_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_98
	else if (__choose0 == 99)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "civil_twilight_end", strlen("civil_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_99
	else if (__choose0 == 100)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "civil_twilight_end", strlen("civil_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_100
	else if (__choose0 == 101)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "day", strlen("day") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_101
	else if (__choose0 == 102)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "fraction", strlen("fraction") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_102
	else if (__choose0 == 103)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "hour", strlen("hour") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_103
	else if (__choose0 == 104)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "minute", strlen("minute") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_104
	else if (__choose0 == 105)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "month", strlen("month") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_105
	else if (__choose0 == 106)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "nautical_twilight_end", strlen("nautical_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_106
	else if (__choose0 == 107)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "nautical_twilight_end", strlen("nautical_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_107
	else if (__choose0 == 108)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "second", strlen("second") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_108
	else if (__choose0 == 109)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "sunset", strlen("sunset") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_109
	else if (__choose0 == 110)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "sunset", strlen("sunset") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_110
	else if (__choose0 == 111)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "year", strlen("year") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_111
	else if (__choose0 == 112)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "zone", strlen("zone") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_112
	else if (__choose0 == 113)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((return_value), "zone_type", strlen("zone_type") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_113
	else if (__choose0 == 114)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "astronomical_twilight_end", strlen("astronomical_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_114
	else if (__choose0 == 115)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "astronomical_twilight_end", strlen("astronomical_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_115
	else if (__choose0 == 116)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "civil_twilight_end", strlen("civil_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_116
	else if (__choose0 == 117)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "civil_twilight_end", strlen("civil_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_117
	else if (__choose0 == 118)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "day", strlen("day") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_118
	else if (__choose0 == 119)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "fraction", strlen("fraction") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_119
	else if (__choose0 == 120)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "hour", strlen("hour") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_120
	else if (__choose0 == 121)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "minute", strlen("minute") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_121
	else if (__choose0 == 122)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "month", strlen("month") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_122
	else if (__choose0 == 123)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "nautical_twilight_end", strlen("nautical_twilight_end") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_123
	else if (__choose0 == 124)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "nautical_twilight_end", strlen("nautical_twilight_end") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_124
	else if (__choose0 == 125)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "second", strlen("second") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_125
	else if (__choose0 == 126)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "sunset", strlen("sunset") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_126
	else if (__choose0 == 127)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "sunset", strlen("sunset") + 1, 1);
	}
	#endif
	#ifdef __COMPILE_127
	else if (__choose0 == 128)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "year", strlen("year") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_128
	else if (__choose0 == 129)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "zone", strlen("zone") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_129
	else if (__choose0 == 130)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_bool_ex((this_ptr), "zone_type", strlen("zone_type") + 1, 0);
	}
	#endif
	#ifdef __COMPILE_130
	else if (__choose0 == 131)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_null_ex((object), "timezone_id", strlen("timezone_id") + 1);
	}
	#endif
	#ifdef __COMPILE_131
	else if (__choose0 == 132)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_null_ex((return_value), "timezone_id", strlen("timezone_id") + 1);
	}
	#endif
	#ifdef __COMPILE_132
	else if (__choose0 == 133)
	{
	//AddStmtAndReplaceAtomKind
	add_assoc_null_ex((this_ptr), "timezone_id", strlen("timezone_id") + 1);
	}
	#endif
	#ifdef __COMPILE_133
	else if (__choose0 == 134)
	{
	//AddStmtAndReplaceAtomKind
	convert_to_boolean((object));
	}
	#endif
	#ifdef __COMPILE_134
	else if (__choose0 == 135)
	{
	//AddStmtAndReplaceAtomKind
	convert_to_boolean((return_value));
	}
	#endif
	#ifdef __COMPILE_135
	else if (__choose0 == 136)
	{
	//AddStmtAndReplaceAtomKind
	convert_to_boolean((this_ptr));
	}
	#endif
	#ifdef __COMPILE_136
	else if (__choose0 == 137)
	{
	//AddStmtAndReplaceAtomKind
	convert_to_long(*(return_value_ptr));
	}
	#endif
	#ifdef __COMPILE_137
	else if (__choose0 == 138)
	{
	//AddStmtAndReplaceAtomKind
	date_ce_period->iterator_funcs.funcs = &date_period_it_funcs && !(1 << 5);
	}
	#endif
	#ifdef __COMPILE_138
	else if (__choose0 == 139)
	{
	//AddStmtAndReplaceAtomKind
	dateobj = (dateobj);
	}
	#endif
	#ifdef __COMPILE_139
	else if (__choose0 == 140)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->d = (-1);
	}
	#endif
	#ifdef __COMPILE_140
	else if (__choose0 == 141)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->d = (0);
	}
	#endif
	#ifdef __COMPILE_141
	else if (__choose0 == 142)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->d = (1);
	}
	#endif
	#ifdef __COMPILE_142
	else if (__choose0 == 143)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->d = (2);
	}
	#endif
	#ifdef __COMPILE_143
	else if (__choose0 == 144)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->d = (3);
	}
	#endif
	#ifdef __COMPILE_144
	else if (__choose0 == 145)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->have_relative = (-1);
	}
	#endif
	#ifdef __COMPILE_145
	else if (__choose0 == 146)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->have_relative = (0);
	}
	#endif
	#ifdef __COMPILE_146
	else if (__choose0 == 147)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->have_relative = (1);
	}
	#endif
	#ifdef __COMPILE_147
	else if (__choose0 == 148)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->have_relative = (2);
	}
	#endif
	#ifdef __COMPILE_148
	else if (__choose0 == 149)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->have_relative = (3);
	}
	#endif
	#ifdef __COMPILE_149
	else if (__choose0 == 150)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->m = (-1);
	}
	#endif
	#ifdef __COMPILE_150
	else if (__choose0 == 151)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->m = (0);
	}
	#endif
	#ifdef __COMPILE_151
	else if (__choose0 == 152)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->m = (1);
	}
	#endif
	#ifdef __COMPILE_152
	else if (__choose0 == 153)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->m = (2);
	}
	#endif
	#ifdef __COMPILE_153
	else if (__choose0 == 154)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->m = (3);
	}
	#endif
	#ifdef __COMPILE_154
	else if (__choose0 == 155)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = (-1);
	}
	#endif
	#ifdef __COMPILE_155
	else if (__choose0 == 156)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = (0);
	}
	#endif
	#ifdef __COMPILE_156
	else if (__choose0 == 157)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = (1);
	}
	#endif
	#ifdef __COMPILE_157
	else if (__choose0 == 158)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = (2);
	}
	#endif
	#ifdef __COMPILE_158
	else if (__choose0 == 159)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = (3);
	}
	#endif
	#ifdef __COMPILE_159
	else if (__choose0 == 160)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y && !(1 << 5), w, d);
	}
	#endif
	#ifdef __COMPILE_160
	else if (__choose0 == 161)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w && !(1 << 5), d);
	}
	#endif
	#ifdef __COMPILE_161
	else if (__choose0 == 162)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, d && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_162
	else if (__choose0 == 163)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->y = (-1);
	}
	#endif
	#ifdef __COMPILE_163
	else if (__choose0 == 164)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->y = (0);
	}
	#endif
	#ifdef __COMPILE_164
	else if (__choose0 == 165)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->y = (1);
	}
	#endif
	#ifdef __COMPILE_165
	else if (__choose0 == 166)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->y = (2);
	}
	#endif
	#ifdef __COMPILE_166
	else if (__choose0 == 167)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->y = (3);
	}
	#endif
	#ifdef __COMPILE_167
	else if (__choose0 == 168)
	{
	//AddStmtAndReplaceAtomKind
	dateobj->time->y = y && !(1 << 5);
	}
	#endif
	#ifdef __COMPILE_168
	else if (__choose0 == 169)
	{
	//AddStmtAndReplaceAtomKind
	gc_remove_zval_from_buffer((object));
	}
	#endif
	#ifdef __COMPILE_169
	else if (__choose0 == 170)
	{
	//AddStmtAndReplaceAtomKind
	gc_remove_zval_from_buffer((return_value));
	}
	#endif
	#ifdef __COMPILE_170
	else if (__choose0 == 171)
	{
	//AddStmtAndReplaceAtomKind
	gc_remove_zval_from_buffer((this_ptr));
	}
	#endif
	#ifdef __COMPILE_171
	else if (__choose0 == 172)
	{
	//AddStmtAndReplaceAtomKind
	gc_zval_check_possible_root(((object)));
	}
	#endif
	#ifdef __COMPILE_172
	else if (__choose0 == 173)
	{
	//AddStmtAndReplaceAtomKind
	gc_zval_check_possible_root(((return_value)));
	}
	#endif
	#ifdef __COMPILE_173
	else if (__choose0 == 174)
	{
	//AddStmtAndReplaceAtomKind
	gc_zval_check_possible_root(((this_ptr)));
	}
	#endif
	#ifdef __COMPILE_174
	else if (__choose0 == 175)
	{
	//AddStmtAndReplaceAtomKind
	gc_zval_possible_root((object));
	}
	#endif
	#ifdef __COMPILE_175
	else if (__choose0 == 176)
	{
	//AddStmtAndReplaceAtomKind
	gc_zval_possible_root((return_value));
	}
	#endif
	#ifdef __COMPILE_176
	else if (__choose0 == 177)
	{
	//AddStmtAndReplaceAtomKind
	gc_zval_possible_root((this_ptr));
	}
	#endif
	#ifdef __COMPILE_177
	else if (__choose0 == 178)
	{
	//AddStmtAndReplaceAtomKind
	i_zval_ptr_dtor((object));
	}
	#endif
	#ifdef __COMPILE_178
	else if (__choose0 == 179)
	{
	//AddStmtAndReplaceAtomKind
	i_zval_ptr_dtor((return_value));
	}
	#endif
	#ifdef __COMPILE_179
	else if (__choose0 == 180)
	{
	//AddStmtAndReplaceAtomKind
	i_zval_ptr_dtor((this_ptr));
	}
	#endif
	#ifdef __COMPILE_180
	else if (__choose0 == 181)
	{
	//AddStmtAndReplaceAtomKind
	memcpy(&date_object_handlers_date && !(1 << 5), zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_181
	else if (__choose0 == 182)
	{
	//AddStmtAndReplaceAtomKind
	memcpy(&date_object_handlers_interval && !(1 << 5), zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_182
	else if (__choose0 == 183)
	{
	//AddStmtAndReplaceAtomKind
	memcpy(&date_object_handlers_period && !(1 << 5), zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_183
	else if (__choose0 == 184)
	{
	//AddStmtAndReplaceAtomKind
	memcpy(&date_object_handlers_timezone && !(1 << 5), zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_184
	else if (__choose0 == 185)
	{
	//AddStmtAndReplaceAtomKind
	memset((dateobj), 0, sizeof(php_date_obj));
	}
	#endif
	#ifdef __COMPILE_185
	else if (__choose0 == 186)
	{
	//AddStmtAndReplaceAtomKind
	php_date_global_timezone_db_enabled = (-1);
	}
	#endif
	#ifdef __COMPILE_186
	else if (__choose0 == 187)
	{
	//AddStmtAndReplaceAtomKind
	php_date_global_timezone_db_enabled = (0);
	}
	#endif
	#ifdef __COMPILE_187
	else if (__choose0 == 188)
	{
	//AddStmtAndReplaceAtomKind
	php_date_global_timezone_db_enabled = (1);
	}
	#endif
	#ifdef __COMPILE_188
	else if (__choose0 == 189)
	{
	//AddStmtAndReplaceAtomKind
	php_date_global_timezone_db_enabled = (2);
	}
	#endif
	#ifdef __COMPILE_189
	else if (__choose0 == 190)
	{
	//AddStmtAndReplaceAtomKind
	php_date_global_timezone_db_enabled = (3);
	}
	#endif
	#ifdef __COMPILE_190
	else if (__choose0 == 191)
	{
	//AddStmtAndReplaceAtomKind
	php_date_global_timezone_db_enabled = (ht);
	}
	#endif
	#ifdef __COMPILE_191
	else if (__choose0 == 192)
	{
	//AddStmtAndReplaceAtomKind
	php_date_global_timezone_db_enabled = (return_value_used);
	}
	#endif
	#ifdef __COMPILE_192
	else if (__choose0 == 193)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_date, (object));
	}
	#endif
	#ifdef __COMPILE_193
	else if (__choose0 == 194)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_date, (return_value));
	}
	#endif
	#ifdef __COMPILE_194
	else if (__choose0 == 195)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_date, (this_ptr));
	}
	#endif
	#ifdef __COMPILE_195
	else if (__choose0 == 196)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_interval, (object));
	}
	#endif
	#ifdef __COMPILE_196
	else if (__choose0 == 197)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_interval, (return_value));
	}
	#endif
	#ifdef __COMPILE_197
	else if (__choose0 == 198)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_interval, (this_ptr));
	}
	#endif
	#ifdef __COMPILE_198
	else if (__choose0 == 199)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_timezone, (object));
	}
	#endif
	#ifdef __COMPILE_199
	else if (__choose0 == 200)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_timezone, (return_value));
	}
	#endif
	#ifdef __COMPILE_200
	else if (__choose0 == 201)
	{
	//AddStmtAndReplaceAtomKind
	php_date_instantiate(date_ce_timezone, (this_ptr));
	}
	#endif
	#ifdef __COMPILE_201
	else if (__choose0 == 202)
	{
	//AddStmtAndReplaceAtomKind
	php_info_print_table_row(2, "Timezone Database", php_date_global_timezone_db_enabled && !(1 << 5) ? "external" : "internal");
	}
	#endif
	#ifdef __COMPILE_202
	else if (__choose0 == 203)
	{
	//AddStmtAndReplaceAtomKind
	timelib_error_container_dtor((date_globals && !(1 << 5).last_errors));
	}
	#endif
	#ifdef __COMPILE_203
	else if (__choose0 == 204)
	{
	//AddStmtAndReplaceAtomKind
	timelib_time_dtor((dateobj)->time);
	}
	#endif
	#ifdef __COMPILE_204
	else if (__choose0 == 205)
	{
	//AddStmtAndReplaceAtomKind
	timelib_update_from_sse((dateobj)->time);
	}
	#endif
	#ifdef __COMPILE_205
	else if (__choose0 == 206)
	{
	//AddStmtAndReplaceAtomKind
	timelib_update_ts((dateobj)->time, ((void *)0));
	}
	#endif
	#ifdef __COMPILE_206
	else if (__choose0 == 207)
	{
	//AddStmtAndReplaceAtomKind
	timelib_update_ts(dateobj && !(1 << 5)->time, ((void *)0));
	}
	#endif
	#ifdef __COMPILE_207
	else if (__choose0 == 208)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(date_ce_period && !(1 << 5), 1, zend_ce_traversable);
	}
	#endif
	#ifdef __COMPILE_208
	else if (__choose0 == 209)
	{
	//AddStmtAndReplaceAtomKind
	zend_class_implements(date_ce_period, 1, zend_ce_traversable && !(1 << 5));
	}
	#endif
	#ifdef __COMPILE_209
	else if (__choose0 == 210)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_period && !(1 << 5), "EXCLUDE_START_DATE", sizeof ("EXCLUDE_START_DATE") - 1, 1);
	}
	#endif
	#ifdef __COMPILE_210
	else if (__choose0 == 211)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "AFRICA", sizeof ("AFRICA") - 1, 1);
	}
	#endif
	#ifdef __COMPILE_211
	else if (__choose0 == 212)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "ALL", sizeof ("ALL") - 1, 2047);
	}
	#endif
	#ifdef __COMPILE_212
	else if (__choose0 == 213)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "ALL_WITH_BC", sizeof ("ALL_WITH_BC") - 1, 4095);
	}
	#endif
	#ifdef __COMPILE_213
	else if (__choose0 == 214)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "AMERICA", sizeof ("AMERICA") - 1, 2);
	}
	#endif
	#ifdef __COMPILE_214
	else if (__choose0 == 215)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "ANTARCTICA", sizeof ("ANTARCTICA") - 1, 4);
	}
	#endif
	#ifdef __COMPILE_215
	else if (__choose0 == 216)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "ARCTIC", sizeof ("ARCTIC") - 1, 8);
	}
	#endif
	#ifdef __COMPILE_216
	else if (__choose0 == 217)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "ASIA", sizeof ("ASIA") - 1, 16);
	}
	#endif
	#ifdef __COMPILE_217
	else if (__choose0 == 218)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "ATLANTIC", sizeof ("ATLANTIC") - 1, 32);
	}
	#endif
	#ifdef __COMPILE_218
	else if (__choose0 == 219)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "AUSTRALIA", sizeof ("AUSTRALIA") - 1, 64);
	}
	#endif
	#ifdef __COMPILE_219
	else if (__choose0 == 220)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "EUROPE", sizeof ("EUROPE") - 1, 128);
	}
	#endif
	#ifdef __COMPILE_220
	else if (__choose0 == 221)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "INDIAN", sizeof ("INDIAN") - 1, 256);
	}
	#endif
	#ifdef __COMPILE_221
	else if (__choose0 == 222)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "PACIFIC", sizeof ("PACIFIC") - 1, 512);
	}
	#endif
	#ifdef __COMPILE_222
	else if (__choose0 == 223)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "PER_COUNTRY", sizeof ("PER_COUNTRY") - 1, 4096);
	}
	#endif
	#ifdef __COMPILE_223
	else if (__choose0 == 224)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_long(date_ce_timezone && !(1 << 5), "UTC", sizeof ("UTC") - 1, 1024);
	}
	#endif
	#ifdef __COMPILE_224
	else if (__choose0 == 225)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "ATOM", sizeof ("ATOM") - 1, "Y-m-d\\TH:i:sP", sizeof ("Y-m-d\\TH:i:sP") - 1);
	}
	#endif
	#ifdef __COMPILE_225
	else if (__choose0 == 226)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "COOKIE", sizeof ("COOKIE") - 1, "l, d-M-y H:i:s T", sizeof ("l, d-M-y H:i:s T") - 1);
	}
	#endif
	#ifdef __COMPILE_226
	else if (__choose0 == 227)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "ISO8601", sizeof ("ISO8601") - 1, "Y-m-d\\TH:i:sO", sizeof ("Y-m-d\\TH:i:sO") - 1);
	}
	#endif
	#ifdef __COMPILE_227
	else if (__choose0 == 228)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "RFC1036", sizeof ("RFC1036") - 1, "D, d M y H:i:s O", sizeof ("D, d M y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_228
	else if (__choose0 == 229)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "RFC1123", sizeof ("RFC1123") - 1, "D, d M Y H:i:s O", sizeof ("D, d M Y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_229
	else if (__choose0 == 230)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "RFC2822", sizeof ("RFC2822") - 1, "D, d M Y H:i:s O", sizeof ("D, d M Y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_230
	else if (__choose0 == 231)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "RFC3339", sizeof ("RFC3339") - 1, "Y-m-d\\TH:i:sP", sizeof ("Y-m-d\\TH:i:sP") - 1);
	}
	#endif
	#ifdef __COMPILE_231
	else if (__choose0 == 232)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "RFC822", sizeof ("RFC822") - 1, "D, d M y H:i:s O", sizeof ("D, d M y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_232
	else if (__choose0 == 233)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "RFC850", sizeof ("RFC850") - 1, "l, d-M-y H:i:s T", sizeof ("l, d-M-y H:i:s T") - 1);
	}
	#endif
	#ifdef __COMPILE_233
	else if (__choose0 == 234)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "RSS", sizeof ("RSS") - 1, "D, d M Y H:i:s O", sizeof ("D, d M Y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_234
	else if (__choose0 == 235)
	{
	//AddStmtAndReplaceAtomKind
	zend_declare_class_constant_stringl(date_ce_date && !(1 << 5), "W3C", sizeof ("W3C") - 1, "Y-m-d\\TH:i:sP", sizeof ("Y-m-d\\TH:i:sP") - 1);
	}
	#endif
	#ifdef __COMPILE_235
	else if (__choose0 == 236)
	{
	//AddStmtAndReplaceAtomKind
	zend_hash_destroy((date_globals && !(1 << 5).tzcache));
	}
	#endif
	#ifdef __COMPILE_236
	else if (__choose0 == 237)
	{
	//AddStmtAndReplaceAtomKind
	zend_object_std_dtor(&(dateobj)->std);
	}
	#endif
	#ifdef __COMPILE_237
	else if (__choose0 == 238)
	{
	//AddStmtAndReplaceAtomKind
	zval_addref_p((object));
	}
	#endif
	#ifdef __COMPILE_238
	else if (__choose0 == 239)
	{
	//AddStmtAndReplaceAtomKind
	zval_addref_p((return_value));
	}
	#endif
	#ifdef __COMPILE_239
	else if (__choose0 == 240)
	{
	//AddStmtAndReplaceAtomKind
	zval_addref_p((this_ptr));
	}
	#endif
	#ifdef __COMPILE_240
	else if (__choose0 == 241)
	{
	//AddStmtAndReplaceAtomKind
	zval_from_error_container((object), (date_globals.last_errors));
	}
	#endif
	#ifdef __COMPILE_241
	else if (__choose0 == 242)
	{
	//AddStmtAndReplaceAtomKind
	zval_from_error_container((return_value), (date_globals.last_errors));
	}
	#endif
	#ifdef __COMPILE_242
	else if (__choose0 == 243)
	{
	//AddStmtAndReplaceAtomKind
	zval_from_error_container((this_ptr), (date_globals.last_errors));
	}
	#endif
	#ifdef __COMPILE_243
	else if (__choose0 == 244)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p((object), 0);
	}
	#endif
	#ifdef __COMPILE_244
	else if (__choose0 == 245)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p((object), 1);
	}
	#endif
	#ifdef __COMPILE_245
	else if (__choose0 == 246)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p((return_value), 0);
	}
	#endif
	#ifdef __COMPILE_246
	else if (__choose0 == 247)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p((return_value), 1);
	}
	#endif
	#ifdef __COMPILE_247
	else if (__choose0 == 248)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p((this_ptr), 0);
	}
	#endif
	#ifdef __COMPILE_248
	else if (__choose0 == 249)
	{
	//AddStmtAndReplaceAtomKind
	zval_set_refcount_p((this_ptr), 1);
	}
	#endif
	#ifdef __COMPILE_249
	else if (__choose0 == 250)
	{
	//AddStmtAndReplaceAtomKind
	zval_unset_isref_p((object));
	}
	#endif
	#ifdef __COMPILE_250
	else if (__choose0 == 251)
	{
	//AddStmtAndReplaceAtomKind
	zval_unset_isref_p((return_value));
	}
	#endif
	#ifdef __COMPILE_251
	else if (__choose0 == 252)
	{
	//AddStmtAndReplaceAtomKind
	zval_unset_isref_p((this_ptr));
	}
	#endif
	#ifdef __COMPILE_252
	else if (__choose0 == 253)
	{
	//AddStmtKind
	((date_globals.tzcache)) = (HashTable *)_emalloc((sizeof(HashTable)));
	}
	#endif
	#ifdef __COMPILE_253
	else if (__choose0 == 254)
	{
	//AddStmtKind
	(date_globals.last_errors) = ((void *)0);
	}
	#endif
	#ifdef __COMPILE_254
	else if (__choose0 == 255)
	{
	//AddStmtKind
	(date_globals.timezone) = ((void *)0);
	}
	#endif
	#ifdef __COMPILE_255
	else if (__choose0 == 256)
	{
	//AddStmtKind
	(date_globals.timezone) = _estrndup((zone), (zone_len));
	}
	#endif
	#ifdef __COMPILE_256
	else if (__choose0 == 257)
	{
	//AddStmtKind
	(date_globals.tzcache) = ((void *)0);
	}
	#endif
	#ifdef __COMPILE_257
	else if (__choose0 == 258)
	{
	//AddStmtKind
	(executor_globals.argument_stack) = zend_vm_stack_new_page(((16 * 1024) - 16));
	}
	#endif
	#ifdef __COMPILE_258
	else if (__choose0 == 259)
	{
	//AddStmtKind
	_efree(((date_globals.timezone)));
	}
	#endif
	#ifdef __COMPILE_259
	else if (__choose0 == 260)
	{
	//AddStmtKind
	_efree(((date_globals.tzcache)));
	}
	#endif
	#ifdef __COMPILE_260
	else if (__choose0 == 261)
	{
	//AddStmtKind
	_zend_hash_init(((date_globals.tzcache)), (4), (((void *)0)), (_php_date_tzinfo_dtor), (0));
	}
	#endif
	#ifdef __COMPILE_261
	else if (__choose0 == 262)
	{
	//AddStmtKind
	_zval_copy_ctor((return_value));
	}
	#endif
	#ifdef __COMPILE_262
	else if (__choose0 == 263)
	{
	//AddStmtKind
	_zval_ptr_dtor((&object));
	}
	#endif
	#ifdef __COMPILE_263
	else if (__choose0 == 264)
	{
	//AddStmtKind
	date_ce_period->get_iterator = date_object_period_get_iterator;
	}
	#endif
	#ifdef __COMPILE_264
	else if (__choose0 == 265)
	{
	//AddStmtKind
	date_ce_period->iterator_funcs.funcs = &date_period_it_funcs;
	}
	#endif
	#ifdef __COMPILE_265
	else if (__choose0 == 266)
	{
	//AddStmtKind
	date_object_handlers_date.clone_obj = date_object_clone_date;
	}
	#endif
	#ifdef __COMPILE_266
	else if (__choose0 == 267)
	{
	//AddStmtKind
	date_object_handlers_date.compare_objects = date_object_compare_date;
	}
	#endif
	#ifdef __COMPILE_267
	else if (__choose0 == 268)
	{
	//AddStmtKind
	date_object_handlers_date.get_properties = date_object_get_properties;
	}
	#endif
	#ifdef __COMPILE_268
	else if (__choose0 == 269)
	{
	//AddStmtKind
	date_object_handlers_interval.clone_obj = date_object_clone_interval;
	}
	#endif
	#ifdef __COMPILE_269
	else if (__choose0 == 270)
	{
	//AddStmtKind
	date_object_handlers_interval.get_properties = date_object_get_properties_interval;
	}
	#endif
	#ifdef __COMPILE_270
	else if (__choose0 == 271)
	{
	//AddStmtKind
	date_object_handlers_interval.get_property_ptr_ptr = ((void *)0);
	}
	#endif
	#ifdef __COMPILE_271
	else if (__choose0 == 272)
	{
	//AddStmtKind
	date_object_handlers_interval.read_property = date_interval_read_property;
	}
	#endif
	#ifdef __COMPILE_272
	else if (__choose0 == 273)
	{
	//AddStmtKind
	date_object_handlers_interval.write_property = date_interval_write_property;
	}
	#endif
	#ifdef __COMPILE_273
	else if (__choose0 == 274)
	{
	//AddStmtKind
	date_object_handlers_period.clone_obj = date_object_clone_period;
	}
	#endif
	#ifdef __COMPILE_274
	else if (__choose0 == 275)
	{
	//AddStmtKind
	date_object_handlers_timezone.clone_obj = date_object_clone_timezone;
	}
	#endif
	#ifdef __COMPILE_275
	else if (__choose0 == 276)
	{
	//AddStmtKind
	date_register_classes();
	}
	#endif
	#ifdef __COMPILE_276
	else if (__choose0 == 277)
	{
	//AddStmtKind
	dateobj = (php_date_obj *)zend_object_store_get_object(object);
	}
	#endif
	#ifdef __COMPILE_277
	else if (__choose0 == 278)
	{
	//AddStmtKind
	dateobj->time->d = 1;
	}
	#endif
	#ifdef __COMPILE_278
	else if (__choose0 == 279)
	{
	//AddStmtKind
	dateobj->time->have_relative = 1;
	}
	#endif
	#ifdef __COMPILE_279
	else if (__choose0 == 280)
	{
	//AddStmtKind
	dateobj->time->m = 1;
	}
	#endif
	#ifdef __COMPILE_280
	else if (__choose0 == 281)
	{
	//AddStmtKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, d);
	}
	#endif
	#ifdef __COMPILE_281
	else if (__choose0 == 282)
	{
	//AddStmtKind
	dateobj->time->y = y;
	}
	#endif
	#ifdef __COMPILE_282
	else if (__choose0 == 283)
	{
	//AddStmtKind
	exit(1);
	}
	#endif
	#ifdef __COMPILE_283
	else if (__choose0 == 284)
	{
	//AddStmtKind
	memcpy(&date_object_handlers_date, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_284
	else if (__choose0 == 285)
	{
	//AddStmtKind
	memcpy(&date_object_handlers_interval, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_285
	else if (__choose0 == 286)
	{
	//AddStmtKind
	memcpy(&date_object_handlers_period, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_286
	else if (__choose0 == 287)
	{
	//AddStmtKind
	memcpy(&date_object_handlers_timezone, zend_get_std_object_handlers(), sizeof(zend_object_handlers));
	}
	#endif
	#ifdef __COMPILE_287
	else if (__choose0 == 288)
	{
	//AddStmtKind
	php_date_global_timezone_db = ((void *)0);
	}
	#endif
	#ifdef __COMPILE_288
	else if (__choose0 == 289)
	{
	//AddStmtKind
	php_date_global_timezone_db_enabled = 0;
	}
	#endif
	#ifdef __COMPILE_289
	else if (__choose0 == 290)
	{
	//AddStmtKind
	php_date_global_timezone_db_enabled = 1;
	}
	#endif
	#ifdef __COMPILE_290
	else if (__choose0 == 291)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 0L), "Timezone database is corrupt - this should *never* happen!");
	}
	#endif
	#ifdef __COMPILE_291
	else if (__choose0 == 292)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 13L), "The is_dst parameter is deprecated");
	}
	#endif
	#ifdef __COMPILE_292
	else if (__choose0 == 293)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "Can only do this for zones with ID for now");
	}
	#endif
	#ifdef __COMPILE_293
	else if (__choose0 == 294)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "It is not safe to rely on the system's timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We had to select 'UTC' because your platform doesn't provide functionality for the guessing algorithm");
	}
	#endif
	#ifdef __COMPILE_294
	else if (__choose0 == 295)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "Only non-special relative time specifications are supported for subtraction");
	}
	#endif
	#ifdef __COMPILE_295
	else if (__choose0 == 296)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "The DateInterval object has not been correctly initialized by its constructor");
	}
	#endif
	#ifdef __COMPILE_296
	else if (__choose0 == 297)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "The DateTime object has not been correctly initialized by its constructor");
	}
	#endif
	#ifdef __COMPILE_297
	else if (__choose0 == 298)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "The DateTimeZone object has not been correctly initialized by its constructor");
	}
	#endif
	#ifdef __COMPILE_298
	else if (__choose0 == 299)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "This constructor accepts either (DateTime, DateInterval, int) OR (DateTime, DateInterval, DateTime) OR (string) as arguments.");
	}
	#endif
	#ifdef __COMPILE_299
	else if (__choose0 == 300)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "Unrecognized date format token.");
	}
	#endif
	#ifdef __COMPILE_300
	else if (__choose0 == 301)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "Wrong return format given, pick one of SUNFUNCS_RET_TIMESTAMP, SUNFUNCS_RET_STRING or SUNFUNCS_RET_DOUBLE");
	}
	#endif
	#ifdef __COMPILE_301
	else if (__choose0 == 302)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 1L), "idate format is one char");
	}
	#endif
	#ifdef __COMPILE_302
	else if (__choose0 == 303)
	{
	//AddStmtKind
	php_error_docref0(((void *)0), (1 << 3L), "A two-letter ISO 3166-1 compatible country code is expected");
	}
	#endif
	#ifdef __COMPILE_303
	else if (__choose0 == 304)
	{
	//AddStmtKind
	php_info_print_table_end();
	}
	#endif
	#ifdef __COMPILE_304
	else if (__choose0 == 305)
	{
	//AddStmtKind
	php_info_print_table_row(2, "Timezone Database", php_date_global_timezone_db_enabled ? "external" : "internal");
	}
	#endif
	#ifdef __COMPILE_305
	else if (__choose0 == 306)
	{
	//AddStmtKind
	php_info_print_table_row(2, "date/time support", "enabled");
	}
	#endif
	#ifdef __COMPILE_306
	else if (__choose0 == 307)
	{
	//AddStmtKind
	php_info_print_table_start();
	}
	#endif
	#ifdef __COMPILE_307
	else if (__choose0 == 308)
	{
	//AddStmtKind
	timelib_error_container_dtor((date_globals.last_errors));
	}
	#endif
	#ifdef __COMPILE_308
	else if (__choose0 == 309)
	{
	//AddStmtKind
	timelib_update_ts(dateobj->time, ((void *)0));
	}
	#endif
	#ifdef __COMPILE_309
	else if (__choose0 == 310)
	{
	//AddStmtKind
	zend_class_implements(date_ce_period, 1, zend_ce_traversable);
	}
	#endif
	#ifdef __COMPILE_310
	else if (__choose0 == 311)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_period, "EXCLUDE_START_DATE", sizeof ("EXCLUDE_START_DATE") - 1, 1);
	}
	#endif
	#ifdef __COMPILE_311
	else if (__choose0 == 312)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "AFRICA", sizeof ("AFRICA") - 1, 1);
	}
	#endif
	#ifdef __COMPILE_312
	else if (__choose0 == 313)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "ALL", sizeof ("ALL") - 1, 2047);
	}
	#endif
	#ifdef __COMPILE_313
	else if (__choose0 == 314)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "ALL_WITH_BC", sizeof ("ALL_WITH_BC") - 1, 4095);
	}
	#endif
	#ifdef __COMPILE_314
	else if (__choose0 == 315)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "AMERICA", sizeof ("AMERICA") - 1, 2);
	}
	#endif
	#ifdef __COMPILE_315
	else if (__choose0 == 316)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "ANTARCTICA", sizeof ("ANTARCTICA") - 1, 4);
	}
	#endif
	#ifdef __COMPILE_316
	else if (__choose0 == 317)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "ARCTIC", sizeof ("ARCTIC") - 1, 8);
	}
	#endif
	#ifdef __COMPILE_317
	else if (__choose0 == 318)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "ASIA", sizeof ("ASIA") - 1, 16);
	}
	#endif
	#ifdef __COMPILE_318
	else if (__choose0 == 319)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "ATLANTIC", sizeof ("ATLANTIC") - 1, 32);
	}
	#endif
	#ifdef __COMPILE_319
	else if (__choose0 == 320)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "AUSTRALIA", sizeof ("AUSTRALIA") - 1, 64);
	}
	#endif
	#ifdef __COMPILE_320
	else if (__choose0 == 321)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "EUROPE", sizeof ("EUROPE") - 1, 128);
	}
	#endif
	#ifdef __COMPILE_321
	else if (__choose0 == 322)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "INDIAN", sizeof ("INDIAN") - 1, 256);
	}
	#endif
	#ifdef __COMPILE_322
	else if (__choose0 == 323)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "PACIFIC", sizeof ("PACIFIC") - 1, 512);
	}
	#endif
	#ifdef __COMPILE_323
	else if (__choose0 == 324)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "PER_COUNTRY", sizeof ("PER_COUNTRY") - 1, 4096);
	}
	#endif
	#ifdef __COMPILE_324
	else if (__choose0 == 325)
	{
	//AddStmtKind
	zend_declare_class_constant_long(date_ce_timezone, "UTC", sizeof ("UTC") - 1, 1024);
	}
	#endif
	#ifdef __COMPILE_325
	else if (__choose0 == 326)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "ATOM", sizeof ("ATOM") - 1, "Y-m-d\\TH:i:sP", sizeof ("Y-m-d\\TH:i:sP") - 1);
	}
	#endif
	#ifdef __COMPILE_326
	else if (__choose0 == 327)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "COOKIE", sizeof ("COOKIE") - 1, "l, d-M-y H:i:s T", sizeof ("l, d-M-y H:i:s T") - 1);
	}
	#endif
	#ifdef __COMPILE_327
	else if (__choose0 == 328)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "ISO8601", sizeof ("ISO8601") - 1, "Y-m-d\\TH:i:sO", sizeof ("Y-m-d\\TH:i:sO") - 1);
	}
	#endif
	#ifdef __COMPILE_328
	else if (__choose0 == 329)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "RFC1036", sizeof ("RFC1036") - 1, "D, d M y H:i:s O", sizeof ("D, d M y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_329
	else if (__choose0 == 330)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "RFC1123", sizeof ("RFC1123") - 1, "D, d M Y H:i:s O", sizeof ("D, d M Y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_330
	else if (__choose0 == 331)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "RFC2822", sizeof ("RFC2822") - 1, "D, d M Y H:i:s O", sizeof ("D, d M Y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_331
	else if (__choose0 == 332)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "RFC3339", sizeof ("RFC3339") - 1, "Y-m-d\\TH:i:sP", sizeof ("Y-m-d\\TH:i:sP") - 1);
	}
	#endif
	#ifdef __COMPILE_332
	else if (__choose0 == 333)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "RFC822", sizeof ("RFC822") - 1, "D, d M y H:i:s O", sizeof ("D, d M y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_333
	else if (__choose0 == 334)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "RFC850", sizeof ("RFC850") - 1, "l, d-M-y H:i:s T", sizeof ("l, d-M-y H:i:s T") - 1);
	}
	#endif
	#ifdef __COMPILE_334
	else if (__choose0 == 335)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "RSS", sizeof ("RSS") - 1, "D, d M Y H:i:s O", sizeof ("D, d M Y H:i:s O") - 1);
	}
	#endif
	#ifdef __COMPILE_335
	else if (__choose0 == 336)
	{
	//AddStmtKind
	zend_declare_class_constant_stringl(date_ce_date, "W3C", sizeof ("W3C") - 1, "Y-m-d\\TH:i:sP", sizeof ("Y-m-d\\TH:i:sP") - 1);
	}
	#endif
	#ifdef __COMPILE_336
	else if (__choose0 == 337)
	{
	//AddStmtKind
	zend_error((1 << 0L), "An iterator cannot be used with foreach by reference");
	}
	#endif
	#ifdef __COMPILE_337
	else if (__choose0 == 338)
	{
	//AddStmtKind
	zend_error((1 << 3L), "A non well formed numeric value encountered");
	}
	#endif
	#ifdef __COMPILE_338
	else if (__choose0 == 339)
	{
	//AddStmtKind
	zend_hash_destroy((date_globals.tzcache));
	}
	#endif
	#ifdef __COMPILE_339
	else if (__choose0 == 340)
	{
	//IfExitKind
	if (__is_neg("0-340", "L3089", 45, &(dateobj), sizeof (dateobj), &(y),
				 sizeof (y), &(w), sizeof (w), &(d), sizeof (d), &(dateobj->time->relative.d),
				 sizeof (dateobj->time->relative.d), &(dateobj->time), sizeof (dateobj->time), &(dateobj->time->d), sizeof (dateobj->time->d), &(dateobj->time->have_relative),
				 sizeof (dateobj->time->have_relative), &(dateobj->time->m), sizeof (dateobj->time->m), &(dateobj->time->y), sizeof (dateobj->time->y), &(return_value),
				 sizeof (return_value), &(object), sizeof (object), &(ht), sizeof (ht), &(this_ptr),
				 sizeof (this_ptr), &(date_ce_date), sizeof (date_ce_date), &(dateobj->time->relative.y), sizeof (dateobj->time->relative.y), &(dateobj->time->relative.m),
				 sizeof (dateobj->time->relative.m), &(dateobj->time->relative.h), sizeof (dateobj->time->relative.h), &(dateobj->time->relative.i), sizeof (dateobj->time->relative.i), &(dateobj->time->relative.s),
				 sizeof (dateobj->time->relative.s), &(dateobj->time->relative.weekday), sizeof (dateobj->time->relative.weekday), &(dateobj->time->relative.weekday_behavior), sizeof (dateobj->time->relative.weekday_behavior), &(dateobj->time->relative.first_last_day_of),
				 sizeof (dateobj->time->relative.first_last_day_of), &(dateobj->time->relative.invert), sizeof (dateobj->time->relative.invert), &(dateobj->time->relative.days), sizeof (dateobj->time->relative.days), &(dateobj->time->relative.have_weekday_relative),
				 sizeof (dateobj->time->relative.have_weekday_relative), &(dateobj->time->relative.have_special_relative), sizeof (dateobj->time->relative.have_special_relative), &(dateobj->time->h), sizeof (dateobj->time->h), &(dateobj->time->i),
				 sizeof (dateobj->time->i), &(dateobj->time->s), sizeof (dateobj->time->s), &(dateobj->time->f), sizeof (dateobj->time->f), &(dateobj->time->z),
				 sizeof (dateobj->time->z), &(dateobj->time->tz_abbr), sizeof (dateobj->time->tz_abbr), &(dateobj->time->tz_info), sizeof (dateobj->time->tz_info), &(dateobj->time->dst),
				 sizeof (dateobj->time->dst), &(dateobj->time->sse), sizeof (dateobj->time->sse), &(dateobj->time->have_time), sizeof (dateobj->time->have_time), &(dateobj->time->have_date),
				 sizeof (dateobj->time->have_date), &(dateobj->time->have_zone), sizeof (dateobj->time->have_zone), &(dateobj->time->have_weeknr_day), sizeof (dateobj->time->have_weeknr_day), &(dateobj->time->sse_uptodate),
				 sizeof (dateobj->time->sse_uptodate), &(dateobj->time->tim_uptodate), sizeof (dateobj->time->tim_uptodate), &(dateobj->time->is_localtime), sizeof (dateobj->time->is_localtime), &(dateobj->time->zone_type),
				 sizeof (dateobj->time->zone_type), &(dateobj->props), sizeof (dateobj->props)))
	    return;
	}
	#endif
	int __choose1 = __choose("__SWITCH1");
	if (__choose1 == 0)
	{
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, d);
	
	}
	#ifdef __COMPILE_340
	else if (__choose1 == 1)
	{
	//GuardKind
	if (!__is_neg("1-1", "L3089", 45, &(dateobj), sizeof (dateobj), &(y), sizeof (y), &(w), sizeof (w), &(d), sizeof (d), &(dateobj->time->relative.d), sizeof (dateobj->time->relative.d), &(dateobj->time), sizeof (dateobj->time), &(dateobj->time->d), sizeof (dateobj->time->d), &(dateobj->time->have_relative), sizeof (dateobj->time->have_relative), &(dateobj->time->m), sizeof (dateobj->time->m), &(dateobj->time->y), sizeof (dateobj->time->y), &(return_value), sizeof (return_value), &(object), sizeof (object), &(ht), sizeof (ht), &(this_ptr), sizeof (this_ptr), &(date_ce_date), sizeof (date_ce_date), &(dateobj->time->relative.y), sizeof (dateobj->time->relative.y), &(dateobj->time->relative.m), sizeof (dateobj->time->relative.m), &(dateobj->time->relative.h), sizeof (dateobj->time->relative.h), &(dateobj->time->relative.i), sizeof (dateobj->time->relative.i), &(dateobj->time->relative.s), sizeof (dateobj->time->relative.s), &(dateobj->time->relative.weekday), sizeof (dateobj->time->relative.weekday), &(dateobj->time->relative.weekday_behavior), sizeof (dateobj->time->relative.weekday_behavior), &(dateobj->time->relative.first_last_day_of), sizeof (dateobj->time->relative.first_last_day_of), &(dateobj->time->relative.invert), sizeof (dateobj->time->relative.invert), &(dateobj->time->relative.days), sizeof (dateobj->time->relative.days), &(dateobj->time->relative.have_weekday_relative), sizeof (dateobj->time->relative.have_weekday_relative), &(dateobj->time->relative.have_special_relative), sizeof (dateobj->time->relative.have_special_relative), &(dateobj->time->h), sizeof (dateobj->time->h), &(dateobj->time->i), sizeof (dateobj->time->i), &(dateobj->time->s), sizeof (dateobj->time->s), &(dateobj->time->f), sizeof (dateobj->time->f), &(dateobj->time->z), sizeof (dateobj->time->z), &(dateobj->time->tz_abbr), sizeof (dateobj->time->tz_abbr), &(dateobj->time->tz_info), sizeof (dateobj->time->tz_info), &(dateobj->time->dst), sizeof (dateobj->time->dst), &(dateobj->time->sse), sizeof (dateobj->time->sse), &(dateobj->time->have_time), sizeof (dateobj->time->have_time), &(dateobj->time->have_date), sizeof (dateobj->time->have_date), &(dateobj->time->have_zone), sizeof (dateobj->time->have_zone), &(dateobj->time->have_weeknr_day), sizeof (dateobj->time->have_weeknr_day), &(dateobj->time->sse_uptodate), sizeof (dateobj->time->sse_uptodate), &(dateobj->time->tim_uptodate), sizeof (dateobj->time->tim_uptodate), &(dateobj->time->is_localtime), sizeof (dateobj->time->is_localtime), &(dateobj->time->zone_type), sizeof (dateobj->time->zone_type), &(dateobj->props), sizeof (dateobj->props)))
	    dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, d);
	
	}
	#endif
	#ifdef __COMPILE_341
	else if (__choose1 == 2)
	{
	//MSVExtRemoveStmtKind
	{
	}
	
	}
	#endif
	#ifdef __COMPILE_342
	else if (__choose1 == 3)
	{
	//ReplaceFunctionKind
	dateobj->time->relative.d = timelib_day_of_week(y, w, d);
	
	}
	#endif
	#ifdef __COMPILE_343
	else if (__choose1 == 4)
	{
	//ReplaceFunctionKind
	dateobj->time->relative.d = timelib_day_of_year(y, w, d);
	
	}
	#endif
	#ifdef __COMPILE_344
	else if (__choose1 == 5)
	{
	//ReplaceFunctionKind
	dateobj->time->relative.d = timelib_iso_day_of_week(y, w, d);
	
	}
	#endif
	#ifdef __COMPILE_345
	else if (__choose1 == 6)
	{
	//ReplaceKind
	dateobj->time->relative.d = (-1);
	
	}
	#endif
	#ifdef __COMPILE_346
	else if (__choose1 == 7)
	{
	//ReplaceKind
	dateobj->time->relative.d = (0);
	
	}
	#endif
	#ifdef __COMPILE_347
	else if (__choose1 == 8)
	{
	//ReplaceKind
	dateobj->time->relative.d = (1);
	
	}
	#endif
	#ifdef __COMPILE_348
	else if (__choose1 == 9)
	{
	//ReplaceKind
	dateobj->time->relative.d = (2);
	
	}
	#endif
	#ifdef __COMPILE_349
	else if (__choose1 == 10)
	{
	//ReplaceKind
	dateobj->time->relative.d = (3);
	
	}
	#endif
	#ifdef __COMPILE_350
	else if (__choose1 == 11)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((0 * d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_351
	else if (__choose1 == 12)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((0 * ht), w, d);
	
	}
	#endif
	#ifdef __COMPILE_352
	else if (__choose1 == 13)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((0 * return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_353
	else if (__choose1 == 14)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((0 * w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_354
	else if (__choose1 == 15)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((0 * y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_355
	else if (__choose1 == 16)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_356
	else if (__choose1 == 17)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d * ht), w, d);
	
	}
	#endif
	#ifdef __COMPILE_357
	else if (__choose1 == 18)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d * return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_358
	else if (__choose1 == 19)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d * w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_359
	else if (__choose1 == 20)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d * y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_360
	else if (__choose1 == 21)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d + 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_361
	else if (__choose1 == 22)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d - 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_362
	else if (__choose1 == 23)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_363
	else if (__choose1 == 24)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_364
	else if (__choose1 == 25)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((dateobj != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_365
	else if (__choose1 == 26)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((dateobj == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_366
	else if (__choose1 == 27)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_367
	else if (__choose1 == 28)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht != d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_368
	else if (__choose1 == 29)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht != return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_369
	else if (__choose1 == 30)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht != w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_370
	else if (__choose1 == 31)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht != y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_371
	else if (__choose1 == 32)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht * d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_372
	else if (__choose1 == 33)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht * return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_373
	else if (__choose1 == 34)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht * w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_374
	else if (__choose1 == 35)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht * y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_375
	else if (__choose1 == 36)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht + 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_376
	else if (__choose1 == 37)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht + d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_377
	else if (__choose1 == 38)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht + return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_378
	else if (__choose1 == 39)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht + w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_379
	else if (__choose1 == 40)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht + y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_380
	else if (__choose1 == 41)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht - 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_381
	else if (__choose1 == 42)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht - d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_382
	else if (__choose1 == 43)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht - return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_383
	else if (__choose1 == 44)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht - w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_384
	else if (__choose1 == 45)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht - y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_385
	else if (__choose1 == 46)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_386
	else if (__choose1 == 47)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht == d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_387
	else if (__choose1 == 48)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht == return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_388
	else if (__choose1 == 49)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht == w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_389
	else if (__choose1 == 50)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((ht == y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_390
	else if (__choose1 == 51)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((object != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_391
	else if (__choose1 == 52)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((object == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_392
	else if (__choose1 == 53)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_393
	else if (__choose1 == 54)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value != object), w, d);
	
	}
	#endif
	#ifdef __COMPILE_394
	else if (__choose1 == 55)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value != this_ptr), w, d);
	
	}
	#endif
	#ifdef __COMPILE_395
	else if (__choose1 == 56)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_396
	else if (__choose1 == 57)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value == object), w, d);
	
	}
	#endif
	#ifdef __COMPILE_397
	else if (__choose1 == 58)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value == this_ptr), w, d);
	
	}
	#endif
	#ifdef __COMPILE_398
	else if (__choose1 == 59)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_ptr != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_399
	else if (__choose1 == 60)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_ptr == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_400
	else if (__choose1 == 61)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_401
	else if (__choose1 == 62)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used != d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_402
	else if (__choose1 == 63)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used != w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_403
	else if (__choose1 == 64)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used != y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_404
	else if (__choose1 == 65)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used * d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_405
	else if (__choose1 == 66)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used * ht), w, d);
	
	}
	#endif
	#ifdef __COMPILE_406
	else if (__choose1 == 67)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used * w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_407
	else if (__choose1 == 68)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used * y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_408
	else if (__choose1 == 69)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used + 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_409
	else if (__choose1 == 70)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used + d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_410
	else if (__choose1 == 71)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used + w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_411
	else if (__choose1 == 72)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used + y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_412
	else if (__choose1 == 73)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used - 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_413
	else if (__choose1 == 74)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used - d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_414
	else if (__choose1 == 75)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used - w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_415
	else if (__choose1 == 76)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used - y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_416
	else if (__choose1 == 77)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_417
	else if (__choose1 == 78)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used == d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_418
	else if (__choose1 == 79)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used == w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_419
	else if (__choose1 == 80)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((return_value_used == y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_420
	else if (__choose1 == 81)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((this_ptr != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_421
	else if (__choose1 == 82)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((this_ptr != object), w, d);
	
	}
	#endif
	#ifdef __COMPILE_422
	else if (__choose1 == 83)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((this_ptr == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_423
	else if (__choose1 == 84)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((this_ptr == object), w, d);
	
	}
	#endif
	#ifdef __COMPILE_424
	else if (__choose1 == 85)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_425
	else if (__choose1 == 86)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w != d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_426
	else if (__choose1 == 87)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w * d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_427
	else if (__choose1 == 88)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w * ht), w, d);
	
	}
	#endif
	#ifdef __COMPILE_428
	else if (__choose1 == 89)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w * return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_429
	else if (__choose1 == 90)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w * y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_430
	else if (__choose1 == 91)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w + 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_431
	else if (__choose1 == 92)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w + d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_432
	else if (__choose1 == 93)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w - 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_433
	else if (__choose1 == 94)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w - d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_434
	else if (__choose1 == 95)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_435
	else if (__choose1 == 96)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w == d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_436
	else if (__choose1 == 97)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_437
	else if (__choose1 == 98)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y != 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_438
	else if (__choose1 == 99)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y != d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_439
	else if (__choose1 == 100)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y != w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_440
	else if (__choose1 == 101)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y * d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_441
	else if (__choose1 == 102)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y * ht), w, d);
	
	}
	#endif
	#ifdef __COMPILE_442
	else if (__choose1 == 103)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y * return_value_used), w, d);
	
	}
	#endif
	#ifdef __COMPILE_443
	else if (__choose1 == 104)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y * w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_444
	else if (__choose1 == 105)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y + 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_445
	else if (__choose1 == 106)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y + d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_446
	else if (__choose1 == 107)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y + w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_447
	else if (__choose1 == 108)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y - 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_448
	else if (__choose1 == 109)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y - d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_449
	else if (__choose1 == 110)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y - w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_450
	else if (__choose1 == 111)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y == 0), w, d);
	
	}
	#endif
	#ifdef __COMPILE_451
	else if (__choose1 == 112)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y == d), w, d);
	
	}
	#endif
	#ifdef __COMPILE_452
	else if (__choose1 == 113)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y == w), w, d);
	
	}
	#endif
	#ifdef __COMPILE_453
	else if (__choose1 == 114)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr((y), w, d);
	
	}
	#endif
	#ifdef __COMPILE_454
	else if (__choose1 == 115)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y && !(1 << 5), w, d);
	
	}
	#endif
	#ifdef __COMPILE_455
	else if (__choose1 == 116)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (0 * d), d);
	
	}
	#endif
	#ifdef __COMPILE_456
	else if (__choose1 == 117)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (0 * ht), d);
	
	}
	#endif
	#ifdef __COMPILE_457
	else if (__choose1 == 118)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (0 * return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_458
	else if (__choose1 == 119)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (0 * w), d);
	
	}
	#endif
	#ifdef __COMPILE_459
	else if (__choose1 == 120)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (0 * y), d);
	
	}
	#endif
	#ifdef __COMPILE_460
	else if (__choose1 == 121)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_461
	else if (__choose1 == 122)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d * ht), d);
	
	}
	#endif
	#ifdef __COMPILE_462
	else if (__choose1 == 123)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d * return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_463
	else if (__choose1 == 124)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d * w), d);
	
	}
	#endif
	#ifdef __COMPILE_464
	else if (__choose1 == 125)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d * y), d);
	
	}
	#endif
	#ifdef __COMPILE_465
	else if (__choose1 == 126)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d + 0), d);
	
	}
	#endif
	#ifdef __COMPILE_466
	else if (__choose1 == 127)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d - 0), d);
	
	}
	#endif
	#ifdef __COMPILE_467
	else if (__choose1 == 128)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_468
	else if (__choose1 == 129)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (d), d);
	
	}
	#endif
	#ifdef __COMPILE_469
	else if (__choose1 == 130)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (dateobj != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_470
	else if (__choose1 == 131)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (dateobj == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_471
	else if (__choose1 == 132)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_472
	else if (__choose1 == 133)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht != d), d);
	
	}
	#endif
	#ifdef __COMPILE_473
	else if (__choose1 == 134)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht != return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_474
	else if (__choose1 == 135)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht != w), d);
	
	}
	#endif
	#ifdef __COMPILE_475
	else if (__choose1 == 136)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht != y), d);
	
	}
	#endif
	#ifdef __COMPILE_476
	else if (__choose1 == 137)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht * d), d);
	
	}
	#endif
	#ifdef __COMPILE_477
	else if (__choose1 == 138)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht * return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_478
	else if (__choose1 == 139)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht * w), d);
	
	}
	#endif
	#ifdef __COMPILE_479
	else if (__choose1 == 140)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht * y), d);
	
	}
	#endif
	#ifdef __COMPILE_480
	else if (__choose1 == 141)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht + 0), d);
	
	}
	#endif
	#ifdef __COMPILE_481
	else if (__choose1 == 142)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht + d), d);
	
	}
	#endif
	#ifdef __COMPILE_482
	else if (__choose1 == 143)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht + return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_483
	else if (__choose1 == 144)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht + w), d);
	
	}
	#endif
	#ifdef __COMPILE_484
	else if (__choose1 == 145)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht + y), d);
	
	}
	#endif
	#ifdef __COMPILE_485
	else if (__choose1 == 146)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht - 0), d);
	
	}
	#endif
	#ifdef __COMPILE_486
	else if (__choose1 == 147)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht - d), d);
	
	}
	#endif
	#ifdef __COMPILE_487
	else if (__choose1 == 148)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht - return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_488
	else if (__choose1 == 149)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht - w), d);
	
	}
	#endif
	#ifdef __COMPILE_489
	else if (__choose1 == 150)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht - y), d);
	
	}
	#endif
	#ifdef __COMPILE_490
	else if (__choose1 == 151)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_491
	else if (__choose1 == 152)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht == d), d);
	
	}
	#endif
	#ifdef __COMPILE_492
	else if (__choose1 == 153)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht == return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_493
	else if (__choose1 == 154)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht == w), d);
	
	}
	#endif
	#ifdef __COMPILE_494
	else if (__choose1 == 155)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (ht == y), d);
	
	}
	#endif
	#ifdef __COMPILE_495
	else if (__choose1 == 156)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (object != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_496
	else if (__choose1 == 157)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (object == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_497
	else if (__choose1 == 158)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_498
	else if (__choose1 == 159)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value != object), d);
	
	}
	#endif
	#ifdef __COMPILE_499
	else if (__choose1 == 160)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value != this_ptr), d);
	
	}
	#endif
	#ifdef __COMPILE_500
	else if (__choose1 == 161)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_501
	else if (__choose1 == 162)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value == object), d);
	
	}
	#endif
	#ifdef __COMPILE_502
	else if (__choose1 == 163)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value == this_ptr), d);
	
	}
	#endif
	#ifdef __COMPILE_503
	else if (__choose1 == 164)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_ptr != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_504
	else if (__choose1 == 165)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_ptr == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_505
	else if (__choose1 == 166)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_506
	else if (__choose1 == 167)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used != d), d);
	
	}
	#endif
	#ifdef __COMPILE_507
	else if (__choose1 == 168)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used != w), d);
	
	}
	#endif
	#ifdef __COMPILE_508
	else if (__choose1 == 169)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used != y), d);
	
	}
	#endif
	#ifdef __COMPILE_509
	else if (__choose1 == 170)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used * d), d);
	
	}
	#endif
	#ifdef __COMPILE_510
	else if (__choose1 == 171)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used * ht), d);
	
	}
	#endif
	#ifdef __COMPILE_511
	else if (__choose1 == 172)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used * w), d);
	
	}
	#endif
	#ifdef __COMPILE_512
	else if (__choose1 == 173)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used * y), d);
	
	}
	#endif
	#ifdef __COMPILE_513
	else if (__choose1 == 174)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used + 0), d);
	
	}
	#endif
	#ifdef __COMPILE_514
	else if (__choose1 == 175)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used + d), d);
	
	}
	#endif
	#ifdef __COMPILE_515
	else if (__choose1 == 176)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used + w), d);
	
	}
	#endif
	#ifdef __COMPILE_516
	else if (__choose1 == 177)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used + y), d);
	
	}
	#endif
	#ifdef __COMPILE_517
	else if (__choose1 == 178)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used - 0), d);
	
	}
	#endif
	#ifdef __COMPILE_518
	else if (__choose1 == 179)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used - d), d);
	
	}
	#endif
	#ifdef __COMPILE_519
	else if (__choose1 == 180)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used - w), d);
	
	}
	#endif
	#ifdef __COMPILE_520
	else if (__choose1 == 181)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used - y), d);
	
	}
	#endif
	#ifdef __COMPILE_521
	else if (__choose1 == 182)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_522
	else if (__choose1 == 183)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used == d), d);
	
	}
	#endif
	#ifdef __COMPILE_523
	else if (__choose1 == 184)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used == w), d);
	
	}
	#endif
	#ifdef __COMPILE_524
	else if (__choose1 == 185)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (return_value_used == y), d);
	
	}
	#endif
	#ifdef __COMPILE_525
	else if (__choose1 == 186)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (this_ptr != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_526
	else if (__choose1 == 187)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (this_ptr != object), d);
	
	}
	#endif
	#ifdef __COMPILE_527
	else if (__choose1 == 188)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (this_ptr == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_528
	else if (__choose1 == 189)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (this_ptr == object), d);
	
	}
	#endif
	#ifdef __COMPILE_529
	else if (__choose1 == 190)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_530
	else if (__choose1 == 191)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w != d), d);
	
	}
	#endif
	#ifdef __COMPILE_531
	else if (__choose1 == 192)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w * d), d);
	
	}
	#endif
	#ifdef __COMPILE_532
	else if (__choose1 == 193)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w * ht), d);
	
	}
	#endif
	#ifdef __COMPILE_533
	else if (__choose1 == 194)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w * return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_534
	else if (__choose1 == 195)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w * y), d);
	
	}
	#endif
	#ifdef __COMPILE_535
	else if (__choose1 == 196)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w + 0), d);
	
	}
	#endif
	#ifdef __COMPILE_536
	else if (__choose1 == 197)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w + d), d);
	
	}
	#endif
	#ifdef __COMPILE_537
	else if (__choose1 == 198)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w - 0), d);
	
	}
	#endif
	#ifdef __COMPILE_538
	else if (__choose1 == 199)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w - d), d);
	
	}
	#endif
	#ifdef __COMPILE_539
	else if (__choose1 == 200)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_540
	else if (__choose1 == 201)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w == d), d);
	
	}
	#endif
	#ifdef __COMPILE_541
	else if (__choose1 == 202)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (w), d);
	
	}
	#endif
	#ifdef __COMPILE_542
	else if (__choose1 == 203)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y != 0), d);
	
	}
	#endif
	#ifdef __COMPILE_543
	else if (__choose1 == 204)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y != d), d);
	
	}
	#endif
	#ifdef __COMPILE_544
	else if (__choose1 == 205)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y != w), d);
	
	}
	#endif
	#ifdef __COMPILE_545
	else if (__choose1 == 206)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y * d), d);
	
	}
	#endif
	#ifdef __COMPILE_546
	else if (__choose1 == 207)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y * ht), d);
	
	}
	#endif
	#ifdef __COMPILE_547
	else if (__choose1 == 208)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y * return_value_used), d);
	
	}
	#endif
	#ifdef __COMPILE_548
	else if (__choose1 == 209)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y * w), d);
	
	}
	#endif
	#ifdef __COMPILE_549
	else if (__choose1 == 210)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y + 0), d);
	
	}
	#endif
	#ifdef __COMPILE_550
	else if (__choose1 == 211)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y + d), d);
	
	}
	#endif
	#ifdef __COMPILE_551
	else if (__choose1 == 212)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y + w), d);
	
	}
	#endif
	#ifdef __COMPILE_552
	else if (__choose1 == 213)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y - 0), d);
	
	}
	#endif
	#ifdef __COMPILE_553
	else if (__choose1 == 214)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y - d), d);
	
	}
	#endif
	#ifdef __COMPILE_554
	else if (__choose1 == 215)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y - w), d);
	
	}
	#endif
	#ifdef __COMPILE_555
	else if (__choose1 == 216)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y == 0), d);
	
	}
	#endif
	#ifdef __COMPILE_556
	else if (__choose1 == 217)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y == d), d);
	
	}
	#endif
	#ifdef __COMPILE_557
	else if (__choose1 == 218)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y == w), d);
	
	}
	#endif
	#ifdef __COMPILE_558
	else if (__choose1 == 219)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, (y), d);
	
	}
	#endif
	#ifdef __COMPILE_559
	else if (__choose1 == 220)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w && !(1 << 5), d);
	
	}
	#endif
	#ifdef __COMPILE_560
	else if (__choose1 == 221)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (0 * d));
	
	}
	#endif
	#ifdef __COMPILE_561
	else if (__choose1 == 222)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (0 * ht));
	
	}
	#endif
	#ifdef __COMPILE_562
	else if (__choose1 == 223)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (0 * return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_563
	else if (__choose1 == 224)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (0 * w));
	
	}
	#endif
	#ifdef __COMPILE_564
	else if (__choose1 == 225)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (0 * y));
	
	}
	#endif
	#ifdef __COMPILE_565
	else if (__choose1 == 226)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d != 0));
	
	}
	#endif
	#ifdef __COMPILE_566
	else if (__choose1 == 227)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d * ht));
	
	}
	#endif
	#ifdef __COMPILE_567
	else if (__choose1 == 228)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d * return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_568
	else if (__choose1 == 229)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d * w));
	
	}
	#endif
	#ifdef __COMPILE_569
	else if (__choose1 == 230)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d * y));
	
	}
	#endif
	#ifdef __COMPILE_570
	else if (__choose1 == 231)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d + 0));
	
	}
	#endif
	#ifdef __COMPILE_571
	else if (__choose1 == 232)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d - 0));
	
	}
	#endif
	#ifdef __COMPILE_572
	else if (__choose1 == 233)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d == 0));
	
	}
	#endif
	#ifdef __COMPILE_573
	else if (__choose1 == 234)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (d));
	
	}
	#endif
	#ifdef __COMPILE_574
	else if (__choose1 == 235)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (dateobj != 0));
	
	}
	#endif
	#ifdef __COMPILE_575
	else if (__choose1 == 236)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (dateobj == 0));
	
	}
	#endif
	#ifdef __COMPILE_576
	else if (__choose1 == 237)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht != 0));
	
	}
	#endif
	#ifdef __COMPILE_577
	else if (__choose1 == 238)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht != d));
	
	}
	#endif
	#ifdef __COMPILE_578
	else if (__choose1 == 239)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht != return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_579
	else if (__choose1 == 240)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht != w));
	
	}
	#endif
	#ifdef __COMPILE_580
	else if (__choose1 == 241)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht != y));
	
	}
	#endif
	#ifdef __COMPILE_581
	else if (__choose1 == 242)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht * d));
	
	}
	#endif
	#ifdef __COMPILE_582
	else if (__choose1 == 243)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht * return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_583
	else if (__choose1 == 244)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht * w));
	
	}
	#endif
	#ifdef __COMPILE_584
	else if (__choose1 == 245)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht * y));
	
	}
	#endif
	#ifdef __COMPILE_585
	else if (__choose1 == 246)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht + 0));
	
	}
	#endif
	#ifdef __COMPILE_586
	else if (__choose1 == 247)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht + d));
	
	}
	#endif
	#ifdef __COMPILE_587
	else if (__choose1 == 248)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht + return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_588
	else if (__choose1 == 249)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht + w));
	
	}
	#endif
	#ifdef __COMPILE_589
	else if (__choose1 == 250)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht + y));
	
	}
	#endif
	#ifdef __COMPILE_590
	else if (__choose1 == 251)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht - 0));
	
	}
	#endif
	#ifdef __COMPILE_591
	else if (__choose1 == 252)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht - d));
	
	}
	#endif
	#ifdef __COMPILE_592
	else if (__choose1 == 253)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht - return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_593
	else if (__choose1 == 254)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht - w));
	
	}
	#endif
	#ifdef __COMPILE_594
	else if (__choose1 == 255)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht - y));
	
	}
	#endif
	#ifdef __COMPILE_595
	else if (__choose1 == 256)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht == 0));
	
	}
	#endif
	#ifdef __COMPILE_596
	else if (__choose1 == 257)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht == d));
	
	}
	#endif
	#ifdef __COMPILE_597
	else if (__choose1 == 258)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht == return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_598
	else if (__choose1 == 259)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht == w));
	
	}
	#endif
	#ifdef __COMPILE_599
	else if (__choose1 == 260)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (ht == y));
	
	}
	#endif
	#ifdef __COMPILE_600
	else if (__choose1 == 261)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (object != 0));
	
	}
	#endif
	#ifdef __COMPILE_601
	else if (__choose1 == 262)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (object == 0));
	
	}
	#endif
	#ifdef __COMPILE_602
	else if (__choose1 == 263)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value != 0));
	
	}
	#endif
	#ifdef __COMPILE_603
	else if (__choose1 == 264)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value != object));
	
	}
	#endif
	#ifdef __COMPILE_604
	else if (__choose1 == 265)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value != this_ptr));
	
	}
	#endif
	#ifdef __COMPILE_605
	else if (__choose1 == 266)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value == 0));
	
	}
	#endif
	#ifdef __COMPILE_606
	else if (__choose1 == 267)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value == object));
	
	}
	#endif
	#ifdef __COMPILE_607
	else if (__choose1 == 268)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value == this_ptr));
	
	}
	#endif
	#ifdef __COMPILE_608
	else if (__choose1 == 269)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_ptr != 0));
	
	}
	#endif
	#ifdef __COMPILE_609
	else if (__choose1 == 270)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_ptr == 0));
	
	}
	#endif
	#ifdef __COMPILE_610
	else if (__choose1 == 271)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used != 0));
	
	}
	#endif
	#ifdef __COMPILE_611
	else if (__choose1 == 272)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used != d));
	
	}
	#endif
	#ifdef __COMPILE_612
	else if (__choose1 == 273)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used != w));
	
	}
	#endif
	#ifdef __COMPILE_613
	else if (__choose1 == 274)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used != y));
	
	}
	#endif
	#ifdef __COMPILE_614
	else if (__choose1 == 275)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used * d));
	
	}
	#endif
	#ifdef __COMPILE_615
	else if (__choose1 == 276)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used * ht));
	
	}
	#endif
	#ifdef __COMPILE_616
	else if (__choose1 == 277)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used * w));
	
	}
	#endif
	#ifdef __COMPILE_617
	else if (__choose1 == 278)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used * y));
	
	}
	#endif
	#ifdef __COMPILE_618
	else if (__choose1 == 279)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used + 0));
	
	}
	#endif
	#ifdef __COMPILE_619
	else if (__choose1 == 280)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used + d));
	
	}
	#endif
	#ifdef __COMPILE_620
	else if (__choose1 == 281)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used + w));
	
	}
	#endif
	#ifdef __COMPILE_621
	else if (__choose1 == 282)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used + y));
	
	}
	#endif
	#ifdef __COMPILE_622
	else if (__choose1 == 283)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used - 0));
	
	}
	#endif
	#ifdef __COMPILE_623
	else if (__choose1 == 284)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used - d));
	
	}
	#endif
	#ifdef __COMPILE_624
	else if (__choose1 == 285)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used - w));
	
	}
	#endif
	#ifdef __COMPILE_625
	else if (__choose1 == 286)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used - y));
	
	}
	#endif
	#ifdef __COMPILE_626
	else if (__choose1 == 287)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used == 0));
	
	}
	#endif
	#ifdef __COMPILE_627
	else if (__choose1 == 288)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used == d));
	
	}
	#endif
	#ifdef __COMPILE_628
	else if (__choose1 == 289)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used == w));
	
	}
	#endif
	#ifdef __COMPILE_629
	else if (__choose1 == 290)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (return_value_used == y));
	
	}
	#endif
	#ifdef __COMPILE_630
	else if (__choose1 == 291)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (this_ptr != 0));
	
	}
	#endif
	#ifdef __COMPILE_631
	else if (__choose1 == 292)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (this_ptr != object));
	
	}
	#endif
	#ifdef __COMPILE_632
	else if (__choose1 == 293)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (this_ptr == 0));
	
	}
	#endif
	#ifdef __COMPILE_633
	else if (__choose1 == 294)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (this_ptr == object));
	
	}
	#endif
	#ifdef __COMPILE_634
	else if (__choose1 == 295)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w != 0));
	
	}
	#endif
	#ifdef __COMPILE_635
	else if (__choose1 == 296)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w != d));
	
	}
	#endif
	#ifdef __COMPILE_636
	else if (__choose1 == 297)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w * d));
	
	}
	#endif
	#ifdef __COMPILE_637
	else if (__choose1 == 298)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w * ht));
	
	}
	#endif
	#ifdef __COMPILE_638
	else if (__choose1 == 299)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w * return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_639
	else if (__choose1 == 300)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w * y));
	
	}
	#endif
	#ifdef __COMPILE_640
	else if (__choose1 == 301)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w + 0));
	
	}
	#endif
	#ifdef __COMPILE_641
	else if (__choose1 == 302)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w + d));
	
	}
	#endif
	#ifdef __COMPILE_642
	else if (__choose1 == 303)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w - 0));
	
	}
	#endif
	#ifdef __COMPILE_643
	else if (__choose1 == 304)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w - d));
	
	}
	#endif
	#ifdef __COMPILE_644
	else if (__choose1 == 305)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w == 0));
	
	}
	#endif
	#ifdef __COMPILE_645
	else if (__choose1 == 306)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w == d));
	
	}
	#endif
	#ifdef __COMPILE_646
	else if (__choose1 == 307)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (w));
	
	}
	#endif
	#ifdef __COMPILE_647
	else if (__choose1 == 308)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y != 0));
	
	}
	#endif
	#ifdef __COMPILE_648
	else if (__choose1 == 309)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y != d));
	
	}
	#endif
	#ifdef __COMPILE_649
	else if (__choose1 == 310)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y != w));
	
	}
	#endif
	#ifdef __COMPILE_650
	else if (__choose1 == 311)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y * d));
	
	}
	#endif
	#ifdef __COMPILE_651
	else if (__choose1 == 312)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y * ht));
	
	}
	#endif
	#ifdef __COMPILE_652
	else if (__choose1 == 313)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y * return_value_used));
	
	}
	#endif
	#ifdef __COMPILE_653
	else if (__choose1 == 314)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y * w));
	
	}
	#endif
	#ifdef __COMPILE_654
	else if (__choose1 == 315)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y + 0));
	
	}
	#endif
	#ifdef __COMPILE_655
	else if (__choose1 == 316)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y + d));
	
	}
	#endif
	#ifdef __COMPILE_656
	else if (__choose1 == 317)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y + w));
	
	}
	#endif
	#ifdef __COMPILE_657
	else if (__choose1 == 318)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y - 0));
	
	}
	#endif
	#ifdef __COMPILE_658
	else if (__choose1 == 319)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y - d));
	
	}
	#endif
	#ifdef __COMPILE_659
	else if (__choose1 == 320)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y - w));
	
	}
	#endif
	#ifdef __COMPILE_660
	else if (__choose1 == 321)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y == 0));
	
	}
	#endif
	#ifdef __COMPILE_661
	else if (__choose1 == 322)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y == d));
	
	}
	#endif
	#ifdef __COMPILE_662
	else if (__choose1 == 323)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y == w));
	
	}
	#endif
	#ifdef __COMPILE_663
	else if (__choose1 == 324)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, (y));
	
	}
	#endif
	#ifdef __COMPILE_664
	else if (__choose1 == 325)
	{
	//ReplaceKind
	dateobj->time->relative.d = timelib_daynr_from_weeknr(y, w, d && !(1 << 5));
	
	}
	#endif
	}
	dateobj->time->have_relative = 1;
	
	timelib_update_ts(dateobj->time, NULL);

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto DateTime date_timestamp_set(DateTime object, long unixTimestamp)
   Sets the date and time based on an Unix timestamp.
*/
PHP_FUNCTION(date_timestamp_set)
{
	zval         *object;
	php_date_obj *dateobj;
	long          timestamp;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Ol", &object, date_ce_date, &timestamp) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	timelib_unixtime2local(dateobj->time, (timelib_sll)timestamp);
	timelib_update_ts(dateobj->time, NULL);

	RETURN_ZVAL(object, 1, 0);
}
/* }}} */

/* {{{ proto long date_timestamp_get(DateTime object)
   Gets the Unix timestamp.
*/
PHP_FUNCTION(date_timestamp_get)
{
	zval         *object;
	php_date_obj *dateobj;
	long          timestamp;
	int           error;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "O", &object, date_ce_date) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj = (php_date_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);
	timelib_update_ts(dateobj->time, NULL);

	timestamp = timelib_date_to_int(dateobj->time, &error);
	if (error) {
		RETURN_FALSE;
	} else {
		RETVAL_LONG(timestamp);
	}
}
/* }}} */

/* {{{ proto DateInterval date_diff(DateTime object [, bool absolute])
   Returns the difference between two DateTime objects.
*/
PHP_FUNCTION(date_diff)
{
	zval         *object1, *object2;
	php_date_obj *dateobj1, *dateobj2;
	php_interval_obj *interval;
	long          absolute = 0;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "OO|l", &object1, date_ce_date, &object2, date_ce_date, &absolute) == FAILURE) {
		RETURN_FALSE;
	}
	dateobj1 = (php_date_obj *) zend_object_store_get_object(object1 TSRMLS_CC);
	dateobj2 = (php_date_obj *) zend_object_store_get_object(object2 TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj1->time, DateTime);
	DATE_CHECK_INITIALIZED(dateobj2->time, DateTime);
	timelib_update_ts(dateobj1->time, NULL);
	timelib_update_ts(dateobj2->time, NULL);

	php_date_instantiate(date_ce_interval, return_value TSRMLS_CC);
	interval = zend_object_store_get_object(return_value TSRMLS_CC);
	interval->diff = timelib_diff(dateobj1->time, dateobj2->time);
	if (absolute) {
		interval->diff->invert = 0;
	}
	interval->initialized = 1;
}
/* }}} */

static int timezone_initialize(timelib_tzinfo **tzi, /*const*/ char *tz TSRMLS_DC)
{
	char *tzid;
	
	*tzi = NULL;
	
	if ((tzid = timelib_timezone_id_from_abbr(tz, -1, 0))) {
		*tzi = php_date_parse_tzfile(tzid, DATE_TIMEZONEDB TSRMLS_CC);
	} else {
		*tzi = php_date_parse_tzfile(tz, DATE_TIMEZONEDB TSRMLS_CC);
	}
	
	if (*tzi) {
		return SUCCESS;
	} else {
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Unknown or bad timezone (%s)", tz);
		return FAILURE;
	}
}

/* {{{ proto DateTimeZone timezone_open(string timezone)
   Returns new DateTimeZone object
*/
PHP_FUNCTION(timezone_open)
{
	char *tz;
	int   tz_len;
	timelib_tzinfo *tzi = NULL;
	php_timezone_obj *tzobj;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &tz, &tz_len) == FAILURE) {
		RETURN_FALSE;
	}
	if (SUCCESS != timezone_initialize(&tzi, tz TSRMLS_CC)) {
		RETURN_FALSE;
	}
	tzobj = zend_object_store_get_object(php_date_instantiate(date_ce_timezone, return_value TSRMLS_CC) TSRMLS_CC);
	tzobj->type = TIMELIB_ZONETYPE_ID;
	tzobj->tzi.tz = tzi;
	tzobj->initialized = 1;
}
/* }}} */

/* {{{ proto DateTimeZone::__construct(string timezone)
   Creates new DateTimeZone object.
*/
PHP_METHOD(DateTimeZone, __construct)
{
	char *tz;
	int tz_len;
	timelib_tzinfo *tzi = NULL;
	php_timezone_obj *tzobj;
	zend_error_handling error_handling;
	
	zend_replace_error_handling(EH_THROW, NULL, &error_handling TSRMLS_CC);
	if (SUCCESS == zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &tz, &tz_len)) {
		if (SUCCESS == timezone_initialize(&tzi, tz TSRMLS_CC)) {
			tzobj = zend_object_store_get_object(getThis() TSRMLS_CC);
			tzobj->type = TIMELIB_ZONETYPE_ID;
			tzobj->tzi.tz = tzi;
			tzobj->initialized = 1;
		} else {
			ZVAL_NULL(getThis());
		}
	}
	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

/* {{{ proto string timezone_name_get(DateTimeZone object)
   Returns the name of the timezone.
*/
PHP_FUNCTION(timezone_name_get)
{
	zval             *object;
	php_timezone_obj *tzobj;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "O", &object, date_ce_timezone) == FAILURE) {
		RETURN_FALSE;
	}
	tzobj = (php_timezone_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(tzobj->initialized, DateTimeZone);

	switch (tzobj->type) {
		case TIMELIB_ZONETYPE_ID:
			RETURN_STRING(tzobj->tzi.tz->name, 1);
			break;
		case TIMELIB_ZONETYPE_OFFSET: {
			char *tmpstr = emalloc(sizeof("UTC+05:00"));
			timelib_sll utc_offset = tzobj->tzi.utc_offset;

			snprintf(tmpstr, sizeof("+05:00"), "%c%02d:%02d",
				utc_offset > 0 ? '-' : '+',
				abs(utc_offset / 60),
				abs((utc_offset % 60)));

			RETURN_STRING(tmpstr, 0);
			}
			break;
		case TIMELIB_ZONETYPE_ABBR:
			RETURN_STRING(tzobj->tzi.z.abbr, 1);
			break;
	}
}
/* }}} */

/* {{{ proto string timezone_name_from_abbr(string abbr[, long gmtOffset[, long isdst]])
   Returns the timezone name from abbrevation
*/
PHP_FUNCTION(timezone_name_from_abbr)
{
	char    *abbr;
	char    *tzid;
	int      abbr_len;
	long     gmtoffset = -1;
	long     isdst = -1;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s|ll", &abbr, &abbr_len, &gmtoffset, &isdst) == FAILURE) {
		RETURN_FALSE;
	}
	tzid = timelib_timezone_id_from_abbr(abbr, gmtoffset, isdst);

	if (tzid) {
		RETURN_STRING(tzid, 1);
	} else {
		RETURN_FALSE;
	}
}
/* }}} */

/* {{{ proto long timezone_offset_get(DateTimeZone object, DateTime object)
   Returns the timezone offset.
*/
PHP_FUNCTION(timezone_offset_get)
{
	zval                *object, *dateobject;
	php_timezone_obj    *tzobj;
	php_date_obj        *dateobj;
	timelib_time_offset *offset;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "OO", &object, date_ce_timezone, &dateobject, date_ce_date) == FAILURE) {
		RETURN_FALSE;
	}
	tzobj = (php_timezone_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(tzobj->initialized, DateTimeZone);
	dateobj = (php_date_obj *) zend_object_store_get_object(dateobject TSRMLS_CC);
	DATE_CHECK_INITIALIZED(dateobj->time, DateTime);

	switch (tzobj->type) {
		case TIMELIB_ZONETYPE_ID:
			offset = timelib_get_time_zone_info(dateobj->time->sse, tzobj->tzi.tz);
			RETVAL_LONG(offset->offset);
			timelib_time_offset_dtor(offset);
			break;
		case TIMELIB_ZONETYPE_OFFSET:
			RETURN_LONG(tzobj->tzi.utc_offset * -60);
			break;
		case TIMELIB_ZONETYPE_ABBR:
			RETURN_LONG((tzobj->tzi.z.utc_offset - (tzobj->tzi.z.dst*60)) * -60);
			break;
	}
}
/* }}} */

/* {{{ proto array timezone_transitions_get(DateTimeZone object [, long timestamp_begin [, long timestamp_end ]])
   Returns numerically indexed array containing associative array for all transitions in the specified range for the timezone.
*/
PHP_FUNCTION(timezone_transitions_get)
{
	zval                *object, *element;
	php_timezone_obj    *tzobj;
	unsigned int         i, begin = 0, found;
	long                 timestamp_begin = LONG_MIN, timestamp_end = LONG_MAX;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "O|ll", &object, date_ce_timezone, &timestamp_begin, &timestamp_end) == FAILURE) {
		RETURN_FALSE;
	}
	tzobj = (php_timezone_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(tzobj->initialized, DateTimeZone);
	if (tzobj->type != TIMELIB_ZONETYPE_ID) {
		RETURN_FALSE;
	}

#define add_nominal() \
		MAKE_STD_ZVAL(element); \
		array_init(element); \
		add_assoc_long(element, "ts",     timestamp_begin); \
		add_assoc_string(element, "time", php_format_date(DATE_FORMAT_ISO8601, 13, timestamp_begin, 0 TSRMLS_CC), 0); \
		add_assoc_long(element, "offset", tzobj->tzi.tz->type[0].offset); \
		add_assoc_bool(element, "isdst",  tzobj->tzi.tz->type[0].isdst); \
		add_assoc_string(element, "abbr", &tzobj->tzi.tz->timezone_abbr[tzobj->tzi.tz->type[0].abbr_idx], 1); \
		add_next_index_zval(return_value, element);

#define add(i,ts) \
		MAKE_STD_ZVAL(element); \
		array_init(element); \
		add_assoc_long(element, "ts",     ts); \
		add_assoc_string(element, "time", php_format_date(DATE_FORMAT_ISO8601, 13, ts, 0 TSRMLS_CC), 0); \
		add_assoc_long(element, "offset", tzobj->tzi.tz->type[tzobj->tzi.tz->trans_idx[i]].offset); \
		add_assoc_bool(element, "isdst",  tzobj->tzi.tz->type[tzobj->tzi.tz->trans_idx[i]].isdst); \
		add_assoc_string(element, "abbr", &tzobj->tzi.tz->timezone_abbr[tzobj->tzi.tz->type[tzobj->tzi.tz->trans_idx[i]].abbr_idx], 1); \
		add_next_index_zval(return_value, element);

#define add_last() add(tzobj->tzi.tz->timecnt - 1, timestamp_begin)

	array_init(return_value);

	if (timestamp_begin == LONG_MIN) {
		add_nominal();
		begin = 0;
		found = 1;
	} else {
		begin = 0;
		found = 0;
		if (tzobj->tzi.tz->timecnt > 0) {
			do {
				if (tzobj->tzi.tz->trans[begin] > timestamp_begin) {
					if (begin > 0) {
						add(begin - 1, timestamp_begin);
					} else {
						add_nominal();
					}
					found = 1;
					break;
				}
				begin++;
			} while (begin < tzobj->tzi.tz->timecnt);
		}
	}

	if (!found) {
		if (tzobj->tzi.tz->timecnt > 0) {
			add_last();
		} else {
			add_nominal();
		}
	} else {
		for (i = begin; i < tzobj->tzi.tz->timecnt; ++i) {
			if (tzobj->tzi.tz->trans[i] < timestamp_end) {
				add(i, tzobj->tzi.tz->trans[i]);
			}
		}
	}
}
/* }}} */

/* {{{ proto array timezone_location_get()
   Returns location information for a timezone, including country code, latitude/longitude and comments
*/
PHP_FUNCTION(timezone_location_get)
{
	zval                *object;
	php_timezone_obj    *tzobj;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "O", &object, date_ce_timezone) == FAILURE) {
		RETURN_FALSE;
	}
	tzobj = (php_timezone_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(tzobj->initialized, DateTimeZone);
	if (tzobj->type != TIMELIB_ZONETYPE_ID) {
		RETURN_FALSE;
	}

	array_init(return_value);
	add_assoc_string(return_value, "country_code", tzobj->tzi.tz->location.country_code, 1);
	add_assoc_double(return_value, "latitude", tzobj->tzi.tz->location.latitude);
	add_assoc_double(return_value, "longitude", tzobj->tzi.tz->location.longitude);
	add_assoc_string(return_value, "comments", tzobj->tzi.tz->location.comments, 1);
}
/* }}} */

static int date_interval_initialize(timelib_rel_time **rt, /*const*/ char *format, int format_length TSRMLS_DC)
{
	timelib_time     *b = NULL, *e = NULL;
	timelib_rel_time *p = NULL;
	int               r = 0;
	int               retval = 0;
	struct timelib_error_container *errors;

	timelib_strtointerval(format, format_length, &b, &e, &p, &r, &errors);
	
	if (errors->error_count > 0) {
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Unknown or bad format (%s)", format);
		retval = FAILURE;
	} else {
		if(p) {
			*rt = p;
			retval = SUCCESS;
		} else {
			if(b && e) {
				timelib_update_ts(b, NULL);
				timelib_update_ts(e, NULL);
				*rt = timelib_diff(b, e);
				retval = SUCCESS;
			} else {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "Failed to parse interval (%s)", format);
				retval = FAILURE;
			}
		}
	}
	timelib_error_container_dtor(errors);
	return retval;
}

/* {{{ date_interval_read_property */
zval *date_interval_read_property(zval *object, zval *member, int type, const zend_literal *key TSRMLS_DC)
{
	php_interval_obj *obj;
	zval *retval;
	zval tmp_member;
	timelib_sll value = -1;

 	if (member->type != IS_STRING) {
		tmp_member = *member;
		zval_copy_ctor(&tmp_member);
		convert_to_string(&tmp_member);
		member = &tmp_member;
	}

	obj = (php_interval_obj *)zend_objects_get_address(object TSRMLS_CC);

#define GET_VALUE_FROM_STRUCT(n,m)            \
	if (strcmp(Z_STRVAL_P(member), m) == 0) { \
		value = obj->diff->n;                 \
		break;								  \
	}
	do {
		GET_VALUE_FROM_STRUCT(y, "y");
		GET_VALUE_FROM_STRUCT(m, "m");
		GET_VALUE_FROM_STRUCT(d, "d");
		GET_VALUE_FROM_STRUCT(h, "h");
		GET_VALUE_FROM_STRUCT(i, "i");
		GET_VALUE_FROM_STRUCT(s, "s");
		GET_VALUE_FROM_STRUCT(invert, "invert");
		GET_VALUE_FROM_STRUCT(days, "days");
		/* didn't find any */
		retval = (zend_get_std_object_handlers())->read_property(object, member, type, key TSRMLS_CC);

		if (member == &tmp_member) {
			zval_dtor(member);
		}

		return retval;
	} while(0);

	ALLOC_INIT_ZVAL(retval);
	Z_SET_REFCOUNT_P(retval, 0);

	ZVAL_LONG(retval, value);

	if (member == &tmp_member) {
		zval_dtor(member);
	}

	return retval;
}
/* }}} */

/* {{{ date_interval_write_property */
void date_interval_write_property(zval *object, zval *member, zval *value, const zend_literal *key TSRMLS_DC)
{
	php_interval_obj *obj;
	zval tmp_member, tmp_value;

 	if (member->type != IS_STRING) {
		tmp_member = *member;
		zval_copy_ctor(&tmp_member);
		convert_to_string(&tmp_member);
		member = &tmp_member;
	}
	obj = (php_interval_obj *)zend_objects_get_address(object TSRMLS_CC);

#define SET_VALUE_FROM_STRUCT(n,m)            \
	if (strcmp(Z_STRVAL_P(member), m) == 0) { \
		if (value->type != IS_LONG) {         \
			tmp_value = *value;               \
			zval_copy_ctor(&tmp_value);       \
			convert_to_long(&tmp_value);      \
			value = &tmp_value;               \
		}                                     \
		obj->diff->n = Z_LVAL_P(value);       \
		if (value == &tmp_value) {            \
			zval_dtor(value);                 \
		}                                     \
		break;								  \
	}

	do {
		SET_VALUE_FROM_STRUCT(y, "y");
		SET_VALUE_FROM_STRUCT(m, "m");
		SET_VALUE_FROM_STRUCT(d, "d");
		SET_VALUE_FROM_STRUCT(h, "h");
		SET_VALUE_FROM_STRUCT(i, "i");
		SET_VALUE_FROM_STRUCT(s, "s");
		SET_VALUE_FROM_STRUCT(invert, "invert");
		/* didn't find any */
		(zend_get_std_object_handlers())->write_property(object, member, value, key TSRMLS_CC);
	} while(0);

	if (member == &tmp_member) {
		zval_dtor(member);
	}
}
/* }}} */


/* {{{ proto DateInterval::__construct([string interval_spec])
   Creates new DateInterval object.
*/
PHP_METHOD(DateInterval, __construct)
{
	char *interval_string = NULL;
	int   interval_string_length;
	php_interval_obj *diobj;
	timelib_rel_time *reltime;
	zend_error_handling error_handling;
	
	zend_replace_error_handling(EH_THROW, NULL, &error_handling TSRMLS_CC);
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &interval_string, &interval_string_length) == SUCCESS) {
		if (date_interval_initialize(&reltime, interval_string, interval_string_length TSRMLS_CC) == SUCCESS) {
			diobj = zend_object_store_get_object(getThis() TSRMLS_CC);
			diobj->diff = reltime;
			diobj->initialized = 1;
		} else {
			ZVAL_NULL(getThis());
		}
	}
	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

/* {{{ proto DateInterval date_interval_create_from_date_string(string time)
   Uses the normal date parsers and sets up a DateInterval from the relative parts of the parsed string
*/
PHP_FUNCTION(date_interval_create_from_date_string)
{
	char           *time_str = NULL;
	int             time_str_len = 0;
	timelib_time   *time;
	timelib_error_container *err = NULL;
	php_interval_obj *diobj;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &time_str, &time_str_len) == FAILURE) {
		RETURN_FALSE;
	}

	php_date_instantiate(date_ce_interval, return_value TSRMLS_CC);

	time = timelib_strtotime(time_str, time_str_len, &err, DATE_TIMEZONEDB);
	diobj = (php_interval_obj *) zend_object_store_get_object(return_value TSRMLS_CC);
	diobj->diff = timelib_rel_time_clone(&time->relative);
	diobj->initialized = 1;
	timelib_time_dtor(time);
	timelib_error_container_dtor(err);
}
/* }}} */

/* {{{ date_interval_format -  */
static char *date_interval_format(char *format, int format_len, timelib_rel_time *t)
{
	smart_str            string = {0};
	int                  i, length, have_format_spec = 0;
	char                 buffer[33];

	if (!format_len) {
		return estrdup("");
	}

	for (i = 0; i < format_len; i++) {
		if (have_format_spec) {
			switch (format[i]) {
				case 'Y': length = slprintf(buffer, 32, "%02d", (int) t->y); break;
				case 'y': length = slprintf(buffer, 32, "%d", (int) t->y); break;

				case 'M': length = slprintf(buffer, 32, "%02d", (int) t->m); break;
				case 'm': length = slprintf(buffer, 32, "%d", (int) t->m); break;

				case 'D': length = slprintf(buffer, 32, "%02d", (int) t->d); break;
				case 'd': length = slprintf(buffer, 32, "%d", (int) t->d); break;

				case 'H': length = slprintf(buffer, 32, "%02d", (int) t->h); break;
				case 'h': length = slprintf(buffer, 32, "%d", (int) t->h); break;

				case 'I': length = slprintf(buffer, 32, "%02d", (int) t->i); break;
				case 'i': length = slprintf(buffer, 32, "%d", (int) t->i); break;

				case 'S': length = slprintf(buffer, 32, "%02d", (int) t->s); break;
				case 's': length = slprintf(buffer, 32, "%d", (int) t->s); break;

				case 'a': {
					if ((int) t->days != -99999) {
						length = slprintf(buffer, 32, "%d", (int) t->days);
					} else {
						length = slprintf(buffer, 32, "(unknown)");
					}
				} break;
				case 'r': length = slprintf(buffer, 32, "%s", t->invert ? "-" : ""); break;
				case 'R': length = slprintf(buffer, 32, "%c", t->invert ? '-' : '+'); break;

				case '%': length = slprintf(buffer, 32, "%%"); break;
				default: buffer[0] = '%'; buffer[1] = format[i]; buffer[2] = '\0'; length = 2; break;
			}
			smart_str_appendl(&string, buffer, length);
			have_format_spec = 0;
		} else {
			if (format[i] == '%') {
				have_format_spec = 1;
			} else {
				smart_str_appendc(&string, format[i]);
			}
		}
	}

	smart_str_0(&string);

	return string.c;
}
/* }}} */

/* {{{ proto string date_interval_format(DateInterval object, string format)
   Formats the interval.
*/
PHP_FUNCTION(date_interval_format)
{
	zval             *object;
	php_interval_obj *diobj;
	char             *format;
	int               format_len;

	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Os", &object, date_ce_interval, &format, &format_len) == FAILURE) {
		RETURN_FALSE;
	}
	diobj = (php_interval_obj *) zend_object_store_get_object(object TSRMLS_CC);
	DATE_CHECK_INITIALIZED(diobj->initialized, DateInterval);

	RETURN_STRING(date_interval_format(format, format_len, diobj->diff), 0);
}
/* }}} */

static int date_period_initialize(timelib_time **st, timelib_time **et, timelib_rel_time **d, long *recurrences, /*const*/ char *format, int format_length TSRMLS_DC)
{
	timelib_time     *b = NULL, *e = NULL;
	timelib_rel_time *p = NULL;
	int               r = 0;
	int               retval = 0;
	struct timelib_error_container *errors;

	timelib_strtointerval(format, format_length, &b, &e, &p, &r, &errors);
	
	if (errors->error_count > 0) {
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Unknown or bad format (%s)", format);
		retval = FAILURE;
	} else {
		*st = b;
		*et = e;
		*d  = p;
		*recurrences = r;
		retval = SUCCESS;
	}
	timelib_error_container_dtor(errors);
	return retval;
}

/* {{{ proto DatePeriod::__construct(DateTime $start, DateInterval $interval, int recurrences|DateTime $end)
   Creates new DatePeriod object.
*/
PHP_METHOD(DatePeriod, __construct)
{
	php_period_obj   *dpobj;
	php_date_obj     *dateobj;
	php_interval_obj *intobj;
	zval *start, *end = NULL, *interval;
	long  recurrences = 0, options = 0;
	char *isostr = NULL;
	int   isostr_len = 0;
	timelib_time *clone;
	zend_error_handling error_handling;
	
	zend_replace_error_handling(EH_THROW, NULL, &error_handling TSRMLS_CC);
	if (zend_parse_parameters_ex(ZEND_PARSE_PARAMS_QUIET, ZEND_NUM_ARGS() TSRMLS_CC, "OOl|l", &start, date_ce_date, &interval, date_ce_interval, &recurrences, &options) == FAILURE) {
		if (zend_parse_parameters_ex(ZEND_PARSE_PARAMS_QUIET, ZEND_NUM_ARGS() TSRMLS_CC, "OOO|l", &start, date_ce_date, &interval, date_ce_interval, &end, date_ce_date, &options) == FAILURE) {
			if (zend_parse_parameters_ex(ZEND_PARSE_PARAMS_QUIET, ZEND_NUM_ARGS() TSRMLS_CC, "s|l", &isostr, &isostr_len, &options) == FAILURE) {
				php_error_docref(NULL TSRMLS_CC, E_WARNING, "This constructor accepts either (DateTime, DateInterval, int) OR (DateTime, DateInterval, DateTime) OR (string) as arguments.");
				zend_restore_error_handling(&error_handling TSRMLS_CC);
				return;
			}
		}
	}

	dpobj = zend_object_store_get_object(getThis() TSRMLS_CC);
	dpobj->current = NULL;

	if (isostr_len) {
		date_period_initialize(&(dpobj->start), &(dpobj->end), &(dpobj->interval), &recurrences, isostr, isostr_len TSRMLS_CC);
		if (dpobj->start == NULL) {
			php_error_docref(NULL TSRMLS_CC, E_WARNING, "The ISO interval '%s' did not contain a start date.", isostr);
		}
		if (dpobj->interval == NULL) {
			php_error_docref(NULL TSRMLS_CC, E_WARNING, "The ISO interval '%s' did not contain an interval.", isostr);
		}
		if (dpobj->end == NULL && recurrences == 0) {
			php_error_docref(NULL TSRMLS_CC, E_WARNING, "The ISO interval '%s' did not contain an end date or a recurrence count.", isostr);
		}

		if (dpobj->start) {
			timelib_update_ts(dpobj->start, NULL);
		}
		if (dpobj->end) {
			timelib_update_ts(dpobj->end, NULL);
		}
	} else {
		/* init */
		intobj  = (php_interval_obj *) zend_object_store_get_object(interval TSRMLS_CC);

		/* start date */
		dateobj = (php_date_obj *) zend_object_store_get_object(start TSRMLS_CC);
		clone = timelib_time_ctor();
		memcpy(clone, dateobj->time, sizeof(timelib_time));
		if (dateobj->time->tz_abbr) {
			clone->tz_abbr = strdup(dateobj->time->tz_abbr);
		}
		if (dateobj->time->tz_info) {
			clone->tz_info = dateobj->time->tz_info;
		}
		dpobj->start = clone;

		/* interval */
		dpobj->interval = timelib_rel_time_clone(intobj->diff);

		/* end date */
		if (end) {
			dateobj = (php_date_obj *) zend_object_store_get_object(end TSRMLS_CC);
			clone = timelib_time_clone(dateobj->time);
			dpobj->end = clone;
		}
	}

	/* options */
	dpobj->include_start_date = !(options & PHP_DATE_PERIOD_EXCLUDE_START_DATE);

	/* recurrrences */
	dpobj->recurrences = recurrences + dpobj->include_start_date;

	dpobj->initialized = 1;

	zend_restore_error_handling(&error_handling TSRMLS_CC);
}
/* }}} */

static int check_id_allowed(char *id, long what)
{
	if (what & PHP_DATE_TIMEZONE_GROUP_AFRICA     && strncasecmp(id, "Africa/",      7) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_AMERICA    && strncasecmp(id, "America/",     8) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_ANTARCTICA && strncasecmp(id, "Antarctica/", 11) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_ARCTIC     && strncasecmp(id, "Arctic/",      7) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_ASIA       && strncasecmp(id, "Asia/",        5) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_ATLANTIC   && strncasecmp(id, "Atlantic/",    9) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_AUSTRALIA  && strncasecmp(id, "Australia/",  10) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_EUROPE     && strncasecmp(id, "Europe/",      7) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_INDIAN     && strncasecmp(id, "Indian/",      7) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_PACIFIC    && strncasecmp(id, "Pacific/",     8) == 0) return 1;
	if (what & PHP_DATE_TIMEZONE_GROUP_UTC        && strncasecmp(id, "UTC",          3) == 0) return 1;
	return 0;
}

/* {{{ proto array timezone_identifiers_list([long what[, string country]])
   Returns numerically index array with all timezone identifiers.
*/
PHP_FUNCTION(timezone_identifiers_list)
{
	const timelib_tzdb             *tzdb;
	const timelib_tzdb_index_entry *table;
	int                             i, item_count;
	long                            what = PHP_DATE_TIMEZONE_GROUP_ALL;
	char                           *option = NULL;
	int                             option_len = 0;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "|ls", &what, &option, &option_len) == FAILURE) {
		RETURN_FALSE;
	}

	/* Extra validation */
	if (what == PHP_DATE_TIMEZONE_PER_COUNTRY && option_len != 2) {
		php_error_docref(NULL TSRMLS_CC, E_NOTICE, "A two-letter ISO 3166-1 compatible country code is expected");
		RETURN_FALSE;
	}

	tzdb = DATE_TIMEZONEDB;
	item_count = tzdb->index_size;
	table = tzdb->index;
	
	array_init(return_value);

	for (i = 0; i < item_count; ++i) {
		if (what == PHP_DATE_TIMEZONE_PER_COUNTRY) {
			if (tzdb->data[table[i].pos + 5] == option[0] && tzdb->data[table[i].pos + 6] == option[1]) {
				add_next_index_string(return_value, table[i].id, 1);
			}
		} else if (what == PHP_DATE_TIMEZONE_GROUP_ALL_W_BC || (check_id_allowed(table[i].id, what) && (tzdb->data[table[i].pos + 4] == '\1'))) {
			add_next_index_string(return_value, table[i].id, 1);
		}
	};
}
/* }}} */

/* {{{ proto array timezone_version_get()
   Returns the Olson database version number.
*/
PHP_FUNCTION(timezone_version_get)
{
	const timelib_tzdb *tzdb;

	tzdb = DATE_TIMEZONEDB;
	RETURN_STRING(tzdb->version, 1);
}
/* }}} */

/* {{{ proto array timezone_abbreviations_list()
   Returns associative array containing dst, offset and the timezone name
*/
PHP_FUNCTION(timezone_abbreviations_list)
{
	const timelib_tz_lookup_table *table, *entry;
	zval                          *element, **abbr_array_pp, *abbr_array;
	
	table = timelib_timezone_abbreviations_list();
	array_init(return_value);
	entry = table;

	do {
		MAKE_STD_ZVAL(element);
		array_init(element);
		add_assoc_bool(element, "dst", entry->type);
		add_assoc_long(element, "offset", entry->gmtoffset);
		if (entry->full_tz_name) {
			add_assoc_string(element, "timezone_id", entry->full_tz_name, 1);
		} else {
			add_assoc_null(element, "timezone_id");
		}

		if (zend_hash_find(HASH_OF(return_value), entry->name, strlen(entry->name) + 1, (void **) &abbr_array_pp) == FAILURE) {
			MAKE_STD_ZVAL(abbr_array);
			array_init(abbr_array);
			add_assoc_zval(return_value, entry->name, abbr_array);
		} else {
			abbr_array = *abbr_array_pp;
		}
		add_next_index_zval(abbr_array, element);
		entry++;
	} while (entry->name);
}
/* }}} */

/* {{{ proto bool date_default_timezone_set(string timezone_identifier)
   Sets the default timezone used by all date/time functions in a script */
PHP_FUNCTION(date_default_timezone_set)
{
	char *zone;
	int   zone_len;

	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "s", &zone, &zone_len) == FAILURE) {
		RETURN_FALSE;
	}
	if (!timelib_timezone_id_is_valid(zone, DATE_TIMEZONEDB)) {
		php_error_docref(NULL TSRMLS_CC, E_NOTICE, "Timezone ID '%s' is invalid", zone);
		RETURN_FALSE;
	}
	if (DATEG(timezone)) {
		efree(DATEG(timezone));
		DATEG(timezone) = NULL;
	}
	DATEG(timezone) = estrndup(zone, zone_len);
	RETURN_TRUE;
}
/* }}} */

/* {{{ proto string date_default_timezone_get()
   Gets the default timezone used by all date/time functions in a script */
PHP_FUNCTION(date_default_timezone_get)
{
	timelib_tzinfo *default_tz;

	default_tz = get_timezone_info(TSRMLS_C);
	RETVAL_STRING(default_tz->name, 1);
}
/* }}} */

/* {{{ php_do_date_sunrise_sunset
 *  Common for date_sunrise() and date_sunset() functions
 */
static void php_do_date_sunrise_sunset(INTERNAL_FUNCTION_PARAMETERS, int calc_sunset)
{
	double latitude = 0.0, longitude = 0.0, zenith = 0.0, gmt_offset = 0, altitude;
	double h_rise, h_set, N;
	timelib_sll rise, set, transit;
	long time, retformat = 0;
	int             rs;
	timelib_time   *t;
	timelib_tzinfo *tzi;
	char           *retstr;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "l|ldddd", &time, &retformat, &latitude, &longitude, &zenith, &gmt_offset) == FAILURE) {
		RETURN_FALSE;
	}
	
	switch (ZEND_NUM_ARGS()) {
		case 1:
			retformat = SUNFUNCS_RET_STRING;
		case 2:
			latitude = INI_FLT("date.default_latitude");
		case 3:
			longitude = INI_FLT("date.default_longitude");
		case 4:
			if (calc_sunset) {
				zenith = INI_FLT("date.sunset_zenith");
			} else {
				zenith = INI_FLT("date.sunrise_zenith");
			}
		case 5:
		case 6:
			break;
		default:
			php_error_docref(NULL TSRMLS_CC, E_WARNING, "invalid format");
			RETURN_FALSE;
			break;
	}
	if (retformat != SUNFUNCS_RET_TIMESTAMP &&
		retformat != SUNFUNCS_RET_STRING &&
		retformat != SUNFUNCS_RET_DOUBLE)
	{
		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Wrong return format given, pick one of SUNFUNCS_RET_TIMESTAMP, SUNFUNCS_RET_STRING or SUNFUNCS_RET_DOUBLE");
		RETURN_FALSE;
	}
	altitude = 90 - zenith;

	/* Initialize time struct */
	t = timelib_time_ctor();
	tzi = get_timezone_info(TSRMLS_C);
	t->tz_info = tzi;
	t->zone_type = TIMELIB_ZONETYPE_ID;

	if (ZEND_NUM_ARGS() <= 5) {
		gmt_offset = timelib_get_current_offset(t) / 3600;
	}

	timelib_unixtime2local(t, time);
	rs = timelib_astro_rise_set_altitude(t, longitude, latitude, altitude, 1, &h_rise, &h_set, &rise, &set, &transit);
	timelib_time_dtor(t);
	
	if (rs != 0) {
		RETURN_FALSE;
	}

	if (retformat == SUNFUNCS_RET_TIMESTAMP) {
		RETURN_LONG(calc_sunset ? set : rise);
	}
	N = (calc_sunset ? h_set : h_rise) + gmt_offset;

	if (N > 24 || N < 0) {
		N -= floor(N / 24) * 24;
	}

	switch (retformat) {
		case SUNFUNCS_RET_STRING:
			spprintf(&retstr, 0, "%02d:%02d", (int) N, (int) (60 * (N - (int) N)));
			RETURN_STRINGL(retstr, 5, 0);
			break;
		case SUNFUNCS_RET_DOUBLE:
			RETURN_DOUBLE(N);
			break;
	}
}
/* }}} */

/* {{{ proto mixed date_sunrise(mixed time [, int format [, float latitude [, float longitude [, float zenith [, float gmt_offset]]]]])
   Returns time of sunrise for a given day and location */
PHP_FUNCTION(date_sunrise)
{
	php_do_date_sunrise_sunset(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);
}
/* }}} */

/* {{{ proto mixed date_sunset(mixed time [, int format [, float latitude [, float longitude [, float zenith [, float gmt_offset]]]]])
   Returns time of sunset for a given day and location */
PHP_FUNCTION(date_sunset)
{
	php_do_date_sunrise_sunset(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);
}
/* }}} */

/* {{{ proto array date_sun_info(long time, float latitude, float longitude)
   Returns an array with information about sun set/rise and twilight begin/end */
PHP_FUNCTION(date_sun_info)
{
	long            time;
	double          latitude, longitude;
	timelib_time   *t, *t2;
	timelib_tzinfo *tzi;
	int             rs;
	timelib_sll     rise, set, transit;
	int             dummy;
	double          ddummy;
	
	if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "ldd", &time, &latitude, &longitude) == FAILURE) {
		RETURN_FALSE;
	}
	/* Initialize time struct */
	t = timelib_time_ctor();
	tzi = get_timezone_info(TSRMLS_C);
	t->tz_info = tzi;
	t->zone_type = TIMELIB_ZONETYPE_ID;
	timelib_unixtime2local(t, time);

	/* Setup */
	t2 = timelib_time_ctor();
	array_init(return_value);
	
	/* Get sun up/down and transit */
	rs = timelib_astro_rise_set_altitude(t, longitude, latitude, -35.0/60, 1, &ddummy, &ddummy, &rise, &set, &transit);
	switch (rs) {
		case -1: /* always below */
			add_assoc_bool(return_value, "sunrise", 0);
			add_assoc_bool(return_value, "sunset", 0);
			break;
		case 1: /* always above */
			add_assoc_bool(return_value, "sunrise", 1);
			add_assoc_bool(return_value, "sunset", 1);
			break;
		default:
			t2->sse = rise;
			add_assoc_long(return_value, "sunrise", timelib_date_to_int(t2, &dummy));
			t2->sse = set;
			add_assoc_long(return_value, "sunset", timelib_date_to_int(t2, &dummy));
	}
	t2->sse = transit;
	add_assoc_long(return_value, "transit", timelib_date_to_int(t2, &dummy));

	/* Get civil twilight */
	rs = timelib_astro_rise_set_altitude(t, longitude, latitude, -6.0, 0, &ddummy, &ddummy, &rise, &set, &transit);
	switch (rs) {
		case -1: /* always below */
			add_assoc_bool(return_value, "civil_twilight_begin", 0);
			add_assoc_bool(return_value, "civil_twilight_end", 0);
			break;
		case 1: /* always above */
			add_assoc_bool(return_value, "civil_twilight_begin", 1);
			add_assoc_bool(return_value, "civil_twilight_end", 1);
			break;
		default:
			t2->sse = rise;
			add_assoc_long(return_value, "civil_twilight_begin", timelib_date_to_int(t2, &dummy));
			t2->sse = set;
			add_assoc_long(return_value, "civil_twilight_end", timelib_date_to_int(t2, &dummy));
	}

	/* Get nautical twilight */
	rs = timelib_astro_rise_set_altitude(t, longitude, latitude, -12.0, 0, &ddummy, &ddummy, &rise, &set, &transit);
	switch (rs) {
		case -1: /* always below */
			add_assoc_bool(return_value, "nautical_twilight_begin", 0);
			add_assoc_bool(return_value, "nautical_twilight_end", 0);
			break;
		case 1: /* always above */
			add_assoc_bool(return_value, "nautical_twilight_begin", 1);
			add_assoc_bool(return_value, "nautical_twilight_end", 1);
			break;
		default:
			t2->sse = rise;
			add_assoc_long(return_value, "nautical_twilight_begin", timelib_date_to_int(t2, &dummy));
			t2->sse = set;
			add_assoc_long(return_value, "nautical_twilight_end", timelib_date_to_int(t2, &dummy));
	}

	/* Get astronomical twilight */
	rs = timelib_astro_rise_set_altitude(t, longitude, latitude, -18.0, 0, &ddummy, &ddummy, &rise, &set, &transit);
	switch (rs) {
		case -1: /* always below */
			add_assoc_bool(return_value, "astronomical_twilight_begin", 0);
			add_assoc_bool(return_value, "astronomical_twilight_end", 0);
			break;
		case 1: /* always above */
			add_assoc_bool(return_value, "astronomical_twilight_begin", 1);
			add_assoc_bool(return_value, "astronomical_twilight_end", 1);
			break;
		default:
			t2->sse = rise;
			add_assoc_long(return_value, "astronomical_twilight_begin", timelib_date_to_int(t2, &dummy));
			t2->sse = set;
			add_assoc_long(return_value, "astronomical_twilight_end", timelib_date_to_int(t2, &dummy));
	}
	timelib_time_dtor(t);
	timelib_time_dtor(t2);
}
/* }}} */
/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * End:
 * vim600: fdm=marker
 * vim: noet sw=4 ts=4
 */
